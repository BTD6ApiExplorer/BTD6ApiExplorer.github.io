let leaderboardNext,leaderboardType,oak_token="",btd6usersave={},_btd6usersave={},btd6publicprofile={},_btd6publicprofile={},racesData=null,leaderboardData=null,leaderboardLink=null,leaderboardPage=1,leaderboardPageEntryCount=null,localStorageOAK={},refreshRateLimited=!1,profileCache={},bossesData=null,CTData=null,DCData=null,challengesCache={},browserData=null,browserLink=null,browserPage=1,browserPageEntryCount=null,browserFilter="newest",cacheBust=!1,isErrorModalOpen=!1,customMapsCache={},rateLimited=!1,preventRateLimiting=!1,maxRequests=100,baseInterval=200,requestCount=0,completedRequests=0,lastResetTime=Date.now(),requestQueue=[],isProcessing=!1,leaderboardCache={},leaderboardMetadata={},leaderboardActiveToken=0,racesDataCachedAt=null,bossesDataCachedAt=null,CTDataCachedAt=null,challengesDataCachedAt=null,latestEvents=null;const TIMEOUT_TTL=6e5,isStale=e=>!e||Date.now()-e>6e5;function addRequestToQueue(e,t){requestQueue.push({id:e,request:t}),isProcessing||processRequestQueue()}function removeRequestFromQueue(e){requestQueue=requestQueue.filter((t=>t.id!==e))}function calculateDelay(){const e=requestCount/(maxRequests/2);return baseInterval+baseInterval*Math.pow(e,2)}async function processRequestQueue(){isProcessing||(isProcessing=!0,function e(){if(0===requestQueue.length)return void(isProcessing=!1);const t=Date.now();if(t-lastResetTime>=18e4&&(requestCount=0,lastResetTime=t),requestCount<maxRequests){const e=requestQueue.shift();requestCount++,e.request()}const a=calculateDelay();setTimeout(e,a)}())}async function fetchData(e,t){let a=null;try{cacheBust?(a=await fetch(e,{cache:"reload"}),cacheBust=!1,rateLimited=!1):(a=await fetch(e),rateLimited=!1)}catch(e){return navigator.onLine?(rateLimited=!0,requestQueue=[],hideLoading(),pressedStart=!1,`You have hit the rate limit. [${e}]`):(errorModal("You are currently offline. Please check your internet connection.","api"),`You are currently offline. [${e}]`)}try{let e=await a.json();return 1==e.success?t(e):"Rate limit"==e.reason?(isErrorModalOpen=!0,errorModal("You have hit the rate limit. Please try again later.","api")):(document.getElementById("loading").style.transform="scale(0)",pressedStart=!1,errorModal(e.error,"api")),e}catch(e){return errorModal(`Something went wrong with the request. Response Code: ${a.status} [${e}]`,"api"),`Something went wrong with the request. Response Code: ${a.status} [${e}]`}}async function getSaveData(e){cacheBust=!0;let t=!0,a=new Promise((async(a,n)=>{await fetchData(`https://data.ninjakiwi.com/btd6/save/${e}`,(e=>{btd6usersave=e.body,_btd6usersave=e.model,readyFlags[0]=1,t=!1,a()}))}));if(await a,t&&!rateLimited){let t=document.getElementsByClassName("error-modal-overlay");for(element of t)element.parentNode.removeChild(element);return delete localStorageOAK[e],writeLocalStorage(),void errorModal("Your Open Access Key has expired. Please make a new one and try again.","expire",!0)}await getPublicProfileData(e)}async function getPublicProfileData(e){return cacheBust=!0,new Promise(((t,a)=>{fetchData(`https://data.ninjakiwi.com/btd6/users/${e}`,(a=>{btd6publicprofile=a.body,_btd6publicprofile=a.model,localStorageOAK[e]={displayName:btd6publicprofile.displayName,avatar:getProfileAvatar(btd6publicprofile),banner:getProfileBanner(btd6publicprofile)},writeLocalStorage(),readyFlags[1]=1,t()}))}))}async function getRacesData(){null==racesData||isStale(racesDataCachedAt)?await fetchData("https://data.ninjakiwi.com/btd6/races",(e=>{racesData=e.body,racesDataCachedAt=Date.now(),generateRaces()})):generateRaces(),addToBackQueue({callback:generateEvents})}async function getRaceMetadata(e){return racesData&&racesData[e]&&"string"==typeof racesData[e].metadata?fetchData(racesData[e].metadata,(t=>(racesData[e].metadata=t.body,racesData[e]))):racesData[e]}async function getLeaderboardData(){return leaderboardLink?(leaderboardData=null,fetchData(`${leaderboardLink}?page=${leaderboardPage}`,(e=>(leaderboardData=e.body,leaderboardPageEntryCount=leaderboardData.length,document.getElementById("leaderboard-footer-page-number").innerHTML=`Page ${leaderboardPage} (#${leaderboardPage*leaderboardPageEntryCount-(leaderboardPageEntryCount-1)} - ${leaderboardPage*leaderboardPageEntryCount})`,leaderboardData)))):errorModal("Leaderboard Fetch Error: No leaderboard data found")}async function getAllLeaderboardData(e){return null==e&&(e=leaderboardLink),requestQueue=[],(null==leaderboardCache[leaderboardLink]||leaderboardCache[leaderboardLink]._cachedAt&&Date.now()-leaderboardCache[leaderboardLink]._cachedAt>6e5)&&(leaderboardCache[leaderboardLink]={entries:[],_cachedAt:Date.now()},getLeaderboardPage(e)),leaderboardCache[leaderboardLink]}async function getLeaderboardPage(e,t=leaderboardActiveToken){null!=e&&(leaderboardCache[leaderboardLink].nextRequested||(requestCount++,await fetchData(e,(a=>{t===leaderboardActiveToken&&(leaderboardCache[leaderboardLink].entries=leaderboardCache[leaderboardLink].entries.concat(a.body),leaderboardCache[leaderboardLink]._cachedAt=Date.now(),leaderboardCache[leaderboardLink].hasOwnProperty("entryPerPage")||(leaderboardCache[leaderboardLink].entryPerPage=a.body.length),addLeaderboardEntries(a.body,isNaN(e.split("=")[1])?1:parseInt(e.split("=")[1]),leaderboardCache[leaderboardLink].entryPerPage?leaderboardCache[leaderboardLink].entryPerPage:a.body.length),leaderboardCache[leaderboardLink].next=a.next,leaderboardCache[leaderboardLink].nextRequested=!1)}))))}async function getBossesData(){null==bossesData||isStale(bossesDataCachedAt)?await fetchData("https://data.ninjakiwi.com/btd6/bosses",(e=>{bossesData=e.body,bossesDataCachedAt=Date.now(),generateBosses(showElite)})):generateBosses(showElite),addToBackQueue({callback:generateEvents})}async function getBossMetadata(e,t){return bossesData&&bossesData[e]&&"string"==typeof bossesData[e][t?"metadataElite":"metadataStandard"]?fetchData(bossesData[e][t?"metadataElite":"metadataStandard"],(a=>(bossesData[e][t?"metadataElite":"metadataStandard"]=a.body,bossesData[e]))):bossesData[e]}async function getCTData(){null==CTData||isStale(CTDataCachedAt)?await fetchData("https://data.ninjakiwi.com/btd6/ct",(e=>{CTData=e.body,CTDataCachedAt=Date.now(),generateCTs()})):generateCTs(),addToBackQueue({callback:generateEvents})}async function getCTTiles(e){let t=null;return await fetchData(e,(e=>(t=e.body,t))),t}async function getDailyChallengesData(){if(null!=DCData&&!isStale(challengesDataCachedAt))return addToBackQueue({callback:generateEvents}),DCData;await fetchData("https://data.ninjakiwi.com/btd6/challenges/filter/daily",(e=>(DCData=e.body,addToBackQueue({callback:generateEvents}),challengesDataCachedAt=Date.now(),DCData)))}async function getChallengeMetadata(e){return(null==challengesCache[e]||isStale(challengesCache[e]._cachedAt))&&await fetchData(`https://data.ninjakiwi.com/btd6/challenges/challenge/${e}`,(t=>(challengesCache[e]=t.body,challengesCache[e]._cachedAt=Date.now(),challengesCache[e]))),challengesCache[e]}async function getBrowserData(){return browserLink?(browserData=null,fetchData(`${browserLink}${browserFilter}?page=${browserPage}`,(e=>(browserData=e.body,browserPageEntryCount=browserData.length,document.getElementById("browser-footer-page-number").innerHTML=`Page ${browserPage} of 4`,leaderboardData)))):errorModal("Content Browser Fetch Error: No data found")}async function getUserProfile(e){let t=e.split("/").pop();return null==profileCache[t]&&await fetchData(e,(e=>{profileCache[t]={...e.body,_cachedAt:Date.now()}})),profileCache[t]}async function getCustomMapMetadata(e){return null==customMapsCache[e]&&await fetchData(`https://data.ninjakiwi.com/btd6/maps/map/${e}`,(t=>(customMapsCache[e]=t.body,customMapsCache[e]))),customMapsCache[e]}async function getLatestEvents(){return null==latestEvents&&await fetchData("https://data.ninjakiwi.com/btd6/events",(e=>{latestEvents=e.body})),latestEvents}async function getLatestCollectionEvent(){let e=await getLatestEvents();console.log(e);for(let t of e)if("collectableEvent"==t.type)return console.log(t),console.log(processCollectionEvent(t)),t;return null}function readLocalStorage(){null!=localStorage.getItem("BTD6OAKStorage")&&(localStorageOAK=JSON.parse(localStorage.getItem("BTD6OAKStorage")))}function writeLocalStorage(){localStorage.setItem("BTD6OAKStorage",JSON.stringify(localStorageOAK))}function challengeIdToDate(e){e.substring(0,3),parseInt(e.substring(3,7));let t=e.substring(7);return[parseInt(t.substring(0,4)),parseInt(t.substring(4,6)),parseInt(t.substring(6,8))]}function getChallengeIdFromInt(e,t){let a=new Date(2024,4,25),n=(t?2101:2114)-parseInt(e);return a.setDate(a.getDate()-n),(t?"adv":"rot")+e+a.toISOString().substring(0,10).replace(/-/g,"")}function getChallengeIDFromDate(e,t){let a=new Date(e),n=new Date(2024,4,25).getTime()-a.getTime();return(t?"adv":"rot")+((t?2101:2114)-Math.floor(n/864e5))+e.replace(/-/g,"")}function clearProfileRequestQueue(){requestQueue=[],isProcessing=!1}processRequestQueue();const achievementNameFixMap={Clicker:"Bloons Master","Superior Clicker":"Superior Bloons Master","Ultimate Clicker":"Ultimate Bloons Master","Knowledgable Primate":"Knowledgeable Primate","Triple Threat":"Triple threat","Small Bloons":"Alchermistman and Bloonacleboy","Master of Life":"Master of life","What did it cost":"What did it cost? - Everything","2 Mega Pops":"2 MegaPops","Looking fab":"Lookin fab",GoldenTicket:"Golden Ticket","Axis of Havok":"Axis of Havoc","Co-op Popper!":"Co-op Popper",CouponCrazy:"Coupon Crazy",LimitedRun:"Limited Run",ALaCode:"A La Code",InstantGratification:"Instant Gratification","Achievement Of Achievements":"Achievement of Achievements","What is this new Bloonery":"What is this new Bloonery?","Who's the Boss":"Who's the Boss?","I'llBeBack":"I'll Be Back",SoSpiiiceyNinjaKiwi:"So Spiiicey Ninja Kiwi",DavidsVsGoliath:"Davids vs Goliath",ToolsToDarwin:"Tools to Darwin",BigSpender:"Big Spender",NotLackingCriticalInformation:"Not Lacking Critical Information",StubbornStrategy:"Stubborn Strategy","Hook Line And Sinker":"Hook, Line, and Sinker",CrashOfTheTitans:"Crash of the Titans","So Shiny":"So Shiny!","Ultimate Team Up":"Ultimate Team-up",StudentLoans:"Student Loans",StickySituation:"Sticky Situation",NoHarvest:"No Harvest",ReadyPlayerOne:"Ready Player One?",TheDailyReid:"The Daily Reid",InstaCentury:"Insta Century"},reverseAchievementNameFixMap=Object.entries(achievementNameFixMap).reduce(((e,[t,a])=>(e[a]=t,e)),{}),skinNameFixMap={ObynOceanGuardian:"OceanObyn",MoltenObyn:"MountainObyn",JoanOfArcAdora:"JoanOfArc",CyberQuincy:"QuincyCyber",ETnEtienne:"ETn",SentaiCaptainChurchill:"SentaiChurchill",SleighCaptainChurchill:"SleighChurchill",TinkerfairyRosalia:"RosaliaTinkerfairy"},upgradeNameFixMap={Spikeopult:"Spike-o-pult",BuccaneerLongRange:"LongRange",BuccaneerGrapeShot:"GrapeShot",BuccaneerCrowsNest:"CrowsNest",BuccaneerHotShot:"HotShot",BuccaneerCarrierFlagship:"CarrierFlagship",BuccaneerCannonShip:"CannonShip",BuccaneerMerchantman:"Merchantman",BuccaneerFavoredTrades:"FavoredTrades",BuccaneerAircraftCarrier:"AircraftCarrier",BuccaneerDestroyer:"Destroyer",BuccaneerTradeEmpire:"TradeEmpire",BuccaneerPirateLord:"PirateLord",BuccaneerMonkeyPirates:"MonkeyPirates",HeattippedDarts:"HeatTippedDart",BioncBoomerang:"BionicBoomerang",LargeCalibre:"LongCalibre",LaserBlasts:"LaserBlast",GuidedMagic:"GuildedMagic",MortarRapidReload:"RapidReload",SupplyDrop:"CashDrop",PlasmaBlasts:"PlasmaBlast",XXXLTrap:"XXXL",OversizeNails:"OversizedNails",CenteredPath:"FlightOrders",Shockwave:"ShellShock",Monkeyopolis:"Metropolis",Spectre:"Specter",TrueSunGod:"TrueSonGod",HydraRocketPods:"HydraRockets",DartMonkeyParagon:"ApexPlasmaMaster",BoomerangMonkeyParagon:"GlaiveDominus",NinjaMonkeyParagon:"AscendedShadow",EngineerMonkeyParagon:"MasterBuilder",WizardMonkeyParagon:"MagusPerfectus",MonkeyAceParagon:"GoliathDoomship",MonkeyBuccaneerParagon:"NavarchOfTheSeas",MonkeySubParagon:"NauticSiegeCore",SmartSpikes:"DirectedSpikes",TackShooterParagon:"CycloneOfFireAndMetal"};let locJSONOverrides={"Directed Spikes":"Smart Spikes","Directed Spikes Description":"Smart Spikes Description",CircusGwendolinSkinName:"HarlegwenGwendolinSkinName",CircusGwendolinSkinDescription:"HarlegwenGwendolinSkinDescription",OctoJonesSkinName:"OctoJonesStrikerJonesSkinName",OctoJonesSkinDescription:"OctoJonesStrikerJonesSkinDescription",MoltenObynSkinName:"ObynMountainGuardianSkinName",MoltenObynSkinDescription:"ObynMountainGuardianSkinDescription",SushiBentoSkinName:"SushiBentoBenjaminSkinName",SushiBentoSkinDescription:"SushiBentoBenjaminSkinDescription",KaijuPatSkinName:"KaijuPatFustySkinName",KaijuPatSkinDescription:"KaijuPatFustySkinDescription",GalaxiliSkinName:"GalaxiliEziliSkinName",GalaxiliSkinDescription:"GalaxiliEziliSkinDescription",VoidoraSkinName:"VoidoraAdoraSkinName",VoidoraSkinDescription:"VoidoraAdoraSkinDescription",VikingSaudaSkinName:"VikingSaudaSaudaSkinName",VikingSaudaSkinDescription:"VikingSaudaSaudaSkinDescription",JiangshiSaudaSkinName:"JiangshiSaudaSaudaSkinName",JiangshiSaudaSkinDescription:"JiangshiSaudaSaudaSkinDescription",DreadPirateBrickellSkinName:"DreadPirateBrickellAdmiralBrickellSkinName",DreadPirateBrickellSkinDescription:"DreadPirateBrickellAdmiralBrickellSkinDescription",LifeguardBrickellSkinName:"LifeguardBrickellAdmiralBrickellSkinName",LifeguardBrickellSkinDescription:"LifeguardBrickellAdmiralBrickellSkinDescription",PsimbalsSkinName:"PsimbalsPsiSkinName",PsimbalsSkinDescription:"PsimbalsPsiSkinDescription",GeraldoGentlemanGadgeteerSkinName:"GentlemonkeyGadgeteerGeraldoSkinName",GeraldoGentlemanGadgeteerSkinDescription:"GentlemonkeyGadgeteerGeraldoSkinDescription","Mode Easy":"Easy","Mode Medium":"Medium","Mode Hard":"Hard","Mode Impoppable":"Impoppable","Mode Sandbox":"Sandbox",RosaliaTinkerfairySkinName:"TinkerfairyRosaliaSkinName",RosaliaTinkerfairySkinDescription:"TinkerfairyRosaliaSkinDescription",AdoraSheRaSkinDescription:"SheRaAdoraSkinDescription",AdoraSheRaSkinName:"SheRaSkinName"},medalMap={Easy:"Bronze",PrimaryOnly:"Bronze01",Deflation:"Bronze02",Medium:"Silver",MilitaryOnly:"Silver01",Apopalypse:"Silver03",Reverse:"Silver02",Hard:"Gold",MagicOnly:"Gold01",DoubleMoabHealth:"Gold03",HalfCash:"Gold04",AlternateBloonsRounds:"Gold02",Impoppable:"Impoppable",Clicks:"ImpoppableRuby","CHIMPS-BLACK":"ImpoppableHematite"},saveSkintoSkinMap={"Scientist Gwendolin":"ScientistGwendolin","Biker Bones":"BikerBones","Sentai Captain Churchill":"SentaiCaptainChurchill","Cyber Quincy":"Cyber Quincy","Octo Jones":"OctoJones","Sleigh Captain Churchill":"SleighCaptainChurchill","Wolfpack Quincy":"WolfpackQuincy",ScientistGwendolin:"Scientist Gwendolin",BikerBones:"Biker Bones",SentaiCaptainChurchill:"Sentai Captain Churchill",CyberQuincy:"Cyber Quincy",OctoJones:"Octo Jones",SleighCaptainChurchill:"Sleigh Captain Churchill",WolfpackQuincy:"Wolfpack Quincy"},trophyStoreKeyFixes={HeroesQuincyCyberQuincyPlacementFireworks:"H-CyberQuincyPlacementFireworks",HeroesChurchillPlacementTankDrop:"H-ChurchillPlacementTankDrop",HeroesBenjamminDJSkinPlacementPartyLights:"H-BenDJSkinPlacementPartyLights",HeroesStrikerJonesPlacementParadrop:"H-StrikerJonesPlacementParadrop",GameUIUpgradesDisplayNamedMonkeys:"GameUIUpgradesNamedMonkeys",GameUIMusicTrackMusicTitleFiestaMix:"UIMusic-TitleFiestaMix",GameUIMusicTrackMusicSunshineGameboyMix:"UIMusic-SunshineGameboyMix",GameUIMusicTrackMusicTropicalComplextroMix:"UIMusic-TropicalComplextroMix",BloonsAllBloonsPopsBarrelOfMonkeys:"BloonsAll-PopsBarrelOfMonkeys",CoopEmoteAnimationSparklingHearts:"CE-AnimationSparklingHearts",GameUIMusicTrackMusicSunsetSilentNightMix:"UIMusic-SunsetSilentNightMix",TowerProjectileBombshooterPumpkin:"TP-BombshooterPumpkin",TowerProjectileBananaFarmCandyCorn:"TP-BananaFarmCandyCorn",TowerEffectAllMonkeysPlacementUpgradesGhosts:"TEAMPU-Ghosts",GameUIPowerSkinSuperVampireStorm:"PSkin-SuperVampireStorm",GameUIMusicTrackMusicFiestaSynthwaveMix:"UIMusic-FiestaSynthwaveMix",TowerEffectAllMonkeysPlacementUpgradesPresents:"TEAMPU-Presents",TowerProjectileBoomerangCandyCane:"TP-BoomerangCandyCane",GameUIMusicTrackMusicJingleBloons:"UIMusic-JingleBloons",TowerProjectileSpikeFactoryPineapples:"TP-SpikeFactoryPineapples",GameUIMusicTrackMusicBMCStreetParty:"UIMusic-BMCStreetParty",TowerProjectileDartlingEasterEggs:"TP-DartlingEasterEggs",CoopEmoteAnimationPixelMonkeyDance:"CE-AnimationPixelMonkeyDance",HeroesPatFustyPlacementSuperjump:"H-PatFustyPlacementSuperjump",TowerPropMonkeyVillageBrazilFlag:"TProp-VillageBrazilFlag",TowerPropMonkeyVillageScotlandFlag:"TProp-VillageScotlandFlag",TowerPropMonkeyVillageBananaFlag:"TProp-VillageBananaFlag",TowerEffectAllMonkeysPlacementUpgradesFireworks:"TEAMPU-Fireworks",TowerProjectileWizardMonkeyFireworks:"TP-WizardMonkeyFireworks",GameUIPowerSkinMonkeyBoostFireworks:"PSkin-MonkeyBoostFireworks",GameUIMusicTrackMusicTropicalOctopusMix:"UIMusic-TropicalOctopusMix",HeroesGwendolinPlacementFireball:"H-GwendolinPlacementFireball",TowerPropMonkeyVillageGermanyFlag:"TProp-VillageGermanyFlag",TowerEffectAllMonkeysPlacementUpgradesButterflies:"TEAMPU-Butterflies",HeroesChurchillSentaiSkinPetDrone:"H-ChurchillSentaiSkinPetDrone",TowerEffectAllMonkeysPlacementUpgradesBats:"TEAMPU-Bats",TowerProjectileEngineerVampireHunter:"TP-EngineerVampireHunter",TowerPropMonkeyVillageCanadianFlag:"TProp-VillageCanadianFlag",TowerPropMonkeyVillageAustralianFlag:"TProp-VillageAustralianFlag",CoopEmoteAnimationBikerBonesRage:"H-BikerBonesPlacementHellrift",GameUIPowerSkinEnergisingTotemChristmasTree:"PSkin-EnergisingTotemXmasTree",GameUIMusicTrackMusicWinterChilledMix:"UIMusic-WinterChilledMix",HeroesStrikerJonesPetGermanShepherd:"H-StrikerJonesPetGermanShepherd",CoopEmoteAnimationThinkingMonkey:"CE-AnimationThinkingMonkey",GameUIPowerSkinRoadSpikesFlowerPatch:"PSkin-RoadSpikesFlowerPatch",GameUIPowerSkinMonkeyBoostSugarRush:"PSkin-MonkeyBoostSugarRush",GameUIMusicTrackMusicSunshineFiestaMix:"UIMusic-SunshineFiestaMix",GameUIMusicTrackMusicTribesJaloonMix:"UIMusic-TribesJaloonMix",GameUIPowerSkinGlueTrapHoneyTrap:"PSkin-GlueTrapHoneyTrap",GameUIPowerSkinBananaFarmerBananaCostume:"PSkin-BananaFarmerBananaCostume",TowerProjectileBananaFarmPresents:"TP-BananaFarmPresents",TowerProjectileTackShooterIcicles:"TP-TackShooterIcicles",TowerProjectileDartMonkeySnowballs:"TP-DartMonkeySnowballs",TowerProjectileNinjaMonkeySnowflakes:"TP-NinjaMonkeySnowflakes",HeroesStrikerJonesBikerBonesPlacementHellrift:"H-BikerBonesPlacementHellrift",TowerProjectileSniperMonkeyConfetti:"BloonsAllBloonsPopsConfetti",TowerProjectileAlchemistSpringFlowers:"TP-AlchemistSpringFlowers",TowerPropMonkeyVillageSwedenFlag:"TProp-VillageSwedenFlag",HeroesQuincyPlacementSpecialForces:"H-QuincyPlacementSpecialForces",GameUIMusicTrackMusicSunset64Mix:"UIMusic-Sunset64Mix",GameUIMusicTrackMusicFiestaHeliumHeightsMix:"UIMusic-FiestaHeliumHeightsMix",GameUIPowerSkinCamoTrapSprinkler:"PSkin-CamoTrapSprinkler",GameUIMusicTrackMusicTribesFunkedMix:"UIMusic-TribesFunkedMix",GameUIMusicTrackMusicTropicalClassyBrassMix:"UIMusic-TropicalClassyBrassMix",GameUIMusicTrackMusicWinterTonkMix:"UIMusic-WinterTonkMix",HeroesAdmiralBrickellPlacementAerialDeployment:"H-BrickellPlacementAerialDep",TowerProjectileDartMonkeyPumpkins:"TP-DartMonkeyPumpkins",TowerProjectileMonkeyBuccaneerFlavouredTrades:"TP-BuccaneerFlavouredTrades"},knownProblematicMaps=["ZMYVERW","ZMYUWTV","ZMYUDTK","ZMYVPGA","ZMYVPFH","ZMYWHPC"];function getTowerAssetPath(e,t){return"WizardMonkey"==e?`Assets/TowerIcon/${t}-Wizard.webp`:`Assets/TowerIcon/${t}-${e}.webp`}function getInstaContainerIcon(e,t){return"WizardMonkey"==e?`Assets/UI/InstaContainer/${t}-Wizard.webp`:`Assets/UI/InstaContainer/${t}-${e}.webp`}function getInstaMonkeyIcon(e,t){let a=Math.max(t[0],t[1],t[2]);switch(Math.max(t[0],t[1],t[2])){case parseInt(t[0]):a=`${a}00`;break;case parseInt(t[1]):a=`0${a}0`;break;case parseInt(t[2]):a=`00${a}`}return"WizardMonkey"==e?`Assets/InstaMonkeyIcon/${a}-WizardInsta.webp`:`Assets/InstaMonkeyIcon/${a}-${e}Insta.webp`}function getUpgradeAssetPath(e){return e=e.replace(/[^a-zA-Z0-9]/g,""),upgradeNameFixMap[e]?`Assets/UpgradeIcon/${upgradeNameFixMap[e]}UpgradeIcon.webp`:`Assets/UpgradeIcon/${e}UpgradeIcon.webp`}function getKnowledgeAssetPath(e){return"SubAdmiral"==e?"Assets/KnowledgeIcon/NavalUpgradesIcon.webp":`Assets/KnowledgeIcon/${e}Icon.webp`}function getHeroPortrait(e,t){return 1==t?`Assets/Portrait/${e}Portrait.webp`:`Assets/Portrait/${e}PortraitLvl${t}.webp`}function getHeroSquareIcon(e){return`Assets/HeroIconSquare/HeroIcon${e=skinNameFixMap[e]||e}.webp`}function getHeroIconCircle(e){return`Assets/HeroIconCircle/HeroIcon${e=skinNameFixMap[e]||e}.webp`}function getSkinAssetPath(e,t){return e=skinNameFixMap[e]||e,1==t?`Assets/Portrait/${e}Portrait.webp`:`Assets/Portrait/${e}PortraitLvl${t}.webp`}function getMapIcon(e){return"#ouch"==e?"Assets/MapIcon/MapSelectouchButton.webp":`Assets/MapIcon/MapSelect${e}Button.webp`}function getPowerIcon(e){return`Assets/PowerIcon/${e}Icon.webp`}function getAchievementIcon(e,t){return t?"Assets/AchievementIcon/HiddenIcon.webp":`Assets/AchievementIcon/${e}Icon.webp`}function fixAchievementName(e){return achievementNameFixMap[e]||e}function getMedalIcon(e){return`Assets/MedalIcon/${e}.webp`}function getModeIcon(e){return`Assets/ModeIcon/${e}Btn.webp`}function getRewardIcon(e){switch(e.type){case"MonkeyMoney":return"Assets/UI/BloonjaminsIcon.webp";case"Power":return getPowerIcon(e.power);case"InstaMonkey":return getInstaMonkeyIcon(e.tower,e.tiers);case"KnowledgePoints":return"Assets/UI/KnowledgeIcon.webp";case"RandomInstaMonkey":return`Assets/UI/InstaRandomTier${0==e.tier?1:e.tier}.webp`;case"Trophy":return"Assets/UI/TrophyIcon.webp";default:return`Assets/UI/${e.value}Icon.webp`}}function getProfileIcon(e){return`Assets/ProfileAvatar/${e}.webp`}function getProfileAvatar(e){if(0==e.avatar)return"Assets/ProfileAvatar/ProfileAvatar01.webp";let t=parseInt(e.avatar.replace(/\D/g,""));return""==e.avatar||isNaN(t)?"Assets/ProfileAvatar/ProfileAvatar01.webp":t<=constants.profileAvatars?`Assets/ProfileAvatar/${e.avatar}.webp`:e.avatarURL}function getProfileBanner(e){if(0==e.banner)return"Assets/ProfileBanner/TeamsBannerDeafult.webp";let t=parseInt(e.banner.replace(/\D/g,""));return""==e.banner||isNaN(t)?"Assets/ProfileBanner/TeamsBannerDeafult.webp":t<=constants.profileBanners?`Assets/ProfileBanner/${e.banner}.webp`:e.bannerURL}function getCustomMapIcon(e){return knownProblematicMaps.includes(e)?`Assets/CustomMapIcon/${e}.webp`:`https://data.ninjakiwi.com/btd6/maps/map/${e}/preview`}function getLocValue(e){return locJSONOverrides[e]?locJSON[locJSONOverrides[e]]:locJSON[e]?locJSON[e]:e}function getCollectionEventSkinIcon(e){if(!e||!e.start||!e.end)return"CollectingEventTotemBtn";const t=new Date(e.start),a=new Date(e.end),n=(e,n)=>{const s=new Date(t.getFullYear(),e-1,n),l=new Date(t.getFullYear()+1,e-1,n);return s>=t&&s<=a||l>=t&&l<=a};return n(12,25)?"CollectingEventChristmasBtn":n(10,31)?"CollectingEventHalloweenBtn":n(7,4)?"CollectingEventFireworksBtn":"CollectingEventTotemBtn"}let rankInfo={rank:1,xp:null,xpGoal:null},xpNeededPerVeteranRank=2e7,rankInfoVeteran={rank:1,xp:null,xpGoal:2e7},profileStats={},exclusiveStats={},medalsInOrder={},extrasUnlocked={},progressSubText={},processedMapData={Maps:{},Medals:{single:{},coop:{}},Borders:{single:{},coop:{}}},useNamedMonkeys=!0,currentlySelectedHero="",allHeroesShown=!1,allTowersShown=!1,currentMapView="grid",coopEnabled=!1,currentDifficultyFilter="All",mapPage=0,currentInstaView="game",instasMissingToggle=!1,currentAchievementFilter="game",currentAchievementRewardFilter="None",processedInstaData={TowerTotal:{},TowerTierTotals:{},TowerMissingByTier:{},TowerBorders:{},TowerObtained:{}},rulesMap={"Monkey Knowledge Disabled":"NoKnowledgeIcon","No Lives Lost":"NoLivesLostIcon","Selling Disabled":"SellingDisabledIcon","Powers Disabled":"PowersDisabledIcon","No Continues":"NoContinuesIcon","All Camo":"AllCamoIcon","All Regrow":"AllRegenIcon","Double Cash Disabled":"NoDoubleCashIcon","No Round 100 Reward":"NoInstaMonkeys","Custom Rounds":"CustomRoundIcon","Paragon Limit":"ParagonLimitIcon"},showElite=!1,currentBrowserView="grid",currentCollectionChest="None",currentCollectionTower="All",collectionMissingToggle=!0,collectionListSortType="Highest Total Chance",chestSelectorMap={wood:"Wooden",bronze:"Bronze",silver:"Silver",gold:"Gold",diamond:"Diamond"},showFeaturedFilter=!1,currentFeaturedTower="All",trophyStoreSubFilter="All",subFiltersMap={Heroes:["All","HeroPlacementUpgrades","HeroPets"],Monkeys:["All","TowerPlacementUpgrades","TowerPets","Projectiles","Flags"],Bloons:["All","PopFX","AllBloonSkins","RegularSkins","MoabSkins"],Coop:["All","StandardEmotes","TextEmotes","SoundEmotes","FullScreenEmotes"],GameUI:["All","MusicTracks","Avatars","ProfileBanners","PowerSkins","Misc"]},showTeamsItems=!1,abilitiesFilter="Most Used",loggedIn=!1,imageScroll=[{title:"New Site Update!",text:'Site Update 2.3.1:<br>\n        - Minor fixes + changes<br>\n        <br>\n        Recent Updates:<br>\n        - Added Roundset Filtering<br>\n        - Contested Territory Groups<br>\n        - Leaderboards Revamped<br>\n        <br>\n        5% Off in <a href="https://btd6store.ninjakiwi.com/" target="_blank" style="color: white;">Webshop</a> when using a code (HalfHydra for me, TY!)<br>\n        Report Bugs: <a href="https://discord.gg/wep2RDmcqZ" target="_blank" style="color: white;">Discord Server</a><br>\n        ',image:"/LandingScroll/Update51&Upsell"},{title:"View Your Profile!",text:"- View API exclusive stats<br>- Full Top Heroes/Towers list<br>- Top Paragons counts<br>- Ability usage counts<br>- Detailed map statistics<br>- Track your insta monkey collection",image:"OverviewProfile"},{title:"View Events!",text:"- View recent events<br>- Race event details<br>- Boss event details<br>- Odyssey event details<br>- Contested Territory details<br>- Daily Challenge details<br>- Advanced Challenge details<br>- Coop Challenge details<br>- Collection event details",image:"/LandingScroll/Events"},{title:"View Leaderboards!",text:"- View event leaderboards<br>- Up to 1000 entries<br>- View extra score information<br>- View user profiles<br>- Contested Territory groups",image:"/LandingScroll/Leaderboards"},{title:"View Roundsets!",text:"- Detailed round information<br>- Advanced round filtering<br>- Preview rounds visually<br>- Boss custom rounds<br>- Custom event rounds<br>- Rogue Legends special rounds included",image:"/LandingScroll/Roundsets"},{title:"Rogue Legends Helper!",text:"- View all artifacts<br>- Search, sort, and filtering<br>- Hero Starter Kits reference<br>- Track extracted artifacts<br>- Export progress image (desktop only)",image:"/LandingScroll/RogueLegends"}],imageScrollIndex=0;function generateIfReady(){readyFlags.every((e=>1===e))?(document.getElementById("home-content")&&(document.getElementById("home-content").style.display="none"),document.body.classList.add("transition-bg"),generateRankInfo(),generateVeteranRankInfo(),generateAchievementsHelper(),generateStats(),generateMedals(),generateExtras(),generateInstaData(),generateMapData(),generateProgressSubText(),changeTab("profile"),parseInt(btd6usersave.latestGameVersion.split(".")[0])>constants.projectContentVersion&&errorModal(`The content of this site (v${constants.projectContentVersion}.0) is out of date with the current version (v${btd6usersave.latestGameVersion.split(".")[0]}.0). New content might be missing, but everything else should remain functional.`,"api",!0)):!loggedIn&&readyFlags.slice(2).every((e=>1===e))&&(document.getElementById("home-content").style.display="none",document.body.classList.add("transition-bg"),generateHeaderTabs(),changeTab("profile"))}function previewSite(){fetchMainDependencies(!0)}function generateRankInfo(){if(18e7===btd6usersave.xp)return rankInfo.rank=155,rankInfo.xp=null,void(rankInfo.xpGoal=null);let e=parseInt(btd6usersave.xp);for(let[t,a]of Object.entries(constants.Rank))if(t=parseInt(t),e<a.totalXpNeeded)return e-=parseInt(constants.Rank[t-1].totalXpNeeded),xpGoal=parseInt(a.totalXpNeeded)-parseInt(constants.Rank[t-1].totalXpNeeded),rankInfo.rank=t-1,rankInfo.xp=e,void(rankInfo.xpGoal=xpGoal)}function generateVeteranRankInfo(){let e=parseInt(btd6usersave.veteranXp);for(;e>=xpNeededPerVeteranRank;)e-=xpNeededPerVeteranRank,rankInfoVeteran.rank+=1;rankInfoVeteran.xp=e}function generateAchievementsHelper(){for(let[e,t]of Object.entries(achievementsJSON))achievementsHelper[t.name]=t}function generateStats(){profileStats["Games Played"]=btd6publicprofile.gameplay.gameCount,profileStats["Games Won"]=btd6publicprofile.gameplay.gamesWon,profileStats["Highest Round (All Time)"]=btd6publicprofile.gameplay.highestRound,profileStats["Highest Round (CHIMPS)"]=btd6publicprofile.gameplay.highestRoundCHIMPS,profileStats["Highest Round (Deflation)"]=btd6publicprofile.gameplay.highestRoundDeflation,profileStats["Monkeys Placed"]=btd6publicprofile.gameplay.monkeysPlaced,profileStats["Total Pop Count"]=btd6publicprofile.bloonsPopped.bloonsPopped,profileStats["Total Co-Op Pop Count"]=btd6publicprofile.bloonsPopped.coopBloonsPopped,profileStats["Camo Bloons Popped"]=btd6publicprofile.bloonsPopped.camosPopped,profileStats["Lead Bloons Popped"]=btd6publicprofile.bloonsPopped.leadsPopped,profileStats["Purple Bloons Popped"]=btd6publicprofile.bloonsPopped.purplesPopped,profileStats["Regrow Bloons Popped"]=btd6publicprofile.bloonsPopped.regrowsPopped,profileStats["Ceramic Bloons Popped"]=btd6publicprofile.bloonsPopped.ceramicsPopped,profileStats["MOABs Popped"]=btd6publicprofile.bloonsPopped.moabsPopped,profileStats["BFBs Popped"]=btd6publicprofile.bloonsPopped.bfbsPopped,profileStats["ZOMGs Popped"]=btd6publicprofile.bloonsPopped.zomgsPopped,profileStats["DDTs Popped"]=btd6publicprofile.bloonsPopped.ddtsPopped,profileStats["BADs Popped"]=btd6publicprofile.bloonsPopped.badsPopped,profileStats["Bloons Leaked"]=btd6publicprofile.bloonsPopped.bloonsLeaked,profileStats["Cash Generated"]=btd6publicprofile.gameplay.cashEarned,profileStats["Cash Gifted"]=btd6publicprofile.gameplay.coopCashGiven,profileStats["Abilities Used"]=btd6publicprofile.gameplay.abilitiesUsed,profileStats["Powers Used"]=btd6publicprofile.gameplay.powersUsed,profileStats["Insta Monkeys Used"]=btd6publicprofile.gameplay.instaMonkeysUsed,profileStats["Daily Reward Chests Opened"]=btd6publicprofile.gameplay.dailyRewards,profileStats["Challenges Completed"]=btd6publicprofile.gameplay.challengesCompleted,profileStats.Achievements=btd6publicprofile.gameplay.achievements,profileStats["Hidden Achievements"]=0,profileStats["Odysseys Completed"]=btd6publicprofile.gameplay.totalOdysseysCompleted,profileStats["Lifetime Trophies"]=btd6publicprofile.gameplay.totalTrophiesEarned,profileStats["Necro Bloons Reanimated"]=btd6publicprofile.bloonsPopped.necroBloonsReanimated,profileStats["Transforming Tonics Used"]=btd6publicprofile.bloonsPopped.transformingTonicsUsed,profileStats["Most Experienced Monkey"]=btd6publicprofile.mostExperiencedMonkey,profileStats["Most Experienced Monkey XP"]=btd6usersave.towerXP[btd6publicprofile.mostExperiencedMonkey],profileStats["Most Experienced Monkey"]=getLocValue(profileStats["Most Experienced Monkey"]),profileStats["Insta Monkey Collection"]=`${btd6publicprofile.gameplay.instaMonkeyCollection}/${constants.totalInstaMonkeys}`,profileStats["Collection Chests Opened"]=btd6publicprofile.gameplay.collectionChestsOpened,profileStats["Golden Bloons Popped"]=btd6publicprofile.bloonsPopped.goldenBloonsPopped,profileStats["Monkey Teams Wins"]=btd6publicprofile.gameplay.monkeyTeamsWins,profileStats["Bosses Popped"]=btd6publicprofile.bloonsPopped.bossesPopped,profileStats["Damage Done To Bosses"]=btd6publicprofile.gameplay.damageDoneToBosses,exclusiveStats["Daily Challenges Completed"]=btd6usersave.totalDailyChallengesCompleted,exclusiveStats["Consecutive DCs Completed"]=btd6usersave.consecutiveDailyChallengesCompleted,exclusiveStats["Race Attempts"]=btd6usersave.totalRacesEntered,exclusiveStats["Contested Territory Tiles Captured"]=btd6publicprofile.stats.ctCapturedTiles,exclusiveStats["Challenges Played"]=btd6usersave.challengesPlayed,exclusiveStats["Challenges Shared"]=btd6usersave.challengesShared,exclusiveStats["Continues Used"]=btd6usersave.continuesUsed,exclusiveStats["Towers Sold"]=btd6publicprofile.stats.totalTowersSold,exclusiveStats["Total Tier 1 Upgrades"]=btd6publicprofile.stats.upgradesPurchasedByTier[1],exclusiveStats["Total Tier 2 Upgrades"]=btd6publicprofile.stats.upgradesPurchasedByTier[2],exclusiveStats["Total Tier 3 Upgrades"]=btd6publicprofile.stats.upgradesPurchasedByTier[3],exclusiveStats["Total Tier 4 Upgrades"]=btd6publicprofile.stats.upgradesPurchasedByTier[4],exclusiveStats["Total Tier 5 Upgrades"]=btd6publicprofile.stats.upgradesPurchasedByTier[5];let e=0,t=0;btd6usersave.achievementsClaimed.forEach((a=>{let n=achievementsHelper[fixAchievementName(a)];n&&(n.model.hidden?e+=1:t+=1)})),profileStats["Hidden Achievements"]=`${e}/${constants.hiddenAchievements}`,profileStats.Achievements=`${t}/${constants.achievements}`}function generateMedals(){let e={};for(let[t,a]of Object.entries(medalMap))medalsInOrder["Medal"+a]=btd6publicprofile._medalsSinglePlayer[t]||0,e["MedalCoop"+a]=btd6publicprofile._medalsMultiplayer[t]||0;medalsInOrder={...medalsInOrder,...e},medalsInOrder.BlastapopoulosEliteBadge=btd6publicprofile.bossBadgesElite.Blastapopoulos||0,medalsInOrder.BlastapopoulosBadge=btd6publicprofile.bossBadgesNormal.Blastapopoulos||0,medalsInOrder.PhayzeEliteBadge=btd6publicprofile.bossBadgesElite.Phayze||0,medalsInOrder.PhayzeBadge=btd6publicprofile.bossBadgesNormal.Phayze||0,medalsInOrder.DreadbloonEliteBadge=btd6publicprofile.bossBadgesElite.Dreadbloon||0,medalsInOrder.DreadbloonBadge=btd6publicprofile.bossBadgesNormal.Dreadbloon||0,medalsInOrder.VortexEliteBadge=btd6publicprofile.bossBadgesElite.Vortex||0,medalsInOrder.VortexBadge=btd6publicprofile.bossBadgesNormal.Vortex||0,medalsInOrder.LychEliteBadge=btd6publicprofile.bossBadgesElite.Lych||0,medalsInOrder.LychBadge=btd6publicprofile.bossBadgesNormal.Lych||0,medalsInOrder.BloonariusEliteBadge=btd6publicprofile.bossBadgesElite.Bloonarius||0,medalsInOrder.BloonariusBadge=btd6publicprofile.bossBadgesNormal.Bloonarius||0,medalsInOrder.MedalEventBronzeMedal=btd6publicprofile._medalsRace.Bronze||0,medalsInOrder.MedalEventSilverMedal=btd6publicprofile._medalsRace.Silver||0,medalsInOrder.MedalEventDoubleSilverMedal=btd6publicprofile._medalsRace.DoubleSilver||0,medalsInOrder.MedalEventGoldSilverMedal=btd6publicprofile._medalsRace.GoldSilver||0,medalsInOrder.MedalEventDoubleGoldMedal=btd6publicprofile._medalsRace.DoubleGold||0,medalsInOrder.MedalEventGoldDiamondMedal=btd6publicprofile._medalsRace.GoldDiamond||0,medalsInOrder.MedalEventBlueDiamondMedal=btd6publicprofile._medalsRace.BlueDiamond||0,medalsInOrder.MedalEventRedDiamondMedal=btd6publicprofile._medalsRace.RedDiamond||0,medalsInOrder.MedalEventBlackDiamondMedal=btd6publicprofile._medalsRace.BlackDiamond||0,medalsInOrder.OdysseyStarIcon=btd6publicprofile.gameplay.totalOdysseyStars||0,medalsInOrder.BossMedalEventBronzeMedal=btd6publicprofile._medalsBoss.Bronze||0,medalsInOrder.BossMedalEventSilverMedal=btd6publicprofile._medalsBoss.Silver||0,medalsInOrder.BossMedalEventDoubleSilverMedal=btd6publicprofile._medalsBoss.DoubleSilver||0,medalsInOrder.BossMedalEventGoldSilverMedal=btd6publicprofile._medalsBoss.GoldSilver||0,medalsInOrder.BossMedalEventDoubleGoldMedal=btd6publicprofile._medalsBoss.DoubleGold||0,medalsInOrder.BossMedalEventGoldDiamondMedal=btd6publicprofile._medalsBoss.GoldDiamond||0,medalsInOrder.BossMedalEventBlueDiamondMedal=btd6publicprofile._medalsBoss.BlueDiamond||0,medalsInOrder.BossMedalEventRedDiamondMedal=btd6publicprofile._medalsBoss.RedDiamond||0,medalsInOrder.BossMedalEventBlackDiamondMedal=btd6publicprofile._medalsBoss.BlackDiamond||0,medalsInOrder.EliteBossMedalEventBronzeMedal=btd6publicprofile._medalsBossElite.Bronze||0,medalsInOrder.EliteBossMedalEventSilverMedal=btd6publicprofile._medalsBossElite.Silver||0,medalsInOrder.EliteBossMedalEventDoubleSilverMedal=btd6publicprofile._medalsBossElite.DoubleSilver||0,medalsInOrder.EliteBossMedalEventGoldSilverMedal=btd6publicprofile._medalsBossElite.GoldSilver||0,medalsInOrder.EliteBossMedalEventDoubleGoldMedal=btd6publicprofile._medalsBossElite.DoubleGold||0,medalsInOrder.EliteBossMedalEventGoldDiamondMedal=btd6publicprofile._medalsBossElite.GoldDiamond||0,medalsInOrder.EliteBossMedalEventBlueDiamondMedal=btd6publicprofile._medalsBossElite.BlueDiamond||0,medalsInOrder.EliteBossMedalEventRedDiamondMedal=btd6publicprofile._medalsBossElite.RedDiamond||0,medalsInOrder.EliteBossMedalEventBlackDiamondMedal=btd6publicprofile._medalsBossElite.BlackDiamond||0,medalsInOrder.CtLocalPlayerBronzeMedal=btd6publicprofile._medalsCTLocal.Bronze||0,medalsInOrder.CtLocalPlayerSilverMedal=btd6publicprofile._medalsCTLocal.Silver||0,medalsInOrder.CtLocalPlayerDoubleGoldMedal=btd6publicprofile._medalsCTLocal.DoubleGold||0,medalsInOrder.CtLocalPlayerGoldDiamondMedal=btd6publicprofile._medalsCTLocal.GoldDiamond||0,medalsInOrder.CtLocalPlayerBlueDiamondMedal=btd6publicprofile._medalsCTLocal.BlueDiamond||0,medalsInOrder.CtLocalPlayerRedDiamondMedal=btd6publicprofile._medalsCTLocal.RedDiamond||0,medalsInOrder.CtLocalPlayerBlackDiamondMedal=btd6publicprofile._medalsCTLocal.BlackDiamond||0,medalsInOrder.CtGlobalPlayerBronzeMedal=btd6publicprofile._medalsCTGlobal.Bronze||0,medalsInOrder.CtGlobalPlayerSilverMedal=btd6publicprofile._medalsCTGlobal.Silver||0,medalsInOrder.CtGlobalPlayerDoubleSilverMedal=btd6publicprofile._medalsCTGlobal.DoubleSilver||0,medalsInOrder.CtGlobalPlayerGoldSilverMedal=btd6publicprofile._medalsCTGlobal.GoldSilver||0,medalsInOrder.CtGlobalPlayerDoubleGoldMedal=btd6publicprofile._medalsCTGlobal.DoubleGold||0,medalsInOrder.CtGlobalPlayerGoldDiamondMedal=btd6publicprofile._medalsCTGlobal.GoldDiamond||0,medalsInOrder.CtGlobalPlayerDiamondMedal=btd6publicprofile._medalsCTGlobal.Diamond||0}function generateExtras(){btd6usersave.unlockedBigBloons&&(extrasUnlocked["Big Bloons"]=btd6usersave.bigBloonsActive),btd6usersave.unlockedSmallBloons&&(extrasUnlocked["Small Bloons"]=btd6usersave.smallBloonsActive),btd6usersave.seenBigTowers&&(extrasUnlocked["Big Monkey Towers"]=btd6usersave.bigTowersActive),btd6usersave.unlockedSmallTowers&&(extrasUnlocked["Small Monkey Towers"]=btd6usersave.smallTowersActive),btd6usersave.unlockedSmallBosses&&(extrasUnlocked["Small Bosses"]=btd6usersave.smallBossesActive)}function generateProgressSubText(){let e=Object.keys(btd6usersave.unlockedTowers).filter((e=>btd6usersave.unlockedTowers[e])).length;progressSubText.Towers=`${e}/${Object.keys(btd6usersave.unlockedTowers).length} Towers Unlocked`;let t=Object.keys(btd6usersave.acquiredUpgrades),a=t.filter((e=>btd6usersave.acquiredUpgrades[e])),n=t.filter((e=>e.includes("Paragon")&&"Sentry Paragon"!=e)),s=n.filter((e=>btd6usersave.acquiredUpgrades[e]));progressSubText.Upgrades=`${a.length-s.length}/${t.length-n.length} Upgrades Unlocked`,s.length>0&&(progressSubText.Paragons=`${s.length}/${n.length} Paragon${1!=s.length?"s":""} Unlocked`);let l=Object.keys(btd6usersave.unlockedHeros).filter((e=>btd6usersave.unlockedHeros[e])).length;progressSubText.Heroes=`${l}/${Object.keys(btd6usersave.unlockedHeros).length} Hero${1!=l?"es":""} Unlocked`;let d=Object.keys(btd6usersave.unlockedSkins).filter((e=>!Object.keys(constants.heroesInOrder).includes(e))).filter((e=>btd6usersave.unlockedSkins[e])).length;progressSubText.Skins=`${d}/${Object.keys(btd6usersave.unlockedSkins).filter((e=>!Object.keys(constants.heroesInOrder).includes(e))).length} Hero Skin${1!=d?"s":""} Unlocked`,progressSubText.ActivatedAbilities=`${Object.keys(btd6publicprofile.stats.abilitiesActivatedByName).filter((e=>e in constants.abilities)).length} Unique Abilities Used`,progressSubText.Knowledge=`${Object.keys(btd6usersave.acquiredKnowledge).filter((e=>btd6usersave.acquiredKnowledge[e])).length}/${Object.keys(btd6usersave.acquiredKnowledge).length} Knowledge Points Unlocked`;let r=Object.keys(btd6usersave.mapProgress).filter((e=>btd6usersave.mapProgress[e])).length;progressSubText.MapProgress=`${r} Map${1!=r?"s":""} Played`;let i=Object.values(processedMapData.Medals.single).map((e=>e.Clicks)).filter((e=>e)).length,o=Object.values(processedMapData.Medals.coop).map((e=>e.Clicks)).filter((e=>e)).length;i+o>0&&(progressSubText.CHIMPS=`${i+o} CHIMPS Medal${i+o!=1?"s":""} Earned`);let c=Object.values(btd6usersave.powers).map((e=>"object"==typeof e&&e.quantity?e.quantity:0)).reduce(((e,t)=>e+t))+btd6publicprofile.gameplay.powersUsed;progressSubText.Powers=`${c} Power${1!=c?"s":""} Collected`;let p=Object.values(processedInstaData.TowerTotal).reduce(((e,t)=>e+t))+btd6publicprofile.gameplay.instaMonkeysUsed;progressSubText.InstaMonkeys=`${p} Insta${1!=p?"s":""} Collected`,progressSubText.Achievements=`${btd6usersave.achievementsClaimed.length}/${constants.achievements+constants.hiddenAchievements} Achievement${1!=btd6publicprofile.achievements?"s":""} Earned`;let m=Object.keys(extrasUnlocked).length;progressSubText.TrophyStore=`${Object.keys(trophyStoreItemsJSON).filter((e=>getTrophyItemObtained(e))).length} Trophy Store Items Collected`,progressSubText.TeamsStore=`${Object.keys(btd6usersave.trophyStoreItems).filter((e=>btd6usersave.trophyStoreItems[e]&&teamsStoreItemsJSON[e])).length} Team Store Items Unlocked`,progressSubText.Quests=`${btd6usersave.quests.filter((e=>e.complete)).length} Quests Complete`,progressSubText.Extras=`${m} Extra${1!=m?"s":""} Unlocked`}function generateMapData(){for(let[e,t]of Object.entries(btd6usersave.mapProgress)){let a={single:{},coop:{}};a.single.Easy=t.difficulty?.Easy?.single?.Standard,a.single.PrimaryOnly=t.difficulty?.Easy?.single?.PrimaryOnly,a.single.Deflation=t.difficulty?.Easy?.single?.Deflation,a.single.Medium=t.difficulty?.Medium?.single?.Standard,a.single.MilitaryOnly=t.difficulty?.Medium?.single?.MilitaryOnly,a.single.Apopalypse=t.difficulty?.Medium?.single?.Apopalypse,a.single.Reverse=t.difficulty?.Medium?.single?.Reverse,a.single.Hard=t.difficulty?.Hard?.single?.Standard,a.single.MagicOnly=t.difficulty?.Hard?.single?.MagicOnly,a.single.DoubleMoabHealth=t.difficulty?.Hard?.single?.DoubleMoabHealth,a.single.HalfCash=t.difficulty?.Hard?.single?.HalfCash,a.single.AlternateBloonsRounds=t.difficulty?.Hard?.single?.AlternateBloonsRounds,a.single.Impoppable=t.difficulty?.Hard?.single?.Impoppable,a.single.Clicks=t.difficulty?.Hard?.single?.Clicks,a.coop.Easy=t.difficulty?.Easy?.coop?.Standard,a.coop.PrimaryOnly=t.difficulty?.Easy?.coop?.PrimaryOnly,a.coop.Deflation=t.difficulty?.Easy?.coop?.Deflation,a.coop.Medium=t.difficulty?.Medium?.coop?.Standard,a.coop.MilitaryOnly=t.difficulty?.Medium?.coop?.MilitaryOnly,a.coop.Apopalypse=t.difficulty?.Medium?.coop?.Apopalypse,a.coop.Reverse=t.difficulty?.Medium?.coop?.Reverse,a.coop.Hard=t.difficulty?.Hard?.coop?.Standard,a.coop.MagicOnly=t.difficulty?.Hard?.coop?.MagicOnly,a.coop.DoubleMoabHealth=t.difficulty?.Hard?.coop?.DoubleMoabHealth,a.coop.HalfCash=t.difficulty?.Hard?.coop?.HalfCash,a.coop.AlternateBloonsRounds=t.difficulty?.Hard?.coop?.AlternateBloonsRounds,a.coop.Impoppable=t.difficulty?.Hard?.coop?.Impoppable,a.coop.Clicks=t.difficulty?.Hard?.coop?.Clicks,a.highestRound=Math.max(...Object.values(a.single).map((e=>e?e.bestRound:0)),...Object.values(a.coop).map((e=>e?e.bestRound:0))),a.totalWins=Object.values(a.single).map((e=>e?e.timesCompleted:0)).reduce(((e,t)=>e+t))+Object.values(a.coop).map((e=>e?e.timesCompleted:0)).reduce(((e,t)=>e+t));for(let[e,t]of Object.entries(a.single))t&&!1===t.completed&&(t.bestRound>=constants.endRound[e]||t.completedWithoutLoadingSave)&&(t.completed=!0);for(let[e,t]of Object.entries(a.single))t&&!0===t.completed&&t.bestRound<constants.endRound[e]&&0==t.timesCompleted&&(t.completed=!1);for(let[e,t]of Object.entries(a.coop))t&&!1===t.completed&&(t.bestRound>=constants.endRound[e]||t.completedWithoutLoadingSave)&&(t.completed=!0);for(let[e,t]of Object.entries(a.coop))t&&!0===t.completed&&t.bestRound<constants.endRound[e]&&0==t.timesCompleted&&(t.completed=!1);processedMapData.Medals.single[e]={},processedMapData.Medals.coop[e]={};for(let[t,n]of Object.entries(a.single))n&&n.completed?processedMapData.Medals.single[e][t]=!0:processedMapData.Medals.single[e][t]=!1;for(let[t,n]of Object.entries(a.coop))n&&n.completed?processedMapData.Medals.coop[e][t]=!0:processedMapData.Medals.coop[e][t]=!1;processedMapData.Medals.single[e]["CHIMPS-BLACK"]=!(!a.single.Clicks||!a.single.Clicks.completed)&&a.single.Clicks.completedWithoutLoadingSave,processedMapData.Medals.coop[e]["CHIMPS-BLACK"]=!(!a.coop.Clicks||!a.coop.Clicks.completed)&&a.coop.Clicks.completedWithoutLoadingSave;let n=["Easy","PrimaryOnly","Deflation"].every((e=>a.single[e]&&!0===a.single[e].completed)),s=n&&["Medium","MilitaryOnly","Apopalypse","Reverse"].every((e=>a.single[e]&&!0===a.single[e].completed)),l=s&&["Hard","MagicOnly","DoubleMoabHealth","HalfCash","AlternateBloonsRounds","Impoppable","Clicks"].every((e=>a.single[e]&&!0===a.single[e].completed)),d=l&&a.single.Clicks.completedWithoutLoadingSave;processedMapData.Borders.single[e]=d?"Black":l?"Gold":s?"Silver":n?"Bronze":"None",n=["Easy","PrimaryOnly","Deflation"].every((e=>a.coop[e]&&!0===a.coop[e].completed)),s=n&&["Medium","MilitaryOnly","Apopalypse","Reverse"].every((e=>a.coop[e]&&!0===a.coop[e].completed)),l=s&&["Hard","MagicOnly","DoubleMoabHealth","HalfCash","AlternateBloonsRounds","Impoppable","Clicks"].every((e=>a.coop[e]&&!0===a.coop[e].completed)),d=l&&a.coop.Clicks.completedWithoutLoadingSave,processedMapData.Borders.coop[e]=d?"Black":l?"Gold":s?"Silver":n?"Bronze":"None",processedMapData.Maps[e]=a}}function generateInstaData(){let e={},t={},a={},n={},s={};for(let[l,d]of Object.entries(btd6usersave.instaTowers)){s[l]=[],e[l]=0;let r={1:0,2:0,3:0,4:0,5:0};t[l]=t[l]||r;let i={1:[],2:[],3:[],4:[],5:[]};a[l]=a[l]||i;for(let[a,n]of Object.entries(d))e[l]+=n,constants.instaTiers[5].includes(a)&&(t[l][5]+=1),constants.instaTiers[4].includes(a)&&(t[l][4]+=1),constants.instaTiers[3].includes(a)&&(t[l][3]+=1),constants.instaTiers[2].includes(a)&&(t[l][2]+=1),constants.instaTiers[1].includes(a)&&(t[l][1]+=1);if(constants.collectionOrder.forEach((e=>{null==d[e]&&(constants.instaTiers[5].includes(e)&&a[l][5].push(e),constants.instaTiers[4].includes(e)&&a[l][4].push(e),constants.instaTiers[3].includes(e)&&a[l][3].push(e),constants.instaTiers[2].includes(e)&&a[l][2].push(e),constants.instaTiers[1].includes(e)&&a[l][1].push(e))})),t[l][4]==constants.instaTiers[4].length&&t[l][3]==constants.instaTiers[3].length&&t[l][2]==constants.instaTiers[2].length&&t[l][1]==constants.instaTiers[1].length){if(t[l][5]==constants.instaTiers[5].length){n[l]="Black";continue}n[l]="Gold"}else n[l]=""}processedInstaData.TowerTotal=e,processedInstaData.TowerTierTotals=t,processedInstaData.TowerMissingByTier=a,processedInstaData.TowerBorders=n,processedInstaData.TowerObtained=s}function calculateInstaBorder(e){processedInstaData.TowerTierTotals[e][4]==constants.instaTiers[4].length&&processedInstaData.TowerTierTotals[e][3]==constants.instaTiers[3].length&&processedInstaData.TowerTierTotals[e][2]==constants.instaTiers[2].length&&processedInstaData.TowerTierTotals[e][1]==constants.instaTiers[1].length?processedInstaData.TowerTierTotals[e][5]==constants.instaTiers[5].length?processedInstaData.TowerBorders[e]="Black":processedInstaData.TowerBorders[e]="Gold":processedInstaData.TowerBorders[e]=""}fetchConstants().then((()=>{generateVersionInfo()}));const header=document.querySelector(".header"),headerDiv=document.querySelector(".header-div"),title=document.querySelector(".title"),content=document.querySelector(".content");function generateFrontPage(){const e=document.getElementById("home-content");e.appendChild(createEl("p",{classList:["disclaimer-text","font-gardenia"],style:{fontSize:"18px",textAlign:"center",lineHeight:"1.5"},innerHTML:'A fanmade viewer for the Ninja Kiwi <a href="https://data.ninjakiwi.com/" target="_blank" style="color: white;">Open Data API</a> plus other features.<br>This site is not affiliated with Ninja Kiwi. All game assets belong to Ninja Kiwi.'})),e.appendChild(createEl("p",{classList:["site-info-header","black-outline"],innerHTML:"Site Features and Information"}));let t=createEl("div",{classList:["d-flex","jc-between"],style:{width:"700px",height:"400px",paddingTop:"20px"}});e.appendChild(t);let a=createEl("div",{classList:["d-flex","fd-column"],style:{width:"300px",background:"rgba(0,0,0,0.36)",padding:"10px",borderRadius:"10px",boxShadow:"0 0 10px rgba(0, 0, 0, 0.5)",gap:"1rem"}});t.appendChild(a);let n=createEl("p",{classList:["font-luckiest","black-outline"],style:{fontSize:"28px",textAlign:"center"},innerHTML:"BTD6 API Explorer"});a.appendChild(n);let s=createEl("p",{classList:["font-gardenia"],style:{fontSize:"20px",lineHeight:"1.5"},innerHTML:"Click on the images to access the sites!"});a.appendChild(s);let l=createEl("img",{classList:["site-image-scroll"],style:{borderRadius:"10px",boxShadow:"0 0 10px rgba(0, 0, 0, 0.5)",transition:"background-image 0.5s ease-in-out",width:"400px"}});t.appendChild(l);let d=createEl("div",{classList:["d-flex","jc-center"],style:{paddingTop:"20px"}});function r(e){let t=imageScroll[e];l.src=`Assets/UI/${t.image}.webp`,n.innerHTML=t.title,s.innerHTML=t.text,d.innerHTML="";for(let t=0;t<=imageScroll.length-1;t++){let a=document.createElement("div");a.classList.add("map-page-dot"),e==t&&a.classList.add("map-page-dot-active"),d.appendChild(a),a.addEventListener("click",(()=>{imageScrollIndex=t,r(t)}))}}e.appendChild(d),r(0),t.addEventListener("click",(()=>{imageScrollIndex=(imageScrollIndex+1)%imageScroll.length,r(imageScrollIndex)}));let i=document.createElement("div");i.classList.add("d-flex","jc-evenly","w-100"),i.style.margin="10px",e.appendChild(i);let o=document.createElement("p");o.classList.add("where-button","black-outline"),o.innerHTML="FAQ";let c=document.createElement("p");c.classList.add("where-button","black-outline"),c.innerHTML="Known Issues";let p=document.createElement("p");p.classList.add("where-button","black-outline"),p.innerHTML="Changelog",i.appendChild(p),i.appendChild(o),i.appendChild(c);let m=document.createElement("div");m.id="faq-div",m.classList.add("faq-div"),m.style.display="none",e.appendChild(m);let u=document.createElement("div");u.id="known-issues-div",u.classList.add("known-issues-div"),u.style.display="none",e.appendChild(u);let h=document.createElement("div");h.id="changelog-div",h.classList.add("changelog-div"),h.style.display="none",e.appendChild(h);let g=document.createElement("p");g.classList.add("site-info-header","sites-text","black-outline"),g.innerHTML="Standalone Sites",e.appendChild(g);let b=document.createElement("p");b.classList.add("where-text"),b.innerHTML="Separate pages with just one module of this site:",e.appendChild(b);let L=document.createElement("div");L.classList.add("site-access-div"),e.appendChild(L);let v=document.createElement("div");v.classList.add("standalone-site-buttons"),L.appendChild(v);Object.entries({Roundsets:{link:"https://btd6apiexplorer.github.io/rounds",text:"Roundsets",icon:"DefaultRoundSetIcon",background:"BloonsBG"},Leaderboards:{link:"https://btd6apiexplorer.github.io/leaderboards",text:"Leaderboards",icon:"LeaderboardSiteBtn",background:"TrophyStoreTiledBG"},"Rogue Artifacts":{link:"https://btd6apiexplorer.github.io/rogue",text:"Rogue Artifacts",icon:"RogueSiteBtn",background:"RogueBG"},"Insta Tracker":{link:"https://btd6apiexplorer.github.io/insta",text:"Insta Tracker",icon:"InstaSiteBtn",background:"CollectionHelp2"}}).forEach((([e,t])=>{let a=document.createElement("div");a.classList.add("site-button-div","pointer"),a.style.backgroundImage=`url(Assets/UI/${t.background}.webp)`,v.appendChild(a),a.addEventListener("click",(()=>{window.location.href=t.link}));let n=document.createElement("img");n.classList.add("site-button-icon"),n.src=`./Assets/UI/${t.icon}.webp`,a.appendChild(n);let s=document.createElement("p");s.classList.add("profile-name","readability-bg","black-outline"),s.style.marginLeft="0",s.innerHTML=t.text,a.appendChild(s)}));let y=document.createElement("div");y.id="version-div",y.classList.add("version-div"),e.appendChild(y),o.id="faq-button",o.addEventListener("click",(()=>{M("faq")})),c.id="known-issues-button",c.addEventListener("click",(()=>{M("known-issues")})),p.id="changelog-button",p.addEventListener("click",(()=>{M("changelog")}));let f=document.createElement("p");f.classList.add("oak-instructions-header","black-outline"),f.innerHTML="Frequently Asked Questions",m.appendChild(f);let C={"How long does the API take to update after I do something in the game?":"15 minutes is the most I've seen. Be sure to press the save button in settings if you want to minimize the time it takes to update! It should not take more than 24 hours to update in any circumstance (browser caching, etc).","Why is logging in not available for BTD6+ and Netflix?":"This is because the data is stored differently for these versions such as using iCloud for BTD6+. This is not compatible with the Open Data API.","How do I leave feedback?":'If you have any feedback including features to add or change on the site or bug reports, please join the project\'s <a href="https://discord.gg/wep2RDmcqZ" target="_blank" style="color: white;">Discord Server</a>. Alternatively, you can create an issue on <a href="https://github.com/HalfHydra/BTD6-API-Explorer/issues" target="_blank" style="color: white;">GitHub</a'};for(let[e,t]of Object.entries(C)){let a=document.createElement("div");a.classList.add("faq-entry-div"),m.appendChild(a);let n=document.createElement("div");n.classList.add("faq-question-div"),a.appendChild(n);let s=document.createElement("p");s.classList.add("faq-question"),s.innerHTML=e,n.appendChild(s);let l=document.createElement("img");l.classList.add("arrow-hide-btn"),l.src="./Assets/UI/ArrowHideBtn.webp",n.appendChild(l);let d=document.createElement("div");d.classList.add("faq-answer-div"),d.style.display="none",a.appendChild(d);let r=document.createElement("p");r.classList.add("faq-answer"),r.innerHTML=t,d.appendChild(r),n.addEventListener("click",(()=>{"none"===d.style.display?(d.style.display="block",l.style.transform="rotate(180deg)"):(d.style.display="none",l.style.transform="rotate(0deg)")}))}let w=document.createElement("p");w.classList.add("oak-instructions-header","black-outline"),w.innerHTML="Known Issues",u.appendChild(w);let E=document.createElement("p");E.classList.add("oak-instructions-text"),E.innerHTML="\n    - Trophy Store items might be incorrect for some users. Currently investigating why<br>\n    ",u.appendChild(E);let k=document.createElement("p");k.classList.add("oak-instructions-header","black-outline"),k.innerHTML="Changelog",h.appendChild(k);let T=document.createElement("p");function M(e){["faq","known-issues","changelog"].forEach((t=>{const a=document.getElementById(t+"-div"),n=document.getElementById(t+"-button");if(t===e){"none"===a.style.display?(n.classList.add("square-btn-yellow"),a.style.display="block"):(n.classList.remove("square-btn-yellow"),a.style.display="none")}else n.classList.remove("square-btn-yellow"),a.style.display="none"}))}T.classList.add("oak-instructions-text"),T.innerHTML="v2.3.1: Minor fixes<br>- Updated trophy store items to use newer structure on the Open Data API, which should prevent this from being as inaccurate as before - still testing though.<br>- Games played text now shows up with the correct value<br>- SheRa Adora skin will now show up correctly.<br>- Other minor UI tweaks<br><br>\n    v2.3.0: Update 51 and Minor Updates<br>- Added Update 51 content including new Rogue changes <br>- You can now navigate to the more detailed menus from Quick Stats<br>- Towers menu now shows related Monkey Knowledge points (rework coming eventually)<br>- Added total of each tier to the game-like view of Insta Monkeys collection when \"Missing\" is toggled.<br>- Unavailable Relics will now displayed on the CT Relics page in prepration for a CT rework<br>- Duplicate (IAP/Special) Rogue starter kits will now show at the bottom<br>- The leaderboard refresh button will now only appear for currently active events<br>- Fixed a bug causing the Clear Filters button to break some roundsets functionality.<br>- Top Paragons will no longer show if there aren't any<br>- Events will now refetch their information from the API after 10 minutes.<br>- The scrollbar is no longer accidentally unstyled. Whoops<br>- Fixed numerous bugs with the back button not clearing when going back<br><br>\n    v2.2.0: Leaderboard Revamp + Rogue Improvements<br>- Leaderboards have been revamped with better loading times.<br>- Clicking a team on the Contested Territory leaderboard will now show their group of competing teams and their scores.<br>- Leaderboards will now refresh the next time you access them if it's been a while and you don't refresh the page.<br>- A manual refresh button has been added to the top of individual leaderboards.<br>- Leaderboards now show text indicating if it is loading new entries and if it has reached the end.<br>- Fixed a bug causing the timers on events to freeze after going back and forward to various menus.<br>- Rogue Artifacts now has a clear filter button.<br>- Rogue Artifacts count should now correctly display if the collection mode is turned off.<br>- Rogue Legends artifact popout updated to include the update that the artifact was added in as well as display an insta monkey that is added if it has one.<br>- Rogue legends starter kits now also show the insta monkey that is added via a starter artifact.<br>- Fixed numerous UI bugs including a missing Fortified DDT Icon, the rogue legends artifact sorting preview not working anymore.<br><br>\n    v2.1.0: Roundsets Revamp + Quests!<br>- The roundset viewer now has options for filtering. This includes a round range (good for Rogue Legends), starting cash, as well as filtering by bloons. There are 6 basic filters and then a toggle for an advanced mode that allows you to filter down to specific bloons.<br>- Bloon Group timings in the detailed view of rounds now has a tooltip that will show the exact timings on hover.<br>- Clicking the round number in simple or detailed will now take you to the previewer for that round.<br>- The roundset previewer has been fixed, and the UI has been rearranged. No more lag issues causing inaccurate previews, it should always be accurate now no matter the capabilities of your device.<br>- You can now turn off round hints.<br>- A helpful message describing the boss roundset changes has been added for each boss.<br>- Quests have been added under the Profile tab. You can also view the custom roundset (if it has one) from there.<br>- Fixed boss details showing the incorrect scoring type.<br>- Fixed some UI issues in Collection Event menus.<br>- You can now reveal hidden achievement descriptions. This will be complimented later with a guide for a select few taht are tougher or less straight forward in the future.<br>- Fixed the download for Rogue artifacts on Firefox.<br>- Fixed a bug that enabled XSS with named monkeys.<br>- New heroes should no longer break the site before I add them. Oops.<br>- 2 variant artifacts filtering has been fixed to include all of them.<br>- Rogue Artifact popout should no longer make you jump to the top of the scrollbar.<br>- Fixed a bug involving reverse mode in the detailed section of roundsets.<br>- Fixed a bug where the list view on map stats would not show any maps after update 45. Whoops, thank you @200e200w for reporting this on the Discord Server.<br><br>\n    v2.0.0: Major Update and Update 49!<br>- The site has been completely reworked and redesigned, allowing for less focus on logging in.<br>- A global back button has been implemented at the top left that will always immediately take you back to wherever you just were.<br>- A way of viewing and filtering the current schedule for collection event featured instas has been added.<br>- Top 1% Boss medal was renamed to Top 100.<br>- Roundsets simple view now shows the time per round on the right.<br>- The full time information for events can now be found via a tooltip on the events list.<br>- Rogue Artifacts search now correctly changes the total count for searching.<br>- Special Rogue Roundsets now show their tooltip of what you would see in game for the associated roundset.<br>- Fixed Hero Skin count. NK wasn't the only one who somehow had issues with that...<br>- Fixed ordering for artifacts using internal name instead of alphabetical name.<br>- You can now logout of your profile and use another OAK token without refreshing the page.<br>- Profiles from leaderboards should no longer be missing many medals.<br>- Standalone pages now only load what's essential for them.<br>- The new achievement was added. <br>- Leaderboards have been fixed.<br><br>\n    v1.9.1: Many Bug Fixes<br>- Fixed Voidora's hero starter kit being incorrect<br>- Fixed CT Local Medals not appearing and Global medals being incorrectly labeled<br>- Fixed the normal Rogue Legends roundset not being updated with the Update 48 changes<br>- Fixed a bug causing modded paragons to show up and error out<br><br>\n    v.1.9.0: Update 48 Content, Abilites Used Section, Top Paragons<br>- Added all content from Update 48 (there was a lot)<br>- You are now able to view how many times you've used each ability. You can find this under Progress -> Unqiue Abilities Used<br>- Top Paragons will now appear under Top Towers and Top Heroes on the overview<br>- Rogue Legends received an update with 6 new roundset variations, those have been added as a top bar with an icon of what bloons on the tile the roundset correlates to.<br>- Rogue Legends Artifacts has been updated to include all the artifacts added, as well as be able to sort for only Update 48 artifacts.<br><br>\n    v1.8.1: Rogue Artifacts Updates<br>- Filter & Sort has been reworked into a new settings menu that adds lots of new filtering options<br>- A search bar has been added to find artifacts quickly<br>- The total count of artifacts should now always be accurate<br>- The back button now correctly returns you to where you were prior<br><br>\n    v1.8.0: Rogue Legends Artifacts<br>- Added Rogue Legends Artifacts standalone site. Allows you to track and share your artifacts collection with others, as well as reference Hero Starter Kits for each artifact<br>- Unfortunately the Open Data API does not have the extracted artifacts available for your profile, so all entry will be manual<br>- Updated the standalone site buttons to be simpler<br><br>\n    v.1.7.1: Inevitable bug fixes<br>- Rogue Legends Stats will no longer show up if you don't own it<br>- Tooltips now render HTML entities, have larger text, and have the arrow centered<br>- Added missing tooltips from leaderboards site<br><br>\n    v.1.7.0: Update 47 and Tooltips!<br>- Added Update 47.1 content including the new Rogue Legends roundset<br>- Added proper tooltips to medals and a few other places like the Towers section.<br>- Added Rogue Legends stats to the overview page<br>- Added Round Hints to the roundset viewer<br>- Added Overall Highest Round and Total Games Won on the map specific details menu<br>- Added missing Adora + Battle Cat Roundsets, and a few older Odysseys courtesy of @jessiepatch<br>- The standalone site buttons got a glow up.<br>- The roundset selection screen has been condensed and cleaned up.<br>- Fixed a bug involving leaderboard requests that result in incorrect placements and duplicated entries<br>- Leaderboard entries should only have the profiles loaded if they are currently rendered on screen.<br><br>\n    v1.6.1: Inevitable Leaderboard Fixes<br>- The site no longer infinite loads when there are no active events<br>- The site no longer has any leaderboards with 0 scores shown (some older events get their leaderboards wiped early)<br>- Events that aren't started won't show up until they are active<br>- The initial load was improved, and the loading icon now shows correctly when clicking a leaderboard for the first time<br><br>\n    v1.6.0: Leaderboards improvements and page!<br>- There is now a <a href=\"./leaderboards\" target=\"_blank\" style=\"color: white;\">Leaderboards Page</a> made specifically for viewing them all in one place.<br>- Loading profiles automatically has been turned back on because...<br>- Improved the handling of automatically loading leaderboard profiles to not be rate limited as quickly. This system should hopefully prevent any rate limiting at all.<br><br>\n    v1.5.1: Bug fixes! <br>- Zero limited or excluded towers/heroes like the upcoming Bloonarius 56 will no longer show an empty box<br>- The timer no longer jumps to the first event of the list assuming there is only one active at a time.<br><br>\n    v1.5.0: Trophy Store Items and Update 46!<br>- Added Update 46 content<br>- Added the Trophy Store Items menu for those who want to see all that exist and your collection.<br>- Team Store items have also been added, but since I am unable to test how that works, it is hidden in settings by default.<br>- Settings should now save when reloading the page using the same system that saves the OAK tokens you've used.<br>- Fixed a bug that prevented newer maps from showing up<br>- Added missing badges<br><br>\n    v1.4.0: Extras and Events in Roundsets<br>- User profiles on the leaderboards and content browser no longer load by default. This caused too many rate limiting issues.<br>- Added a setting in Settings to toggle automatic profile loading back on if you wanted to see the profile avatar and banner of users on the leaderboard.<br>- Added known previous events with custom roundsets to the Roundsets section.<br>- Fixed a bug involving timers going weirdly negative<br>- Added Creator Support instructions<br><br>\n    v1.3.0: QoL Changes<br>- Added Update 45 images and content<br>- You can now toggle to see just the excluded towers and heroes of a challenge or event<br>- You can now swap between Normal/Elite on the details for a boss<br>- Bloon groups can now be hidden in the round previewer by clicking on them<br>- Added a checkmark in the Collection Event list to categories that were completely collected<br>- Updated Endurance Rounds to use updated round thresholds<br>- Resolved an issue when applying a filter to content browser content and not refreshing<br>- Added Ceramic Flood Roundset (very late)<br><br>\n    v1.2.3: Collection Event Menu Upgrade<br>- Added a how to use guide at the top of the Collection Event Menu<br>- Added the Insta Chest odds to the Collection Event Menu<br>- Clicking on a missing Insta will now temporarily mark it as obtained<br><br>\n    v1.2.2: Missing Medals<br>- Added a few missing medals from the overview/leaderboard profile pages<br>- Added mouse hover tooltips to various elements<br><br>\n    v1.2.1: Insta Monkey Collection Improvements<br>- Resolved an issue preventing the collected but used Insta Monkeys from being displayed.<br>- Add a new list of all the Insta Monkey tower chances in the Collection Event Helper for efficient checking of what the best Featured Insta Monkey to choose is.<br>- The trailer video no longer plays in the background after previewing the site or logging in! Thanks for the feedback.<br><br>v1.2.0: Preview Mode and UI Improvements <br>- Added a way to use the site without an OAK token. Useful when you don't have it accessible or can't make one<br>- The site now prompts when your data has new content that the site doesn't have updated yet<br>- Challenge details now correctly shows the max amount of specific monkeys if limited<br>- Other UI fixes<br><br>\n    v1.1.0: Insta Monkey Collection Features<br>- Added Insta Monkey Collection Event Helper. This displays the odds of getting a new Insta Monkey for each chest type and when selecting a featured tower.<br>- Also added a page documentating all of the continuous sources of Insta Monkeys<br>- UI fixes and improvements<br><br>v1.0.1: Bug Fixes<br>- Daily challenges now show the correct associated date<br>- Rework roundset processing to fix numerous bugs<br>- Add extra one-off roundsets to the list for completion sake<br>- Other minor UI fixes<br><br>\n    v1.0.0: Initial Release<br>- The Odyssey tab is still being worked on and will be added in the near future.<br>- An Insta Monkeys Rotation helper will also be added soon.",h.appendChild(T)}function generateVersionInfo(){let e=document.getElementById("version-div"),t=document.createElement("p");t.classList.add("tool-version-text"),t.innerHTML=`App Version: ${constants.version} / Game Content Version: v${constants.projectContentVersion}`,e?.appendChild(t)}readLocalStorage();let headerTabs=["home","profile","events","leaderboards","rounds","extras"];function generateHeaderTabs(){const e=document.querySelector(".header-container");headerTabs.forEach((t=>{t=t.toLowerCase();let a=document.createElement("p");a.classList.add("header-label","black-outline"),a.id=t.toLowerCase(),a.innerHTML=t,a.addEventListener("click",(()=>{changeTab(t.toLowerCase())})),e.appendChild(a)}))}function changeTitle(e){document.querySelector(".title").innerHTML=e}function changeTab(e){clearBackQueue(),resetScroll(),timerInterval&&clearInterval(timerInterval),changeHexBGColor(constants.BGColor);for(let t of document.querySelector(".content").children)t.id===e+"-content"?t.style.display="flex":t.style.display="none";for(let e of headerTabs)document.getElementById(e)&&document.getElementById(e).classList.remove("selected");document.getElementById(e)&&document.getElementById(e).classList.add("selected");for(let e of document.getElementsByClassName("sub-content-div"))e.style.display="none";switch(changeTitle("Bloons TD 6 API Explorer"),e){case"overview":generateOverview();break;case"profile":generateProgress();break;case"events":generateEvents();break;case"explore":generateExplore();break;case"leaderboards":generateLeaderboards();break;case"rounds":changeTitle("Bloons TD 6 Roundsets"),generateRoundsets();break;case"extras":generateExtrasPage()}}let canvas,ctx,tempXP=0;function generateOverview(){let e=document.getElementById("profile-content");if(e.innerHTML="",addToBackQueue({source:"profile",destination:"profile",callback:generateProgress}),loggedIn){let t=document.createElement("div");t.classList.add("profile-container","bg-color-primary","w-100","content-div","overview"),e.appendChild(t);let a=document.createElement("div");a.classList.add("profile-header"),a.classList.add("profile-banner"),a.style.backgroundImage=`linear-gradient(to bottom, transparent 50%, var(--profile-primary) 70%),url('${getProfileBanner(btd6publicprofile)}')`,t.appendChild(a),a.appendChild(generateAvatar(100,getProfileAvatar(btd6publicprofile)));let n=document.createElement("div");n.classList.add("profile-top-bottom"),a.appendChild(n);let s=document.createElement("div");s.classList.add("profile-top"),n.appendChild(s);let l=document.createElement("p");if(l.classList.add("profile-name","black-outline"),l.innerHTML=btd6publicprofile.displayName,s.appendChild(l),btd6publicprofile.followers>0){let e=document.createElement("div");e.classList.add("profile-followers"),s.appendChild(e);let t=document.createElement("p");t.classList.add("followers-label","black-outline"),t.innerHTML="Followers",e.appendChild(t);let a=document.createElement("p");a.classList.add("followers-count"),a.innerHTML=btd6publicprofile.followers.toLocaleString(),e.appendChild(a)}let d=document.createElement("div");d.classList.add("profile-bottom"),n.appendChild(d),d.appendChild(generateRank()),btd6usersave.veteranXp>0&&d.appendChild(generateRank(!0));let r=document.createElement("div");r.classList.add("below-profile-header"),t.appendChild(r);let i=document.createElement("div");i.classList.add("left-column-div"),r.appendChild(i);let o=document.createElement("div");o.classList.add("quick-stats-div"),i.appendChild(o);let c=document.createElement("div");c.classList.add("quick-stats-header"),o.appendChild(c);let p=document.createElement("p");p.classList.add("column-header-text","black-outline"),p.innerHTML="Quick Stats",c.appendChild(p);let m=document.createElement("div");m.classList.add("quick-stats-content"),o.appendChild(m);let u={Towers:"../Assets/UI/MaxMonkeysIcon.webp",Heroes:"../Assets/UI/AllHeroesIcon.webp",Extras:"../Assets/UI/SmallBloonsModeIcon.webp",Achievements:"../Assets/AchievementIcon/AchievementsIcon.webp",CHIMPS:"../Assets/MedalIcon/MedalImpoppableRuby.webp",InstaMonkeys:"../Assets/UI/InstaIcon.webp",MapProgress:"../Assets/UI/StartRoundIconSmall.webp",Paragons:"../Assets/UI/ParagonPip.webp",Powers:"../Assets/UI/PowerContainer.webp",Skins:"../Assets/UI/TopHatSprite.webp",Upgrades:"../Assets/UI/UpgradeIcon.webp",Knowledge:"../Assets/UI/KnowledgeIcon.webp",TrophyStore:"../Assets/UI/LimitedRunIcon.webp",TeamsStore:"../Assets/UI/TeamTrophyIconSmall.webp",ActivatedAbilities:"../Assets/UI/RapidShotIcon.webp",Quests:"../Assets/UI/QuestIcon.webp"};Object.entries(progressSubText).forEach((([e,t])=>{if(t.includes("0 Extras")||t.includes("Team Store"))return;if(t.match(/(^|[^0-9])0\/\d{1,2}(?!\d)/))return;let a=document.createElement("div");a.classList.add("quick-stat","pointer"),m.appendChild(a);let n=document.createElement("img");n.classList.add("quick-stat-icon"),n.src=u[e],a.appendChild(n);let s=document.createElement("p");s.classList.add("quick-stat-name"),s.innerHTML=t,a.appendChild(s),a.addEventListener("click",(()=>{switch(addToBackQueue({source:"profile",destination:"profile",callback:generateOverview}),e){case"Towers":case"Upgrades":case"Paragons":generateTowerProgress();break;case"Heroes":case"Skins":generateHeroesProgress();break;case"ActivatedAbilities":generateAbilities();break;case"Knowledge":generateKnowledgeProgress();break;case"MapProgress":case"CHIMPS":generateMapsProgress();break;case"Powers":generatePowersProgress();break;case"InstaMonkeys":generateInstaMonkeysProgress();break;case"Achievements":generateAchievementsProgress();break;case"Extras":generateExtrasProgress();break;case"TrophyStore":generateTrophyStoreProgress();break;case"TeamsStore":generateTeamsStoreProgress();break;case"Logout":logoutProgress();break;case"Quests":generateQuestsPage()}}))}));let h=document.createElement("div");h.classList.add("currency-medals-div"),i.appendChild(h);let g=document.createElement("div");g.classList.add("left-column-header"),h.appendChild(g);let b=document.createElement("p");b.classList.add("column-header-text","black-outline"),b.innerHTML="Currency and Medals",g.appendChild(b);let L=document.createElement("div");L.classList.add("currency-div"),h.appendChild(L);let v=document.createElement("div");v.classList.add("currency-mm-div"),L.appendChild(v);let y=document.createElement("img");y.classList.add("currency-mm-img"),y.src="../Assets/UI/BloonjaminsIcon.webp",v.appendChild(y);let f=document.createElement("p");f.classList.add("currency-mm-text","mm-outline"),f.innerHTML="$"+btd6usersave.monkeyMoney.toLocaleString(),v.appendChild(f);let C=document.createElement("div");C.classList.add("currency-knowledge-div"),L.appendChild(C);let w=document.createElement("img");w.classList.add("currency-knowledge-img"),w.src="../Assets/UI/KnowledgeIcon.webp",C.appendChild(w);let E=document.createElement("p");E.classList.add("currency-knowledge-text","knowledge-outline"),E.innerHTML=btd6usersave.knowledgePoints.toLocaleString(),C.appendChild(E);let k=document.createElement("div");k.classList.add("currency-trophies-div"),L.appendChild(k);let T=document.createElement("img");T.classList.add("currency-trophies-img"),T.src="../Assets/UI/TrophyIcon.webp",k.appendChild(T);let M=document.createElement("p");M.classList.add("currency-trophies-text","black-outline"),M.innerHTML=btd6usersave.trophies.toLocaleString(),k.appendChild(M);let S=document.createElement("div");S.classList.add("medals-div"),h.appendChild(S);for(let[e,t]of Object.entries(medalsInOrder)){if(0===t)continue;let a=document.createElement("div");a.classList.add("medal-div"),S.appendChild(a),tippy(a,{content:constants.medalLabels[e],placement:"top",theme:"speech_bubble"});let n=document.createElement("img");n.classList.add("medal-img"),n.src=getMedalIcon(e),n.style.display="none",n.addEventListener("load",(()=>{n.width<n.height?n.style.width=`${ratioCalc(3,70,256,0,n.width)}px`:n.style.height=`${ratioCalc(3,70,256,0,n.height)}px`,n.style.removeProperty("display")})),a.appendChild(n);let s=document.createElement("p");s.classList.add("medal-text","black-outline"),s.innerHTML=t.toLocaleString(),a.appendChild(s)}let I=document.createElement("div");I.classList.add("top-heroes-monkeys-div"),i.appendChild(I);let x=document.createElement("div");x.classList.add("top-heroes-div"),I.appendChild(x);let B=document.createElement("div");B.classList.add("top-heroes-top-div"),x.appendChild(B);let A=document.createElement("div");A.classList.add("top-heroes-top-ribbon-div"),B.appendChild(A);let D=document.createElement("p");D.classList.add("top-heroes-text","black-outline"),D.innerHTML="Top Heroes",A.appendChild(D);let P=document.createElement("div");P.classList.add("maps-progress-coop-toggle"),B.appendChild(P);let H=document.createElement("p");H.classList.add("maps-progress-coop-toggle-text","black-outline"),H.innerHTML="Show All: ",P.appendChild(H);let O=document.createElement("input");O.classList.add("maps-progress-coop-toggle-input"),O.type="checkbox",P.appendChild(O);let R=document.createElement("div");R.classList.add("top-heroes-list"),x.appendChild(R);let F=document.createElement("div");F.classList.add("top-3-heroes-div"),R.appendChild(F);let $=document.createElement("div");$.classList.add("other-heroes-div"),$.style.display="none",R.appendChild($),O.addEventListener("change",(()=>{O.checked?$.style.display="flex":$.style.display="none"}));let U=0,N=Object.keys(constants.heroesInOrder);for(let[e,t]of Object.entries(btd6publicprofile.heroesPlaced).sort(((e,t)=>t[1]-e[1]))){if(0===t)continue;if(!N.includes(e))continue;let a=document.createElement("div");a.classList.add("hero-div"),a.title=getLocValue(e),U<3?F.appendChild(a):$.appendChild(a);let n=document.createElement("img");n.classList.add("hero-img"),n.src=getHeroPortrait(e,1),n.style.display="none",n.addEventListener("load",(()=>{n.width<n.height?n.style.width=`${ratioCalc(3,150,1920,0,n.width)}px`:n.style.height=`${ratioCalc(3,150,1920,0,n.height)}px`,n.style.removeProperty("display")})),a.appendChild(n);let s=document.createElement("p");s.classList.add("hero-text","black-outline"),s.innerHTML=t.toLocaleString(),a.appendChild(s),U++,tippy(a,{content:`${getLocValue(e)} Placed ${t.toLocaleString()} Times`,placement:"top",theme:"speech_bubble"})}let j=document.createElement("div");j.classList.add("top-heroes-div"),I.appendChild(j);let G=document.createElement("div");G.classList.add("top-heroes-top-div"),j.appendChild(G);let V=document.createElement("div");V.classList.add("top-heroes-top-ribbon-div"),G.appendChild(V);let _=document.createElement("p");_.classList.add("top-heroes-text","black-outline"),_.innerHTML="Top Towers",V.appendChild(_);let q=document.createElement("div");q.classList.add("maps-progress-coop-toggle"),G.appendChild(q);let K=document.createElement("p");K.classList.add("maps-progress-coop-toggle-text","black-outline"),K.innerHTML="Show All: ",q.appendChild(K);let z=document.createElement("input");z.classList.add("maps-progress-coop-toggle-input"),z.type="checkbox",q.appendChild(z);let J=document.createElement("div");J.classList.add("top-heroes-list"),j.appendChild(J);let W=document.createElement("div");W.classList.add("top-3-heroes-div"),J.appendChild(W);let Q=document.createElement("div");Q.classList.add("other-heroes-div"),Q.style.display="none",J.appendChild(Q),z.addEventListener("change",(()=>{z.checked?Q.style.display="flex":Q.style.display="none"})),U=0;let Y=Object.keys(constants.towersInOrder);for(let[e,t]of Object.entries(btd6publicprofile.towersPlaced).sort(((e,t)=>t[1]-e[1]))){if(0===t)continue;if(!Y.includes(e))continue;let a=document.createElement("div");a.classList.add("hero-div"),a.title=getLocValue(e),U<3?W.appendChild(a):Q.appendChild(a);let n=document.createElement("img");n.classList.add("hero-img"),n.src=getInstaContainerIcon(e,"000"),a.appendChild(n);let s=document.createElement("p");s.classList.add("hero-text","black-outline"),s.innerHTML=t.toLocaleString(),a.appendChild(s),U++,tippy(a,{content:`${getLocValue(e)} Placed ${t.toLocaleString()} Times`,placement:"top",theme:"speech_bubble"})}let Z=document.createElement("div");Z.classList.add("top-heroes-div"),Object.entries(btd6publicprofile.stats.paragonsPurchasedByName).length>0&&I.appendChild(Z);let X=document.createElement("div");X.classList.add("top-heroes-top-div"),Z.appendChild(X);let ee=document.createElement("div");ee.classList.add("top-heroes-top-ribbon-div"),ee.style.filter="hue-rotate(250deg)",X.appendChild(ee);let te=document.createElement("p");te.classList.add("top-heroes-text","black-outline"),te.innerHTML="Top Paragons",ee.appendChild(te);let ae=document.createElement("div");ae.classList.add("maps-progress-coop-toggle"),X.appendChild(ae);let ne=document.createElement("p");ne.classList.add("maps-progress-coop-toggle-text","black-outline"),ne.innerHTML="Show All: ",ae.appendChild(ne);let se=document.createElement("input");se.classList.add("maps-progress-coop-toggle-input"),se.type="checkbox",ae.appendChild(se);let le=document.createElement("div");le.classList.add("top-heroes-list"),Z.appendChild(le);let de=document.createElement("div");de.classList.add("top-3-heroes-div"),le.appendChild(de);let re=document.createElement("div");re.classList.add("other-heroes-div"),re.style.display="none",le.appendChild(re),se.addEventListener("change",(()=>{se.checked?re.style.display="flex":re.style.display="none"})),U=0;for(let[e,t]of Object.entries(btd6publicprofile.stats.paragonsPurchasedByName).sort(((e,t)=>t[1]-e[1]))){if(0===t)continue;if(!constants.paragonsAvailable.includes(e))continue;let a=document.createElement("div");a.classList.add("hero-div"),a.style.backgroundImage="url(../Assets/UI/ParagonContainer.webp)",U<3?de.appendChild(a):re.appendChild(a);let n=document.createElement("img");n.classList.add("hero-img"),n.src=getTowerAssetPath(e,"Paragon"),a.appendChild(n);let s=document.createElement("p");s.classList.add("hero-text","black-outline"),s.innerHTML=t.toLocaleString(),a.appendChild(s),U++,tippy(a,{content:`${getLocValue(e+" Paragon")} Placed ${t.toLocaleString()} Times`,placement:"top",theme:"speech_bubble"})}let ie=document.createElement("div");ie.classList.add("right-column-div"),r.appendChild(ie);let oe=document.createElement("div");oe.classList.add("profile-stats"),ie.appendChild(oe);let ce=document.createElement("div");ce.classList.add("overview-right-column-header"),oe.appendChild(ce);let pe=document.createElement("p");pe.classList.add("column-header-text","black-outline"),pe.innerHTML="Profile Stats",ce.appendChild(pe);for(let[e,t]of Object.entries(profileStats)){let a=document.createElement("div");a.classList.add("stat"),oe.appendChild(a);let n=document.createElement("p");n.classList.add("stat-name"),n.innerHTML=e,a.appendChild(n);let s=document.createElement("p");s.classList.add("stat-value"),s.innerHTML=t.toLocaleString(),a.appendChild(s)}let me=document.createElement("div");me.classList.add("profile-stats"),ie.appendChild(me);let ue=document.createElement("div");ue.classList.add("overview-right-column-header"),me.appendChild(ue);let he=document.createElement("p");he.classList.add("column-header-text","black-outline"),he.innerHTML="API Exclusive Stats",ue.appendChild(he);for(let[e,t]of Object.entries(exclusiveStats)){if(null==t)continue;let a=document.createElement("div");a.classList.add("stat"),me.appendChild(a);let n=document.createElement("p");n.classList.add("stat-name"),n.innerHTML=e,a.appendChild(n);let s=document.createElement("p");s.classList.add("stat-value"),s.innerHTML=t.toLocaleString(),a.appendChild(s)}if(btd6usersave.hasOwnProperty("rogueLegends")){let e=document.createElement("div");e.classList.add("profile-stats"),ie.appendChild(e);let t=document.createElement("div");t.classList.add("overview-right-column-header"),e.appendChild(t);let a=document.createElement("p");a.classList.add("column-header-text","black-outline"),a.innerHTML="Rogue Legends Stats",t.appendChild(a);let n={};n["Tiles Captured"]=btd6usersave.rogueLegends.tilesCaptured,n["Campaign Maps Won"]=btd6usersave.rogueLegends.bossesDefeated,n["Common Artifacts Collected"]=btd6usersave.rogueLegends.commonArtifactsCollected,n["Rare Artifacts Collected"]=btd6usersave.rogueLegends.rareArtifactsCollected,n["Legendary Artifacts Collected"]=btd6usersave.rogueLegends.legendaryArtifactsCollected,n["Common Boosts Collected"]=btd6usersave.rogueLegends.commonBoostsCollected,n["Rare Boosts Collected"]=btd6usersave.rogueLegends.rareBoostsCollected,n["Legendary Boosts Collected"]=btd6usersave.rogueLegends.legendaryBoostsCollected;for(let[t,a]of Object.entries(n)){let n=document.createElement("div");n.classList.add("stat"),e.appendChild(n);let s=document.createElement("p");s.classList.add("stat-name"),s.innerHTML=t,n.appendChild(s);let l=document.createElement("p");l.classList.add("stat-value"),l.innerHTML=a.toLocaleString(),n.appendChild(l)}}}}function generateRank(e){let t=document.createElement("div");t.classList.add("rank");let a=document.createElement("div");a.classList.add("rank-star"),t.appendChild(a);let n=document.createElement("img");n.classList.add("rank-img"),n.src=e?"../Assets/UI/LvlHolderVeteran.webp":"../Assets/UI/LvlHolder.webp",a.appendChild(n);let s=document.createElement("p");s.classList.add("rank-text","black-outline"),s.innerHTML=e?rankInfoVeteran.rank:rankInfo.rank,a.appendChild(s);let l=document.createElement("div");l.classList.add("rank-bar"),t.appendChild(l);let d=document.createElement("div");d.classList.add("rank-bar-fill"),e?(l.classList.add("rank-bar-veteran"),d.classList.add("rank-bar-fill-veteran"),d.style.width=null===rankInfoVeteran.xp?"100%":rankInfoVeteran.xp/rankInfoVeteran.xpGoal*100+"%"):d.style.width=null===rankInfo.xp?"100%":rankInfo.xp/rankInfo.xpGoal*100+"%",l.appendChild(d);let r=document.createElement("p");return r.classList.add("rank-bar-text"),r.innerHTML=e?null===rankInfoVeteran.xp?"Max Level":`${rankInfoVeteran.xp.toLocaleString()}/${rankInfoVeteran.xpGoal.toLocaleString()}`:null===rankInfo.xp?"Max Level":`${rankInfo.xp.toLocaleString()}/${rankInfo.xpGoal.toLocaleString()}`,null!=rankInfo.xp||e||r.classList.add("rank-bar-text-max"),l.appendChild(r),t}function generateProgress(){let e=document.getElementById("profile-content");if(e.innerHTML="",loggedIn){let t=document.createElement("div");t.classList.add("progress-page"),e.appendChild(t);let a=document.createElement("div");a.classList.add("selectors-div"),t.appendChild(a),currentInstaView="game";let n=createEl("div",{classList:["d-flex","jc-between","ai-center","bg-color-tertiary","pointer"],style:{padding:"10px",margin:"10px",borderRadius:"10px"}});n.addEventListener("click",(()=>{logoutProgress()})),n.appendChild(createEl("p",{classList:["profile-name","tc-white","font-luckiest","black-outline"],innerHTML:"Logged in as: "+btd6publicprofile.displayName}));const s=createEl("img",{style:{height:"50px"},src:"./Assets/UI/BackBtn.webp"});n.appendChild(s),a.appendChild(n);let l=document.createElement("div");l.classList.add("d-flex","jc-between","ai-center","view-profile","pointer","transparent-border"),l.style.backgroundImage=`url(${getProfileBanner(btd6publicprofile)})`,l.addEventListener("click",(()=>{generateOverview()})),a.appendChild(l);let d=document.createElement("img");d.classList.add("selector-img"),d.src=getProfileAvatar(btd6publicprofile),l.appendChild(d);let r=document.createElement("p");r.classList.add("selector-text","black-outline"),r.innerHTML="View Your Profile Stats",l.appendChild(r);let i=document.createElement("img");i.classList.add("selector-go-img"),i.src="../Assets/UI/ContinueBtn.webp",l.appendChild(i),["Towers","Heroes","ActivatedAbilities","MapProgress","Powers","InstaMonkeys","Knowledge","Achievements","Quests","TrophyStore","TeamsStore","Extras"].forEach((e=>{if(progressSubText[e].includes("0 Extras"))return;if(progressSubText[e].includes("Team Store")&&!showTeamsItems)return;let t=document.createElement("div");t.classList.add("selector-div","progress-selector-div"),t.addEventListener("click",(()=>{changeProgressTab(e)})),a.appendChild(t);let n=document.createElement("img");n.classList.add("selector-img"),n.src="Heroes"==e?`../Assets/HeroIconCircle/HeroIcon${btd6usersave.primaryHero}.webp`:"../Assets/UI/"+e.replace(" ","")+"Btn.webp",t.appendChild(n);let s=document.createElement("p");s.classList.add("selector-text","black-outline"),s.innerHTML=progressSubText[e],t.appendChild(s);let l=document.createElement("img");l.classList.add("selector-go-img"),l.src="../Assets/UI/ContinueBtn.webp",t.appendChild(l)}))}else{let t=document.createElement("div");t.classList.add("bg-color-primary","content-div","progress","d-flex"),e.appendChild(t);let a=generateLoginDiv();t.appendChild(a);let n=document.createElement("p");n.classList.add("site-info-header","black-outline"),n.innerHTML="When an OAK token is entered:",t.appendChild(n);let s={Maps:{name:"View Extra Map Stats!",desc:"You can view your highest round and times completed count for every map on every mode!"},InstaMonkeys:{name:"View Your Insta Monkeys Collection!",desc:"You can view how many of each Insta Monkey you've accumulated here as well as track your collection."},CollectionEvent:{name:"Collection Event Helper!",desc:"Using your current inventory, you can view the odds of getting a new Insta Monkey for each chest type in general and when selecting a featured tower."},Achievements:{name:"View Achievements!",desc:"You can view your achievement progress here as well as use a few useful filters such as finding Monkey Knowledge points as rewards."},Towers:{name:"View Your Towers!",desc:"You can view portait art and total xp for every tower you've unlocked here."},Heroes:{name:"View Your Heroes!",desc:"You can view all portrait art for all heroes and skins you've unlocked as well as hero level information here."},Powers:{name:"View Your Powers!",desc:"You can view how many of each power you've accumulated here."},Knowledge:{name:"View Your Knowledge!",desc:"You can view your Monkey Knowledge point unlock progress here."}},l=document.createElement("div");l.classList.add("insta-monkey-guide-container"),l.style.width="800px",t.appendChild(l),Object.keys(s).forEach((e=>{let t=document.createElement("div");t.classList.add("insta-monkey-guide-method"),l.appendChild(t);let a=document.createElement("p");a.classList.add("insta-monkey-guide-method-text","black-outline"),a.innerHTML=s[e].name,t.appendChild(a);let n=document.createElement("p");n.classList.add("insta-monkey-guide-method-desc"),n.innerHTML=s[e].desc,t.appendChild(n);let d=document.createElement("img");d.classList.add("insta-monkey-guide-method-img"),d.src=`./Assets/UI/Progress${e}.webp`,t.appendChild(d)}))}}function logoutProgress(){loggedIn=!1,pressedStart=!1,generateProgress()}function changeProgressTab(e){switch(resetScroll(),timerInterval&&clearInterval(timerInterval),addToBackQueue({source:"profile",destination:"profile",callback:generateProgress}),e){case"Towers":generateTowerProgress();break;case"Heroes":generateHeroesProgress();break;case"ActivatedAbilities":generateAbilities();break;case"Knowledge":generateKnowledgeProgress();break;case"MapProgress":generateMapsProgress();break;case"Powers":generatePowersProgress();break;case"InstaMonkeys":generateInstaMonkeysProgress();break;case"Achievements":generateAchievementsProgress();break;case"Extras":generateExtrasProgress();break;case"TrophyStore":generateTrophyStoreProgress();break;case"TeamsStore":generateTeamsStoreProgress();break;case"Logout":logoutProgress();break;case"Quests":generateQuestsPage()}}function generateTowerProgress(){let e=document.getElementById("profile-content");e.innerHTML="";let t=document.createElement("div");t.classList.add("tower-progress-container"),e.appendChild(t);let a=document.createElement("div");a.classList.add("tower-progress-div"),t.appendChild(a);let n=document.createElement("div");n.classList.add("tower-selector-header-top"),a.appendChild(n);let s=document.createElement("p");s.classList.add("tower-selector-header-text","black-outline"),s.innerHTML=`Towers - ${Object.keys(btd6usersave.unlockedTowers).filter((e=>btd6usersave.unlockedTowers[e])).length}/${Object.keys(btd6usersave.unlockedTowers).length}`,n.appendChild(s);let l=document.createElement("p");l.classList.add("tower-selector-header-text","black-outline"),l.innerHTML=`Upgrades - ${Object.keys(btd6usersave.acquiredUpgrades).filter((e=>btd6usersave.acquiredUpgrades[e])).length}/${Object.keys(btd6usersave.acquiredUpgrades).length}`,n.appendChild(l);let d=document.createElement("div");d.classList.add("tower-selector-header"),a.appendChild(d);btd6usersave.unlockedTowers;for(let[e,t]of Object.entries(constants.towersInOrder)){if(!Object.keys(btd6usersave.unlockedTowers).includes(e))continue;let a=document.createElement("div");a.id=e+"-selector",a.classList.add(`tower-selector-${t.toLowerCase()}`),btd6usersave.unlockedTowers[e]||a.classList.add("hero-selector-div-disabled"),a.addEventListener("click",(()=>{btd6usersave.unlockedTowers[e]&&generateTowerProgressTower(e)})),d.appendChild(a);let n=document.createElement("img");n.classList.add("tower-selector-img"),n.src=getInstaContainerIcon(e,"000"),a.appendChild(n);let s=document.createElement("div");s.id=e+"-selector-highlight",s.classList.add("tower-selector-highlight"),a.appendChild(s)}let r=document.createElement("div");r.id="tower-progress-content",r.classList.add("tower-progress-content"),t.appendChild(r),t.append(generateTowerProgressTower("DartMonkey"))}function generateTowerProgressTower(e){let t=document.getElementById("tower-progress-content");t.innerHTML="";let a=0;for(let t of Object.values(constants.towerPaths[e]))for(let e of Object.keys(t))btd6usersave.acquiredUpgrades[e]&&(a+=1);a=15===a;let n=!!constants.paragonsAvailable.includes(e)&&btd6usersave.acquiredUpgrades[`${e} Paragon`],s=document.createElement("div");s.classList.add("tower-progress-top"),n&&s.classList.add("tower-progress-top-paragon"),t.appendChild(s);let l=document.createElement("div");l.classList.add("tower-progress-content-top"),s.appendChild(l);let d=document.createElement("div");d.classList.add("tower-progress-info-container"),l.appendChild(d);let r=document.createElement("p");r.classList.add("tower-progress-content-text",n?"knowledge-outline":"black-outline");let i=useNamedMonkeys&&btd6usersave.namedMonkeys[e]?btd6usersave.namedMonkeys[e]:getLocValue(e);r.appendChild(document.createTextNode(i)),d.appendChild(r);let o=document.createElement("p");o.classList.add("tower-progress-content-xp","mm-outline"),o.innerHTML=`XP: ${btd6usersave.towerXP[e].toLocaleString()}`,d.appendChild(o);let c=document.createElement("p");c.classList.add("tower-progress-content-desc"+(n?"-paragon":"")),c.innerHTML=getLocValue(`${e} Description`),l.appendChild(c);let p=document.createElement("div");p.classList.add("tower-name-and-portrait"),t.appendChild(p);let m=document.createElement("p");m.id="tower-portrait-name",m.classList.add("tower-portrait-name","black-outline"),m.innerHTML=getLocValue(e),p.appendChild(m);let u=document.createElement("div");u.id="tower-progress-portrait",u.classList.add("tower-progress-portrait"),u.classList.add(`tower-progress-portrait-${constants.towersInOrder[e].toLowerCase()}`),p.appendChild(u);let h=document.createElement("img");h.id="tower-progress-portrait-img",h.classList.add("tower-progress-portrait-img"),h.src=getTowerAssetPath(e,"000"),u.appendChild(h);let g=document.createElement("div");g.classList.add("tower-progress-main-div","fd-column"),t.appendChild(g),g.appendChild(makeUpgradeButtons(e,a,n));let b=document.createElement("div");b.style.maxWidth="720px";let L=createEl("p",{classList:["black-outline","ta-center"],style:{fontSize:"28px"},innerHTML:"Knowledge Points:"});g.appendChild(L),g.appendChild(b);let v=createEl("div",{classList:[]});b.appendChild(v);let y=Object.keys(constants.knowledgeTags).filter((t=>constants.knowledgeTags[t].includes(e)||constants.knowledgeTags[t].includes("All"+constants.towersInOrder[e])));if(0===y.length)L.style.display="none";else for(let e of y){let t=document.createElement("img");t.classList.add("knowledge-icon"),t.src=getKnowledgeAssetPath(e),v.appendChild(t),tippy(t,{content:`<p class="artifact-title">${getLocValue(e)}</p>${getLocValue(e+"Description")}`,allowHTML:!0,placement:"top",hideOnClick:!1,theme:"speech_bubble",popperOptions:{modifiers:[{name:"preventOverflow",options:{boundary:"viewport",padding:{right:18}}}]}})}for(let e of document.getElementsByClassName("tower-selector-highlight"))e.style.display="none";return document.getElementById(`${e}-selector-highlight`).style.display="block",n?changeHexBGColor(constants.ParagonBGColor):changeHexBGColor(),t}function makeUpgradeButtons(e,t,a){let n=document.createElement("div");n.classList.add("upgrade-container");let s=document.createElement("div");s.classList.add("upgrade-rows"),n.appendChild(s);let l=document.createElement("div");l.classList.add("upgrade-row"),s.appendChild(l);let d=document.createElement("div");d.classList.add("upgrade-row"),s.appendChild(d);let r=document.createElement("div");r.classList.add("upgrade-row"),s.appendChild(r);let i=0,o=!1;for(let[t,n]of Object.entries(constants.towerPaths[e].path1)){let n=btd6usersave.acquiredUpgrades[t]?"unlocked":"locked";l.appendChild(generateUpgradeIcon(e,t,n,1,i,a,o)),"locked"==n&&(o=!0),i++}i=0,o=!1;for(let[t,n]of Object.entries(constants.towerPaths[e].path2)){let n=btd6usersave.acquiredUpgrades[t]?"unlocked":"locked";d.appendChild(generateUpgradeIcon(e,t,n,2,i,a,o)),"locked"==n&&(o=!0),i++}i=0,o=!1;for(let[t,n]of Object.entries(constants.towerPaths[e].path3)){let n=btd6usersave.acquiredUpgrades[t]?"unlocked":"locked";r.appendChild(generateUpgradeIcon(e,t,n,3,i,a,o)),"locked"==n&&(o=!0),i++}if(constants.paragonsAvailable.includes(e)&&t){let t=document.createElement("div");t.classList.add("upgrade-container-paragon"),n.appendChild(t),t.appendChild(generateParagonIcon(e,`${e} Paragon`,btd6usersave.acquiredUpgrades[`${e} Paragon`]?"unlocked":"locked"))}return n}function generateUpgradeIcon(e,t,a,n,s,l,d){let r=document.createElement("div");r.id=`${e}-${t}-div`,r.classList.add("upgrade-div");let i="";switch(n){case 1:i=`${s+1}00`;break;case 2:i=`0${s+1}0`;break;case 3:i=`00${s+1}`}let o=document.createElement("div");o.id=`${e}-${t}-glow`,r.appendChild(o);let c=document.createElement("div");c.classList.add("upgrade-bg-img");let p=btd6usersave.towerXP[e]>=constants.towerPaths[e][`path${n}`][t];4==s?btd6usersave.acquiredUpgrades[t]?c.classList.add("upgrade-t5"):c.classList.add("upgrade-t5-locked"):c.classList.add(`upgrade-${l?"paragon":"unlocked"==a?a:p?"green":"red"}`),r.appendChild(c);let m=document.createElement("img");m.classList.add("upgrade-img"),m.src=getUpgradeAssetPath(t),btd6usersave.acquiredUpgrades[t]||4!=s||(m.style.visibility="hidden"),r.appendChild(m);let u=document.createElement("p");return u.classList.add("upgrade-text"),u.innerHTML=getLocValue(t),r.appendChild(u),r.addEventListener("click",(()=>{onSelectTowerUpgrade(e,t,i),Array.from(document.getElementsByClassName("upgrade-glow")).forEach((e=>{e.classList.remove("upgrade-glow")})),document.getElementsByClassName("upgrade-glow-paragon").length>0&&document.getElementsByClassName("upgrade-glow-paragon")[0].classList.remove("upgrade-glow-paragon"),o.classList.add("upgrade-glow")})),d&&(c.classList.add("upgrade-after-locked"),m.classList.add("upgrade-after-locked")),tippy(r,{content:getLocValue(`${t} Description`),placement:"top",theme:"speech_bubble",hideOnClick:!1,allowHTML:!0}),r}function generateParagonIcon(e,t,a){let n=document.createElement("div");n.id=`${e}-paragon-div`,n.classList.add("upgrade-div");let s=document.createElement("div");s.classList.add("upgrade-bg-img"),s.classList.add("upgrade-paragon-special"+(btd6usersave.acquiredUpgrades[t]?"":"-locked")),n.appendChild(s);let l=document.createElement("div");l.id="paragon-glow",n.appendChild(l);let d=document.createElement("img");d.classList.add("upgrade-img"),d.src=getUpgradeAssetPath(`${e} Paragon`),btd6usersave.acquiredUpgrades[t]||(d.style.visibility="hidden"),n.appendChild(d);let r=document.createElement("p");return r.classList.add("upgrade-text"),r.innerHTML=getLocValue(t),n.appendChild(r),n.addEventListener("click",(()=>{onSelectTowerUpgradeParagon(e,t,"Paragon"),Array.from(document.getElementsByClassName("upgrade-glow")).forEach((e=>{e.classList.remove("upgrade-glow")})),l.classList.add("upgrade-glow-paragon")})),tippy(n,{content:getLocValue(`${t} Description`),placement:"top",theme:"speech_bubble",popperOptions:{modifiers:[{name:"preventOverflow",options:{boundary:"viewport",padding:{right:18}}}]},hideOnClick:!1}),n}function onSelectTowerUpgrade(e,t,a){let n=document.getElementById("tower-progress-portrait"),s=document.getElementById("tower-portrait-name"),l=document.getElementById("tower-progress-portrait-img");if(s.innerHTML=getLocValue(t),a.includes("5")&&!btd6usersave.acquiredUpgrades[t])return n.classList.add("tower-progress-portrait-t5-locked"),void(l.src="");n.classList.contains("tower-progress-portrait-t5-locked")&&n.classList.remove("tower-progress-portrait-t5-locked"),n.classList.contains("tower-progress-portrait-paragon")&&n.classList.remove("tower-progress-portrait-paragon"),n.classList.contains("tower-progress-portrait-paragon-locked")&&n.classList.remove("tower-progress-portrait-paragon-locked"),n.classList.add(`tower-progress-portrait-${constants.towersInOrder[e].toLowerCase()}`);for(let e of document.getElementsByClassName("upgrade-div"))e.classList.remove("selected");null!=document.getElementById(`${e}-paragon-div`)&&document.getElementById(`${e}-paragon-div`).classList.remove("selected-paragon"),l.src=getTowerAssetPath(e,a)}function onSelectTowerUpgradeParagon(e,t,a){let n=document.getElementById("tower-progress-portrait"),s=document.getElementById("tower-portrait-name"),l=document.getElementById("tower-progress-portrait-img");if(s.innerHTML=getLocValue(t),a.includes("Paragon")&&!btd6usersave.acquiredUpgrades[t])return n.classList.add("tower-progress-portrait-paragon-locked"),void(l.src="");n.classList.contains(`tower-progress-portrait-${constants.towersInOrder[e].toLowerCase()}`)&&n.classList.remove(`tower-progress-portrait-${constants.towersInOrder[e].toLowerCase()}`),n.classList.add("tower-progress-portrait-paragon");for(let e of document.getElementsByClassName("upgrade-div"))e.classList.remove("selected");l.src=getTowerAssetPath(e,a)}function generateHeroesProgress(){let e=document.getElementById("profile-content");e.innerHTML="";let t=document.createElement("div");t.classList.add("tower-progress-container"),e.appendChild(t);let a=document.createElement("div");a.classList.add("hero-progress-div"),t.appendChild(a);let n=document.createElement("div");n.classList.add("hero-selector-header-top"),a.appendChild(n);let s=Object.keys(btd6usersave.unlockedSkins).filter((e=>!constants.heroesInOrder[e])),l=document.createElement("p");l.classList.add("hero-selector-header-text","black-outline"),l.innerHTML=`Heroes - ${Object.keys(btd6usersave.unlockedHeros).filter((e=>btd6usersave.unlockedHeros[e])).length}/${Object.keys(btd6usersave.unlockedHeros).length}`,n.appendChild(l);let d=document.createElement("p");d.classList.add("hero-selector-header-text","black-outline"),d.innerHTML=`Skins - ${Object.keys(btd6usersave.unlockedSkins).filter((e=>btd6usersave.unlockedSkins[e]&&s.includes(e))).length}/${s.length}`,n.appendChild(d);let r=document.createElement("div");r.classList.add("hero-selector-header"),a.appendChild(r);for(let[e,t]of Object.entries(constants.heroesInOrder)){let a=document.createElement("div");a.classList.add("hero-selector-div"),btd6usersave.unlockedHeros[e]||a.classList.add("hero-selector-div-disabled"),a.addEventListener("click",(()=>{btd6usersave.unlockedHeros[e]&&generateHeroProgressHero(e,t)})),r.appendChild(a);let n=document.createElement("img");n.classList.add("hero-selector-img"),n.src=getHeroSquareIcon(e),a.appendChild(n);let s=document.createElement("div");s.id=e+"-selector-highlight",s.classList.add("hero-selector-highlight"),a.appendChild(s)}let i=document.createElement("div");i.id="hero-progress-content",i.classList.add("hero-progress-content"),t.appendChild(i),generateHeroProgressHero(btd6usersave.primaryHero,constants.heroesInOrder[btd6usersave.primaryHero])}function generateHeroProgressHero(e,t){currentlySelectedHero=e;let a=document.getElementById("hero-progress-content");a.innerHTML="";let n=document.createElement("div");n.classList.add("hero-progress-container"),a.appendChild(n);let s=document.createElement("div");s.classList.add("hero-progress-top"),n.appendChild(s);let l=document.createElement("div");l.classList.add("hero-progress-header"),s.appendChild(l);let d=document.createElement("img");d.classList.add("hero-progress-trail-fx"),d.src="./Assets/UI/TrailFx.webp",l.appendChild(d);let r=document.createElement("p");r.id="hero-progress-header-text",r.classList.add("hero-progress-header-text"),r.style.backgroundImage=`url('../Assets/UI/${t}TxtTextureMain.webp')`,r.innerHTML=getLocValue(e),l.appendChild(r);let i=document.createElement("p");i.id="hero-progress-header-subtitle",i.classList.add("hero-progress-header-subtitle","subtitle-outline"),i.innerHTML=getLocValue(`${e} Short Description`),l.appendChild(i);let o=document.createElement("div");o.classList.add("hero-progress-middle"),n.appendChild(o);let c=document.createElement("div");c.id="hero-portrait-level-select-btns",c.classList.add("hero-portrait-level-select-btns"),o.appendChild(c),updatePortraitLevelButtons(e);let p=document.createElement("div");p.classList.add("hero-portrait-div"),o.appendChild(p);let m=document.createElement("img");m.id="hero-portrait-img",m.classList.add("hero-portrait-img"),m.src=getHeroPortrait(e,1),p.appendChild(m);let u=document.createElement("div");u.classList.add("hero-portrait-bar"),p.appendChild(u);let h=document.createElement("div");h.id="hero-portrait-glow",h.classList.add("hero-portrait-glow"),h.style.background=`radial-gradient(circle, rgb(${255*constants.HeroBGColors[e][0]},${255*constants.HeroBGColors[e][1]},${255*constants.HeroBGColors[e][2]}) 0%, transparent 70%)`,p.appendChild(h);let g=document.createElement("div");g.classList.add("hero-skins-div"),o.appendChild(g),constants.heroSkins[e].forEach((t=>{if(null==btd6usersave.unlockedSkins[saveSkintoSkinMap[t]||t]&&t!=e)return;let a=document.createElement("img");a.id=`${e}-${t}-skin`,a.classList.add("hero-skin"),a.src=getHeroIconCircle(t),0==btd6usersave.unlockedSkins[saveSkintoSkinMap[t]||t]?a.classList.add("insta-tower-container-none"):a.addEventListener("click",(()=>{let a=constants.HeroBGColors[t]?constants.HeroBGColors[t]:constants.HeroBGColors[e];changeHexBGColor(a),changeHeroSkin(t,e==t),document.getElementById("hero-portrait-glow").style.background=`radial-gradient(circle, rgb(${255*a[0]},${255*a[1]},${255*a[2]}) 0%, transparent 70%)`})),g.appendChild(a)}));let b=document.createElement("div");b.classList.add("hero-progress-bottom"),n.appendChild(b);let L=document.createElement("p");L.id="hero-progress-desc",L.classList.add("hero-progress-desc"),L.innerHTML=getLocValue(`${e} Description`),b.appendChild(L);let v=document.createElement("div");v.classList.add("hero-level-descs"),b.appendChild(v);for(let t=1;t<21;t++){let a=document.createElement("div");a.classList.add("hero-level-desc-div"),v.appendChild(a);let n=document.createElement("div");n.classList.add("hero-level-desc-icon-div"),20==t?n.classList.add("hero-level-desc-image-purple"):constants.heroLevelIcons[e].includes(t)?n.classList.add("hero-level-desc-image-gold"):n.classList.add("hero-level-desc-image"),a.appendChild(n);let s=document.createElement("p");s.classList.add("hero-level-desc-text","black-outline"),s.innerHTML=t,n.appendChild(s);let l=document.createElement("p");l.classList.add("hero-level-desc"),l.innerHTML=getLocValue(`${e} Level ${t} Description`),a.appendChild(l)}for(let e of document.getElementsByClassName("hero-selector-highlight"))e.style.display="none";return document.getElementById(`${e}-selector-highlight`).style.display="block",changeHexBGColor(constants.HeroBGColors[e]),a}function changeHeroSkin(e,t){currentlySelectedHero=e,document.getElementById("hero-progress-header-subtitle").innerHTML=getLocValue(t?`${e} Short Description`:`${e}SkinName`),document.getElementById("hero-progress-desc").innerHTML=getLocValue(t?`${e} Description`:`${e}SkinDescription`),changeHeroLevelPortrait(1),document.body.style.display="none",document.body.offsetHeight,document.body.style.removeProperty("display")}function changeHeroLevelPortrait(e){document.getElementById("hero-portrait-img").src=getSkinAssetPath(currentlySelectedHero,e),updatePortraitLevelButtons(currentlySelectedHero);for(let e of document.getElementsByClassName("hero-level-select-btn"))e.classList.remove("selected-level-btn");document.getElementById(`${e}-level-select-btn`).classList.add("selected-level-btn")}function updatePortraitLevelButtons(e){let t=document.getElementById("hero-portrait-level-select-btns");t.innerHTML="",constants.HeroPortraitLevels[e].forEach((e=>{if("20SunGod"==e&&!btd6usersave.acquiredUpgrades["True Sun God"])return;if(("20SunGodVengeful"==e||"20SunGodVengful"==e)&&!btd6usersave.achievementsClaimed.includes("Strangely Adorable"))return;let a=document.createElement("div");a.id=`${e}-level-select-div`,a.classList.add("hero-level-select-div"),t.appendChild(a);let n=document.createElement("div");if(n.id=`${e}-level-select-btn`,n.classList.add("hero-level-select-btn"),a.appendChild(n),"20SunGod"==e||"20SunGodVengeful"==e||"20SunGodVengful"==e){let t=document.createElement("img");t.id=`${e}-level-select-img`,t.classList.add("hero-level-select-img"),t.src="20SunGod"==e?"./Assets/UI/BuffIconTrueSunGod5xx.webp":"./Assets/UI/BuffIconTrueSunGod555.webp",a.appendChild(t)}else{let t=document.createElement("p");t.id=`${e}-level-select-text`,t.classList.add("hero-level-select-text","black-outline"),t.innerHTML=e,a.appendChild(t)}a.addEventListener("click",(()=>{changeHeroLevelPortrait(e)}))})),document.getElementById("1-level-select-btn").classList.add("selected-level-btn")}function generateKnowledgeProgress(){let e=document.getElementById("profile-content");e.innerHTML="",changeHexBGColor(constants.ParagonBGColor);let t=[0,0,0];for(let[e,a]of Object.entries(btd6usersave.acquiredKnowledge))a?t[0]+=1:constants.RecommendedKnowledge.includes(e)?t[1]+=1:t[2]+=1;let a=document.createElement("div");a.id="knowledge-progress-container",a.classList.add("knowledge-progress-container"),e.appendChild(a);let n=document.createElement("div");n.classList.add("knowledge-progress-container-div"),a.appendChild(n);let s=document.createElement("p");s.classList.add("column-header-text","black-outline"),s.innerHTML=`${t[0]} Unlocked Knowledge Points`,n.appendChild(s);let l=document.createElement("div");l.classList.add("knowledge-progress-div"),n.appendChild(l);let d=document.createElement("div");d.classList.add("knowledge-progress-container-div"),a.appendChild(d);let r=document.createElement("p");r.classList.add("column-header-text","black-outline"),r.innerHTML=`${t[2]+t[1]} Locked Knowledge Points`,d.appendChild(r);let i=document.createElement("div");i.classList.add("knowledge-progress-div"),d.appendChild(i);for(let[e,t]of Object.entries(btd6usersave.acquiredKnowledge)){if(!getLocValue(e))continue;let a=document.createElement("div");a.classList.add("knowledge-icon-div"),t?l.appendChild(a):i.appendChild(a);let n=document.createElement("div");n.id=`${e}-glow`,a.appendChild(n);let s=document.createElement("img");s.classList.add("knowledge-icon"),s.src=getKnowledgeAssetPath(e),a.appendChild(s),a.addEventListener("click",(()=>{onSelectKnowledgePoint(e),Array.from(document.getElementsByClassName("knowledge-glow")).forEach((e=>{e.classList.remove("knowledge-glow")})),n.classList.add("knowledge-glow")}))}""==i.innerHTML&&(r.style.display="none"),""==l.innerHTML&&(s.style.display="none");let o=document.createElement("div");o.classList.add("tooltip-container-div"),a.appendChild(o);let c=document.createElement("div");c.id="knowledge-progress-floating-tooltip",c.classList.add("knowledge-progress-floating-tooltip"),o.appendChild(c);let p=document.createElement("p");p.id="knowledge-name-text",p.classList.add("knowledge-name-text","black-outline"),c.appendChild(p);let m=document.createElement("p");m.id="knowledge-desc-text",m.classList.add("knowledge-desc-text"),c.appendChild(m)}function onSelectKnowledgePoint(e){document.getElementById("knowledge-progress-floating-tooltip").style.display="block",document.getElementById("knowledge-name-text").innerHTML=getLocValue(e),document.getElementById("knowledge-desc-text").innerHTML=getLocValue(`${e}Description`)}function generateMapsProgress(){let e=document.getElementById("profile-content");e.innerHTML="",currentMapView="grid",coopEnabled=!1,currentDifficultyFilter="All",mapPage=0;let t=document.createElement("div");t.id="maps-progress-header-bar",t.classList.add("maps-progress-header-bar"),e.appendChild(t);let a=document.createElement("div");a.id="maps-progress-views",a.classList.add("maps-progress-views"),t.appendChild(a);let n=document.createElement("p");n.classList.add("maps-progress-coop-toggle-text","black-outline"),n.innerHTML="Display Type:",a.appendChild(n);let s=document.createElement("div");s.id="maps-progress-game",s.classList.add("maps-progress-view","black-outline"),s.innerHTML="Game",s.addEventListener("click",(()=>{onChangeMapView("game")})),a.appendChild(s);let l=document.createElement("div");l.id="maps-progress-grid",l.classList.add("maps-progress-view","black-outline","maps-progress-view-selected"),l.innerHTML="Grid",l.addEventListener("click",(()=>{onChangeMapView("grid")})),a.appendChild(l);let d=document.createElement("div");d.id="maps-progress-list",d.classList.add("maps-progress-view","black-outline","maps-progress-view-list"),d.innerHTML="List",d.addEventListener("click",(()=>{onChangeMapView("list")})),a.appendChild(d);let r=document.createElement("div");r.classList.add("maps-progress-filter"),t.appendChild(r);let i=document.createElement("div");i.classList.add("map-progress-filter-difficulty"),r.appendChild(i);let o=document.createElement("p");o.classList.add("maps-progress-coop-toggle-text","black-outline"),o.innerHTML="Filter Difficulty:",i.appendChild(o);let c=document.createElement("select");c.id="map-progress-filter-difficulty-select",c.classList.add("map-progress-filter-difficulty-select"),c.addEventListener("change",(()=>{onChangeDifficultyFilter(c.value)}));["All","Beginner","Intermediate","Advanced","Expert"].forEach((e=>{let t=document.createElement("option");t.value=e,t.innerHTML=e,c.appendChild(t)})),i.appendChild(c);let p=document.createElement("div");p.classList.add("maps-progress-coop-toggle"),r.appendChild(p);let m=document.createElement("p");m.classList.add("maps-progress-coop-toggle-text","black-outline"),m.innerHTML="Co-op: ",p.appendChild(m);let u=document.createElement("input");u.id="maps-progress-coop-toggle-input",u.classList.add("maps-progress-coop-toggle-input"),u.type="checkbox",u.addEventListener("change",(()=>{onChangeCoopToggle(u.checked)})),p.appendChild(u);let h=document.createElement("div");h.id="maps-progress-container",h.classList.add("maps-progress-container"),e.appendChild(h);let g=document.createElement("div");g.id="map-progress-container",g.classList.add("map-progress-container"),g.style.display="none",e.appendChild(g),onChangeMapView("game")}function onChangeMapView(e){switch(currentMapView=e,e){case"grid":document.getElementById("maps-progress-grid").classList.add("stats-tab-yellow"),document.getElementById("maps-progress-list").classList.remove("stats-tab-yellow"),document.getElementById("maps-progress-game").classList.remove("stats-tab-yellow"),document.getElementById("maps-progress-header-bar").classList.add("border-top-only"),generateMapsGridView();break;case"list":document.getElementById("maps-progress-grid").classList.remove("stats-tab-yellow"),document.getElementById("maps-progress-list").classList.add("stats-tab-yellow"),document.getElementById("maps-progress-game").classList.remove("stats-tab-yellow"),document.getElementById("maps-progress-header-bar").classList.add("border-top-only"),generateMapsListView();break;case"game":document.getElementById("maps-progress-grid").classList.remove("stats-tab-yellow"),document.getElementById("maps-progress-list").classList.remove("stats-tab-yellow"),document.getElementById("maps-progress-game").classList.add("stats-tab-yellow"),document.getElementById("maps-progress-header-bar").classList.remove("border-top-only"),generateMapsGameView()}}function onChangeCoopToggle(e){switch(coopEnabled=e,document.getElementById("maps-progress-coop-toggle-input").checked=e,currentMapView){case"grid":generateMapsGridView();break;case"list":generateMapsListView();break;case"game":generateMapsGameView()}}function onChangeDifficultyFilter(e){switch(currentDifficultyFilter=e,currentMapView){case"grid":generateMapsGridView();break;case"list":generateMapsListView();break;case"game":generateMapsGameView()}}function onSelectMap(e){document.getElementById("maps-progress-container").style.display="none",document.getElementById("maps-progress-header-bar").style.display="none",document.getElementById("map-progress-container").style.display="flex",resetScroll(),generateMapDetails(e)}function onExitMap(){document.getElementById("map-progress-container").style.display="none",document.getElementById("maps-progress-header-bar").style.display="flex",document.getElementById("maps-progress-container").style.display="block"}function generateMapDetails(e){let t=document.getElementById("map-progress-container");t.innerHTML="";let a=document.createElement("div");a.classList.add("single-map-progress-header-bar"),t.appendChild(a);let n=document.createElement("div");n.classList.add("map-next-and-prev"),a.appendChild(n);let s=document.createElement("div");s.classList.add("maps-progress-view","black-outline"),s.innerHTML="Previous",s.addEventListener("click",(()=>{let t=Object.keys(constants.mapsInOrder).filter((e=>Object.keys(btd6usersave.mapProgress).includes(e)));0==t.indexOf(e)?onSelectMap(t[t.length-1]):onSelectMap(t[t.indexOf(e)-1])})),n.appendChild(s);let l=document.createElement("div");l.classList.add("maps-progress-view","black-outline"),l.innerHTML="Next",l.addEventListener("click",(()=>{let t=Object.keys(constants.mapsInOrder).filter((e=>Object.keys(btd6usersave.mapProgress).includes(e)));t.indexOf(e)==t.length-1?onSelectMap(t[0]):onSelectMap(t[t.indexOf(e)+1])})),n.appendChild(l);let d=document.createElement("img");d.classList.add("modal-close"),d.src="./Assets/UI/CloseBtn.webp",d.addEventListener("click",(()=>{goBack()})),a.appendChild(d);let r=document.createElement("div");r.classList.add("map-below-header-bar"),t.appendChild(r);let i=document.createElement("div");i.classList.add("map-left-column"),r.appendChild(i);let o=document.createElement("div");o.classList.add("map-progress-div"),i.appendChild(o);let c=document.createElement("div");c.classList.add("map-name-top"),o.appendChild(c);let p=document.createElement("img");p.classList.add("map-difficulty-icon"),p.src=`./Assets/DifficultyIcon/Map${constants.mapsInOrder[e]}Btn.webp`,c.appendChild(p);let m=document.createElement("div");m.classList.add("map-name-and-medals"),c.appendChild(m);let u=document.createElement("p");u.classList.add("map-name-large","black-outline"),u.innerHTML=getLocValue(e),m.appendChild(u);let h=document.createElement("div");h.classList.add("map-progress-subtext"),h.innerHTML=`${Object.values(processedMapData.Medals.single[e]).filter((e=>1==e)).length}/15 Single Player Medals`,m.appendChild(h);let g=document.createElement("div");g.classList.add("map-progress-subtext"),g.innerHTML=`${Object.values(processedMapData.Medals.coop[e]).filter((e=>1==e)).length}/15 Coop Medals`,m.appendChild(g);let b=document.createElement("div");b.classList.add("map-progress-subtext"),b.innerHTML=`Overall Highest Round: ${processedMapData.Maps[e].highestRound}`,m.appendChild(b);let L=document.createElement("div");L.classList.add("map-progress-subtext"),L.innerHTML=`Total Wins: ${processedMapData.Maps[e].totalWins}`,m.appendChild(L);let v=document.createElement("img");v.classList.add("map-icon"),v.src=getMapIcon(e),o.appendChild(v);let y=document.createElement("div");switch(y.classList.add("map-progress-medals"),i.appendChild(y),processedMapData.Borders.single[e]){case"None":y.classList.add("none-border");break;case"Bronze":y.classList.add("bronze-border");break;case"Silver":y.classList.add("silver-border");break;case"Gold":y.classList.add("gold-border");break;case"Black":y.classList.add("black-border")}for(let[t,a]of Object.entries(processedMapData.Medals.single[e])){if(null==a)continue;let n=document.createElement("div");n.classList.add("medal-div"),y.appendChild(n);let s=document.createElement("img");s.classList.add("medal-img"),s.src=getMedalIcon(a?`Medal${medalMap[t]}`:"MedalEmpty"),"Black"==processedMapData.Borders.single[e]&&s.classList.add("medal-glow"),s.style.display="none",s.addEventListener("load",(()=>{s.width<s.height?s.style.width=`${ratioCalc(3,70,256,0,s.width)}px`:s.style.height=`${ratioCalc(3,70,256,0,s.height)}px`,s.style.removeProperty("display")})),n.appendChild(s),tippy(n,{content:constants.medalLabels[`Medal${medalMap[t]}`],placement:"top",theme:"speech_bubble"})}let f=document.createElement("div");f.classList.add("map-progress-medals"),i.appendChild(f);for(let[t,a]of Object.entries(processedMapData.Medals.coop[e])){if(null==a)continue;let n=document.createElement("div");n.classList.add("medal-div"),f.appendChild(n);let s=document.createElement("img");s.classList.add("medal-img"),s.src=getMedalIcon(a?`Medal${medalMap[t]}`:"MedalCoopEmpty"),s.style.display="none","Black"==processedMapData.Borders.coop[e]&&s.classList.add("medal-glow"),s.addEventListener("load",(()=>{s.width<s.height?s.style.width=`${ratioCalc(3,70,256,0,s.width)}px`:s.style.height=`${ratioCalc(3,70,256,0,s.height)}px`,s.style.removeProperty("display")})),n.appendChild(s),tippy(n,{content:constants.medalLabels[`MedalCoop${medalMap[t]}`],placement:"top",theme:"speech_bubble"})}switch(processedMapData.Borders.coop[e]){case"None":f.classList.add("coop-border");break;case"Bronze":f.classList.add("bronze-border");break;case"Silver":f.classList.add("silver-border");break;case"Gold":f.classList.add("gold-border");break;case"Black":f.classList.add("black-border")}let C=document.createElement("div");C.classList.add("map-right-column"),r.appendChild(C);let w=document.createElement("div");w.classList.add("right-column-header"),C.appendChild(w);let E=document.createElement("p");E.classList.add("column-header-text","black-outline"),E.innerHTML="Mode Stats",w.appendChild(E);let k=document.createElement("div");k.classList.add("maps-progress-coop-toggle"),w.appendChild(k);let T=document.createElement("p");T.classList.add("maps-progress-coop-toggle-text","black-outline"),T.innerHTML="Co-op: ",k.appendChild(T);let M=document.createElement("input");M.id="maps-progress-coop-toggle-input",M.classList.add("maps-progress-coop-toggle-input"),M.type="checkbox",M.addEventListener("change",(()=>{onChangeCoopToggle(M.checked),generateMapRightColStats(e,coopEnabled)})),M.checked=coopEnabled,k.appendChild(M);let S=document.createElement("div");S.id="map-stats-container",S.classList.add("map-stats-container"),C.appendChild(S),generateMapRightColStats(e,coopEnabled)}function generateMapRightColStats(e,t){let a=document.getElementById("map-stats-container");a.innerHTML="";for(let[n,s]of Object.entries(t?processedMapData.Maps[e].coop:processedMapData.Maps[e].single)){if(null==s)continue;let e=document.createElement("div");e.classList.add("map-stats-div"),a.appendChild(e);let t=document.createElement("img");t.classList.add("map-stats-icon"),t.src=getModeIcon(n),e.appendChild(t);let l=document.createElement("div");l.classList.add("map-stats-text-div"),e.appendChild(l);let d=document.createElement("p");d.classList.add("map-stats-text-mode","black-outline"),d.innerHTML=getLocValue(`Mode ${n}`),l.appendChild(d);let r=document.createElement("p");r.classList.add("map-stats-text"),r.innerHTML=`Times Completed: ${s.timesCompleted}`,l.appendChild(r);let i=document.createElement("p");i.classList.add("map-stats-text"),i.innerHTML=`Best Round: ${s.bestRound}`,l.appendChild(i)}if(""==a.innerHTML){let e=document.createElement("p");e.classList.add("no-data-found","black-outline"),e.innerHTML="No Data Found.",a.appendChild(e)}}function generateMapsGridView(){let e=document.getElementById("maps-progress-container");e.innerHTML="";let t=document.createElement("div");t.classList.add("maps-grid-container"),e.appendChild(t);for(let[e,a]of Object.entries(constants.mapsInOrder)){if(null==processedMapData.Borders[coopEnabled?"coop":"single"][e])continue;if("All"!=currentDifficultyFilter&&a!=currentDifficultyFilter)continue;let n=document.createElement("div");switch(n.classList.add("map-div","pointer"),processedMapData.Borders[coopEnabled?"coop":"single"][e]){case"None":coopEnabled?n.classList.add("coop-border"):n.classList.add("none-border");break;case"Bronze":n.classList.add("bronze-border");break;case"Silver":n.classList.add("silver-border");break;case"Gold":n.classList.add("gold-border");break;case"Black":n.classList.add("black-border")}t.appendChild(n);let s=document.createElement("img");s.classList.add("map-img"),s.src=getMapIcon(e),n.appendChild(s);let l=document.createElement("p");l.classList.add("map-name","black-outline"),l.innerHTML=getLocValue(e),n.appendChild(l);let d=document.createElement("div");d.classList.add("map-progress"),n.appendChild(d),n.addEventListener("click",(()=>{onSelectMap(e),addToBackQueue({callback:onExitMap})}))}}function generateMapsListView(){let e=document.getElementById("maps-progress-container");e.innerHTML="";let t=document.createElement("div");t.classList.add("maps-list-container"),e.appendChild(t);let a=document.createDocumentFragment(),n=!1;for(let[e,t]of Object.entries(constants.mapsInOrder)){if(null==processedMapData.Borders[coopEnabled?"coop":"single"][e])continue;if("All"!=currentDifficultyFilter&&t!=currentDifficultyFilter)continue;if(Object.entries(coopEnabled?processedMapData.Maps[e].coop:processedMapData.Maps[e].single).every((([e,t])=>null==t)))continue;let s=document.createElement("div");s.classList.add("map-container"),s.style.backgroundColor=n?"var(--profile-secondary)":"var(--profile-tertiary)",n=!n,a.appendChild(s);let l=document.createElement("div");switch(l.classList.add("map-div"),processedMapData.Borders[coopEnabled?"coop":"single"][e]){case"None":coopEnabled?l.classList.add("coop-border"):l.classList.add("none-border");break;case"Bronze":l.classList.add("bronze-border");break;case"Silver":l.classList.add("silver-border");break;case"Gold":l.classList.add("gold-border");break;case"Black":l.classList.add("black-border")}s.appendChild(l);let d=document.createElement("img");d.classList.add("map-img"),d.src=getMapIcon(e),l.appendChild(d);let r=document.createElement("p");r.classList.add("map-name","black-outline"),r.innerHTML=getLocValue(e),l.appendChild(r);let i=document.createElement("div");i.classList.add("map-sections"),s.appendChild(i);let o=document.createElement("div");o.classList.add("map-section"),i.appendChild(o);let c=document.createElement("p");c.classList.add("map-label-medals","black-outline"),o.appendChild(c);let p=document.createElement("p");p.classList.add("map-label-rounds","black-outline"),p.innerHTML="Best Round:",o.appendChild(p);let m=document.createElement("p");m.classList.add("map-label-completed","black-outline"),m.innerHTML="Times Completed:",o.appendChild(m);for(let[t,a]of Object.entries(coopEnabled?processedMapData.Maps[e].coop:processedMapData.Maps[e].single)){if(null==a)continue;let e=document.createElement("div");e.classList.add("map-section-column"),i.appendChild(e);let n=document.createElement("div");n.classList.add("map-section-medal"),e.appendChild(n);let s=document.createElement("img");s.classList.add("map-section-medal-img"),s.src=getMedalIcon("Clicks"==t&&a.completedWithoutLoadingSave?`Medal${coopEnabled?"Coop":""}${medalMap["CHIMPS-BLACK"]}`:`Medal${coopEnabled?"Coop":""}${medalMap[t]}`),s.style.display="none",!a.completed&&a.bestRound<constants.endRound[t]&&!a.completedWithoutLoadingSave&&(s.style.filter="brightness(0.5)"),s.addEventListener("load",(()=>{s.width<s.height?s.style.width=`${ratioCalc(3,70,256,0,s.width)}px`:s.style.height=`${ratioCalc(3,70,256,0,s.height)}px`,s.style.removeProperty("display")})),n.appendChild(s),tippy(n,{content:constants.medalLabels[`Medal${coopEnabled?"Coop":""}${medalMap[t]}`],placement:"top",theme:"speech_bubble"});let l=document.createElement("p");l.classList.add("map-section-text","black-outline"),l.innerHTML=a.bestRound,e.appendChild(l);let d=document.createElement("p");d.classList.add("map-section-text","black-outline"),d.innerHTML=a.timesCompleted,e.appendChild(d)}l.addEventListener("click",(()=>{onSelectMap(e),addToBackQueue({callback:onExitMap})}))}t.appendChild(a)}function generateMapsGameView(){let e=document.getElementById("maps-progress-container");e.innerHTML="";let t=document.createElement("div");t.classList.add("maps-game-container"),e.appendChild(t);let a=Object.keys(constants.mapsInOrder).filter((e=>Object.keys(btd6usersave.mapProgress).includes(e)));"All"!=currentDifficultyFilter&&(a=a.filter((e=>constants.mapsInOrder[e]==currentDifficultyFilter)));let n=Math.ceil(a.length/6)-1;mapPage>n&&(mapPage=0),mapPage<0&&(mapPage=n);let s=a.slice(6*mapPage,6*mapPage+6),l=document.createElement("div");l.classList.add("map-arrow"),t.appendChild(l);let d=document.createElement("img");d.classList.add("map-arrow-img"),d.src="./Assets/UI/PrevArrow.webp",l.appendChild(d);let r=document.createElement("div");r.classList.add("maps-game-grid"),t.appendChild(r);for(let e of s){let t=document.createElement("div");switch(t.classList.add("map-div-ingame"),processedMapData.Borders[coopEnabled?"coop":"single"][e]){case"None":coopEnabled?t.classList.add("coop-border"):t.classList.add("none-border");break;case"Bronze":t.classList.add("bronze-border");break;case"Silver":t.classList.add("silver-border");break;case"Gold":t.classList.add("gold-border");break;case"Black":t.classList.add("black-border")}r.appendChild(t);let a=document.createElement("img");a.classList.add("map-img-ingame"),a.src=getMapIcon(e),t.appendChild(a);let n=document.createElement("p");n.classList.add("map-name","black-outline"),n.innerHTML=getLocValue(e),t.appendChild(n);for(let[a,n]of coopEnabled?Object.entries(processedMapData.Medals.coop[e]):Object.entries(processedMapData.Medals.single[e])){if(null==n)continue;let e=document.createElement("div");["Easy","Medium","Hard","Impoppable"].includes(a)?e.classList.add("medal-div-large"):e.classList.add("medal-div-small"),e.classList.add(`medal-div-${a.toLowerCase()}`),t.appendChild(e);let s=document.createElement("img");s.classList.add("medal-img"),s.src=getMedalIcon(n?`Medal${medalMap[a]}`:"MedalEmpty"),n||s.classList.add("medal-div-unobtained"),s.style.display="none",s.addEventListener("load",(()=>{s.width<s.height?s.style.width=`${ratioCalc(3,70,256,0,s.width)}px`:s.style.height=`${ratioCalc(3,70,256,0,s.height)}px`,s.style.removeProperty("display")})),e.appendChild(s)}t.addEventListener("click",(()=>{onSelectMap(e),addToBackQueue({callback:onExitMap})}))}let i=document.createElement("div");i.classList.add("map-arrow"),t.appendChild(i);let o=document.createElement("img");o.classList.add("map-arrow-img"),o.src="./Assets/UI/NextArrow.webp",i.appendChild(o),l.addEventListener("click",(()=>{mapPage--,generateMapsGameView()})),i.addEventListener("click",(()=>{mapPage++,generateMapsGameView()}));let c=document.createElement("div");c.classList.add("map-page-dots"),e.appendChild(c);for(let e=0;e<=n;e++){let t=document.createElement("div");t.classList.add("map-page-dot"),e==mapPage&&t.classList.add("map-page-dot-active"),c.appendChild(t),t.addEventListener("click",(()=>{mapPage=e,generateMapsGameView()}))}}function generatePowersProgress(){let e=document.getElementById("profile-content");e.innerHTML="";let t=document.createElement("div");t.classList.add("powers-progress-container"),e.appendChild(t);for(let e of constants.powersInOrder){let a=document.createElement("div");a.classList.add("power-div"),t.appendChild(a),constants.powersIAP.includes(e)&&(a.style.backgroundImage="url(../Assets/UI/PowerIAPContainer.webp)");let n=document.createElement("img");n.classList.add("power-img"),n.src=getPowerIcon(e),a.appendChild(n);let s=document.createElement("p");s.classList.add("power-name","black-outline"),s.innerHTML=getLocValue(e),a.appendChild(s);let l=document.createElement("div");l.classList.add("power-progress"),a.appendChild(l);let d=document.createElement("p");d.classList.add("power-progress-text","black-outline"),d.innerHTML=`${btd6usersave.powers[e].quantity||0}`,l.appendChild(d)}}function generateInstaMonkeysProgress(){let e=document.getElementById("profile-content");e.innerHTML="";let t=document.createElement("div");t.classList.add("insta-monkeys-header-bar"),e.appendChild(t);let a=document.createElement("div");a.classList.add("maps-progress-views"),t.appendChild(a);let n=document.createElement("p");n.classList.add("maps-progress-coop-toggle-text","black-outline"),n.classList.add("black-outline"),n.innerHTML="View Inventory:",a.appendChild(n);let s=document.createElement("div");s.id="insta-monkeys-game-view",s.classList.add("maps-progress-view","black-outline"),s.innerHTML="Game",s.addEventListener("click",(()=>{currentInstaView="game",onChangeInstaMonkeysView(t,currentInstaView)})),a.appendChild(s);let l=document.createElement("div");l.id="insta-monkeys-list-view",l.classList.add("maps-progress-view","black-outline"),l.innerHTML="List",l.addEventListener("click",(()=>{currentInstaView="list",onChangeInstaMonkeysView(t,currentInstaView)})),a.appendChild(l);let d=document.createElement("p");d.id="insta-total-counter",d.classList.add("insta-monkey-progress-text","insta-total-counter","black-outline"),d.innerHTML=`${btd6publicprofile.gameplay.instaMonkeyCollection}/${constants.totalInstaMonkeys}`,t.appendChild(d);let r=document.createElement("div");r.classList.add("maps-progress-views"),t.appendChild(r);let i=document.createElement("div");i.id="insta-monkeys-obtain-view",i.classList.add("maps-progress-view","black-outline"),i.innerHTML="Get More",i.addEventListener("click",(()=>{currentInstaView="obtain",onChangeInstaMonkeysView(t,currentInstaView)})),r.appendChild(i);let o=document.createElement("div");o.id="insta-monkeys-collection-view",o.classList.add("maps-progress-view","black-outline"),o.innerHTML="Collection Event",o.addEventListener("click",(()=>{currentInstaView="collection",onChangeInstaMonkeysView(t,currentInstaView)})),r.appendChild(o);let c=document.createElement("div");c.id="insta-monkeys-progress-container",c.classList.add("insta-monkeys-progress-container"),e.appendChild(c);let p=document.createElement("div");p.id="insta-monkey-progress-container",p.classList.add("insta-monkey-progress-container"),p.style.display="none",e.appendChild(p),onChangeInstaMonkeysView(t,currentInstaView)}function onChangeInstaMonkeysView(e,t){document.getElementById("insta-monkeys-progress-container").style.removeProperty("display"),document.getElementById("insta-monkey-progress-container").style.display="none";switch(["game","list","obtain","collection"].forEach((e=>{document.getElementById(`insta-monkeys-${e}-view`).classList.remove("stats-tab-yellow")})),document.getElementById(`insta-monkeys-${t}-view`).classList.add("stats-tab-yellow"),t){case"game":e.classList.remove("border-top-only"),generateInstaGameView();break;case"list":e.classList.remove("border-top-only"),generateInstaListView();break;case"obtain":e.classList.add("border-top-only"),generateInstaObtainGuide();break;case"collection":e.classList.add("border-top-only"),generateInstaCollectionEventHelper()}}function generateInstaGameView(){let e=document.getElementById("insta-monkeys-progress-container");e.innerHTML="";let t=document.createElement("div");t.classList.add("insta-monkey-game-container"),e.appendChild(t);let a=document.createElement("div");a.classList.add("towers-container"),t.appendChild(a);let n=[],s=[];Object.keys(constants.towersInOrder).forEach((e=>{Object.keys(btd6usersave.unlockedTowers).includes(e)&&(void 0!==processedInstaData.TowerTotal[e]?n.push(e):s.push(e))})),n.concat(s).forEach((e=>{let t=document.createElement("div");t.classList.add("tower-container"),t.style.backgroundImage=`url(./Assets/UI/InstaTowersContainer${processedInstaData.TowerBorders[e]||""}.webp)`,t.addEventListener("click",(()=>{onSelectInstaTower(e)})),a.appendChild(t);let n=document.createElement("img");n.classList.add("tower-img"),n.src=getInstaContainerIcon(e,"000"),t.appendChild(n);let s=document.createElement("p");if(s.classList.add("tower-name","black-outline"),s.innerHTML=getLocValue(e),t.appendChild(s),null!=processedInstaData.TowerTotal[e]){let a=document.createElement("p");a.classList.add("insta-progress"),t.appendChild(a);let n=document.createElement("p");n.classList.add("power-progress-text","black-outline"),n.innerHTML=processedInstaData.TowerTotal[e]||0,a.appendChild(n)}else t.classList.add("insta-tower-container-none")}))}function onSelectInstaTower(e){document.getElementById("insta-monkeys-progress-container").style.display="none",document.getElementById("insta-monkey-progress-container").style.display="flex",generateSingleInstaTower(e)}function generateSingleInstaTower(e){let t=document.getElementById("insta-monkey-progress-container");t.innerHTML="";let a=document.createElement("div");t.appendChild(a);let n=document.createElement("div");n.classList.add("insta-monkey-top-bar"),a.appendChild(n);let s=document.createElement("div");s.classList.add("insta-arrow"),s.addEventListener("click",(()=>{onSelectInstaPrevArrow(e)})),n.appendChild(s);let l=document.createElement("img");l.classList.add("map-arrow-img"),l.src="./Assets/UI/PrevArrow.webp",s.appendChild(l);let d=document.createElement("div");switch(d.classList.add("insta-monkey-header-div"),processedInstaData.TowerBorders[e]){case"Gold":d.classList.add("insta-topbar-gold");break;case"Black":d.classList.add("insta-topbar-black")}n.appendChild(d);let r=document.createElement("div");r.classList.add("insta-arrow"),r.addEventListener("click",(()=>{onSelectInstaNextArrow(e)})),n.appendChild(r);let i=document.createElement("img");i.classList.add("map-arrow-img"),i.src="./Assets/UI/NextArrow.webp",r.appendChild(i);let o=document.createElement("div");o.classList.add("maps-progress-coop-toggle"),d.appendChild(o);let c=document.createElement("p");c.classList.add("maps-progress-coop-toggle-text","black-outline"),c.innerHTML="Missing: ",o.appendChild(c);let p=document.createElement("input");p.classList.add("insta-progress-missing-toggle-input","MkOffRed"),p.type="checkbox",p.addEventListener("change",(()=>{onSelectMissingToggle(p.checked)})),p.checked=instasMissingToggle,o.appendChild(p);let m=document.createElement("p");m.classList.add("insta-monkey-name","black-outline"),m.innerHTML=getLocValue(e),d.appendChild(m);let u=document.createElement("div");u.classList.add("insta-monkey-progress"),d.appendChild(u);let h=document.createElement("p");h.classList.add("insta-monkey-progress-text","black-outline"),h.innerHTML=`${processedInstaData.TowerTierTotals[e]?Object.values(processedInstaData.TowerTierTotals[e]).reduce(((e,t)=>e+t),0):0}/64`,u.appendChild(h);let g=document.createElement("div");g.id=`${e}-main-container`,g.classList.add("insta-monkey-main-container","fd-column"),a.appendChild(g),generateInstaMonkeyIcons(e),onSelectMissingToggle(p.checked)}function generateInstaMonkeyIcons(e){let t=document.getElementById(`${e}-main-container`);t.innerHTML="";let a=createEl("div",{id:"main-container-tier-totals",classList:["d-flex","jc-evenly"],style:{display:"none",margin:"10px 90px 0 90px",padding:"10px",borderRadius:"10px",backgroundColor:"rgba(0,0,0,0.25)"}});t.appendChild(a);for(let[t,n]of Object.entries(processedInstaData.TowerTierTotals[e])){let e=document.createElement("p");e.classList.add("insta-monkey-tier-text-list",`insta-tier-text-${t}`,"5"==t?"t5-insta-outline":"black-outline"),e.innerHTML=`${n}/${constants.instaTiers[t].length}`,a.appendChild(e)}let n=document.createElement("div");n.classList.add("insta-monkey-icons-container"),t.appendChild(n),constants.collectionOrder.forEach((t=>{let a=document.createElement("div");if(a.classList.add("insta-monkey-tier-container"),btd6usersave.instaTowers.hasOwnProperty(e)&&btd6usersave.instaTowers[e][t]||(a.style.display="none",a.classList.add("insta-monkey-unobtained")),n.appendChild(a),btd6usersave.instaTowers.hasOwnProperty(e)&&btd6usersave.instaTowers[e][t]>1){let n=document.createElement("p");n.classList.add("insta-progress","insta-tier-scale"),a.appendChild(n);let s=document.createElement("p");s.classList.add("power-progress-text","black-outline"),s.innerHTML=btd6usersave.instaTowers[e][t],n.appendChild(s)}let s=document.createElement("img");s.classList.add("insta-monkey-tier-img"),s.src=btd6usersave.instaTowers.hasOwnProperty(e)&&null!=btd6usersave.instaTowers[e][t]?getInstaMonkeyIcon(e,t):"./Assets/UI/InstaUncollected.webp",a.appendChild(s),btd6usersave.instaTowers.hasOwnProperty(e)&&0==btd6usersave.instaTowers[e][t]&&s.classList.add("upgrade-after-locked");let l=document.createElement("p");l.classList.add("insta-monkey-tier-text","black-outline"),l.innerHTML=`${t[0]}-${t[1]}-${t[2]}`,a.appendChild(l)}))}function onSelectMissingToggle(e){instasMissingToggle=e;for(let e of document.getElementsByClassName("insta-monkey-unobtained"))e.style.display=instasMissingToggle?"block":"none";document.getElementById("main-container-tier-totals").style.display=instasMissingToggle?"flex":"none"}function onSelectInstaPrevArrow(e){let t=Object.keys(constants.towersInOrder),a=t.indexOf(e);0==a?a=t.length-1:a--,onSelectInstaTower(t[a])}function onSelectInstaNextArrow(e){let t=Object.keys(constants.towersInOrder),a=t.indexOf(e);a==t.length-1?a=0:a++,onSelectInstaTower(t[a])}function generateInstaListView(){let e=document.getElementById("insta-monkeys-progress-container");e.innerHTML="";let t=document.createElement("div");t.classList.add("insta-monkeys-list-container"),e.appendChild(t);let a=document.createElement("div");a.classList.add("insta-monkeys-list"),t.appendChild(a),Object.keys(constants.towersInOrder).forEach((e=>{if(null==processedInstaData.TowerTierTotals[e])return;let t=document.createElement("div");switch(t.classList.add("insta-monkey-div"),a.appendChild(t),processedInstaData.TowerBorders[e]){case"Gold":t.classList.add("insta-list-gold");break;case"Black":t.classList.add("insta-list-black")}let n=document.createElement("div");n.classList.add("tower-container"),n.style.backgroundImage=`url(./Assets/UI/InstaTowersContainer${processedInstaData.TowerBorders[e]||""}.webp)`,n.addEventListener("click",(()=>{onSelectInstaTower(e)})),t.appendChild(n);let s=document.createElement("img");s.classList.add("tower-img"),s.src=getInstaContainerIcon(e,"000"),n.appendChild(s);let l=document.createElement("p");l.classList.add("tower-name","black-outline"),l.innerHTML=getLocValue(e),n.appendChild(l);let d=document.createElement("div");d.classList.add("insta-monkey-top-bottom"),t.appendChild(d);let r=document.createElement("div");r.classList.add("insta-monkey-progress-list"),d.appendChild(r);let i=document.createElement("div");i.classList.add("insta-monkey-total"),r.appendChild(i);let o=document.createElement("p");o.classList.add("insta-monkey-progress-label-text","black-outline"),o.innerHTML="Usable Instas:",i.appendChild(o);let c=document.createElement("p");c.classList.add("insta-monkey-total-text","black-outline"),c.innerHTML=processedInstaData.TowerTotal[e],i.appendChild(c);let p=document.createElement("div");p.classList.add("insta-monkey-tier-progress"),r.appendChild(p);let m=document.createElement("p");m.classList.add("insta-monkey-progress-label-text","black-outline"),m.innerHTML="Unique Instas:",p.appendChild(m);let u=document.createElement("p");u.classList.add("insta-monkey-progress-text","black-outline"),u.innerHTML=`${Object.values(processedInstaData.TowerTierTotals[e]).reduce(((e,t)=>e+t),0)}/64`,p.appendChild(u);let h=document.createElement("div");h.classList.add("insta-monkey-tiers-container"),d.appendChild(h);let g=document.createElement("p");g.classList.add("insta-monkey-tiers-label","black-outline"),g.innerHTML="Unique By Tier:",h.appendChild(g);for(let[t,a]of Object.entries(processedInstaData.TowerTierTotals[e])){let e=document.createElement("div");e.classList.add("insta-monkey-tier-div"),h.appendChild(e);let n=document.createElement("p");n.classList.add("insta-monkey-tier-text-list",`insta-tier-text-${t}`,"5"==t?"t5-insta-outline":"black-outline"),e.style.backgroundImage=`url(./Assets/UI/InstaTier${t}Container.webp)`,n.innerHTML=`${a}/${constants.instaTiers[t].length}`,e.appendChild(n)}}))}function generateInstaObtainGuide(){let e=document.getElementById("insta-monkeys-progress-container");e.innerHTML="";let t=document.createElement("div");t.classList.add("insta-monkeys-obtain-guide"),e.appendChild(t);let a=document.createElement("p");a.classList.add("insta-monkeys-guide-title-text","black-outline"),a.innerHTML="Where To Get More Insta Monkeys",t.appendChild(a);let n={Collection:{name:"Collection Events",desc:"Collection events are the main way to get Insta Monkeys. They usually happen around holidays. During the event, collect as much of the event currency as possible to open crates that contain random Insta Monkeys. You can use the Collection Event tab to help you view the odds of getting a new Insta Monkey from each of the chest types."},Daily:{name:"Daily Challenges",desc:"Daily Challenges often have random Insta Monkeys ranging from T1 to T3 as a reward. Coop Daily Challenges also give a random T1-T3 Insta Monkey. During a Collection event, these will give event currency for opening Insta Monkey chests."},Boss:{name:"Boss Events",desc:"Boss events happen every week. Defeating the Tier 4 and Tier 5 bosses in these events give random Insta Monkeys. The Normal Boss rewards include a T2 and T3 Insta Monkey, and the Elite Boss rewards include a T3 and T4 Insta Monkey."},Odyssey:{name:"Odyssey Events",desc:"Odyssey events give Insta Monkeys for completing the event and opening the chest. Medium difficulty usually gives a predetermined T3 Insta, and Hard gives a predetermined T4 Insta. During Collection events, Odysseys will give collection event currency instead for Insta Monkey chests."},Ranked:{name:"Ranked Events",desc:"Ranked events give random Insta Monkeys depending on your leaderboard placement. You can view Races, Bosses, and Contested Territory leaderboard rewards at the bottom right of the leaderboard. There is also a Mini Leaderboard for each event which gives extra rewards including Insta Monkeys."},R100:{name:"100 Rounds Rewards",desc:"Every 100 rounds you complete in a game, you get a random Insta Monkey. The tier of the Insta Monkey is dependent on the difficulty of the map. Beginner gives T0-T2, Intermediate gives T1-T3, Advanced gives T2-T4, Expert gives T3-T4. Round 200 and beyond also guarantees T3-T4 regardless of difficulty."},Chest:{name:"Daily Chest",desc:"The daily chest gives a random Insta Monkey on some days. The tiers range from T1-T4."},Shop:{name:"Shop",desc:"Need more Instas? The shop has some Insta packs you can purchase."}},s=document.createElement("div");s.classList.add("insta-monkey-guide-container"),t.appendChild(s),Object.keys(n).forEach((e=>{let t=document.createElement("div");t.classList.add("insta-monkey-guide-method"),s.appendChild(t);let a=document.createElement("div");a.classList.add("insta-monkey-guide-text-div"),t.appendChild(a);let l=document.createElement("p");l.classList.add("insta-monkey-guide-method-text","black-outline"),l.innerHTML=n[e].name,a.appendChild(l);let d=document.createElement("p");d.classList.add("insta-monkey-guide-method-desc"),d.innerHTML=n[e].desc,a.appendChild(d);let r=document.createElement("img");r.classList.add("insta-monkey-guide-method-img"),r.src=`./Assets/UI/Obtain${e}.webp`,t.appendChild(r)}))}function generateChestOddsModal(){let e=document.createElement("div"),t=document.createElement("p");t.classList.add("collection-desc-text"),t.innerHTML="These are the standard odds. Certain events may change these, but they will be updated to be accurate when I update the site. Accurate as of 8/30/2024",e.appendChild(t);let a=document.createElement("div");e.appendChild(a),Object.entries(constants.collection.crateRewards.instaMonkey).forEach((([e,t])=>{let n=document.createElement("div");n.classList.add("chest-container"),a.appendChild(n);let s=document.createElement("img");s.classList.add("collection-event-chest-selector"),s.src=`./Assets/UI/EventMysteryBox${chestSelectorMap[e]}Icon.webp`,n.appendChild(s);let l=document.createElement("div");l.classList.add("chest-tier-div"),n.appendChild(l),Object.entries(t.tierChance).forEach((([e,t])=>{let a=document.createElement("div");a.classList.add("tier-container"),l.appendChild(a);let n=document.createElement("img");n.classList.add("insta-monkey-tier-img"),n.src=`./Assets/UI/InstaRandomTier${e}.webp`,a.appendChild(n);let s=document.createElement("p");s.classList.add("tier-text","black-outline"),s.innerHTML=`${(100*t).toFixed(2)}%`,a.appendChild(s)}));let d=document.createElement("div");d.classList.add("chest-quantity-div"),n.appendChild(d),Object.entries(t.quantityChance).forEach((([e,t])=>{let a=document.createElement("div");a.classList.add("quantity-container"),d.appendChild(a);let n=document.createElement("div");n.classList.add("insta-icon-div"),a.appendChild(n);let s=document.createElement("img");s.classList.add("insta-quantity-icon"),s.src="./Assets/UI/InstaIcon.webp",n.appendChild(s);let l=document.createElement("p");l.classList.add("bloon-group-number","black-outline"),l.innerHTML=`X${e}`,n.appendChild(l);let r=document.createElement("p");r.classList.add("quantity-text","black-outline"),r.innerHTML=100*t+"%",a.appendChild(r)}))})),createModal({header:"Chest Base Odds",content:e,classList:["error-modal-overlay"]})}function generateHowToUseModal(){let e=document.createElement("div"),t=document.createElement("div");e.appendChild(t);Object.entries({"What is a Collection Event?":"These are events that occur approximately every other month (usually around holidays) that allow you to earn some form of currency that count towards unlocking Insta Monkey chests. This is the best way for collectors to work on their Insta Monkey collection.","What is a Featured Insta?":"Every 8 hours, a rotating select rotation of 4 Featured Insta Monkeys are available to select in collection events. Selecting a Featured Insta Monkey in-game will guarantee that Insta Monkeys recieved from the chest are of that tower type.","What does this helper do?":"When opening chests, how do you know which Featured Insta Monkey is best to pick to have the highest chance of getting a new Insta Monkey for your collection? This helps you choose what to pick, read below to learn how.","Start by Selecting a Chest":"Choose your current Collection Event chest type to set the type of chest to calculate the odds for.","Choose a Featured Insta Monkey (Optional)":"If you choose a featured Insta Monkey below the chests, you will see the odds by tier and total chance for that Insta Monkey. Select the same one again to go back to All Towers.","Entering Obtained Insta Monkeys":"At the bottom of selecting a featured Insta, you can see the missing Instas. Click on an Insta that you were missing to mark it as obtained manually until the API updates (takes at most 15 minutes).","All Towers":"All Towers displays the chances of getting a new Insta Monkey relative to your entire collection in the selected chest as well as a combined list of all the chances you will see when selecting each Featured Insta.","Featured Insta Odds List":"This is a great way to see which Featured Insta Monkey will be more likely to get a new Insta Monkey for your current chest type, including if it's better to let it go completely random with none selected!","How are the chances calculated?":"The chances are calculated by first taking how likely a specific Insta is out of random Insta Tier roll, and then multiplying it by the chest's likelihood of getting that random tier as a roll. This chance is for each individual roll of an Insta, and does not account for the varying quantities of Instas in chests. For example, using this sample Monkey Sub information, we can calculate how likely getting a missing Tier 2 is from a Silver Chest by first taking the chance of rolling that Insta Monkey when rolling a Tier 2 Insta from the chest, and then multiplying it by the chance of getting a Tier 2 Insta from the chest. In reality, this is 1/12 * 40% which is equivalent to 3.33%."}).forEach((([e,a],n)=>{let s=document.createElement("div");s.classList.add("modal-help-div"),t.appendChild(s);let l=document.createElement("p");l.classList.add("collection-header-title-text","black-outline"),l.innerHTML=e,s.appendChild(l);let d=document.createElement("p");d.classList.add("collection-desc-text"),d.innerHTML=a,s.appendChild(d);let r=document.createElement("img");r.classList.add("collection-help-img"),r.src=`./Assets/UI/CollectionHelp${n+1}.webp`,s.appendChild(r)})),createModal({header:"How to Use This Helper",content:e})}async function generateInstaCollectionEventHelper(){let e=document.getElementById("insta-monkeys-progress-container");e.innerHTML="",currentCollectionChest="None";let t=document.createElement("div");t.classList.add("insta-monkey-collection-container"),e.appendChild(t);let a=document.createElement("div");a.classList.add("insta-monkey-collection-top-btns"),t.appendChild(a);let n=document.createElement("p");n.classList.add("where-button","black-outline"),n.style.width="230px",n.innerHTML="How to Use This",n.addEventListener("click",(()=>{generateHowToUseModal()})),a.appendChild(n);let s=document.createElement("p");s.classList.add("where-button","black-outline"),s.style.width="230px",s.innerHTML="View Chest Odds",s.addEventListener("click",(()=>{generateChestOddsModal()})),a.appendChild(s);let l=await getLatestCollectionEvent(),d=new Date;if(null!=l&&d<new Date(l.end)){let e=document.createElement("p");e.classList.add("where-button","black-outline"),e.style.width="230px",e.innerHTML="Featured Instas",e.addEventListener("click",(()=>{addToBackQueue({source:"profile",destination:"featured"}),generateInstaSchedule(),document.getElementById("profile-content").style.display="none",document.getElementById("featured-content").style.display="flex"})),a.appendChild(e)}let r=document.createElement("p");r.classList.add("collection-desc-text"),r.innerHTML="Select a chest to see the chances of obtaining a new Insta Monkey based on your current collection. You can also view the Featured list or select a Featured Insta below to check the odds for selecting them in the event. The percentages represent the odds for each Insta Monkey received, so if a chest yields 2 Insta Monkeys, the odds are for 1 Insta Monkey roll.";let i=document.createElement("div");i.classList.add("collection-event-chest-selectors"),t.appendChild(i),Object.keys(chestSelectorMap).forEach((e=>{let t=document.createElement("img");t.id=`collection-event-chest-selector-${e}`,t.classList.add("collection-event-chest-selector"),t.src=`./Assets/UI/EventMysteryBox${chestSelectorMap[e]}Icon.webp`,t.addEventListener("click",(()=>{onSelectCollectionEventChest(e)})),i.appendChild(t)}));let o=document.createElement("div");o.classList.add("collection-event-tower-selectors"),t.appendChild(o),Object.keys(constants.towersInOrder).forEach((e=>{if(!Object.keys(btd6usersave.unlockedTowers).includes(e))return;let t=document.createElement("div");t.classList.add("collection-event-tower-selector"),t.addEventListener("click",(()=>{for(element of(currentCollectionTower=currentCollectionTower===e?"All":e,document.getElementsByClassName("collection-event-tower-selector")))element.classList.remove("collection-event-tower-selector-active");"All"!=currentCollectionTower&&t.classList.add("collection-event-tower-selector-active"),generateCollectionEventTowerInfo(currentCollectionTower)})),o.appendChild(t);let a=document.createElement("img");a.classList.add("collection-tower-icon"),a.src=getInstaMonkeyIcon(e,"000"),t.appendChild(a)}));let c=document.createElement("div");c.id="collection-event-tower-info",c.classList.add("collection-event-tower-info"),t.appendChild(c),generateCollectionEventTowerInfo(currentCollectionTower)}function generateChances(e){let t=[];if("All"==e)for(let e=1;e<6;e++){let a=0;Object.keys(constants.towersInOrder).forEach((t=>{Object.keys(btd6usersave.unlockedTowers).includes(t)&&(a+=processedInstaData.TowerMissingByTier[t][e].length||0)})),t.push(a>0?a/(constants.instaTiers[e].length*Object.keys(btd6usersave.unlockedTowers).length):0)}else for(let a=1;a<6;a++){let n=processedInstaData.TowerMissingByTier[e][a].length||0;t.push(n>0?n/constants.instaTiers[a].length:0)}let a=constants.collection.crateRewards.instaMonkey[currentCollectionChest].tierChance;return t.forEach(((e,n)=>{let s=a[n+1]||0;t[n]=e*s})),t}function generateCollectionEventTowerInfo(e){"None"==currentCollectionChest&&onSelectCollectionEventChest("wood");let t=generateChances(e),a=document.getElementById("collection-event-tower-info");a.innerHTML="";let n=document.createElement("div");n.classList.add("insta-monkey-div","insta-monkey-collection-div"),a.appendChild(n);let s=document.createElement("div");if(s.classList.add("insta-monkey-collection-main-div"),n.appendChild(s),"All"!=e)switch(processedInstaData.TowerBorders[e]){case"Gold":n.classList.add("insta-list-gold");break;case"Black":n.classList.add("insta-list-black")}let l=document.createElement("div");l.classList.add("insta-tower-and-missing-toggle"),"All"==e&&l.classList.add("insta-collection-all"),s.appendChild(l);let d=document.createElement("div");d.classList.add("tower-container-collection"),d.style.backgroundImage=`url(./Assets/UI/InstaTowersContainer${processedInstaData.TowerBorders[e]||""}.webp)`,"All"!=e&&d.addEventListener("click",(()=>{onSelectInstaTower(e)})),l.appendChild(d);let r=document.createElement("img");r.classList.add("tower-img"),r.src="All"==e?"./Assets/UI/AllTowersIcon.webp":getInstaContainerIcon(e,"000"),d.appendChild(r);let i=document.createElement("p");i.classList.add("tower-name","black-outline"),i.innerHTML="All"==e?"All Towers":getLocValue(e),d.appendChild(i);let o=document.createElement("div");o.classList.add("insta-missing-toggle-div");let c=document.createElement("p");c.classList.add("insta-collection-missing-label","black-outline"),c.innerHTML="Show Missing: ",o.appendChild(c);let p=document.createElement("input");p.classList.add("maps-progress-coop-toggle-input"),p.type="checkbox",p.checked=collectionMissingToggle,o.appendChild(p),"All"!=e&&l.appendChild(o);let m=document.createElement("div");m.classList.add("insta-monkey-top-bottom"),s.appendChild(m);let u=document.createElement("div");u.classList.add("insta-monkey-progress-list"),m.appendChild(u);let h=document.createElement("div");h.classList.add("insta-monkey-total"),u.appendChild(h);let g=document.createElement("p");g.classList.add("insta-monkey-progress-label-text","black-outline"),g.innerHTML="Usable Instas:",h.appendChild(g);let b=document.createElement("p");b.classList.add("insta-monkey-total-text","black-outline"),b.innerHTML="All"==e?Object.values(processedInstaData.TowerTotal).reduce(((e,t)=>e+t)):processedInstaData.TowerTotal[e],h.appendChild(b);let L=document.createElement("div");L.classList.add("insta-monkey-tier-progress"),u.appendChild(L);let v=document.createElement("p");v.classList.add("insta-monkey-progress-label-text","black-outline"),v.innerHTML="Unique Instas:",L.appendChild(v);let y=document.createElement("p");y.classList.add("insta-monkey-progress-text","black-outline"),y.innerHTML="All"==e?`${btd6publicprofile.gameplay.instaMonkeyCollection}/${constants.totalInstaMonkeys}`:`${Object.values(processedInstaData.TowerTierTotals[e]).reduce(((e,t)=>e+t),0)}/64`,L.appendChild(y);let f=document.createElement("div");f.classList.add("insta-monkey-new-chance"),u.appendChild(f);let C=document.createElement("p");C.classList.add("insta-monkey-progress-label-text","black-outline"),C.innerHTML="Total New Chance:",f.appendChild(C);let w=document.createElement("p");w.classList.add("insta-monkey-total-chance-text","black-outline"),f.appendChild(w);let E=document.createElement("div");E.classList.add("insta-monkey-tiers-container"),m.appendChild(E);let k=document.createElement("p");k.classList.add("insta-monkey-tiers-label","black-outline"),k.innerHTML="Unique By Tier:",E.appendChild(k);let T="All"==e?Object.entries([1,2,3,4,5].reduce(((e,t)=>({...e,[t]:Object.values(processedInstaData.TowerTierTotals).map((e=>e[t]||0)).reduce(((e,t)=>e+t),0)})),{})):Object.entries(processedInstaData.TowerTierTotals[e]);for(let[t,a]of T){let n=document.createElement("div");if(n.classList.add("insta-monkey-tier-div"),E.appendChild(n),"All"==e){let e=document.createElement("p");e.classList.add("insta-monkey-tier-text-list",`insta-tier-text-${t}`,"5"==t?"t5-insta-outline":"black-outline"),n.style.backgroundImage=`url(./Assets/UI/InstaTier${t}Container.webp)`,e.innerHTML=`${a}`,n.appendChild(e);let s=document.createElement("p");s.classList.add("insta-monkey-tier-fraction-bar",`insta-tier-text-${t}`,"5"==t?"t5-insta-outline":"black-outline"),n.appendChild(s);let l=document.createElement("p");l.classList.add("insta-monkey-tier-text-list",`insta-tier-text-${t}`,"5"==t?"t5-insta-outline":"black-outline"),l.innerHTML=""+constants.instaTiers[t].length*Object.keys(constants.towersInOrder).length,n.appendChild(l)}else{let e=document.createElement("p");e.classList.add("insta-monkey-tier-text-list",`insta-tier-text-${t}`,"5"==t?"t5-insta-outline":"black-outline"),n.style.backgroundImage=`url(./Assets/UI/InstaTier${t}Container.webp)`,e.innerHTML=`${a}/${constants.instaTiers[t].length}`,n.appendChild(e)}}let M=document.createElement("div");M.classList.add("insta-monkey-chance-container"),m.appendChild(M);let S=document.createElement("p");S.classList.add("insta-monkey-tiers-label","black-outline"),S.innerHTML="New Chance:",M.appendChild(S);let I="black-outline";if("All"!=e)switch(processedInstaData.TowerBorders[e]){case"Gold":I="knowledge-outline";break;case"Black":I="leaderboard-outline"}let x=constants.collection.crateRewards.instaMonkey[currentCollectionChest].tierChance;for(let[e,a]of T){let a=document.createElement("div");a.classList.add("insta-monkey-chance-div"),M.appendChild(a);let n=document.createElement("p");if(n.classList.add("insta-monkey-chance-text-list",I),n.innerHTML=(100*t[e-1]).toFixed(2)+"%",a.appendChild(n),x.hasOwnProperty(e)&&0==t[e-1]){let e=document.createElement("img");e.classList.add("insta-monkey-completed-tick"),e.src="./Assets/UI/TickGreenIcon.webp",a.appendChild(e)}else 0==t[e-1]&&n.classList.add("insta-monkey-chance-zero")}w.innerHTML=`${(100*t.reduce(((e,t)=>e+t),0)).toFixed(2)}%`,0==t.reduce(((e,t)=>e+t),0)&&w.classList.add("insta-monkey-chance-zero");let B=document.createElement("div");B.style.display="none",B.classList.add("insta-monkeys-missing-container"),n.appendChild(B),"All"!=e?p.addEventListener("change",(()=>{B.style.display=p.checked?"flex":"none",B.innerHTML="",collectionMissingToggle=p.checked,onSelectCollectionEventMissingToggle(B,e,t)})):(B.style.display="flex",openAllTowersList(B)),collectionMissingToggle&&"All"!=e&&(B.style.display="flex",onSelectCollectionEventMissingToggle(B,e,t))}function onSelectCollectionEventChest(e){currentCollectionChest=e;for(let e of document.getElementsByClassName("collection-event-chest-selector"))e.classList.remove("chest-selected"),e.classList.add("chest-unselected");document.getElementById(`collection-event-chest-selector-${e}`).classList.add("chest-selected"),generateCollectionEventTowerInfo(currentCollectionTower)}function onSelectCollectionEventMissingToggle(e,t,a){function n(t,a,n){let s=document.createElement("div");s.classList.add("insta-monkey-tier-container","insta-monkey-unobtained"),e.appendChild(s);let l=document.createElement("img");l.classList.add("insta-monkey-tier-img"),l.src=getInstaMonkeyIcon(t,a),s.appendChild(l),l.classList.add("upgrade-after-locked");let d=document.createElement("p");if(d.classList.add("insta-monkey-tier-text","black-outline"),d.innerHTML=`${a[0]}-${a[1]}-${a[2]}`,s.appendChild(d),n){let e=document.createElement("img");e.classList.add("insta-monkey-tier-obtained"),e.src="./Assets/UI/TickGreenIcon.webp",s.appendChild(e),s.addEventListener("click",(()=>{processedInstaData.TowerObtained[t]=processedInstaData.TowerObtained[t].filter((e=>e!=a));let e=Object.keys(constants.instaTiers).find((e=>constants.instaTiers[e].includes(a)));processedInstaData.TowerMissingByTier[t][e].push(a),delete btd6usersave.instaTowers[t][a],processedInstaData.TowerTierTotals[t][e]-=1,btd6publicprofile.gameplay.instaMonkeyCollection-=1,document.getElementById("insta-total-counter").innerHTML=`${btd6publicprofile.gameplay.instaMonkeyCollection}/${constants.totalInstaMonkeys}`,calculateInstaBorder(t),generateCollectionEventTowerInfo(t)}))}else s.addEventListener("click",(()=>{processedInstaData.TowerObtained[t].push(a);let e=Object.keys(constants.instaTiers).find((e=>constants.instaTiers[e].includes(a)));processedInstaData.TowerMissingByTier[t][e]=processedInstaData.TowerMissingByTier[t][e].filter((e=>e!=a)),btd6usersave.instaTowers[t][a]=0,processedInstaData.TowerTierTotals[t][e]+=1,btd6publicprofile.gameplay.instaMonkeyCollection+=1,document.getElementById("insta-total-counter").innerHTML=`${btd6publicprofile.gameplay.instaMonkeyCollection}/${constants.totalInstaMonkeys}`,calculateInstaBorder(t),generateCollectionEventTowerInfo(t)}))}if("All"==t)Object.entries(processedInstaData.TowerMissingByTier).forEach((([e,t])=>{Object.entries(t).forEach((([t,s])=>{if(a[t-1]>0)for(let t of s)n(e,t)}))}));else{let s=Object.entries(processedInstaData.TowerMissingByTier[t]).map((([e,t])=>({tier:e,insta:t}))).filter((({tier:e,insta:t})=>a[e-1]>0)).map((({insta:e})=>e)).flat();s.forEach((e=>{n(t,e,!1)}));let l=processedInstaData.TowerObtained[t];if(l.forEach((e=>{n(t,e,!0)})),0==s.length&&0==l.length){let t=document.createElement("p");t.classList.add("no-data-found","none-collection","black-outline"),t.innerHTML="None Missing in this Chest Type!",e.appendChild(t)}}}function openAllTowersList(e){e.innerHTML="";let t={};t.NoFeatured=generateChances("All"),Object.keys(constants.towersInOrder).forEach((e=>{t[e]=generateChances(e)}));let a=Object.keys(constants.towersInOrder);switch(collectionListSortType){case"Highest Total Chance":a=Object.keys(t).sort(((e,a)=>{let n=t[e].reduce(((e,t)=>e+t),0),s=t[a].reduce(((e,t)=>e+t),0);return s-n}));break;case"In-Game Tower Order":break;case"Alphabetical Towers":a=Object.keys(constants.towersInOrder).sort()}let n=document.createElement("div");n.classList.add("insta-monkey-title-container"),e.appendChild(n);let s=document.createElement("p");s.classList.add("collection-header-list-text","black-outline"),s.innerHTML=`Featured Insta Odds (${currentCollectionChest.toLocaleUpperCase()} ${"wood"==currentCollectionChest?"Crate":"Chest"})`,n.appendChild(s);let l=document.createElement("div");l.classList.add("insta-monkey-sort-container"),n.appendChild(l);let d=document.createElement("p");d.classList.add("insta-monkey-sort-label","black-outline"),d.innerHTML="Sort By:",l.appendChild(d);let r=document.createElement("select");r.classList.add("map-progress-filter-difficulty-select"),r.addEventListener("change",(()=>{})),l.appendChild(r);["Highest Total Chance","In-Game Tower Order","Alphabetical Towers"].forEach((e=>{let t=document.createElement("option");t.value=e,t.innerHTML=e,r.appendChild(t)})),r.value=collectionListSortType,r.addEventListener("change",(()=>{collectionListSortType=r.value,openAllTowersList(e)}));let i=document.createElement("div");i.classList.add("insta-monkey-header-container","insta-monkey-unobtained"),e.appendChild(i),Object.entries({"Tower Type":"white","Tier 1 Chance":"insta-tier-text-1","Tier 2 Chance":"insta-tier-text-2","Tier 3 Chance":"insta-tier-text-3","Tier 4 Chance":"insta-tier-text-4","Tier 5 Chance":"insta-tier-text-5","Total Chance":"white"}).forEach((([e,t])=>{let a=document.createElement("div");a.classList.add("insta-monkey-header-container","insta-monkey-unobtained"),i.appendChild(a);let n=document.createElement("p");n.classList.add("insta-monkey-small-name-text","black-outline",t),n.innerHTML=e,a.appendChild(n)}));let o=constants.collection.crateRewards.instaMonkey[currentCollectionChest].tierChance;a.forEach((a=>{let n=document.createElement("div");n.classList.add("insta-monkey-list-container","insta-monkey-unobtained"),e.appendChild(n);let s=document.createElement("img");s.classList.add("insta-monkey-list-img"),s.src="NoFeatured"==a?"./Assets/UI/InstaRandomTier1.webp":getInstaMonkeyIcon(a,"000"),n.appendChild(s);let l=document.createElement("p");l.classList.add("insta-monkey-small-name-text","black-outline"),l.innerHTML="NoFeatured"==a?"No Featured Selected":getLocValue(a),n.appendChild(l);let d=document.createElement("div");d.classList.add("insta-monkey-list-chance-container"),n.appendChild(d),t[a].forEach(((e,t)=>{let a=document.createElement("div");a.classList.add("insta-monkey-chance-div"),d.appendChild(a);let n=document.createElement("p");if(n.classList.add("insta-monkey-chance-text-list","black-outline"),n.innerHTML=(100*e).toFixed(2)+"%",o.hasOwnProperty(t+1)&&0==e){let e=document.createElement("img");e.classList.add("insta-monkey-completed-tick"),e.src="./Assets/UI/TickGreenIcon.webp",a.appendChild(e)}else 0==e&&n.classList.add("insta-monkey-chance-zero");a.appendChild(n)}));let r=document.createElement("div");r.classList.add("insta-monkey-chance-div"),d.appendChild(r);let i=t[a].reduce(((e,t)=>e+t),0),c=document.createElement("p");c.classList.add("insta-monkey-chance-text-list","black-outline"),c.innerHTML=(100*i).toFixed(2)+"%",0==i&&c.classList.add("insta-monkey-chance-zero"),r.appendChild(c)}))}function generateAbilities(){let e=document.getElementById("profile-content");e.innerHTML="";let t=document.createElement("div");t.classList.add("insta-monkeys-header-bar","d-flex","jc-between","ai-center","w-100"),e.appendChild(t);let a={...btd6publicprofile.stats.abilitiesActivatedByName};switch(abilitiesFilter){case"Most Used":a=Object.fromEntries(Object.entries(a).sort(((e,t)=>t[1]-e[1])));break;case"Least Used":a=Object.fromEntries(Object.entries(a).sort(((e,t)=>e[1]-t[1])))}let n=generateDropdown("Sort By:",["Most Used","Least Used"],abilitiesFilter,(e=>{abilitiesFilter=e,generateAbilities()}));n.style.padding="10px",t.appendChild(n);let s=document.createElement("p");s.classList.add("abilities-total-text","black-outline"),s.style.padding="10px",s.style.fontSize="22px",s.innerHTML=`Total Abilities Used: ${profileStats["Abilities Used"].toLocaleString()}`,t.appendChild(s);let l=document.createElement("div");l.classList.add("d-flex","f-wrap","ai-center","jc-center"),e.appendChild(l),Object.entries(a).forEach((([e,t])=>{if(null==constants.abilities[e])return;let a=constants.abilities[e],n=document.createElement("div");n.classList.add("ability-container"),l.appendChild(n);let s=document.createElement("img");s.classList.add("ability-img","of-contain"),s.style.width="100px",s.style.height="100px",s.src=`./Assets/AbilityIcon/${a.icon}.webp`,n.appendChild(s);let d=document.createElement("p");d.classList.add("ability-text","black-outline"),d.style.width="100px",d.innerHTML=a.displayName,n.appendChild(d);let r=document.createElement("p");r.classList.add("ability-uses-counter","black-outline"),r.innerHTML=`${t.toLocaleString()} uses`,n.appendChild(r),tippy(n,{content:a.description,placement:"top",theme:"speech_bubble",popperOptions:{modifiers:[{name:"preventOverflow",options:{boundary:"viewport",padding:{right:18}}}]}})}))}function generateAchievementsProgress(){let e=document.getElementById("profile-content");e.innerHTML="";let t=document.createElement("div");t.classList.add("achievements-progress-container"),e.appendChild(t);let a=document.createElement("div");a.classList.add("achievements-header-bar"),t.appendChild(a);let n=document.createElement("div");n.classList.add("maps-progress-views"),a.appendChild(n);let s=document.createElement("div");s.classList.add("map-progress-filter-difficulty"),n.appendChild(s);let l=document.createElement("p");l.classList.add("maps-progress-coop-toggle-text","black-outline"),l.innerHTML="Filter:",s.appendChild(l);let d=document.createElement("select");d.classList.add("map-progress-filter-difficulty-select");["None","Knowledge Points","Insta Monkeys","Hidden Achievements"].forEach((e=>{let t=document.createElement("option");t.value=e,t.innerHTML=e,d.appendChild(t)})),s.appendChild(d);let r=document.createElement("div");r.classList.add("maps-progress-filter"),a.appendChild(r);let i=document.createElement("div");i.classList.add("map-progress-filter-difficulty"),r.appendChild(i);let o=document.createElement("p");o.classList.add("maps-progress-coop-toggle-text","black-outline"),o.innerHTML="Display:",i.appendChild(o);let c=document.createElement("select");c.classList.add("map-progress-filter-difficulty-select"),c.addEventListener("change",(()=>{onChangeAchievementsFilter(c.value)}));["All","Locked","Unlocked"].forEach((e=>{let t=document.createElement("option");t.value=e,t.innerHTML=e,c.appendChild(t)})),i.appendChild(c);let p=document.createElement("div");p.id="achievements-container",p.classList.add("achievements-container"),e.appendChild(p),d.addEventListener("change",(()=>{onChangeAchievementRewardFilter(d.value)})),onChangeAchievementsFilter("All"),onChangeAchievementRewardFilter("None"),generateAchievementsGameView()}function generateAchievementsGameView(){let e=document.getElementById("achievements-container");e.innerHTML="";let t=Object.keys(achievementsJSON);switch(currentAchievementFilter){case"Locked":t=t.filter((e=>!btd6usersave.achievementsClaimed.includes(reverseAchievementNameFixMap[achievementsJSON[e].name]||achievementsJSON[e].name)));break;case"Unlocked":t=t.filter((e=>btd6usersave.achievementsClaimed.includes(reverseAchievementNameFixMap[achievementsJSON[e].name]||achievementsJSON[e].name)));break;case"All":t=t.sort(((e,t)=>btd6usersave.achievementsClaimed.includes(reverseAchievementNameFixMap[achievementsJSON[e].name]||achievementsJSON[e].name)-btd6usersave.achievementsClaimed.includes(reverseAchievementNameFixMap[achievementsJSON[t].name]||achievementsJSON[t].name)))}switch(currentAchievementRewardFilter){case"Monkey Money":t=t.filter((e=>achievementsJSON[e].model.loot.includes("MonkeyMoney"))),t=t.sort(((e,t)=>Object.values(processRewardsString(achievementsJSON[e].model.loot)).find((e=>"MonkeyMoney"==e.type)).amount-Object.values(processRewardsString(achievementsJSON[t].model.loot)).find((e=>"MonkeyMoney"==e.type)).amount));break;case"Knowledge Points":t=t.filter((e=>achievementsJSON[e].model.loot.includes("KnowledgePoints")));break;case"Insta Monkeys":t=t.filter((e=>achievementsJSON[e].model.loot.includes("InstaMonkey")));break;case"Hidden Achievements":t=t.filter((e=>achievementsJSON[e].model.hidden))}if(0==t.length){let t=document.createElement("p");t.classList.add("no-data-found","black-outline"),t.innerHTML="No Data Found.",t.style.width="100%",e.appendChild(t)}let a=document.createDocumentFragment();for(let e of t){let t=achievementsJSON[e],n=btd6usersave.achievementsClaimed.includes(reverseAchievementNameFixMap[t.name]||t.name),s=document.createElement("div");s.classList.add("achievement-div"),a.appendChild(s);let l=document.createElement("div");l.classList.add("achievement-top-div"),s.appendChild(l);let d=document.createElement("div");d.classList.add("achievement-icon-div"),l.appendChild(d);let r=document.createElement("img");r.classList.add("achievement-icon-img"),r.src=getAchievementIcon(t.model.achievementIcon,!n&&t.model.hidden),d.appendChild(r);let i=document.createElement("div");i.classList.add("achievement-text-div"),l.appendChild(i);let o=document.createElement("p");o.classList.add("achievement-name-text","black-outline"),o.innerHTML=n?getLocValue(`Achievement ${t.model.achievementId} Name`):t.model.hidden?"???":getLocValue(`Achievement ${t.model.achievementId} Name`),i.appendChild(o);let c=document.createElement("p");c.classList.add("achievement-desc-text");let p=n?getLocValue(`Achievement ${t.model.achievementId} Description`):t.model.hidden?"???":getLocValue(`Achievement ${t.model.achievementId} Description`);c.innerHTML=-1!=p.indexOf("{0}")?p.replace("{0}"," "+t.model.achievementGoal.toLocaleString()):p,i.appendChild(c);let m=document.createElement("div");m.classList.add("achievement-bottom-div"),s.appendChild(m);let u=document.createElement("div");u.classList.add("achievement-rewards-div"),m.appendChild(u);for(let[e,a]of Object.entries(processRewardsString(t.model.loot))){let e=document.createElement("div");e.classList.add("achievement-reward-div"),u.appendChild(e);let t=document.createElement("img");t.classList.add("achievement-reward-img"),t.src=getRewardIcon(a),e.appendChild(t);let n=document.createElement("p");n.classList.add("achievement-reward-text","black-outline");let s="";switch(a.type){case"InstaMonkey":s=a.tiers.split("").join("-");break;case"Knowledge":s="+ "+a.amount.toLocaleString();break;case"Power":case"RandomInstaMonkey":s="X "+a.amount.toLocaleString();break;default:s=a.amount?a.amount.toLocaleString():""}n.innerHTML=s,e.appendChild(n)}if(n){let e=document.createElement("img");e.classList.add("achievement-completed-check"),e.src="./Assets/UI/TickGreenIcon.webp",m.appendChild(e)}else t.model.hidden&&m.appendChild(generateButton("Reveal","unset",(function(){o.innerHTML=getLocValue(`Achievement ${t.model.achievementId} Name`),c.innerHTML=getLocValue(`Achievement ${t.model.achievementId} Description`),r.src=getAchievementIcon(t.model.achievementIcon,!1),t.model.hidden=!1,m.removeChild(m.lastChild)})))}e.appendChild(a)}function generateExtrasProgress(){let e=document.getElementById("profile-content");e.innerHTML="";let t=document.createElement("div");t.classList.add("extras-progress-container"),e.appendChild(t);let a=[["Big Bloons","BigBloonsMode"],["Small Bloons","SmallBloonsMode"],["Big Monkey Towers","BigTowersMode"],["Small Monkey Towers","SmallTowersMode"],["Small Bosses","SmallBossesMode"]];for(let[e,n]of a){let a=null==extrasUnlocked[e],s=document.createElement("div");s.classList.add("extra-progress-div"),t.appendChild(s);let l=document.createElement("img");l.classList.add("extra-progress-img"),l.src=a?"./Assets/AchievementIcon/HiddenIcon.webp":`./Assets/UI/${n}Icon.webp`,s.appendChild(l);let d=document.createElement("p");if(d.classList.add("extra-progress-text","black-outline"),d.innerHTML=a?"???":getLocValue(n),s.appendChild(d),!a){let e=document.createElement("img");e.classList.add("extra-progress-tick"),e.src="./Assets/UI/TickGreenIcon.webp",s.appendChild(e)}}}function onChangeAchievementsFilter(e){currentAchievementFilter=e,generateAchievementsGameView()}function onChangeAchievementRewardFilter(e){currentAchievementRewardFilter=e,generateAchievementsGameView()}async function generateEvents(){let e=document.getElementById("events-content");e.innerHTML="";let t=document.createElement("div");t.classList.add("progress-page"),e.appendChild(t);let a=document.createElement("div");a.classList.add("selectors-div"),t.appendChild(a);let n={Collection:{img:getCollectionEventSkinIcon(constants.collection.current.skin),text:"Collection Event Schedule",bgimg:"EventBanner/EventBannerSmallTotem"},Races:{img:"EventRaceBtn",text:"Race Events",bgimg:"EventBanner/EventBannerSmallRaces"},Bosses:{img:"BossesBtn",text:"Boss Events",bgimg:"EventBanner/EventBannerSmallBossChallenge"},Odyssey:{img:"OdysseyEventBtn",text:"Odyssey Events (Coming Soon)",bgimg:"EventBanner/EventBannerSmallOdyssey"},ContestedTerritory:{img:"ContestedTerritoryEventBtn",text:"Contested Territory",bgimg:"ProfileBanner/TeamsBanner8"},DailyChallenges:{img:"DailyChallengeBtn",text:"Daily Challenges",bgcolor:"radial-gradient(circle, transparent 50%, rgba(0,0,0,1) 100%),linear-gradient(45deg, rgb(70,148,213), rgb(70,148,213))"},AdvancedDailyChallenges:{img:"DailyChallengeBtn",text:"Advanced Daily Challenges",bgcolor:"radial-gradient(circle, transparent 50%, rgba(0,0,0,1) 100%),linear-gradient(45deg, rgb(234,99,52), rgb(234,99,52))"},CoopDailyChallenges:{img:"DailyChallengeBtn",text:"Coop Challenges",bgcolor:"radial-gradient(circle, transparent 50%, rgba(0,0,0,1) 100%),linear-gradient(45deg, rgb(255,150,0), rgb(255,150,0))"}};showLoading();let s=await getLatestCollectionEvent(),l=new Date;(null==s||l>new Date(s.end))&&delete n.Collection,Object.entries(n).forEach((([e,t])=>{let n=createEl("div",{classList:["events-selector-div","transparent-border"],style:{borderWidth:"5px",borderStyle:"solid"}});t.bgcolor?n.style.background=t.bgcolor:n.style.backgroundImage=`url(../Assets/${t.bgimg}.webp)`,n.addEventListener("click",(()=>{changeEventTab(e)})),a.appendChild(n);let s=document.createElement("img");s.classList.add("selector-img"),s.src=`../Assets/UI/${t.img}.webp`,n.appendChild(s);let l=document.createElement("p");l.classList.add("event-selector-text","black-outline"),l.innerHTML=t.text,n.appendChild(l);let d=document.createElement("img");d.classList.add("selector-go-img"),"Odyssey"==e&&d.classList.add("hero-selector-div-disabled"),d.src="../Assets/UI/ContinueBtn.webp",n.appendChild(d)}))}function changeEventTab(e){switch(resetScroll(),timerInterval&&clearInterval(timerInterval),e){case"Races":showLoading(),getRacesData();break;case"Bosses":showLoading(),getBossesData();break;case"Odyssey":break;case"ContestedTerritory":showLoading(),getCTData();break;case"DailyChallenges":showLoading(),generateChallenges("DailyChallenges");break;case"AdvancedDailyChallenges":showLoading(),generateChallenges("AdvancedDailyChallenges");break;case"CoopDailyChallenges":showLoading(),generateChallenges("CoopDailyChallenges");break;case"Collection":addToBackQueue({source:"events",destination:"featured"}),generateInstaSchedule(),document.getElementById("events-content").style.display="none",document.getElementById("featured-content").style.display="flex"}}function generateRaces(){let e=document.getElementById("events-content");e.innerHTML="",clearAllTimers(),Object.values(racesData).forEach(((t,a)=>{let n=document.createElement("div");n.classList.add("race-div"),e.appendChild(n);let s=document.createElement("div");s.classList.add("race-map-div","silver-border"),n.appendChild(s);let l=document.createElement("img");l.classList.add("race-map-img"),l.src="./Assets/MapIcon/MapLoadingImage.webp",s.appendChild(l);let d=document.createElement("div");d.classList.add("race-challenge-icons"),s.appendChild(d);let r=document.createElement("p");r.classList.add("race-map-rounds","black-outline"),s.appendChild(r);let i=document.createElement("div");i.classList.add("race-info-div"),n.appendChild(i);let o=document.createElement("div");o.classList.add("race-info-top-div"),i.appendChild(o);let c=document.createElement("div");c.classList.add("race-info-middle-div"),i.appendChild(c);let p=document.createElement("div");p.classList.add("race-info-bottom-div"),i.appendChild(p);let m=document.createElement("p");m.classList.add("race-info-name","black-outline"),m.innerHTML=t.name,o.appendChild(m);let u=document.createElement("p");u.id=`Race-${t.id}-TimeLeft`,u.classList.add("race-time-left","black-outline"),u.innerHTML="Finished",o.appendChild(u),new Date<new Date(t.start)?u.innerHTML="Coming Soon!":new Date(t.end)>new Date?registerTimer(u.id,new Date(t.end)):new Date>new Date(t.end)&&(u.innerHTML="Finished");let h=document.createElement("p");h.classList.add("race-info-dates","black-outline"),h.innerHTML=`${new Date(t.start).toLocaleDateString()} - ${new Date(t.end).toLocaleDateString()}`,c.appendChild(h),tippy(h,{content:`${new Date(t.start).toLocaleString()}<br>${new Date(t.end).toLocaleString()}`,placement:"top",theme:"speech_bubble",allowHTML:!0});let g=document.createElement("p");g.classList.add("race-info-total-scores","black-outline"),g.innerHTML=`Total Scores: ${0==t.totalScores?"No Data":t.totalScores.toLocaleString()}`,c.appendChild(g);let b=document.createElement("div");b.classList.add("race-info-rules","start-button","hero-selector-div-disabled","black-outline"),b.innerHTML="Details",b.addEventListener("click",(()=>{"string"!=typeof racesData[a].metadata&&(showLoading(),showChallengeModel("events",t.metadata,"Race"))})),p.appendChild(b);let L=document.createElement("div");L.classList.add("race-info-leaderboard","where-button","black-outline"),L.innerHTML="Leaderboard",L.addEventListener("click",(()=>{showLeaderboard("events",t,"Race")})),p.appendChild(L),new IntersectionObserver(((e,n)=>{e.forEach((async e=>{if(e.isIntersecting&&(await getRaceMetadata(a),"string"!=typeof racesData[a].metadata)){n.unobserve(e.target),b.classList.remove("hero-selector-div-disabled"),l.src=Object.keys(constants.mapsInOrder).includes(t.metadata.map)?getMapIcon(t.metadata.map):t.metadata.mapURL;let a=challengeModifiers(t.metadata),s=challengeRules(t.metadata);for(let e of Object.values(a)){let t=document.createElement("img");t.classList.add("challenge-modifier-icon-event"),t.src=`./Assets/ChallengeRulesIcon/${e.icon}.webp`,d.appendChild(t)}for(let e of s){if("No Round 100 Reward"==e)continue;if("Paragon Limit"==e)continue;let t=document.createElement("img");t.classList.add("challenge-rule-icon-event"),t.src=`./Assets/ChallengeRulesIcon/${rulesMap[e]}.webp`,d.appendChild(t)}r.innerHTML=`Rounds ${t.metadata.startRound}/${t.metadata.endRound}`}}))})).observe(s)}))}function generateBosses(e){let t=document.getElementById("events-content");t.innerHTML="",clearAllTimers();let a=document.createElement("div");a.classList.add("switch-banner"),a.style.backgroundImage=`url(../Assets/UI/${showElite?"":"Elite"}Ribbon.webp)`,t.appendChild(a);let n=document.createElement("div");n.classList.add("switch-boss-div"),a.appendChild(n);let s=["Bloonarius","Lych","Vortex","Dreadbloon","Phayze","Blastapopoulos"];for(let e of s){let t=document.createElement("img");t.classList.add("switch-boss-img"),t.src=`./Assets/BossIcon/${e}Portrait${showElite?"":"Elite"}.webp`,n.appendChild(t)}let l=document.createElement("p");l.classList.add("switch-text","black-outline"),l.innerHTML=`Switch to ${showElite?"Standard":"Elite"}  Bosses`,a.appendChild(l),a.addEventListener("click",(()=>{showElite=!showElite,timerInterval&&clearInterval(timerInterval),generateBosses(showElite)})),Object.values(bossesData).forEach(((a,n)=>{let s=a.bossType.toLowerCase().replace(/\b\w/g,(e=>e.toUpperCase())),l=a.name.replace(/\D/g,""),d=`${e?"Elite":""} ${s} ${l}`,r={name:s,elite:e,eventNumber:l,scoringType:e?a.eliteScoringType:a.normalScoringType,index:n},i=document.createElement("div");i.classList.add("race-div"),i.style.backgroundImage=`url(../Assets/EventBanner/EventBannerSmall${s}.webp)`,t.appendChild(i);let o=document.createElement("div");o.classList.add("race-map-div","boss-border"),i.appendChild(o);let c=document.createElement("img");c.classList.add("race-map-img"),c.src="./Assets/MapIcon/MapLoadingImage.webp",o.appendChild(c);let p=document.createElement("img");p.classList.add("boss-map-boss-icon"),p.src=`./Assets/BossIcon/${s}Portrait${e?"Elite":""}.webp`,o.appendChild(p);let m=document.createElement("div");m.classList.add("race-challenge-icons"),o.appendChild(m);let u=document.createElement("p");u.classList.add("race-map-rounds"),o.appendChild(u);let h=document.createElement("div");h.classList.add("race-info-div","boss-info-div"),i.appendChild(h);let g=document.createElement("div");g.classList.add("race-info-top-div"),h.appendChild(g);let b=document.createElement("div");b.classList.add("race-info-middle-div"),h.appendChild(b);let L=document.createElement("div");L.classList.add("race-info-bottom-div"),h.appendChild(L);let v=document.createElement("p");v.classList.add("race-info-name","black-outline"),v.innerHTML=d,g.appendChild(v);let y=document.createElement("p");y.id=`Boss-${a.id}-TimeLeft`,y.classList.add("race-time-left","black-outline"),y.innerHTML="Finished",g.appendChild(y),new Date<new Date(a.start)?y.innerHTML="Coming Soon!":new Date(a.end)>new Date?registerTimer(y.id,new Date(a.end)):new Date>new Date(a.end)&&(y.innerHTML="Finished");let f=document.createElement("p");f.classList.add("race-info-dates","black-outline"),f.innerHTML=`${new Date(a.start).toLocaleDateString()} - ${new Date(a.end).toLocaleDateString()}`,b.appendChild(f),tippy(f,{content:`${new Date(a.start).toLocaleString()}<br>${new Date(a.end).toLocaleString()}`,placement:"top",theme:"speech_bubble",allowHTML:!0});let C=document.createElement("p");C.classList.add("race-info-total-scores","black-outline"),C.innerHTML=`Total Scores: ${0==(e?a.totalScores_elite:a.totalScores_standard)?"No Data":(e?a.totalScores_elite:a.totalScores_standard).toLocaleString()}`,b.appendChild(C);let w=document.createElement("div");w.classList.add("race-info-rules","start-button","hero-selector-div-disabled",e?"btn-rotate-boss-elite":"btn-rotate-boss","black-outline"),w.innerHTML="Details",w.addEventListener("click",(()=>{"string"!=typeof bossesData[n][e?"metadataElite":"metadataStandard"]&&(showLoading(),showChallengeModel("events",e?a.metadataElite:a.metadataStandard,"Boss",r))})),L.appendChild(w);let E=document.createElement("div");E.classList.add("race-info-leaderboard","start-button",e?"btn-rotate-boss-elite":"btn-rotate-boss","black-outline"),E.innerHTML="Leaderboard",E.addEventListener("click",(()=>{showLeaderboard("events",a,e?"BossElite":"Boss")})),L.appendChild(E),new IntersectionObserver(((t,s)=>{t.forEach((async t=>{if(t.isIntersecting&&(await getBossMetadata(n,e),"string"!=typeof bossesData[n][e?"metadataElite":"metadataStandard"])){w.classList.remove("hero-selector-div-disabled");let n=document.createElement("img");switch(n.classList.add("challenge-modifier-icon-event"),e?a.eliteScoringType:a.normalScoringType){case"LeastCash":n.src="./Assets/ChallengeRulesIcon/LeastCashIcon.webp",m.appendChild(n);break;case"LeastTiers":n.src="./Assets/ChallengeRulesIcon/LeastTiersIcon.webp",m.appendChild(n)}s.unobserve(t.target);let l=challengeModifiers(e?a.metadataElite:a.metadataStandard),d=challengeRules(e?a.metadataElite:a.metadataStandard);for(let e of Object.values(l)){let t=document.createElement("img");t.classList.add("challenge-modifier-icon-event"),t.src=`./Assets/ChallengeRulesIcon/${e.icon}.webp`,m.appendChild(t)}for(let e of d){if("No Round 100 Reward"==e)continue;let t=document.createElement("img");t.classList.add("challenge-rule-icon-event"),t.src=`./Assets/ChallengeRulesIcon/${rulesMap[e]}.webp`,m.appendChild(t)}c.src=Object.keys(constants.mapsInOrder).includes(e?a.metadataElite.map:a.metadataStandard.map)?getMapIcon(e?a.metadataElite.map:a.metadataStandard.map):e?a.metadataElite.mapURL:a.metadataStandard.mapURL}}))})).observe(o)}))}function generateCTs(){let e=document.getElementById("events-content");e.innerHTML="",clearAllTimers(),document.getElementById("loading").style.transform="scale(0)",Object.values(CTData).forEach(((t,a)=>{let n=document.createElement("div");n.classList.add("race-div","ct-div"),n.style.backgroundImage="url(../Assets/ProfileBanner/TeamsBanner8.webp)",e.appendChild(n);let s=document.createElement("div");s.classList.add("ct-info-div"),n.appendChild(s);let l=document.createElement("div");l.classList.add("ct-info-top-div"),s.appendChild(l);let d=document.createElement("div");d.classList.add("ct-info-bottom-div"),s.appendChild(d);let r=document.createElement("p");r.classList.add("race-info-name","black-outline"),r.innerHTML="Contested Territory / "+t.id,l.appendChild(r);let i=document.createElement("p");i.id=`CT-${t.id}-TimeLeft`,i.classList.add("race-time-left","black-outline"),i.innerHTML="Finished",l.appendChild(i),new Date<new Date(t.start)?i.innerHTML="Coming Soon!":new Date(t.end)>new Date?registerTimer(i.id,new Date(t.end)):new Date>new Date(t.end)&&(i.innerHTML="Finished");let o=document.createElement("div");o.classList.add("ct-info-left-div"),d.appendChild(o);let c=document.createElement("p");c.classList.add("race-info-dates","ct-info-dates","black-outline"),c.innerHTML=`${new Date(t.start).toLocaleDateString()} - ${new Date(t.end).toLocaleDateString()}`,o.appendChild(c),tippy(c,{content:`${new Date(t.start).toLocaleString()}<br>${new Date(t.end).toLocaleString()}`,placement:"top",theme:"speech_bubble",allowHTML:!0});let p=document.createElement("div");p.classList.add("race-info-rules","start-button","currency-trophies-div","black-outline"),p.innerHTML="Map Details",p.addEventListener("click",(()=>{showLoading(),openRelics("events",t.tiles,`${new Date(t.start).toLocaleDateString()} - ${new Date(t.end).toLocaleDateString()}`)})),o.appendChild(p);let m=document.createElement("div");m.classList.add("ct-leaderboards-div"),d.appendChild(m);let u=document.createElement("p");u.classList.add("ct-leaderboards-header","black-outline"),u.innerHTML="Leaderboards",m.appendChild(u);let h=document.createElement("div");h.classList.add("ct-leaderboards-btns"),m.appendChild(h);let g=document.createElement("div");g.classList.add("race-info-leaderboard","ct-info-leaderboard","start-button","blue-btn","black-outline"),g.innerHTML="Players",g.addEventListener("click",(()=>{showLeaderboard("events",t,"CTPlayer")})),h.appendChild(g);let b=document.createElement("div");b.classList.add("race-info-leaderboard","ct-info-leaderboard","start-button","blue-btn","black-outline"),b.innerHTML="Teams",b.addEventListener("click",(()=>{showLeaderboard("events",t,"CTTeam")})),h.appendChild(b);let L=document.createElement("div");L.classList.add("race-info-middle-div","ct-info-middle-div"),m.appendChild(L);let v=document.createElement("p");v.classList.add("race-info-total-scores","black-outline"),v.innerHTML=`Total Scores: ${0==t.totalScores_player?"No Data":t.totalScores_player.toLocaleString()}`,L.appendChild(v);let y=document.createElement("p");y.classList.add("race-info-total-scores","black-outline"),y.innerHTML=`Total Scores: ${0==t.totalScores_team?"No Data":t.totalScores_team.toLocaleString()}`,L.appendChild(y)}))}async function generateChallenges(e){let t=document.getElementById("events-content");t.innerHTML="",await getDailyChallengesData();let a=Object.values(DCData).filter((t=>{switch(e){case"DailyChallenges":return t.name.startsWith("Standard");case"AdvancedDailyChallenges":return t.name.startsWith("Advanced");case"CoopDailyChallenges":return t.name.startsWith("coop")}})),n=new Date;"CoopDailyChallenges"==e&&(a=a.filter((e=>new Date(e.createdAt)<n)),a=a.sort(((e,t)=>new Date(t.createdAt)-new Date(e.createdAt))));let s=0;if(Object.values(a).forEach(((e,t)=>{let a=e.name.match(/^(Standard|Advanced|coop)(?: (\d+))?: (.*)$/),n="";a&&(n=a[2]||null,null!=n&&n>s&&(s=n))})),"DailyChallenges"==e||"AdvancedDailyChallenges"==e){let a=document.createElement("div");a.classList.add("race-div","event-select-challenge-div"),t.appendChild(a);let n=document.createElement("p");n.classList.add("challenge-select-info-name","black-outline"),n.innerHTML=("DailyChallenges"==e?"Standard":"Advanced")+" Challenges",a.appendChild(n);let l=document.createElement("p");l.classList.add("challenge-info-desc"),l.innerHTML=`Select a challenge by entering a date or ID below. IDs can be no less than 1000, and the date cannot be earlier than ${"DailyChallenges"==e?new Date(Date.UTC(2021,4,7)).toISOString().split("T")[0]:new Date(Date.UTC(2021,4,20)).toISOString().split("T")[0]} for ${"DailyChallenges"==e?"Standard":"Advanced"} challenges.`,a.appendChild(l);let d=document.createElement("div");d.classList.add("challenge-selectors"),a.appendChild(d);let r=document.createElement("div");r.classList.add("challenge-selector-date"),d.appendChild(r);let i=document.createElement("p");i.classList.add("challenge-selector-date-text","black-outline"),i.innerHTML="Date",r.appendChild(i);let o=document.createElement("input");o.classList.add("challenge-selector-date-input"),o.type="date";let c=challengeIdToDate(getChallengeIdFromInt(s,"AdvancedDailyChallenges"==e));o.value=new Date(c[0],c[1]-1,c[2]).toISOString().split("T")[0],o.addEventListener("change",(()=>{new Date(o.value)>new Date&&(o.value=(new Date).toISOString().split("T")[0]),new Date(o.value)<new Date("DailyChallenges"==e?"2021-05-07":"2021-05-20")&&(o.value="DailyChallenges"==e?"2021-05-07":"2021-05-20")})),r.appendChild(o);let p=document.createElement("img");p.classList.add("challenge-selector-date-img"),p.src="../Assets/UI/ContinueBtn.webp",p.addEventListener("click",(async()=>{showLoading(),showChallengeModel("events",await getChallengeMetadata(getChallengeIDFromDate(o.value,"AdvancedDailyChallenges"==e)),e)})),r.appendChild(p);let m=document.createElement("p");m.classList.add("challenge-selector-or","black-outline"),m.innerHTML="OR",d.appendChild(m);let u=document.createElement("div");u.classList.add("challenge-selector-id"),d.appendChild(u);let h=document.createElement("p");h.classList.add("challenge-selector-id-text","black-outline"),h.innerHTML="Challenge ID",u.appendChild(h);let g=document.createElement("input");g.classList.add("challenge-selector-id-input"),g.type="number",g.min=1e3,g.max=s,g.value=s,g.addEventListener("change",(()=>{g.value<1e3&&(g.value=1e3),g.value>s&&(g.value=s)})),u.appendChild(g);let b=document.createElement("img");b.classList.add("challenge-selector-id-img"),b.src="../Assets/UI/ContinueBtn.webp",b.addEventListener("click",(async()=>{showLoading(),showChallengeModel("events",await getChallengeMetadata(getChallengeIdFromInt(g.value,"AdvancedDailyChallenges"==e)),e)})),u.appendChild(b)}Object.values(a).forEach(((a,n)=>{let l=a.name.match(/^(Standard|Advanced|coop)(?: (\d+))?: (.*)$/),d="",r="",i="";l&&(d=l[1]||null,r=l[2]||null,i=l[3]||null,null!=r&&r>s&&(s=r));let o=document.createElement("div");o.classList.add("race-div","event-challenge-div"),t.appendChild(o);let c=document.createElement("div");c.classList.add("race-map-div","silver-border"),o.appendChild(c);let p=document.createElement("img");p.classList.add("race-map-img"),p.src="./Assets/MapIcon/MapLoadingImage.webp",c.appendChild(p);let m=document.createElement("div");m.classList.add("race-challenge-icons"),c.appendChild(m);let u=document.createElement("p");u.classList.add("race-map-rounds","black-outline"),c.appendChild(u);let h=document.createElement("div");h.classList.add("race-info-div"),o.appendChild(h);let g=document.createElement("div");g.classList.add("challenge-info-top-div"),h.appendChild(g);let b=document.createElement("div");b.classList.add("challenge-info-left-right"),h.appendChild(b);let L=document.createElement("div");L.classList.add("challenge-info-middle-div"),b.appendChild(L);let v=document.createElement("div");v.classList.add("challenge-info-bottom-div"),b.appendChild(v);let y=document.createElement("p");y.classList.add("challenge-info-name","black-outline"),y.innerHTML="CoopDailyChallenges"==e?a.name.replace("coop - ",""):i,g.appendChild(y);let f=document.createElement("p");f.classList.add("challenge-date","black-outline");let C="CoopDailyChallenges"!=e&&challengeIdToDate(getChallengeIdFromInt(r,"AdvancedDailyChallenges"==e));f.innerHTML=`${"CoopDailyChallenges"==e?new Date(a.createdAt).toLocaleDateString():new Date(C[0],C[1]-1,C[2]).toLocaleDateString()}`,L.appendChild(f);let w=document.createElement("p");w.classList.add("challenge-date","black-outline"),w.innerHTML="CoopDailyChallenges"==e?"Coop":`${d} ${r}`,L.appendChild(w);let E=document.createElement("div");E.classList.add("challenge-info-rules","start-button","black-outline"),E.innerHTML="Details",E.addEventListener("click",(async()=>{showLoading(),showChallengeModel("events",await getChallengeMetadata(a.id),e)})),L.appendChild(E);let k=["Attempts","Wins","Fails","Unique Players","Victorious Players"],T=document.createElement("div");T.classList.add("challenge-stats-div"),v.appendChild(T);for(let e of k){let t=document.createElement("div");t.classList.add("challenge-stat"),T.appendChild(t);let n=document.createElement("p");n.classList.add("challenge-stat-key"),n.innerHTML=e,t.appendChild(n);let s=document.createElement("p");s.id=`${a.id}-${e}`,s.classList.add("challenge-stat-value"),s.innerHTML="Loading...",t.appendChild(s)}new IntersectionObserver(((t,n)=>{t.forEach((async t=>{if(t.isIntersecting){let s=await getChallengeMetadata(a.id);if(n.unobserve(t.target),null!=s){let t=challengeModifiers(s),n=challengeRules(s);for(let e of Object.values(t)){let t=document.createElement("img");t.classList.add("challenge-modifier-icon-event"),t.src=`./Assets/ChallengeRulesIcon/${e.icon}.webp`,m.appendChild(t)}for(let t of n){if("No Round 100 Reward"==t&&"AdvancedDailyChallenges"!=e)continue;if("Paragon Limit"==t)continue;let a=document.createElement("img");a.classList.add("challenge-rule-icon-event"),a.src=`./Assets/ChallengeRulesIcon/${rulesMap[t]}.webp`,m.appendChild(a)}p.src=Object.keys(constants.mapsInOrder).includes(s.map)?getMapIcon(s.map):s.mapURL,u.innerHTML=`Rounds ${s.startRound}/${s.endRound}`,k={Attempts:s.plays+s.restarts,Wins:s.wins,Fails:s.losses+s.restarts,"Unique Players":s.playsUnique,"Victorious Players":s.winsUnique};for(let[e,t]of Object.entries(k))document.getElementById(`${a.id}-${e}`).innerHTML=t.toLocaleString()}}}))})).observe(c)}))}function processChallenge(e,t){let a={};return null==t&&("-1"!=e.leastCashUsed?a.scoringType="Least Cash":"-1"!=e.leastTiersUsed?a.scoringType="Least Tiers":a.scoringType=null,a["Random Seed"]=e.seed),a["Date Created"]=new Date(e.createdAt).toLocaleDateString(),a.ID=e.id,a.Creator=e.creator,a["Game Version"]=e.gameVersion,a.Stats={Plays:e.plays,Wins:e.wins,Losses:e.losses,Restarts:e.restarts,"Unique Plays":e.playsUnique,"Unique Wins":e.winsUnique,"Unique Losses":e.lossesUnique},a.Upvotes=e.upvotes,a["Player Completion Rate"]=0==e.playsUnique?"0%":e.winsUnique-e.playsUnique==0?"100%":`${(e.winsUnique/e.playsUnique*100).toFixed(2)}%`,a["Player Win Rate"]=0==e.playsUnique?"0%":`${(e.wins/(e.plays+e.restarts)*100).toFixed(2)}%`,a.statsValid=!1,"n/a"!=e.id&&(a.statsValid=!0),a}async function showChallengeModel(e,t,a,n){if(null==t)return;document.getElementById("challenge-content").style.display="flex",document.getElementById("challenge-content").innerHTML="",document.getElementById(`${e}-content`).style.display="none",resetScroll(),addToBackQueue({source:e,destination:"challenge"});let s=processChallenge(t);if("Boss"==a&&"GameTime"!=n.scoringType)switch(n.scoringType){case"LeastCash":s.scoringType="Least Cash";break;case"LeastTiers":s.scoringType="Least Tiers"}let l=document.createElement("div");l.classList.add("challenge-model"),document.getElementById("challenge-content").appendChild(l);let d=document.createElement("div");d.classList.add("challenge-model-header"),l.appendChild(d);let r=document.createElement("div");r.classList.add("challenge-model-header-icons"),d.appendChild(r);let i=document.createElement("img");i.classList.add("challenge-model-header-difficulty"),r.appendChild(i);let o=document.createElement("div");o.classList.add("challenge-model-header-texts"),d.appendChild(o);let c=document.createElement("p");c.classList.add("challenge-model-header-name","black-outline"),c.innerHTML=t.name,o.appendChild(c);let p=document.createElement("p");p.classList.add("challenge-model-header-mode-diff","black-outline"),p.innerHTML=`${t.difficulty} - ${getLocValue("Mode "+t.mode)} ${null==s.scoringType?"":` - ${s.scoringType}`}`,o.appendChild(p);let m=document.createElement("div");m.classList.add("challenge-header-right-container"),d.appendChild(m);let u=document.createElement("div");u.classList.add("challenge-header-right-top"),m.appendChild(u);let h=document.createElement("img");h.classList.add("modal-close"),h.src="./Assets/UI/CloseBtn.webp",h.addEventListener("click",(()=>{goBack()})),u.appendChild(h);let g=document.createElement("div");g.classList.add("challenge-header-right-bottom"),m.appendChild(g);let b=document.createElement("div");b.classList.add("challenge-model-top"),l.appendChild(b);let L=document.createElement("img");L.classList.add("challenge-model-map-icon","boss-border"),L.src=Object.keys(constants.mapsInOrder).includes(t.map)?getMapIcon(t.map):t.mapURL,b.appendChild(L);let v=document.createElement("div");v.classList.add("challenge-model-settings"),b.appendChild(v);let y=document.createElement("div");y.classList.add("challenge-model-settings-left"),v.appendChild(y);let f=document.createElement("div");f.classList.add("challenge-model-settings-right"),v.appendChild(f);Object.entries({"Starting Cash":{icon:"CoinIcon",key:"startingCash"},"Start Round":{icon:"StartRoundIconSmall",key:"startRound"},"Starting Lives":{icon:"LivesIcon",key:"lives"},"End Round":{icon:"EndRoundIconSmall",key:"endRound"},"Max Lives":{icon:"LivesIcon",key:"maxLives"},"Max Monkeys":{icon:"MaxMonkeysIcon",key:"maxTowers"}}).forEach((([e,a],n)=>{let s=document.createElement("div");s.classList.add("challenge-setting"),n%2?f.appendChild(s):y.appendChild(s);let l=document.createElement("img");l.classList.add("challenge-setting-icon"),l.src=`./Assets/UI/${a.icon}.webp`,s.appendChild(l);let d=document.createElement("div");d.classList.add("challenge-setting-texts"),s.appendChild(d);let r=document.createElement("p");r.classList.add("challenge-setting-text","black-outline"),r.innerHTML=e+":",d.appendChild(r);let i=document.createElement("p");i.classList.add("challenge-setting-value","black-outline"),i.innerHTML=t[a.key],d.appendChild(i),"maxTowers"!=a.key||0!=t[a.key]&&9999!=t[a.key]||(i.innerHTML="Unlimited"),"maxLives"!=a.key&&"lives"!=a.key&&"startingCash"!=a.key&&"startRound"!=a.key&&"endRound"!=a.key||0!=t[a.key]||(i.innerHTML="Default")}));let C=document.createElement("div");C.classList.add("challenge-setting"),v.appendChild(C);let w=document.createElement("img");w.classList.add("challenge-setting-icon"),C.appendChild(w);let E=document.createElement("div");E.classList.add("challenge-setting-texts"),C.appendChild(E);let k=document.createElement("p");switch(k.classList.add("challenge-setting-text","black-outline"),E.appendChild(k),a){case"Race":i.src="./Assets/UI/EventRaceBtn.webp",k.innerHTML="Race Event",w.src="./Assets/UI/RaceIcon.webp",d.style.backgroundColor="#FFC300";break;case"Boss":i.src=`./Assets/BossIcon/${n.name}EventIcon.webp`,k.innerHTML=(n.elite?"Elite ":"")+"Boss Event",w.src=`./Assets/BossIcon/${n.name}Portrait${n.elite?"Elite":""}.webp`,c.innerHTML=`${n.elite?"Elite ":""}${n.name} ${n.eventNumber}`,d.style.background=n.elite?"linear-gradient(180deg, #401DB4, #A144E2)":"linear-gradient(180deg, #1882A5, #07A4CB)";let e=document.createElement("div");e.classList.add("start-button","black-outline",n.elite?"btn-rotate-boss":"btn-rotate-boss-elite"),e.innerHTML="Swap",e.addEventListener("click",(async()=>{n.elite=!n.elite,showLoading(),"string"==typeof bossesData[n.index][n.elite?"metadataElite":"metadataStandard"]&&await getBossMetadata(n.index,n.elite),goBack(),showChallengeModel("events",bossesData[n.index][n.elite?"metadataElite":"metadataStandard"],a,n),hideLoading()})),m.appendChild(e);break;case"Odyssey":i.src="./Assets/UI/OdysseyEventBtn.webp";break;case"ContestedTerritory":i.src="./Assets/UI/ContestedTerritoryEventBtn.webp";break;case"DailyChallenges":k.innerHTML="Daily Challenge",w.src="./Assets/UI/ChallengesIcon.webp",i.src="./Assets/UI/DailyChallengeBtn.webp",d.style.backgroundColor="rgb(70,148,213)";break;case"AdvancedDailyChallenges":k.innerHTML="Advanced Daily",w.src="./Assets/UI/ChallengesIcon.webp",i.src="./Assets/UI/DailyChallengeBtn.webp",d.style.backgroundColor="rgb(234,99,52)";break;case"CoopDailyChallenges":k.innerHTML="Coop Challenge",w.src="./Assets/UI/ChallengesIcon.webp",i.src="./Assets/UI/DailyChallengeBtn.webp",d.style.backgroundColor="rgb(255,150,0)";break;case"Custom":k.innerHTML="Custom Challenge",w.src="./Assets/UI/CustomChallenge.webp",i.src="./Assets/UI/CreateChallengeIcon.webp";let s=document.createElement("p");s.classList.add("challenge-id","black-outline"),s.innerHTML=t.id,s.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),copyID(t.id,s)})),g.appendChild(s);let l=document.createElement("img");l.classList.add("browser-copy-img"),l.src="../Assets/UI/CopyClipboardBtn.webp",l.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),copyID(t.id,s)})),g.appendChild(l);let r=document.createElement("img");r.classList.add("browser-go-img"),r.src="../Assets/UI/GoBtnSmall.webp",r.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),openBTD6Site(`https://join.btd6.com/Challenge/${t.id}`)})),g.appendChild(r)}if(null!=s.scoringType){let e="Boss"==a,n=document.createElement("div");n.classList.add("challenge-setting"),v.appendChild(n);let l=document.createElement("img");l.classList.add("challenge-setting-icon"),n.appendChild(l);let d=document.createElement("div");d.classList.add("challenge-setting-texts"),n.appendChild(d);let r=document.createElement("p");r.classList.add("challenge-setting-text","black-outline"),d.appendChild(r);let i=document.createElement("p");switch(i.classList.add("challenge-setting-value","black-outline"),i.innerHTML="ERROR",e||d.appendChild(i),s.scoringType){case"Least Cash":r.innerHTML=e?"Least Cash":"Least Cash:",l.src="./Assets/UI/LeastCashIconSmall.webp",i.innerHTML=t.leastCashUsed;break;case"Least Tiers":r.innerHTML=e?"Least Tiers":"Least Tiers:",l.src="./Assets/UI/LeastTiersIconSmall.webp",i.innerHTML=t.leastTiersUsed}}let T={},M={},S=!1,I={},x={};Object.entries(t._towers).forEach((([e,t])=>{0!=t.max?("ChosenPrimaryHero"===t.tower&&0!=t.max&&(S=!0),t.isHero?T[t.tower]=t:M[t.tower]=t):t.isHero?x[t.tower]=t:I[t.tower]=t}));let B=document.createElement("div");B.classList.add("challenge-towers-list"),l.appendChild(B);let A=document.createElement("div");A.classList.add("challenge-tower-selector-top"),B.appendChild(A);let D=document.createElement("p");D.classList.add("challenge-tower-selector-title","black-outline"),D.innerHTML="Monkeys Available:",A.appendChild(D);let P=document.createElement("div");P.classList.add("challenge-tower-selector-checkboxes"),A.appendChild(P);let H=document.createElement("div");H.classList.add("maps-progress-coop-toggle"),P.appendChild(H);let O=document.createElement("p");O.classList.add("maps-progress-coop-toggle-text","black-outline"),O.innerHTML="Only Excluded & Limited: ",H.appendChild(O);let R=document.createElement("input");R.classList.add("maps-progress-coop-toggle-input"),R.type="checkbox",H.appendChild(R),R.addEventListener("change",(()=>{j.style.display="none"==j.style.display?"flex":"none",N.style.display="none"==N.style.display?"flex":"none",R.checked?D.innerHTML="Monkeys Limited:":D.innerHTML="Monkeys Available:"}));let F=document.createElement("div");F.classList.add("maps-progress-coop-toggle"),P.appendChild(F);let $=document.createElement("p");$.classList.add("maps-progress-coop-toggle-text","black-outline"),$.innerHTML="Hide Heroes: ",F.appendChild($);let U=document.createElement("input");U.classList.add("maps-progress-coop-toggle-input"),U.type="checkbox",F.appendChild(U),U.addEventListener("change",(()=>{let e=document.getElementsByClassName("tower-selector-hero");for(let t of e)t.style.display="none"==t.style.display?"flex":"none"}));let N=document.createElement("div");N.classList.add("challenge-tower-selector"),B.appendChild(N);let j=document.createElement("div");if(j.style.display="none",j.classList.add("challenge-tower-selector"),B.appendChild(j),S){let e=document.createElement("div");e.classList.add("tower-selector-hero"),N.appendChild(e);let t=document.createElement("img");t.classList.add("hero-selector-img"),t.src="./Assets/UI/AllHeroesIcon.webp",e.appendChild(t)}else for(let[e,t]of Object.entries(constants.heroesInOrder)){if(!T[e])continue;let t=document.createElement("div");t.classList.add("tower-selector-hero");let a=document.createElement("img");a.classList.add("hero-selector-img"),a.src=getInstaContainerIcon(e,"000"),t.appendChild(a),N.appendChild(t)}for(let[e,t]of Object.entries(constants.towersInOrder)){if(!I[e])continue;let a=document.createElement("div");a.classList.add(`tower-selector-${t.toLowerCase()}`),j.appendChild(a);let n=document.createElement("img");n.classList.add("tower-selector-img"),n.src=getInstaContainerIcon(e,"000"),a.appendChild(n);let s=document.createElement("div");s.classList.add("max-count","towerTopLeft","towerExcluded"),a.appendChild(s)}for(let[e,t]of Object.entries(constants.towersInOrder)){if(!M[e])continue;let a=document.createElement("div");a.classList.add(`tower-selector-${t.toLowerCase()}`),N.appendChild(a);let n=document.createElement("img");n.classList.add("tower-selector-img"),n.src=getInstaContainerIcon(e,"000"),a.appendChild(n);let s=!1;if(0!=M[e].path1NumBlockedTiers||0!=M[e].path2NumBlockedTiers||0!=M[e].path3NumBlockedTiers){s=!0;let t=document.createElement("p");t.classList.add("tower-selector-tiers","black-outline"),t.innerHTML=`${-1==M[e].path1NumBlockedTiers?"0":5-M[e].path1NumBlockedTiers}-${-1==M[e].path2NumBlockedTiers?"0":5-M[e].path2NumBlockedTiers}-${-1==M[e].path3NumBlockedTiers?"0":5-M[e].path3NumBlockedTiers}`,a.appendChild(t)}else if(M[e].hasOwnProperty("restrictParagon")&&M[e].restrictParagon){let e=document.createElement("p");e.classList.add("tower-selector-tiers","black-outline"),e.innerHTML="5-5-5",a.appendChild(e)}if(-1!=M[e].max){s=!0;let t=document.createElement("div");t.classList.add("max-count","towerTopLeft"),a.appendChild(t);let n=document.createElement("p");n.classList.add("towerTopLeftText","black-outline"),n.innerHTML=`${M[e].max}`,t.appendChild(n)}s&&j.appendChild(a.cloneNode(!0))}if(!S)for(let[e,t]of Object.entries(constants.heroesInOrder)){if(!x[e])continue;let t=document.createElement("div");t.classList.add("tower-selector-hero");let a=document.createElement("img");a.classList.add("hero-selector-img"),a.src=getInstaContainerIcon(e,"000"),t.appendChild(a);let n=document.createElement("div");n.classList.add("max-count","towerTopLeft","towerExcluded"),t.appendChild(n),j.appendChild(t)}let G=!1;if(0==j.children.length){let e=document.createElement("p");e.classList.add("challenge-modifier-none"),e.style.width="100%",e.innerHTML="No Excluded or Limited Towers!",j.appendChild(e),G=!0}"Boss"!=a||G||(R.checked=!0,j.style.display="none"==j.style.display?"flex":"none",N.style.display="none"==N.style.display?"flex":"none",R.checked?D.innerHTML="Monkeys Limited:":D.innerHTML="Monkeys Available:");let V=document.createElement("div");V.classList.add("challenge-model-columns"),l.appendChild(V);let _=document.createElement("div");_.classList.add("challenge-model-left"),V.appendChild(_);let q=document.createElement("div");q.classList.add("challenge-model-right"),V.appendChild(q);let K=challengeModifiers(t),z=document.createElement("div");z.classList.add("challenge-modifiers-div"),_.appendChild(z);let J=document.createElement("p");if(J.classList.add("challenge-modifiers-header","black-outline"),J.innerHTML="Modifiers",Object.entries(K).forEach((([e,t])=>{let a=document.createElement("div");a.classList.add("challenge-modifier"),z.appendChild(a);let n=document.createElement("img");n.classList.add("challenge-modifier-icon"),n.src=`./Assets/ChallengeRulesIcon/${t.icon}.webp`,a.appendChild(n);let s=document.createElement("div");s.classList.add("challenge-modifier-texts"),a.appendChild(s);let l=document.createElement("p");l.classList.add("challenge-modifier-text","black-outline"),l.innerHTML=`${e}:`,s.appendChild(l);let d=document.createElement("p");d.classList.add("challenge-modifier-value","black-outline"),d.innerHTML=isNaN(t.value)?t.value:`${(100*t.value).toFixed(0)}%`,s.appendChild(d)})),0==z.children.length){let e=document.createElement("p");e.classList.add("challenge-modifier-none"),e.innerHTML="Default",z.appendChild(e)}z.prepend(J);let W=challengeRules(t),Q=document.createElement("p");Q.classList.add("challenge-rules-header","black-outline"),Q.innerHTML="Rules",q.appendChild(Q);let Y=document.createElement("div");if(Y.classList.add("challenge-rules-div"),q.appendChild(Y),W.forEach((e=>{if("No Round 100 Reward"==e&&"AdvancedDailyChallenges"!=a)return;if("Paragon Limit"==e&&0==t.maxParagons&&"Boss"!=a)return;let n=document.createElement("div");n.classList.add("challenge-rule"),Y.appendChild(n);let s=document.createElement("img");s.classList.add("challenge-modifier-icon"),s.src=`./Assets/ChallengeRulesIcon/${rulesMap[e]}.webp`,n.appendChild(s);let l=document.createElement("div");l.classList.add("challenge-rule-text-div"),n.appendChild(l);let d=document.createElement("p");if(d.classList.add("challenge-rule-text","black-outline"),d.innerHTML=e,l.appendChild(d),"Custom Rounds"==e&&"Boss"==a){let e=null;if(t.roundSets.includes("bloonarius")&&(e="BloonariusRoundSet"),t.roundSets.includes("lych")&&(e="LychRoundSet"),t.roundSets.includes("vortex")&&(e="VortexRoundSet"),t.roundSets.includes("dreadbloon")&&(e="DreadbloonRoundSet"),t.roundSets.includes("phayze")&&(e="PhayzeRoundSet"),t.roundSets.includes("blastapopoulos")&&(e="BlastapopoulosRoundSet"),null!=e){let t=document.createElement("div");t.classList.add("challenge-rule-subtext","start-button","black-outline"),t.innerHTML="Open",l.appendChild(t),t.addEventListener("click",(()=>{showRoundsetModel("challenge",e)}))}}let r=t.roundSets.filter((e=>"default"!==e&&"bloonarius"!==e&&"lych"!==e&&"vortex"!==e&&"dreadbloon"!==e&&"phayze"!==e));if("Custom Rounds"==e&&constants.skuRoundsets.includes(r[0])&&"AlternateBloonsRounds"!=t.mode){let e=document.createElement("div");e.classList.add("challenge-rule-subtext","start-button","black-outline"),e.innerHTML="Open",l.appendChild(e),e.addEventListener("click",(()=>{showRoundsetModel("challenge",r[0])}))}if("Paragon Limit"==e){let e=document.createElement("p");e.classList.add("challenge-rule-value","black-outline"),e.innerHTML=t.maxParagons,l.appendChild(e)}})),0==Y.children.length){let e=document.createElement("p");e.classList.add("challenge-modifier-none"),e.innerHTML="Default",Y.appendChild(e)}if(q.prepend(Q),s.statsValid){let e=document.createElement("div");e.classList.add("challenge-model-stats-div"),e.style.display="none",l.appendChild(e);let t=document.createElement("p");t.classList.add("challenge-stats-header","black-outline"),t.innerHTML="Challenge Stats",e.appendChild(t);let a=document.createElement("div");a.classList.add("challenge-stats-left-right"),e.appendChild(a);let n=document.createElement("div");n.classList.add("challenge-stats-left"),a.appendChild(n);let d=document.createElement("p");d.classList.add("challenge-stats-x"),d.innerHTML="X",d.addEventListener("click",(()=>{e.style.display="none"})),e.appendChild(d);let r=document.createElement("div");if(r.classList.add("challenge-usv-div"),n.appendChild(r),0!=s.Upvotes){let e=document.createElement("div");e.classList.add("challenge-upvote-div"),r.appendChild(e);let t=document.createElement("img");t.classList.add("challenge-upvote-icon"),t.src="./Assets/UI/ChallengeThumbsUpIcon.webp",e.appendChild(t);let a=document.createElement("p");a.classList.add("challenge-upvote-value"),a.innerHTML=s.Upvotes,e.appendChild(a)}let i=document.createElement("div");i.classList.add("challenge-trophy-div"),r.appendChild(i);let o=document.createElement("img");o.classList.add("challenge-trophy-icon"),o.src="./Assets/UI/ChallengeTrophyIcon.webp",i.appendChild(o);let c=document.createElement("p");c.classList.add("challenge-trophy-value"),c.innerHTML=s["Player Completion Rate"],i.appendChild(c);let p=document.createElement("div");p.classList.add("challenge-skull-div"),r.appendChild(p);let m=document.createElement("img");m.classList.add("challenge-skull-icon"),m.src="./Assets/UI/DeathRateIcon.webp",p.appendChild(m);let h=document.createElement("p");if(h.classList.add("challenge-skull-value"),h.innerHTML=s["Player Win Rate"],p.appendChild(h),"n/a"!=s.Creator&&null!=s.Creator){let e=document.createElement("div");e.classList.add("challenge-creator"),n.appendChild(e);let t=document.createElement("div");t.classList.add("avatar"),e.appendChild(t);let a=50,l=document.createElement("img");l.classList.add("avatar-frame","noSelect"),l.style.width=`${a}px`,l.src="../Assets/UI/InstaTowersContainer.webp",t.appendChild(l);let d=document.createElement("img");d.classList.add("avatar-img","noSelect"),d.style.width=`${a}px`,d.src="../Assets/ProfileAvatar/ProfileAvatar01.webp",t.appendChild(d);let r=document.createElement("p");r.classList.add("challenge-creator-name","black-outline"),r.innerHTML=preventRateLimiting?"Click to Load Creator":"Loading...",e.appendChild(r),e.addEventListener("click",(async()=>{r.innerHTML="Loading...";let t=await getUserProfile(s.Creator);null!=t?(r.innerHTML=t.displayName,d.src=getProfileAvatar(t),e.style.backgroundImage=`linear-gradient(to right, transparent 80%, var(--profile-secondary) 100%),url(${getProfileBanner(t)})`,e.removeEventListener("click",arguments.callee),e.addEventListener("click",(()=>{openProfile("challenge",s.Creator)}))):r.innerHTML="Click to Load Creator"})),preventRateLimiting||e.click()}["Date Created","Game Version","Random Seed"].forEach((e=>{if("Game Version"==e&&0==s[e])return;let t=document.createElement("div");t.classList.add("challenge-stat"),n.appendChild(t);let a=document.createElement("p");a.classList.add("challenge-stat-label"),a.innerHTML=`${e}: ${s[e]}`,t.appendChild(a)}));let g=document.createElement("div");g.classList.add("challenge-stats-right"),a.appendChild(g),Object.entries(s.Stats).forEach((([e,t])=>{let a=document.createElement("div");a.classList.add("challenge-stat"),g.appendChild(a);let n=document.createElement("p");n.classList.add("challenge-stat-label"),n.innerHTML=e,a.appendChild(n);let s=document.createElement("p");s.classList.add("challenge-model-stat-value"),s.innerHTML=t.toLocaleString(),a.appendChild(s)}));let b=document.createElement("img");b.classList.add("challenge-stats-btn"),b.src="./Assets/UI/InfoBtn.webp",b.addEventListener("click",(()=>{e.style.display="none"==e.style.display?"flex":"none"})),u.appendChild(b)}}function challengeModifiers(e){let t={};return 1!=e._bloonModifiers.speedMultiplier&&(t["Bloon Speed"]={value:e._bloonModifiers.speedMultiplier,icon:e._bloonModifiers.speedMultiplier>1?"FasterBloonsIcon":"SlowerBloonsIcon"}),1!=e._bloonModifiers.moabSpeedMultiplier&&(t["MOAB Speed"]={value:e._bloonModifiers.moabSpeedMultiplier,icon:e._bloonModifiers.moabSpeedMultiplier>1?"FasterMoabIcon":"SlowerMoabIcon"}),e._bloonModifiers.hasOwnProperty("regrowRateMultiplier")&&1!=e._bloonModifiers.regrowRateMultiplier&&(t["Regrow Rate"]={value:e._bloonModifiers.regrowRateMultiplier,icon:e._bloonModifiers.regrowRateMultiplier>1?"RegrowRateIncreaseIcon":"RegrowRateDecreaseIcon"}),e.hasOwnProperty("abilityCooldownReductionMultiplier")&&1!=e.abilityCooldownReductionMultiplier&&(t["Ability Cooldown Rate"]={value:e.abilityCooldownReductionMultiplier,icon:e.abilityCooldownReductionMultiplier>1?"AbilityCooldownReductionIncreaseIcon":"AbilityCooldownReductionDecreaseIcon"}),1!=e.removeableCostMultiplier&&-1!=e.removeableCostMultiplier&&(t["Removeable Cost"]={value:0==e.removeableCostMultiplier?"Free":12==e.removeableCostMultiplier?"Disabled":e.removeableCostMultiplier,icon:e.removeableCostMultiplier>1?"RemovableCostIncreaseIcon":"RemovableCostDecreaseIcon"}),1!=e._bloonModifiers.healthMultipliers.bloons&&(t["Ceramic Health"]={value:e._bloonModifiers.healthMultipliers.bloons,icon:e._bloonModifiers.healthMultipliers.bloons>1?"CeramicIncreaseHPIcon.webp":"CeramicDecreaseHPIcon"}),1!=e._bloonModifiers.healthMultipliers.moabs&&(t["MOAB Health"]={value:e._bloonModifiers.healthMultipliers.moabs,icon:e._bloonModifiers.healthMultipliers.moabs>1?"MoabBoostIcon":"MoabDecreaseHPIcon"}),e._bloonModifiers.healthMultipliers.hasOwnProperty("boss")&&1!=e._bloonModifiers.healthMultipliers.boss&&(t["Boss Health"]={value:e._bloonModifiers.healthMultipliers.boss,icon:e._bloonModifiers.healthMultipliers.boss>1?"BossBoostIcon":"BossDecreaseHPIcon"}),e._bloonModifiers.hasOwnProperty("bossSpeedMultiplier")&&1!=e._bloonModifiers.bossSpeedMultiplier&&(t["Boss Speed"]={value:e._bloonModifiers.bossSpeedMultiplier,icon:e._bloonModifiers.bossSpeedMultiplier>1?"FasterBossIcon":"SlowerBossIcon"}),t}function challengeRules(e){let t=[];return e.disableMK&&t.push("Monkey Knowledge Disabled"),1==e.lives&&t.push("No Lives Lost"),e.disableSelling&&t.push("Selling Disabled"),e.disablePowers&&t.push("Powers Disabled"),e.noContinues&&t.push("No Continues"),e._bloonModifiers.allCamo&&t.push("All Camo"),e._bloonModifiers.allRegen&&t.push("All Regrow"),e.disableDoubleCash&&t.push("Double Cash Disabled"),t.push("No Round 100 Reward"),(e.roundSets.includes("default")&&e.roundSets.length>1||1==e.roundSets.length&&"default"!=e.roundSets[0])&&t.push("Custom Rounds"),10!=e.maxParagons&&t.push("Paragon Limit"),t}function exitChallengeModel(e){document.getElementById("challenge-content").style.display="none",document.getElementById(`${e}-content`).style.display="flex"}function exitMapModel(e){document.getElementById("map-content").style.display="none",document.getElementById(`${e}-content`).style.display="flex"}async function openRelics(e,t,a){let n=await getCTTiles(t);if(null==n)return;document.getElementById(`${e}-content`).style.display="none";let s=document.getElementById("relics-content");s.style.display="flex",s.innerHTML="",addToBackQueue({source:e,destination:"relics"});let l=document.createElement("div");l.classList.add("relic-container"),s.appendChild(l),resetScroll();let d=document.createElement("div");d.classList.add("relic-header"),l.appendChild(d);let r=document.createElement("div");r.classList.add("relic-header-views"),d.appendChild(r);let i=document.createElement("div");i.classList.add("maps-progress-view","black-outline","stats-tab-yellow"),i.innerHTML="List",r.appendChild(i);let o=document.createElement("div");o.classList.add("maps-progress-view","black-outline"),o.innerHTML="Tile",r.appendChild(o),i.addEventListener("click",(()=>{i.classList.add("stats-tab-yellow"),o.classList.remove("stats-tab-yellow"),document.querySelectorAll(".relic-text-div").forEach((e=>{e.classList.contains("relic-tile-view")&&e.classList.remove("relic-tile-view")}))})),o.addEventListener("click",(()=>{o.classList.add("stats-tab-yellow"),i.classList.remove("stats-tab-yellow"),document.querySelectorAll(".relic-text-div").forEach((e=>{e.classList.contains("relic-tile-view")||e.classList.add("relic-tile-view")}))}));let c=document.createElement("p");c.classList.add("relic-header-title","black-outline"),c.innerHTML=`Contested Territory<br>${a}`,d.appendChild(c);let p=document.createElement("div");p.classList.add("relic-header-right"),d.appendChild(p);let m=document.createElement("img");m.classList.add("modal-close"),m.src="./Assets/UI/CloseBtn.webp",m.addEventListener("click",(()=>{s.style.display="none",document.getElementById(`${e}-content`).style.display="flex"})),p.appendChild(m);let u=n.tiles.filter((e=>e.type.includes("Relic")));u=u.sort(((e,t)=>e.id.localeCompare(t.id))),u=u.map((e=>(e.type=e.type.split(" ")[2],e)));let h=document.createElement("div");h.classList.add("relics-div"),l.appendChild(h),u.forEach((e=>{let t=e.type,a=document.createElement("div");switch(a.classList.add("relic-div"),h.appendChild(a),e.id.charAt(0)){case"A":a.style.backgroundColor="#9C55E4";break;case"B":a.style.backgroundColor="#E978AA";break;case"C":a.style.backgroundColor="#00DD6B";break;case"D":a.style.backgroundColor="#04A6F3";break;case"E":a.style.backgroundColor="#F7D302";break;case"F":a.style.backgroundColor="#F4413F";break;case"M":a.style.backgroundColor="#B9E546"}let n=document.createElement("p");n.classList.add("relic-id"),n.innerHTML=e.id,a.appendChild(n);let s=document.createElement("img");s.classList.add("relic-icon"),s.src=`./Assets/RelicIcon/${t}.webp`,a.appendChild(s);let l=document.createElement("div");l.classList.add("relic-text-div"),a.appendChild(l);let d=document.createElement("p");d.classList.add("relic-name","black-outline"),d.innerHTML=getLocValue(`Relic${t}`),l.appendChild(d);let r=document.createElement("p");r.classList.add("relic-description"),r.innerHTML=getLocValue(`Relic${t}Description`),l.appendChild(r)}));let g=new Set(u.map((e=>e.type)));constants.relicsInOrder.filter((e=>!g.has(e))).forEach((e=>{let t=document.createElement("div");t.classList.add("relic-div"),t.style.backgroundColor="grey",h.appendChild(t);let a=document.createElement("p");a.classList.add("relic-id"),a.innerHTML="X",t.appendChild(a);let n=document.createElement("img");n.classList.add("relic-icon"),n.src=`./Assets/RelicIcon/${e}.webp`,t.appendChild(n);let s=document.createElement("div");s.classList.add("relic-text-div"),t.appendChild(s);let l=document.createElement("p");l.classList.add("relic-name","black-outline"),l.innerHTML=getLocValue(`Relic${e}`),s.appendChild(l);let d=document.createElement("p");d.classList.add("relic-description"),d.innerHTML=getLocValue(`Relic${e}Description`),s.appendChild(d)}))}function generateExplore(){let e=document.getElementById("explore-content");e.innerHTML="";let t=document.createElement("div");t.classList.add("progress-page"),e.appendChild(t);let a=document.createElement("div");a.classList.add("selectors-div"),t.appendChild(a);["Challenge Browser","Map Browser"].forEach((t=>{let n=document.createElement("div");n.classList.add("selector-div"),n.addEventListener("click",(()=>{e.style.display="none",document.getElementById("browser-content").style.display="flex",changeBrowserTab(t)})),a.appendChild(n);let s=document.createElement("img");switch(s.classList.add("selector-img"),n.appendChild(s),t){case"Challenge Browser":s.src="../Assets/UI/PatchNotesMonkeyIcon.webp",n.classList.add("blueprint-bg");break;case"Map Browser":s.src="../Assets/UI/MapEditorBtn.webp",n.classList.add("map-model-bg","map-browser-selector")}let l=document.createElement("p");l.classList.add("selector-text","black-outline"),l.innerHTML=t,n.appendChild(l);let d=document.createElement("img");d.classList.add("selector-go-img"),d.src="../Assets/UI/ContinueBtn.webp",n.appendChild(d)}));["Enter Challenge ID","Enter Map ID"].forEach((e=>{let t=document.createElement("div");t.classList.add("selector-div"),a.appendChild(t);let n=document.createElement("img");n.classList.add("selector-img"),t.appendChild(n);let s=document.createElement("div");s.classList.add("enter-code-middle-div"),t.appendChild(s);let l=document.createElement("p");l.classList.add("selector-text","selector-text-code","black-outline"),l.innerHTML=e,s.appendChild(l);let d=document.createElement("input");d.classList.add("selector-input"),d.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation()})),s.appendChild(d);let r=document.createElement("img");switch(r.classList.add("selector-go-img"),r.src="../Assets/UI/ContinueBtn.webp",t.appendChild(r),e){case"Enter Challenge ID":n.src="../Assets/UI/EnterCodeIcon.webp",t.classList.add("blueprint-bg"),d.value="ZMGVLCF",r.addEventListener("click",(async()=>{showLoading();let e=d.value.trim();e.length>6&&showChallengeModel("explore",await getChallengeMetadata(e),"Custom")}));break;case"Enter Map ID":n.src="../Assets/UI/EnterCodeIcon.webp",t.classList.add("map-model-bg","map-browser-selector"),d.value="ZMYXDVU",r.addEventListener("click",(async()=>{showLoading();let e=d.value.trim();e.length>6&&showMapModel("explore",await getCustomMapMetadata(e))}))}}))}function changeBrowserTab(e){switch(resetScroll(),currentBrowserView="Grid",e){case"Challenge Browser":browserLink="https://data.ninjakiwi.com/btd6/challenges/filter/";break;case"Map Browser":browserLink="https://data.ninjakiwi.com/btd6/maps/filter/"}generateBrowser(e),addToBackQueue({source:"explore",destination:"browser"})}function generateBrowser(e){let t=document.getElementById("browser-content");t.innerHTML="";let a=document.createElement("div");a.classList.add("browser-div"),t.appendChild(a);let n=document.createElement("div");n.classList.add("maps-progress-header-bar","browser-header-bar","border-top-only"),a.appendChild(n);let s=document.createElement("div");s.classList.add("map-progress-header-top"),n.appendChild(s);let l=document.createElement("p");l.classList.add("browser-header-title","black-outline"),l.innerHTML=e,s.appendChild(l);let d=document.createElement("p");d.classList.add("browser-header-desc"),d.innerHTML="This is not a replacement for the in-game browser, this exists to show what's available on the API.<br>Only 100 entries (4 pages) are available on the API. You can enter a specific ID at the bottom right.",s.appendChild(d);let r=document.createElement("div");r.classList.add("map-progress-header-bottom"),n.appendChild(r);let i=document.createElement("div");i.classList.add("maps-progress-views"),r.appendChild(i);let o=document.createElement("p");o.classList.add("maps-progress-coop-toggle-text","black-outline"),o.innerHTML="Display Type:",i.appendChild(o);let c=document.createElement("div");c.classList.add("maps-progress-filter"),n.appendChild(c);let p=document.createElement("div");p.classList.add("map-progress-filter-difficulty"),c.appendChild(p);let m=document.createElement("p");m.classList.add("maps-progress-coop-toggle-text","black-outline"),m.innerHTML="Category Type:",p.appendChild(m);let u=document.createElement("select");u.classList.add("map-progress-filter-difficulty-select"),u.addEventListener("change",(()=>{changeBrowserFilter(e,u.value)})),p.appendChild(u);let h=document.createElement("div");h.id="browser-entries",a.appendChild(h);let g=document.createElement("div");g.classList.add("browser-footer"),a.appendChild(g);let b=document.createElement("div");b.classList.add("leaderboard-footer-left","browser-footer-left"),g.appendChild(b);let L=document.createElement("img");L.classList.add("leaderboard-footer-refresh"),L.src="./Assets/UI/RefreshBtn.webp",L.addEventListener("click",(()=>{refreshRateLimited||(cacheBust=!0,generateBrowserEntries(e),L.style.filter="grayscale(1) brightness(0.5)",setTimeout((()=>{L.style.filter="none",refreshRateLimited=!1}),1e4),refreshRateLimited=!0)})),b.appendChild(L);let v=document.createElement("div");v.classList.add("leaderboard-footer-middle","browser-footer-middle"),g.appendChild(v);let y=document.createElement("img");y.classList.add("leaderboard-footer-page-left","black-outline"),y.src="./Assets/UI/NextArrowSmallYellow.webp",v.appendChild(y);let f=document.createElement("div");f.id="browser-footer-page-number",f.classList.add("leaderboard-footer-page-number","black-outline"),f.innerHTML="Loading...",v.appendChild(f);let C=document.createElement("img");C.classList.add("leaderboard-footer-page-right","black-outline"),C.src="./Assets/UI/NextArrowSmallYellow.webp",y.addEventListener("click",(()=>{browserPage<=1||refreshRateLimited||(browserPage--,f.innerHTML=`Page ${browserPage} of 4`,h.innerHTML="",copyLoadingIcon(h),generateBrowserEntries(e),C.style.filter="grayscale(1) brightness(0.5)",y.style.filter="grayscale(1) brightness(0.5)",setTimeout((()=>{C.style.filter="none",y.style.filter="none",refreshRateLimited=!1}),5e3),refreshRateLimited=!0)})),C.addEventListener("click",(()=>{browserPage>=4||refreshRateLimited||(browserPage++,f.innerHTML=`Page ${browserPage} of 4`,h.innerHTML="",copyLoadingIcon(h),generateBrowserEntries(e),C.style.filter="grayscale(1) brightness(0.5)",y.style.filter="grayscale(1) brightness(0.5)",setTimeout((()=>{C.style.filter="none",y.style.filter="none",refreshRateLimited=!1}),5e3),refreshRateLimited=!0)})),v.appendChild(C);let w=document.createElement("div");w.classList.add("leaderboard-footer-right","browser-footer-right"),g.appendChild(w);let E=document.createElement("p");E.classList.add("leaderboard-footer-goto","black-outline"),E.innerHTML="ID:",w.appendChild(E);let k=document.createElement("input");k.classList.add("leaderboard-footer-page-input","browser-footer-input"),k.type="text",k.value="Map Browser"==e?"ZMYXDVU":"ZMGVLCF",w.appendChild(k);let T=document.createElement("img");switch(T.classList.add("leaderboard-go-img"),T.src="../Assets/UI/ContinueBtn.webp",T.addEventListener("click",(async()=>{showLoading(),"Map Browser"==e?showMapModel("browser",await getCustomMapMetadata(k.value.trim())):showChallengeModel("browser",await getChallengeMetadata(k.value.trim()),"Custom")})),w.appendChild(T),e){case"Challenge Browser":let t=document.createElement("div");t.classList.add("maps-progress-view","stats-tab-yellow","black-outline"),t.innerHTML="Grid",i.appendChild(t);let a=document.createElement("div");a.classList.add("maps-progress-view","black-outline"),a.innerHTML="List",i.appendChild(a),t.addEventListener("click",(()=>{currentBrowserView="Grid",t.classList.add("stats-tab-yellow"),a.classList.remove("stats-tab-yellow"),generateBrowserEntries(e)})),a.addEventListener("click",(()=>{currentBrowserView="List",a.classList.add("stats-tab-yellow"),t.classList.remove("stats-tab-yellow"),generateBrowserEntries(e)})),["Featured","Newest"].forEach((e=>{let t=document.createElement("option");t.value=e,t.innerHTML=e,u.appendChild(t)})),changeBrowserFilter(e,"Featured");break;case"Map Browser":let n=document.createElement("div");n.classList.add("maps-progress-view","stats-tab-yellow","black-outline"),n.innerHTML="Grid",i.appendChild(n);let s=document.createElement("div");s.classList.add("maps-progress-view","black-outline"),s.innerHTML="Gallery",i.appendChild(s),n.addEventListener("click",(()=>{currentBrowserView="Grid",n.classList.add("stats-tab-yellow"),s.classList.remove("stats-tab-yellow"),generateBrowserEntries(e)})),s.addEventListener("click",(()=>{currentBrowserView="Gallery",s.classList.add("stats-tab-yellow"),n.classList.remove("stats-tab-yellow"),generateBrowserEntries(e)})),["Most Liked","Trending","Newest"].forEach((e=>{let t=document.createElement("option");t.value=e,t.innerHTML=e,u.appendChild(t)})),changeBrowserFilter(e,"Most Liked")}h.classList.add("challenge-card-entries"),copyLoadingIcon(h)}function changeBrowserFilter(e,t){switch(t){case"Newest":browserFilter="newest";break;case"Featured":case"Trending":browserFilter="trending";break;case"Most Liked":browserFilter="mostLiked"}browserPage=1,showLoading(),document.getElementById("browser-entries").innerHTML="",generateBrowserEntries(e)}async function generateBrowserEntries(e){await getBrowserData();let t=document.getElementById("browser-entries");if(t.innerHTML="",null!=browserData)switch(e){case"Challenge Browser":generateChallengeEntries(t);break;case"Map Browser":generateMapGameEntries(t)}else{let e=document.createElement("p");e.classList.add("no-data-found","black-outline"),e.style.width="250px",e.innerHTML="No Data Found",t.appendChild(e)}}function generateChallengeEntries(e){browserData.forEach((async(t,a)=>{let n=document.createElement("div");switch(n.addEventListener("click",(async()=>{showLoading(),showChallengeModel("browser",await getChallengeMetadata(t.id),"Custom")})),e.appendChild(n),currentBrowserView){case"Grid":n.classList.add("challenge-entry");let e=document.createElement("div");e.classList.add("challenge-top"),n.appendChild(e);let a=document.createElement("p");a.classList.add("challenge-name","black-outline"),a.innerHTML=t.name,t.name.length>30&&(a.style.fontSize="18px"),e.appendChild(a);let s=document.createElement("div");s.classList.add("challenge-middle"),n.appendChild(s);let l=document.createElement("div");l.classList.add("challenge-left"),s.appendChild(l);let d=document.createElement("div");d.classList.add("race-map-div","silver-border"),l.appendChild(d);let r=document.createElement("img");r.classList.add("race-map-img"),r.src="./Assets/MapIcon/MapLoadingImage.webp",d.appendChild(r);let i=document.createElement("div");i.classList.add("race-challenge-icons"),d.appendChild(i);let o=document.createElement("p");o.classList.add("race-map-rounds","black-outline"),d.appendChild(o);let c=document.createElement("div");c.classList.add("browser-usv-div"),s.appendChild(c);let p=document.createElement("div");p.classList.add("challenge-upvote-div"),c.appendChild(p);let m=document.createElement("img");m.classList.add("browser-upvote-icon"),m.src="./Assets/UI/ChallengeThumbsUpIcon.webp",p.appendChild(m);let u=document.createElement("p");u.classList.add("browser-upvote-value"),u.innerHTML=0,p.appendChild(u);let h=document.createElement("div");h.classList.add("challenge-trophy-div"),c.appendChild(h);let g=document.createElement("img");g.classList.add("browser-trophy-icon"),g.src="./Assets/UI/ChallengeTrophyIcon.webp",h.appendChild(g);let b=document.createElement("p");b.classList.add("browser-trophy-value"),b.innerHTML=0,h.appendChild(b);let L=document.createElement("div");L.classList.add("challenge-skull-div"),c.appendChild(L);let v=document.createElement("img");v.classList.add("browser-skull-icon"),v.src="./Assets/UI/DeathRateIcon.webp",L.appendChild(v);let y=document.createElement("p");y.classList.add("browser-skull-value"),y.innerHTML=0,L.appendChild(y);let f=document.createElement("div");f.classList.add("challenge-bottom"),n.appendChild(f);let C=document.createElement("div");C.classList.add("challenge-creator"),f.appendChild(C);let w=document.createElement("div");w.classList.add("avatar"),C.appendChild(w);let E=50,k=document.createElement("img");k.classList.add("avatar-frame","noSelect"),k.style.width=`${E}px`,k.src="../Assets/UI/InstaTowersContainer.webp",w.appendChild(k);let T=document.createElement("img");T.classList.add("avatar-img","noSelect"),T.style.width=`${E}px`,T.src="../Assets/ProfileAvatar/ProfileAvatar01.webp",w.appendChild(T);let M=document.createElement("p");M.classList.add("browser-creator-name","black-outline"),M.innerHTML=preventRateLimiting?"Click to Load Creator":"Loading...",C.appendChild(M);let S=document.createElement("div");S.classList.add("challenge-id-and-play"),f.appendChild(S);let I=document.createElement("p");I.classList.add("browser-id","black-outline"),I.innerHTML=t.id,I.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),copyID(t.id,I)})),S.appendChild(I);let x=document.createElement("img");x.classList.add("browser-copy-img"),x.src="../Assets/UI/CopyClipboardBtn.webp",x.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),copyID(t.id,I)})),S.appendChild(x);let B=document.createElement("img");B.classList.add("browser-go-img"),B.src="../Assets/UI/GoBtnSmall.webp",B.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),openBTD6Site(`https://join.btd6.com/Challenge/${t.id}`)})),S.appendChild(B),new IntersectionObserver(((e,a)=>{e.forEach((async e=>{if(e.isIntersecting){a.unobserve(e.target);let n=await getChallengeMetadata(t.id);if(null==n)return;r.src=Object.keys(constants.mapsInOrder).includes(n.map)?getMapIcon(n.map):n.mapURL;let s=challengeModifiers(n),l=challengeRules(n);for(let e of Object.values(s)){let t=document.createElement("img");t.classList.add("challenge-modifier-icon-event"),t.src=`./Assets/ChallengeRulesIcon/${e.icon}.webp`,i.appendChild(t)}for(let e of l){if("No Round 100 Reward"==e)continue;if("Paragon Limit"==e)continue;let t=document.createElement("img");t.classList.add("challenge-rule-icon-event"),t.src=`./Assets/ChallengeRulesIcon/${rulesMap[e]}.webp`,i.appendChild(t)}o.innerHTML=`Rounds ${0==n.startRound?constants.startRound[n.difficulty]:n.startRound}/${0==n.endRound?constants.endRound[n.difficulty]:n.endRound}`,u.innerHTML=n.upvotes.toLocaleString(),b.innerHTML=0==n.playsUnique||n.winsUnique-n.playsUnique==0?"0%":`${(n.winsUnique/n.playsUnique*100).toFixed(2)}%`,y.innerHTML=0==n.playsUnique?"0%":`${(n.wins/(n.plays+n.restarts)*100).toFixed(2)}%`,C.addEventListener("click",(async e=>{e.preventDefault(),e.stopPropagation(),M.innerHTML="Loading...";let t=await getUserProfile(n.creator);null!=t?(M.innerHTML=t.displayName,t.displayName.length>13&&(M.style.fontSize="17px"),T.src=getProfileAvatar(t),f.style.backgroundImage=`linear-gradient(to right, transparent 80%, var(--profile-secondary) 100%),url(${getProfileBanner(t)})`,C.removeEventListener("click",arguments.callee),C.addEventListener("click",(()=>openProfile("browser",n.creator)))):M.innerHTML="Click to Load Creator"})),preventRateLimiting||C.click()}}))})).observe(n);break;case"List":n.classList.add("browser-list-entry");let A=document.createElement("img");A.classList.add("browser-list-map-img"),A.src="./Assets/MapIcon/MapLoadingImage.webp",n.appendChild(A);let D=document.createElement("div");D.classList.add("browser-top-bottom"),n.appendChild(D);let P=document.createElement("div");P.classList.add("browser-list-entry-top"),D.appendChild(P);let H=document.createElement("div");H.classList.add("browser-list-entry-bottom"),D.appendChild(H);let O=document.createElement("p");O.classList.add("challenge-name","browser-list-name","black-outline"),O.innerHTML=t.name,t.name.length>30&&(O.style.fontSize="18px"),P.appendChild(O);let R=document.createElement("div");R.classList.add("challenge-creator","browser-challenge-creator"),P.appendChild(R);let F=document.createElement("div");F.classList.add("avatar"),R.appendChild(F);let $=45,U=document.createElement("img");U.classList.add("avatar-frame","noSelect"),U.style.width=`${$}px`,U.src="../Assets/UI/InstaTowersContainer.webp",F.appendChild(U);let N=document.createElement("img");N.classList.add("avatar-img","noSelect"),N.style.width=`${$}px`,N.src="../Assets/ProfileAvatar/ProfileAvatar01.webp",F.appendChild(N);let j=document.createElement("p");j.classList.add("browser-creator-name","black-outline"),j.innerHTML=preventRateLimiting?"Click to Load Creator":"Loading...",R.appendChild(j);let G=document.createElement("div");G.classList.add("browser-usv-list-div"),H.appendChild(G);let V=document.createElement("div");V.classList.add("challenge-upvote-div"),G.appendChild(V);let _=document.createElement("img");_.classList.add("browser-upvote-icon"),_.src="./Assets/UI/ChallengeThumbsUpIcon.webp",V.appendChild(_);let q=document.createElement("p");q.classList.add("browser-upvote-value"),q.innerHTML=0,V.appendChild(q);let K=document.createElement("div");K.classList.add("challenge-trophy-div"),G.appendChild(K);let z=document.createElement("img");z.classList.add("browser-trophy-icon"),z.src="./Assets/UI/ChallengeTrophyIcon.webp",K.appendChild(z);let J=document.createElement("p");J.classList.add("browser-trophy-value"),J.innerHTML=0,K.appendChild(J);let W=document.createElement("div");W.classList.add("challenge-skull-div"),G.appendChild(W);let Q=document.createElement("img");Q.classList.add("browser-skull-icon"),Q.src="./Assets/UI/DeathRateIcon.webp",W.appendChild(Q);let Y=document.createElement("p");Y.classList.add("browser-skull-value"),Y.innerHTML=0,W.appendChild(Y);let Z=document.createElement("div");Z.classList.add("challenge-id-and-play"),H.appendChild(Z);let X=document.createElement("p");X.classList.add("browser-id","black-outline"),X.innerHTML=t.id,X.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),copyID(t.id,X)})),Z.appendChild(X);let ee=document.createElement("img");ee.classList.add("browser-copy-img"),ee.src="../Assets/UI/CopyClipboardBtn.webp",ee.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),copyID(t.id,X)})),Z.appendChild(ee);let te=document.createElement("img");te.classList.add("browser-go-img"),te.src="../Assets/UI/GoBtnSmall.webp",te.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),openBTD6Site(`https://join.btd6.com/Challenge/${t.id}`)})),Z.appendChild(te);let ae=new IntersectionObserver(((e,a)=>{e.forEach((async e=>{if(e.isIntersecting){a.unobserve(e.target);let n=await getChallengeMetadata(t.id);if(null==n)return;A.src=Object.keys(constants.mapsInOrder).includes(n.map)?getMapIcon(n.map):n.mapURL,q.innerHTML=n.upvotes.toLocaleString(),J.innerHTML=0==n.playsUnique||n.winsUnique-n.playsUnique==0?"0%":`${(n.winsUnique/n.playsUnique*100).toFixed(2)}%`,Y.innerHTML=0==n.playsUnique?"0%":`${(n.wins/(n.plays+n.restarts)*100).toFixed(2)}%`,R.addEventListener("click",(async e=>{e.preventDefault(),e.stopPropagation(),j.innerHTML="Loading...";let t=await getUserProfile(n.creator);null!=t?(j.innerHTML=t.displayName,t.displayName.length>13&&(j.style.fontSize="17px"),N.src=getProfileAvatar(t),R.style.backgroundImage=`linear-gradient(to right, transparent 80%, var(--profile-primary) 100%),url(${getProfileBanner(t)})`,R.removeEventListener("click",arguments.callee),R.addEventListener("click",(()=>openProfile("browser",n.creator)))):j.innerHTML="Click to Load Creator"})),preventRateLimiting||R.click()}}))}));ae.observe(n)}}))}function copyID(e,t){navigator.clipboard.writeText(e).then((function(){console.log("Copying to clipboard was successful!"),t.innerHTML="Copied!",setTimeout((()=>{t.innerHTML=e}),2e3)}),(function(t){console.log("Could not copy text: ",t),errorModal(`Failed to copy text "${e}" to clipboard. ${t}`)}))}function generateMapGameEntries(e){browserData.forEach(((t,a)=>{let n=document.createElement("div");switch(n.addEventListener("click",(async()=>{showLoading(),showMapModel("browser",await getCustomMapMetadata(t.id))})),e.appendChild(n),currentBrowserView){case"Grid":n.classList.add("challenge-entry","map-browser-bg");let e=document.createElement("div");e.classList.add("challenge-top"),n.appendChild(e);let a=document.createElement("p");a.classList.add("challenge-name","black-outline"),a.innerHTML=t.name,t.name.length>30&&(a.style.fontSize="18px"),t.name.length>35&&(a.style.fontSize="17px"),e.appendChild(a);let s=document.createElement("div");s.classList.add("challenge-middle"),n.appendChild(s);let l=document.createElement("div");l.classList.add("challenge-left"),s.appendChild(l);let d=document.createElement("div");d.classList.add("race-map-div","silver-border"),l.appendChild(d);let r=document.createElement("img");r.classList.add("race-map-img"),r.src=getCustomMapIcon(t.id),r.onerror=function(){this.onerror=null,this.src="./Assets/MapIcon/MapLoadingImage.webp"},d.appendChild(r);let i=document.createElement("div");i.classList.add("browser-usv-div"),s.appendChild(i);let o=document.createElement("div");o.classList.add("challenge-upvote-div"),i.appendChild(o);let c=document.createElement("img");c.classList.add("browser-upvote-icon"),c.src="./Assets/UI/ChallengeThumbsUpIcon.webp",o.appendChild(c);let p=document.createElement("p");p.classList.add("browser-upvote-value"),p.innerHTML=0,o.appendChild(p);let m=document.createElement("div");m.classList.add("challenge-trophy-div"),i.appendChild(m);let u=document.createElement("img");u.classList.add("browser-trophy-icon"),u.src="./Assets/UI/ChallengeTrophyIcon.webp",m.appendChild(u);let h=document.createElement("p");h.classList.add("browser-trophy-value"),h.innerHTML=0,m.appendChild(h);let g=document.createElement("div");g.classList.add("challenge-skull-div"),i.appendChild(g);let b=document.createElement("img");b.classList.add("browser-skull-icon"),b.src="./Assets/UI/DeathRateIcon.webp",g.appendChild(b);let L=document.createElement("p");L.classList.add("browser-skull-value"),L.innerHTML=0,g.appendChild(L);let v=document.createElement("div");v.classList.add("challenge-bottom"),n.appendChild(v);let y=document.createElement("div");y.classList.add("challenge-creator"),v.appendChild(y);let f=document.createElement("div");f.classList.add("avatar"),y.appendChild(f);let C=50,w=document.createElement("img");w.classList.add("avatar-frame","noSelect"),w.style.width=`${C}px`,w.src="../Assets/UI/InstaTowersContainer.webp",f.appendChild(w);let E=document.createElement("img");E.classList.add("avatar-img","noSelect"),E.style.width=`${C}px`,E.src="../Assets/ProfileAvatar/ProfileAvatar01.webp",f.appendChild(E);let k=document.createElement("p");k.classList.add("browser-creator-name","black-outline"),k.innerHTML=preventRateLimiting?"Click to Load Creator":"Loading...",y.appendChild(k);let T=document.createElement("div");T.classList.add("challenge-id-and-play"),v.appendChild(T);let M=document.createElement("p");M.classList.add("browser-id","black-outline"),M.innerHTML=t.id,M.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),copyID(t.id,M)})),T.appendChild(M);let S=document.createElement("img");S.classList.add("browser-copy-img"),S.src="../Assets/UI/CopyClipboardBtn.webp",S.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),copyID(t.id,M)})),T.appendChild(S);let I=document.createElement("img");I.classList.add("browser-go-img"),I.src="../Assets/UI/GoBtnSmall.webp",I.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),openBTD6Site(`https://join.btd6.com/Map/${t.id}`)})),T.appendChild(I),new IntersectionObserver(((e,a)=>{e.forEach((async e=>{if(e.isIntersecting){a.unobserve(e.target);let n=await getCustomMapMetadata(t.id);if(null==n)return;p.innerHTML=n.upvotes.toLocaleString(),h.innerHTML=0==n.playsUnique||n.winsUnique-n.playsUnique==0?"0%":`${(n.winsUnique/n.playsUnique*100).toFixed(2)}%`,L.innerHTML=0==n.playsUnique?"0%":`${(n.wins/(n.plays+n.restarts)*100).toFixed(2)}%`,y.addEventListener("click",(async e=>{e.preventDefault(),e.stopPropagation(),k.innerHTML="Loading...";let t=await getUserProfile(n.creator);null!=t?(k.innerHTML=t.displayName,t.displayName.length>13&&(k.style.fontSize="17px"),E.src=getProfileAvatar(t),v.style.backgroundImage=`linear-gradient(to right, transparent 80%, var(--profile-secondary) 100%),url(${getProfileBanner(t)})`,y.removeEventListener("click",arguments.callee),y.addEventListener("click",(()=>openProfile("browser",n.creator)))):k.innerHTML="Click to Load Creator"})),preventRateLimiting||y.click()}}))})).observe(n);break;case"Gallery":let x=document.createElement("div");x.classList.add("race-map-div","silver-border"),n.appendChild(x);let B=document.createElement("p");B.classList.add("browser-id","gallery-id","black-outline"),B.innerHTML=t.id,B.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),copyID(t.id,B)})),x.appendChild(B);let A=document.createElement("img");A.classList.add("race-map-img"),A.src=getCustomMapIcon(t.id),A.onerror=function(){this.onerror=null,this.src="./Assets/MapIcon/MapLoadingImage.webp"},x.appendChild(A)}new IntersectionObserver(((e,t)=>{e.forEach((async e=>{e.isIntersecting&&t.unobserve(e.target)}))})).observe(n)}))}async function showMapModel(e,t){if(null==t)return;resetScroll();let a=document.getElementById("map-content");a.style.display="flex",a.innerHTML="",document.getElementById(`${e}-content`).style.display="none",addToBackQueue({source:e,destination:"map"});let n=processChallenge(t),s=document.createElement("div");s.classList.add("challenge-model"),a.appendChild(s);let l=document.createElement("div");l.classList.add("challenge-model-header"),s.appendChild(l);let d=document.createElement("div");d.classList.add("challenge-model-header-icons"),l.appendChild(d);let r=document.createElement("img");r.classList.add("challenge-model-header-difficulty"),r.src="./Assets/UI/EditMapIcon.webp",d.appendChild(r);let i=document.createElement("div");i.classList.add("challenge-model-header-texts"),l.appendChild(i);let o=document.createElement("p");o.classList.add("challenge-model-header-name","black-outline"),o.innerHTML=t.name,i.appendChild(o);let c=document.createElement("div");c.classList.add("challenge-header-right-container"),l.appendChild(c);let p=document.createElement("div");p.classList.add("challenge-header-right-top"),c.appendChild(p);let m=document.createElement("img");m.classList.add("modal-close"),m.src="./Assets/UI/CloseBtn.webp",m.addEventListener("click",(()=>{goBack()})),p.appendChild(m);let u=document.createElement("div");u.classList.add("challenge-header-right-bottom"),c.appendChild(u);let h=document.createElement("p");h.classList.add("challenge-id","black-outline"),h.innerHTML=t.id,h.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),copyID(t.id,h)})),u.appendChild(h);let g=document.createElement("img");g.classList.add("browser-copy-img"),g.src="../Assets/UI/CopyClipboardBtn.webp",g.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),copyID(t.id,h)})),u.appendChild(g);let b=document.createElement("img");b.classList.add("browser-go-img"),b.src="../Assets/UI/GoBtnSmall.webp",b.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),openBTD6Site(`https://join.btd6.com/Map/${t.id}`)})),u.appendChild(b);let L=document.createElement("div");L.classList.add("map-model-top","map-model-bg"),s.appendChild(L);let v=document.createElement("img");if(v.classList.add("map-model-img","boss-border"),v.src=Object.keys(constants.mapsInOrder).includes(t.map)?getMapIcon(t.map):t.mapURL,L.appendChild(v),n.statsValid){let e=document.createElement("div");e.classList.add("map-model-stats-div"),L.appendChild(e);let t=document.createElement("p");t.classList.add("challenge-stats-header","black-outline"),t.innerHTML="Challenge Stats",e.appendChild(t);let a=document.createElement("div");a.classList.add("challenge-stats-left-right"),e.appendChild(a);let s=document.createElement("div");s.classList.add("challenge-stats-left"),a.appendChild(s);let l=document.createElement("div");if(l.classList.add("challenge-usv-div"),s.appendChild(l),0!=n.Upvotes){let e=document.createElement("div");e.classList.add("challenge-upvote-div"),l.appendChild(e);let t=document.createElement("img");t.classList.add("challenge-upvote-icon"),t.src="./Assets/UI/ChallengeThumbsUpIcon.webp",e.appendChild(t);let a=document.createElement("p");a.classList.add("challenge-upvote-value"),a.innerHTML=n.Upvotes,e.appendChild(a)}let d=document.createElement("div");d.classList.add("challenge-trophy-div"),l.appendChild(d);let r=document.createElement("img");r.classList.add("challenge-trophy-icon"),r.src="./Assets/UI/ChallengeTrophyIcon.webp",d.appendChild(r);let i=document.createElement("p");i.classList.add("challenge-trophy-value"),i.innerHTML=n["Player Completion Rate"],d.appendChild(i);let o=document.createElement("div");o.classList.add("challenge-skull-div"),l.appendChild(o);let c=document.createElement("img");c.classList.add("challenge-skull-icon"),c.src="./Assets/UI/DeathRateIcon.webp",o.appendChild(c);let p=document.createElement("p");if(p.classList.add("challenge-skull-value"),p.innerHTML=n["Player Win Rate"],o.appendChild(p),"n/a"!=n.Creator&&null!=n.Creator){let e=document.createElement("div");e.classList.add("challenge-creator"),s.appendChild(e);let t=document.createElement("div");t.classList.add("avatar"),e.appendChild(t);let a=50,l=document.createElement("img");l.classList.add("avatar-frame","noSelect"),l.style.width=`${a}px`,l.src="../Assets/UI/InstaTowersContainer.webp",t.appendChild(l);let d=document.createElement("img");d.classList.add("avatar-img","noSelect"),d.style.width=`${a}px`,d.src="../Assets/ProfileAvatar/ProfileAvatar01.webp",t.appendChild(d);let r=document.createElement("p");r.classList.add("challenge-creator-name","black-outline"),r.innerHTML=preventRateLimiting?"Click to Load Creator":"Loading...",e.appendChild(r),e.addEventListener("click",(async()=>{r.innerHTML="Loading...";let t=await getUserProfile(n.Creator);null!=t?(r.innerHTML=t.displayName,d.src=getProfileAvatar(t),e.style.backgroundImage=`linear-gradient(to right, transparent 80%, var(--profile-secondary) 100%),url(${getProfileBanner(t)})`,e.removeEventListener("click",arguments.callee),e.addEventListener("click",(()=>{openProfile("map",n.Creator)}))):r.innerHTML="Click to Load Creator"})),preventRateLimiting||e.click()}["Date Created","Game Version"].forEach((e=>{if("Game Version"==e&&0==n[e])return;let t=document.createElement("div");t.classList.add("challenge-stat"),s.appendChild(t);let a=document.createElement("p");a.classList.add("challenge-stat-label"),a.innerHTML=`${e}: ${n[e]}`,t.appendChild(a)}));let m=document.createElement("div");m.classList.add("challenge-stats-right"),a.appendChild(m),Object.entries(n.Stats).forEach((([e,t])=>{let a=document.createElement("div");a.classList.add("challenge-stat"),m.appendChild(a);let n=document.createElement("p");n.classList.add("challenge-stat-label"),n.innerHTML=e,a.appendChild(n);let s=document.createElement("p");s.classList.add("challenge-model-stat-value"),s.innerHTML=t.toLocaleString(),a.appendChild(s)}))}}function generateExtrasPage(){let e=document.getElementById("extras-content");e.innerHTML="",changeTitle("Bloons TD 6 API Explorer");let t=document.createElement("div");t.classList.add("progress-page"),e.appendChild(t);let a=document.createElement("div");a.classList.add("selectors-div"),t.appendChild(a);let n=["Rogue Legends Artifacts","Challenge & Map Browser","Settings","Use Code 'HalfHydra' <br>in the BTD6 Shop!"];loggedIn||(n=n.filter((e=>"Collection Event Odds"!=e))),n.forEach((t=>{let n=document.createElement("div");n.classList.add("selector-div","blueprint-bg"),n.addEventListener("click",(()=>{e.style.display="none",document.getElementById("extras-content").style.display="flex",changeExtrasTab(t)})),a.appendChild(n);let s=document.createElement("img");switch(s.classList.add("selector-img"),n.appendChild(s),t){case"Custom Round Sets":s.src="../Assets/ChallengeRulesIcon/CustomRoundIcon.webp";break;case"Featured Insta Schedule":s.src="../Assets/UI/InstaBtn.webp";break;case"Collection Event Odds":s.src="../Assets/UI/CollectingEventTotemBtn.webp";break;case"Monkey Money Helper":default:s.src="../Assets/UI/WoodenRoundButton.webp";break;case"Send Feedback":s.src="../Assets/UI/FeedbackBtn.webp";break;case"Settings":s.src="../Assets/UI/OptionsBtn.webp";break;case"Use Code 'HalfHydra' <br>in the BTD6 Shop!":s.src="../Assets/UI/CreatorSupportBtn.webp";break;case"Rogue Legends Artifacts":n.classList.add("rogue-bg"),s.src="../Assets/UI/RogueBtn.webp";break;case"Challenge & Map Browser":s.src="../Assets/UI/PatchNotesMonkeyIcon.webp"}let l=document.createElement("p");l.classList.add("selector-text","black-outline"),l.innerHTML=t,n.appendChild(l);let d=document.createElement("img");d.classList.add("selector-go-img"),d.src="../Assets/UI/ContinueBtn.webp",n.appendChild(d)}))}function changeExtrasTab(e){switch(resetScroll(),e){case"Custom Round Sets":generateRoundsets();break;case"Featured Insta Schedule":addToBackQueue({source:"extras",destination:"featured"}),generateInstaSchedule(),document.getElementById("extras-content").style.display="none",document.getElementById("featured-content").style.display="flex";break;case"Collection Event Odds":changeTab("profile"),currentInstaView="collection",changeProgressTab("InstaMonkeys");break;case"Send Feedback":window.open("https://forms.gle/Tg1PuRNj2ftojMde6","_blank");break;case"CreatorSupport":case"Use Code 'HalfHydra' <br>in the BTD6 Shop!":addToBackQueue({callback:generateExtrasPage}),generateArticle("CreatorSupport");break;case"Settings":addToBackQueue({callback:generateExtrasPage}),generateSettings();break;case"Rogue Legends Artifacts":changeTitle("Rogue Legends Artifacts"),addToBackQueue({source:"extras",destination:"rogue",callback:generateExtrasPage}),generateRogueSelectors(),document.getElementById("extras-content").style.display="none",document.getElementById("rogue-content").style.display="flex";break;case"Challenge & Map Browser":addToBackQueue({source:"extras",destination:"explore",callback:generateExtrasPage}),generateExplore(),document.getElementById("extras-content").style.display="none",document.getElementById("explore-content").style.display="flex"}}function generateArticle(e){let t=document.getElementById("extras-content");t.innerHTML="";let a=document.createElement("div");a.classList.add("article-page"),t.appendChild(a);let n=document.createElement("div");n.classList.add("d-flex","fd-column","ai-center"),a.appendChild(n);({CreatorSupport:[{type:"text",class:"oak-instructions-text",content:"Creator support is a program offered by Ninja Kiwi that allows players to give a cut of the purchases you make in game to the creator who's code you've entered in the Bloons TD 6 shop. You can support me and my site by using the code \"HalfHydra\""},{type:"text",class:"site-info-header black-outline",content:"How to enter a creator code:"},{type:"panels",content:{1:{name:"Step 1",desc:"On the main menu after pressing start, navigate to the shop",img:"CS1"},2:{name:"Step 2",desc:"Press the creator support button on the bottom left",img:"CS2"},3:{name:"Step 3",desc:'Enter code "HalfHydra" (or any other creators code) and press submit. When purchasing anything in the store, a cut will go to the creator chosen.',img:"CS3"}}},{type:"text",class:"site-info-header black-outline ta-center",content:"Try the Official Bloons TD 6 Web Store!"},{type:"text",class:"oak-instructions-text",content:"In addition to frequent sales exclusive to the web store, purchasing in game items on the web store will give you bonus rewards such as extra Monkey Money. You can also leave a tip if wish to support me further! <a href='https://btd6store.ninjakiwi.com/' target='_blank' rel='noopener noreferrer'>Official Bloons TD 6 Web Store</a>"},{type:"img",class:"insta-monkey-guide-method-img",content:"CS4.webp"}]})[e].forEach((e=>{switch(e.type){case"text":let t=document.createElement("p");e.class&&(t.className=e.class),t.innerHTML=e.content,n.appendChild(t);break;case"img":let a=document.createElement("img");e.class&&(a.className=e.class),a.style.width="800px",a.src=`../Assets/UI/${e.content}`,n.appendChild(a);break;case"panels":let s=e.content,l=document.createElement("div");l.classList.add("insta-monkey-guide-container"),n.appendChild(l),Object.keys(s).forEach((e=>{let t=document.createElement("div");t.classList.add("insta-monkey-guide-method"),l.appendChild(t);let a=document.createElement("p");a.classList.add("insta-monkey-guide-method-text","black-outline"),a.innerHTML=s[e].name,t.appendChild(a);let n=document.createElement("p");n.classList.add("insta-monkey-guide-method-desc"),n.innerHTML=s[e].desc,t.appendChild(n);let d=document.createElement("img");d.classList.add("insta-monkey-guide-method-img"),d.src=`./Assets/UI/${s[e].img}.webp`,t.appendChild(d)}))}}))}function generateSettings(){let e=document.getElementById("extras-content");e.innerHTML="";let t={ProfileLoading:{name:"Load Profiles Automatically",description:"When switched on, user profiles on leaderboards and the content browser will load and display user cosmetics. Otherwise user profiles will need to be clicked to be loaded. This option may cause you to be rate limited much faster (you will need to wait a few minutes before loading any new content from the Ninja Kiwi API on the site if you reach a threshold).",input:"toggle"},UseNamedMonkeys:{name:"Use Named Monkeys Nicknames",description:"When switched on, the site will use the nicknames you've set for towers instead of the tower names.",input:"toggle"},TeamsStoreItems:{name:"Show Teams Store Items in Progress Tab",description:"When switched on, the progress tab will show collected team store items. I don't have a way to test this so it may not work.",input:"toggle"}},a=document.createElement("div");a.classList.add("article-page"),e.appendChild(a);let n=document.createElement("p");n.classList.add("hero-progress-header-text","settings-text"),n.innerHTML="Settings",a.appendChild(n);let s=document.createElement("div");s.classList.add("settings-options-container"),a.appendChild(s);for(let e in t){let a=document.createElement("div");a.classList.add("setting-div"),s.appendChild(a);let n=document.createElement("p");n.classList.add("insta-monkey-guide-method-text","black-outline"),n.innerHTML=t[e].name,a.appendChild(n);let l=document.createElement("div");l.classList.add("setting-info-div"),a.appendChild(l);let d=document.createElement("p");d.classList.add("insta-monkey-guide-method-desc","setting-desc"),d.innerHTML=t[e].description,l.appendChild(d);let r=document.createElement("label");r.classList.add("setting-input-label"),l.appendChild(r);let i=document.createElement("input");if(i.classList.add("setting-input"),r.appendChild(i),"toggle"===t[e].input){let e=document.createElement("span");e.classList.add("toggle-img","slider"),e.src="../Assets/UI/BlueBtnCircleSmall.webp",r.appendChild(e),i.type="checkbox",r.classList.add("switch")}switch(e){case"ProfileLoading":i.checked=!preventRateLimiting,i.addEventListener("change",(()=>{preventRateLimiting=!i.checked,saveSettings()}));break;case"UseNamedMonkeys":i.checked=useNamedMonkeys,i.addEventListener("change",(()=>{useNamedMonkeys=!useNamedMonkeys,saveSettings()}));break;case"TeamsStoreItems":i.checked=showTeamsItems,i.addEventListener("change",(()=>{showTeamsItems=!showTeamsItems,saveSettings()}))}}}function generateTrophyStoreProgress(){let e=document.getElementById("profile-content");e.innerHTML="";let t=document.createElement("div");t.classList.add("trophy-store-progress-container"),e.appendChild(t);let a=document.createElement("div");a.classList.add("trophy-store-header-bar"),t.appendChild(a);let n=document.createElement("div");n.classList.add("achievements-header-bar"),a.appendChild(n);let s=document.createElement("div");a.appendChild(s);let l=createEl("p",{classList:["font-gardenia","ta-center"],style:{marginBottom:"10px"},innerHTML:"This is being tested, not all items may show up as collected properly."});s.appendChild(l);let d=document.createElement("div");d.classList.add("sub-filter-container"),d.style.display="none",s.appendChild(d);let r=document.createElement("div");r.classList.add("maps-progress-views"),n.appendChild(r);let i=document.createElement("div");i.classList.add("map-progress-filter-difficulty"),r.appendChild(i);let o=document.createElement("p");o.classList.add("maps-progress-coop-toggle-text","black-outline"),o.innerHTML="Filter:",i.appendChild(o);let c=document.createElement("select");c.classList.add("map-progress-filter-difficulty-select");["All","Heroes","Monkeys","Bloons","Coop","Game & UI"].forEach((e=>{let t=document.createElement("option");t.value="Game & UI"===e?"GameUI":e,t.innerHTML=e,c.appendChild(t)})),i.appendChild(c);let p=document.createElement("p");p.classList.add("trophy-store-item-counter","black-outline"),p.innerHTML="0/0",n.appendChild(p),c.addEventListener("change",(()=>{var e;trophyStoreSubFilter="All","All"!==c.value?(e=c.value,d.innerHTML="",d.style.display="flex",subFiltersMap[e].forEach((e=>{let t=document.createElement("div");t.classList.add("maps-progress-view","sub-filter","black-outline"),"All"===e&&t.classList.add("stats-tab-yellow"),t.innerHTML=getLocValue(`Filter${e}`),t.addEventListener("click",(()=>{trophyStoreSubFilter=e,Array.from(d.children).forEach((e=>{e===t?e.classList.add("stats-tab-yellow"):e.classList.remove("stats-tab-yellow")})),generateTrophyStoreContainer(c.value,g.value,p)})),d.appendChild(t)}))):d.style.display="none",generateTrophyStoreContainer(c.value,g.value,p)}));let m=document.createElement("div");m.classList.add("maps-progress-filter"),n.appendChild(m);let u=document.createElement("div");u.classList.add("map-progress-filter-difficulty"),m.appendChild(u);let h=document.createElement("p");h.classList.add("maps-progress-coop-toggle-text","black-outline"),h.innerHTML="Display:",u.appendChild(h);let g=document.createElement("select");g.classList.add("map-progress-filter-difficulty-select"),g.addEventListener("change",(()=>{generateTrophyStoreContainer(c.value,g.value,p)}));["All","Owned","Unowned","Hidden"].forEach((e=>{let t=document.createElement("option");t.value=e,t.innerHTML=e,g.appendChild(t)})),u.appendChild(g);let b=document.createElement("div");b.id="trophy-store-items-container",b.classList.add("trophy-store-items-container"),t.appendChild(b),generateTrophyStoreContainer("All","All",p)}function getTrophyItemObtained(e){return!(!btd6usersave.trophyStoreItems.hasOwnProperty(e)||1!=btd6usersave.trophyStoreItems[e])||!!btd6usersave.trophyStoreItems.hasOwnProperty(trophyStoreKeyFixes[e])&&btd6usersave.trophyStoreItems[trophyStoreKeyFixes[e]]}function generateTrophyStoreContainer(e,t,a){let n=document.getElementById("trophy-store-items-container");n.innerHTML="";let s=JSON.parse(JSON.stringify(trophyStoreItemsJSON));for(let e of constants.unreleasedContent.trophyStoreItems)delete s[e];switch("All"!==e&&(s=Object.fromEntries(Object.entries(s).filter((([t,a])=>a.storeFilter===e)))),"All"!==trophyStoreSubFilter&&(s=Object.fromEntries(Object.entries(s).filter((([e,t])=>t.subFilter===trophyStoreSubFilter)))),t){case"All":break;case"Unowned":s=Object.fromEntries(Object.entries(s).filter((([e,t])=>!getTrophyItemObtained(e))));break;case"Owned":s=Object.fromEntries(Object.entries(s).filter((([e,t])=>getTrophyItemObtained(e))));break;case"Hidden":s=Object.fromEntries(Object.entries(s).filter((([e,t])=>t.hidden))),s=Object.fromEntries(Object.entries(s).sort((([e,t],[a,n])=>!btd6usersave.trophyStoreItems.hasOwnProperty(e)||!btd6usersave.trophyStoreItems[e]||btd6usersave.trophyStoreItems.hasOwnProperty(a)&&btd6usersave.trophyStoreItems[a]?btd6usersave.trophyStoreItems.hasOwnProperty(e)&&btd6usersave.trophyStoreItems[e]||!btd6usersave.trophyStoreItems.hasOwnProperty(a)||!btd6usersave.trophyStoreItems[a]?0:-1:1)))}switch(t){case"Unowned":case"Owned":a.innerHTML=`${Object.keys(s).length} Items`;break;default:a.innerHTML=`${Object.keys(s).filter((e=>getTrophyItemObtained(e))).length}/${Object.keys(s).length} Owned`}0==Object.keys(s).length&&(a.innerHTML="No Items Match");for(let[e,t]of Object.entries(s)){let a=document.createElement("div");a.classList.add("trophy-store-item-div"),n.appendChild(a);let s=document.createElement("img");s.classList.add("trophy-store-item-img","trophy-store-item-div"),s.src="Avatar"===t.itemType?`../Assets/ProfileAvatar/${t.icon}.webp`:`../Assets/TrophyStoreIcon/${t.icon}.webp`,a.appendChild(s),s.loading="lazy",a.addEventListener("click",(()=>{generateTrophyStorePopout(e)}));let l=document.createElement("p");if(l.classList.add("trophy-store-item-text"),l.innerHTML=getLocValue(`${e}ShortName`),a.appendChild(l),"TextEmotes"===t.subFilter){let t=document.createElement("p");t.classList.add("trophy-store-item-text-emote","black-outline"),t.innerHTML=getLocValue("CoopEmoteAnimationHappyHolidays"===e?`${e}ShortName`:`${e}Word`),a.appendChild(t)}if(getTrophyItemObtained(e)){let e=document.createElement("p");e.classList.add("trophy-store-collected-text","black-outline"),e.innerHTML="Owned",a.appendChild(e),s.style.borderImageSource="url(../Assets/UI/TrophyBGPanelBlue.webp)"}let d=document.createElement("img");d.classList.add("trophy-store-item-type-icon"),d.src=`../Assets/UI/Trophy${t.storeFilter}Icon.webp`,a.appendChild(d)}}function generateTrophyStorePopout(e){let t=trophyStoreItemsJSON[e],a=document.createElement("div"),n=document.createElement("div");n.classList.add("item-img-and-details"),a.appendChild(n);let s=document.createElement("div");s.classList.add("modal-trophy-div"),n.appendChild(s);let l=document.createElement("img");if(l.classList.add("trophy-store-item-img","trophy-store-item-div","modal-trophy-item"),l.src="Avatar"===t.itemType?`../Assets/ProfileAvatar/${t.icon}.webp`:`../Assets/TrophyStoreIcon/${t.icon}.webp`,s.appendChild(l),"TextEmotes"===t.subFilter){let t=document.createElement("p");t.classList.add("trophy-store-item-text-emote-popout","black-outline"),t.innerHTML=getLocValue("CoopEmoteAnimationHappyHolidays"===e?`${e}ShortName`:`${e}Word`),s.appendChild(t)}btd6usersave.trophyStoreItems.hasOwnProperty(e)&&btd6usersave.trophyStoreItems[e]&&(l.style.borderImageSource="url(../Assets/UI/TrophyBGPanelBlue.webp)");let d=document.createElement("div");d.classList.add("item-details-div"),n.appendChild(d);let r=document.createElement("p");r.classList.add("trophy-store-item-full-name","black-outline"),r.innerHTML=getLocValue(`${e}Name`),d.appendChild(r);let i=document.createElement("p");i.classList.add("trophy-store-item-description"),i.innerHTML=getLocValue(`${e}Description`),d.appendChild(i);let o=document.createElement("p");if(o.classList.add("trophy-store-item-obtain-method"),d.appendChild(o),t.hasOwnProperty("obtainMethod"))switch(t.obtainMethod){case"Quest":o.innerHTML="Obtained by completing a quest";break;case"Limited":o.innerHTML="Obtained during a limited time event";break;case"Rogue":o.innerHTML="Obtained by unlocking a feat in Rogue Legends";break;case"Nexus":o.innerHTML="Obtained by purchasing anything in the store with a Nexus Creator Code applied";break;case"Purchase":o.innerHTML="Obtained by purchasing the associated bundle in the store"}t.hidden&&!t.hasOwnProperty("obtainMethod")&&(o.innerHTML="This item is hidden and may show up in the featured tab during the related seasonal rotation."),createModal({content:a,header:getLocValue(`${e}ShortName`)})}function generateTeamsStoreProgress(){let e=document.getElementById("profile-content");e.innerHTML="";let t=document.createElement("div");t.classList.add("powers-progress-container"),e.appendChild(t);let a=JSON.parse(JSON.stringify(teamsStoreItemsJSON));for(let e of constants.unreleasedContent.teamsStoreItems)delete a[e];for(let[e,n]of Object.entries(a)){if(n.isDefault)continue;let a=document.createElement("div");a.classList.add("trophy-store-item-div"),t.appendChild(a),a.addEventListener("click",(()=>{generateTeamsStorePopout(e)}));let s=document.createElement("img");s.classList.add("trophy-store-item-img","trophy-store-item-div","teams-store-unowned"),s.src="Avatar"===n.itemType?`../Assets/ProfileAvatar/${n.icon}.webp`:`../Assets/TeamsStoreIcon/${n.icon}.webp`,a.appendChild(s);let l=document.createElement("p");if(l.classList.add("trophy-store-item-text"),l.innerHTML=getLocValue(`${e}ShortName`),a.appendChild(l),btd6usersave.trophyStoreItems.hasOwnProperty(e)&&btd6usersave.trophyStoreItems[e]){let e=document.createElement("p");e.classList.add("trophy-store-collected-text","black-outline"),e.innerHTML="Owned",a.appendChild(e),s.classList.add("teams-store-owned")}}}function generateTeamsStorePopout(e){let t=teamsStoreItemsJSON[e],a=document.createElement("div"),n=document.createElement("div");n.classList.add("item-img-and-details"),n.style.backgroundImage="url(../Assets/UI/TeamStoreTiledBg.webp)",a.appendChild(n);let s=document.createElement("div");s.classList.add("modal-trophy-div"),n.appendChild(s);let l=document.createElement("img");l.classList.add("trophy-store-item-img","trophy-store-item-div","modal-trophy-item","teams-store-unowned"),l.src=`../Assets/TeamsStoreIcon/${t.icon}.webp`,s.appendChild(l),btd6usersave.trophyStoreItems.hasOwnProperty(e)&&btd6usersave.trophyStoreItems[e]&&l.classList.add("teams-store-owned");let d=document.createElement("div");d.classList.add("item-details-div"),n.appendChild(d);let r=document.createElement("p");r.classList.add("trophy-store-item-full-name","black-outline"),r.innerHTML=getLocValue(`${e}Name`),d.appendChild(r);let i=document.createElement("p");i.classList.add("trophy-store-item-description"),i.innerHTML=getLocValue(`${e}Description`),d.appendChild(i);let o=document.createElement("p");if(o.classList.add("trophy-store-item-obtain-method"),d.appendChild(o),t.hasOwnProperty("obtainMethod"))switch(t.obtainMethod){case"Quest":o.innerHTML="Obtained by completing a quest";break;case"Limited":o.innerHTML="Obtained during a limited time event";break;case"Rogue":o.innerHTML="Obtained by unlocking a feat in Rogue Legends";break;case"Nexus":o.innerHTML="Obtained by purchasing anything in the store with a Nexus Creator Code applied";break;case"Purchase":o.innerHTML="Obtained by purchasing the associated bundle in the store"}t.hidden&&!t.hasOwnProperty("obtainMethod")&&(o.innerHTML="This item is hidden and may show up in the featured tab during the related seasonal rotation."),createModal({content:a,header:getLocValue(`${e}ShortName`)})}async function generateInstaSchedule(){let e=await getLatestCollectionEvent();e=processCollectionEvent(e);let t=document.getElementById("featured-content");t.innerHTML="",currentFeaturedTower="All";let a=createEl("div",{classList:["totem-bg"],style:{width:"800px",borderRadius:"20px",backgroundColor:"#7a674b"}});t.appendChild(a);let n=createEl("div",{classList:["d-flex","jc-between","ai-center","grey-border","fd-column"]});a.appendChild(n);let s=createEl("div",{classList:["d-flex","jc-between","ai-center","w-100"]});n.appendChild(s);let l=new Date(e.start),d=new Date(e.end),r=createEl("p",{classList:["black-outline","fg-1"],style:{fontSize:"32px",padding:"10px 20px"},innerHTML:`Featured Insta Schedule<br>${l.toLocaleDateString()} - ${d.toLocaleDateString()}`});s.appendChild(r);let i=generateButton("Filter","150px");s.appendChild(i);let o=createEl("div",{classList:["d-flex","f-wrap"],style:{width:"800px",display:"none"}});n.appendChild(o);let c=createEl("p",{classList:["font-gardenia"],style:{fontSize:"18px",padding:"10px 20px",textAlign:"center",lineHeight:"1.5"},innerHTML:"Times are your local timezone. Event list and times may change. Special thanks to Minecool for helping me find what broke my list generator!"});n.appendChild(c);let p=createEl("div",{classList:["insta-schedule-container"],style:{width:"800px"}});Object.keys(constants.towersInOrder).forEach((t=>{let a=document.createElement("div");a.classList.add("featured-insta-filter-selector"),a.addEventListener("click",(()=>{for(element of(currentFeaturedTower=currentFeaturedTower===t?"All":t,document.getElementsByClassName("featured-insta-filter-selector")))element.classList.remove("collection-event-tower-selector-active");"All"!=currentFeaturedTower&&a.classList.add("collection-event-tower-selector-active"),generateRotations(p,e)})),o.appendChild(a);let n=document.createElement("img");n.style.width="88px",n.style.height="88px",n.src=getInstaMonkeyIcon(t,"000"),a.appendChild(n)})),i.addEventListener("click",(()=>{showFeaturedFilter=!showFeaturedFilter,o.style.display=showFeaturedFilter?"flex":"none",i.classList.toggle("square-btn-yellow",showFeaturedFilter)})),a.appendChild(p),generateRotations(p,e)}function generateRotations(e,t){e.innerHTML="";let a=0,n=Math.floor((Date.now()-t.start)/288e5);Object.values(t.rotations).forEach(((s,l)=>{if(!s.includes(currentFeaturedTower)&&"All"!==currentFeaturedTower)return;if(l<n)return;let d=createEl("div",{classList:["d-flex","jc-between","ai-center"],style:{borderTop:"2px solid black"}});a%2&&(d.style.backgroundColor="#00000040"),e.appendChild(d);let r=new Date(t.start+288e5*l),i=createEl("p",{classList:["insta-schedule-rotation-date","black-outline"],style:{fontSize:"28px",textAlign:"center",flexGrow:"1"},innerHTML:n==l?"Active Selection":`${r.toLocaleDateString()}<br>${r.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`});d.appendChild(i);let o=createEl("div",{classList:["d-flex"]});d.appendChild(o),s.forEach((e=>{let t=createEl("div",{classList:["insta-schedule-item"],style:{backgroundImage:`url(../Assets/UI/TowerContainer${constants.towersInOrder[e]}.webp)`,backgroundSize:"cover",backgroundPosition:"center 130px",height:"75px",width:"150px",position:"relative"}});o.appendChild(t);let a=createEl("img",{classList:["insta-schedule-item-img"],style:{width:"150px",height:"75px"},src:`../Assets/UI/FaceEntry/${e}.webp`});t.appendChild(a)})),firstRotation=!1,a++}))}function generateQuestsPage(){let e=document.getElementById("profile-content");e.innerHTML="";let t=createEl("div",{style:{width:"750px"}});e.appendChild(t);let a=createEl("div",{classList:["d-flex","jc-center","ai-center","coop-border","fd-column"],style:{}});t.appendChild(a);let n=createEl("p",{classList:["black-outline"],style:{fontSize:"32px",textAlign:"center",marginBottom:"10px"},innerHTML:"Quests"});a.appendChild(n);let s=createEl("p",{classList:["font-gardenia"],style:{fontSize:"18px",lineHeight:"1.5",textAlign:"center",marginBottom:"10px"},innerHTML:"Completion status will be inaccurate for quests that were completed before NK changed the quest system internally. Replaying and clearing the quests will fix the completion status. Note: If you click 'Replay' on a quest, this will make it 'incomplete' as well."});a.appendChild(s);const l={};Object.entries(constants.roundSets).forEach((([e,t])=>{t&&"quest"===t.type&&t.icon&&(l[t.icon]||=[]).push(e)})),btd6usersave.quests.forEach((e=>{let a=constants.quests[e.id],n=createEl("div",{classList:["d-flex","ai-center","jc-between","wood-container"],style:{margin:"10px 0px"}});t.appendChild(n);let s=createEl("img",{classList:["quest-img"],style:{width:"100px"},src:`../Assets/QuestIcon/${a.icon||"QuestIconPhayzeOne"}.webp`});n.appendChild(s);let d=createEl("div",{classList:["d-flex","fd-column","jc-center","ai-center"],style:{gap:"10px"}});n.appendChild(d);let r=createEl("p",{classList:["quest-title","black-outline"],style:{fontSize:"28px"},innerHTML:getLocValue(`${a.nameLocKey}`)||e.id});if(d.appendChild(r),a?.icon&&l[a.icon]?.length){const e=l[a.icon];if(e.length){const t=createEl("div",{classList:["d-flex","ai-center","jc-start"]});d.appendChild(t),e.forEach(((a,n)=>{let s=constants.roundSets[a]?.part||null;const l=createEl("div",{classList:["maps-progress-view","black-outline","pointer"],style:{filter:"hue-rotate(270deg)"}});l.innerHTML=s?`Stage ${s}`:e.length>1?`Stage ${n+1}`:"Open Rounds",l.addEventListener("click",(e=>{showLoading(),showRoundsetModel("profile",constants.roundSets[a]?.roundset||a)})),t.appendChild(l)}))}}if(e.complete){let e=createEl("img",{classList:[],style:{width:"100px",height:"100px",transform:"scale(0.75)"},src:"../Assets/UI/TickGreenIcon.webp"});n.appendChild(e)}else{let t=createEl("p",{classList:["quest-progress","ta-center","black-outline"],style:{width:"100px",fontSize:"36px"},innerHTML:`${e.partsComplete}/${e.parts}`});n.appendChild(t)}}))}let previewFrameId=null,speedMultiplier=1,bloonsData={Red:{name:"Red",rbe:1,speed:25,layer:1,scale:.8,color:"#ED0F0F",border:"#690000"},Blue:{name:"Blue",rbe:2,speed:35,layer:2,scale:.85,color:"#2797E0",border:"#004772"},Green:{name:"Green",rbe:3,speed:45,layer:3,scale:.9,color:"#77A80F",border:"#3D5400"},Yellow:{name:"Yellow",rbe:4,speed:80,layer:4,scale:.95,color:"#FFD50F",border:"#8E620C"},Pink:{name:"Pink",rbe:5,speed:87.5,layer:5,scale:1,color:"#F15060",border:"#A92626"},Black:{name:"Black",rbe:11,speed:45,layer:6,scale:.58,color:"#161616",border:"#414141"},Purple:{name:"Purple",rbe:11,speed:75,layer:7,scale:.95,color:"#9326E0",border:"#00E4FF"},White:{name:"White",rbe:12,speed:50,layer:6,scale:.58,color:"#D7D7D7",border:"#727272"},Lead:{name:"Lead",rbe:23,speed:25,layer:7,scale:.95,color:"#7E7E7E",border:"#2F2F2F"},Zebra:{name:"Zebra",rbe:23,speed:45,layer:7,scale:.9,color:"repeating-linear-gradient(145deg, #040404, #040404 10px, #ffffff 10px, #ffffff 20px)",border:"#5A5A5A"},Rainbow:{name:"Rainbow",rbe:47,speed:55,layer:8,scale:1,color:"linear-gradient(180deg, rgba(228,26,26,1) 0%, rgba(255,159,0,1) 16%, rgba(255,224,0,1) 33%, rgba(125,181,4,1) 48%, rgba(83,176,222,1) 66%, rgba(226,74,226,1) 84%, rgba(132,21,132,1) 100%)",border:"transparent"},Ceramic:{name:"Ceramic",rbe:47,speed:62.5,layer:9,scale:1,color:"#BE6C1D",border:"#61370B"},Moab:{name:"Moab",rbe:616,speed:25,layer:10,color:"#2AC2FF",border:"#FFFFFF"},Bfb:{name:"Bfb",rbe:3164,speed:6.25,layer:11,color:"#C00505",border:"#FFFFFF"},Zomg:{name:"Zomg",rbe:16656,speed:4.5,layer:12,color:"#575757",border:"#B7F700"},Ddt:{name:"Ddt",rbe:3164,speed:66,layer:12,color:"#3C3C3C",border:"#A5A5A5"},Bad:{name:"Bad",rbe:16464,speed:4.5,layer:13,color:"#AB02AC",border:"#500151"}},bloons_spritesheet=new Image;bloons_spritesheet.src="../Assets/BloonIcon/preview_bloons_spritesheet.webp";let bloonImageMap={CeramicCamo:{x:1153,y:0,width:129,height:163},CeramicFortified:{x:993,y:547,width:140,height:163},CeramicFortifiedCamo:{x:993,y:711,width:140,height:163},CeramicRegrow:{x:0,y:782,width:176,height:162},CeramicRegrowCamo:{x:177,y:782,width:176,height:162},CeramicRegrowFortified:{x:629,y:0,width:186,height:162},CeramicRegrowFortifiedCamo:{x:629,y:163,width:186,height:162},Black:{x:1283,y:790,width:78,height:97},BlackCamo:{x:1283,y:888,width:78,height:97},BlackRegrow:{x:833,y:945,width:105,height:97},BlackRegrowCamo:{x:708,y:782,width:105,height:97},Blue:{x:1283,y:148,width:110,height:139},BlueCamo:{x:1283,y:288,width:110,height:139},BlueRegrow:{x:408,y:641,width:150,height:138},BlueRegrowCamo:{x:993,y:146,width:150,height:138},Ceramic:{x:1153,y:164,width:129,height:163},LeadFortifiedCamo:{x:993,y:875,width:133,height:156},LeadRegrow:{x:816,y:326,width:168,height:154},LeadRegrowCamo:{x:816,y:481,width:168,height:154},LeadRegrowFortified:{x:629,y:326,width:178,height:154},LeadRegrowFortifiedCamo:{x:629,y:481,width:178,height:154},Green:{x:878,y:1100,width:116,height:147},GreenCamo:{x:995,y:1100,width:116,height:147},GreenRegrow:{x:468,y:474,width:159,height:145},GreenRegrowCamo:{x:629,y:636,width:159,height:145},Lead:{x:134,y:1100,width:123,height:156},LeadCamo:{x:258,y:1100,width:123,height:156},LeadFortified:{x:0,y:1100,width:133,height:156},WhiteRegrow:{x:1153,y:1132,width:105,height:97},WhiteRegrowCamo:{x:1283,y:428,width:105,height:97},Yellow:{x:382,y:1100,width:123,height:156},YellowCamo:{x:506,y:1100,width:123,height:156},YellowRegrow:{x:816,y:636,width:168,height:154},YellowRegrowCamo:{x:0,y:945,width:168,height:154},Zebra:{x:1153,y:984,width:116,height:147},ZebraCamo:{x:1283,y:0,width:116,height:147},ZebraRegrow:{x:816,y:791,width:159,height:145},ZebraRegrowCamo:{x:993,y:0,width:159,height:145},Pink:{x:1153,y:328,width:129,height:163},PinkCamo:{x:1153,y:492,width:129,height:163},PinkRegrow:{x:354,y:782,width:176,height:162},PinkRegrowCamo:{x:531,y:782,width:176,height:162},Purple:{x:630,y:1100,width:123,height:156},PurpleCamo:{x:754,y:1100,width:123,height:156},PurpleRegrow:{x:169,y:945,width:168,height:154},PurpleRegrowCamo:{x:338,y:945,width:168,height:154},Rainbow:{x:1153,y:656,width:129,height:163},RainbowCamo:{x:1153,y:820,width:129,height:163},RainbowRegrow:{x:816,y:0,width:176,height:162},RainbowRegrowCamo:{x:816,y:163,width:176,height:162},Red:{x:1283,y:526,width:103,height:131},RedCamo:{x:1283,y:658,width:103,height:131},RedRegrow:{x:993,y:285,width:143,height:130},RedRegrowCamo:{x:993,y:416,width:143,height:130},White:{x:1283,y:986,width:78,height:97},WhiteCamo:{x:1283,y:1084,width:78,height:97},Bad:{x:0,y:238,width:326,height:235},BadFortified:{x:0,y:0,width:326,height:237},Bfb:{x:234,y:474,width:233,height:164},BfbFortified:{x:0,y:474,width:233,height:166},DdtCamo:{x:0,y:641,width:203,height:140},DdtFortifiedCamo:{x:204,y:641,width:203,height:140},Moab:{x:670,y:945,width:162,height:105},MoabFortified:{x:507,y:945,width:162,height:110},Zomg:{x:327,y:0,width:301,height:194},ZomgFortified:{x:327,y:195,width:301,height:194}};class Bloon{constructor(e,t){this.speed=bloonsData[e.replace("Camo","").replace("Regrow","").replace("Fortified","")].speed,this.scale=bloonsData[e.replace("Camo","").replace("Regrow","").replace("Fortified","")].scale,this.x=-ratioCalc(1,0,100,bloonImageMap[e].width,bloonImageMap[e].height),this.y=100+(100-100*this.scale)/2,this.type=e,this.groupIndex=t,this.width=ratioCalc(1,0,100,bloonImageMap[e].width,bloonImageMap[e].height)}move(e){this.x+=this.speed*e*6.86*speedMultiplier*roundSpeedModifier*difficultySpeedModifier}shouldDelete(){return this.x>=800}render(e){if(hiddenGroups.includes(this.groupIndex))return;let t=bloonImageMap[this.type];e.drawImage(bloons_spritesheet,t.x,t.y,t.width,t.height,this.x,this.y,this.scale*this.width,100*this.scale)}}class Blimp{constructor(e,t){this.speed=bloonsData[e.replace("Camo","").replace("Regrow","").replace("Fortified","")].speed,this.x=-1.62*bloonImageMap[e].width,this.type=e,this.groupIndex=t}move(e){this.x+=this.speed*e*6.86*speedMultiplier*roundSpeedModifier*difficultySpeedModifier}shouldDelete(){return this.x>=800}render(e){if(hiddenGroups.includes(this.groupIndex))return;let t=bloonImageMap[this.type];e.drawImage(bloons_spritesheet,t.x,t.y,t.width,t.height,this.x,150-1.62*t.height/2,1.62*t.width,1.62*t.height)}}const bloons=[];let currentRoundGroups,difficultySpeedModifier=1,roundSpeedModifier=1;function resetPreview(){previewActive=!1,previewFrameId&&(cancelAnimationFrame(previewFrameId),previewFrameId=null),clearPreview()}function startPreviewLoop(){previewFrameId&&(cancelAnimationFrame(previewFrameId),previewFrameId=null),previewActive=!0;let e=performance.now();previewFrameId=requestAnimationFrame((function t(){if(!previewActive)return;const a=performance.now(),n=(a-e)/1e3;e=a,update(n),render(),previewFrameId=requestAnimationFrame(t)}))}const update=e=>{const t=performance.now();for(let t=bloons.length-1;t>=0;t--){const a=bloons[t];a.move(e),a.shouldDelete()&&bloons.splice(t,1)}null!=currentRoundGroups&&currentRoundGroups.bloonGroups.forEach((e=>{if(t>=e.startTime&&e.spawned<e.total){const a=(t-e.startTime)/1e3;if(0===e.spawnInterval){const t=e.total-e.spawned;for(let n=0;n<t;n++)e.spawnBloon(a),e.spawned++}else{const t=Math.min(e.total,Math.floor(a/e.spawnInterval)+1);for(;e.spawned<t;){const t=e.spawned,n=Math.max(0,a-t*e.spawnInterval);e.spawnBloon(n),e.spawned++}}}}))},render=()=>{ctx.clearRect(0,0,canvas.width,canvas.height),bloons.forEach((e=>e.render(ctx)))};function startRound(e){if(roundSpeedModifier=calcRoundSpeed(e.roundNumber),currentRoundGroups=JSON.parse(JSON.stringify(e)),roundsetFilterSettings.roundsetReversed){let t=Math.max(...e.bloonGroups.map((e=>e.end)));for(let e of currentRoundGroups.bloonGroups){let a=e.end-e.start;e.start=t-e.end,e.end=e.start+a}}addTimelinePlayhead(Math.max(...currentRoundGroups.bloonGroups.map((e=>e.end)))/speedMultiplier),currentRoundGroups.bloonGroups.forEach(((e,t)=>{e.startTime=performance.now()+1e3*e.start/speedMultiplier,e.total=e.count,e.spawned=0,e.activeTime=0,e.spawnAccumulator=0,e.spawnInterval=(e.end-e.start)/(e.count-1)/speedMultiplier,(!isFinite(e.spawnInterval)||e.spawnInterval<0)&&(e.spawnInterval=0),e.spawnBloon=spawnBloon(e,t)}))}function spawnBloon(e,t){return function(a=0){let n=e.bloon,s=["Moab","MoabFortified","Bfb","BfbFortified","Zomg","ZomgFortified","DdtCamo","DdtFortifiedCamo","Bad","BadFortified"].includes(n)?new Blimp(n,t):new Bloon(n,t);a>0&&s.move(a);let l=bloonsData[n.replace("Camo","").replace("Regrow","").replace("Fortified","")].layer,d=bloons.findIndex((e=>bloonsData[e.type.replace("Camo","").replace("Regrow","").replace("Fortified","")].layer>l));-1===d?bloons.push(s):bloons.splice(d,0,s)}}function calcRoundSpeed(e){let t=0;return t=e<=80?1:e<=100?1+.02*(e-80):e<=150?1.6+.02*(e-101):e<=200?3+.02*(e-151):e<=250?4.5+.02*(e-201):6+.02*(e-252),t}const TWO64=1n<<64n,TWO63=1n<<63n,MOD_PM=2147483647n,MOD_PM_MINUS1_NUM=2147483646;function toLong(e){let t=e&TWO64-1n;return t>=TWO63&&(t-=TWO64),t}function longAbs(e){return e===-TWO63?e:e<0n?-e:e}function I64(e){let t=0n;for(const a of e){const e=BigInt(a.charCodeAt(0)-48);t=toLong(toLong(10n*t)+e)}return t}function GetSeedLong(e){let t="";for(const a of e)t+=a.charCodeAt(0).toString();t.length>18&&(t=t.substring(0,18));return longAbs(I64(t))}class SeededRandom{constructor(e){e<0n&&(e=longAbs(e)),this.seed=e}Next(){return this.seed=toLong(16807n*this.seed),this.seed=this.seed%MOD_PM,Number(this.seed)}NextFloat(){return this.Next()/2147483646}Range(e,t){if(e===t)return e;const a=t-e;return e+this.Next()%a}}function ShuffleSeeded(e,t){const a=new SeededRandom(e),n=t.slice(),s=n.length;for(let e=0;e<s;e++){const t=a.Range(e,s);if(t<0||t>=s)continue;const l=n[e];n[e]=n[t],n[t]=l}return n}class CollectionEventFeaturedInstasHelper{constructor(){this.instaMonkeysTypeList=[],this.getCurrentPageNumber=()=>0}GetPossibleInstaMonkeys(){const e=this.instaMonkeysTypeList;if(!e||0===e.length)return[];const t=e.length,a=Math.ceil(.25*t);let n=this.getCurrentPageNumber(),s=0;for(;a<n;)n-=a,s++;const l=[];for(let a=0;a<4;a++){const d=(a+s+4*n)%t;l.push(e[d])}return l}}function processCollectionEvent(e){const t=GetSeedLong(e.id);let a=Math.ceil((e.end-e.start)/288e5);const n=ShuffleSeeded(t,["Alchemist","BananaFarm","BombShooter","BoomerangMonkey","DartMonkey","Druid","GlueGunner","HeliPilot","IceMonkey","MonkeyAce","MonkeyBuccaneer","MonkeySub","MonkeyVillage","NinjaMonkey","SniperMonkey","SpikeFactory","SuperMonkey","TackShooter","WizardMonkey","MortarMonkey","EngineerMonkey","DartlingGunner","BeastHandler","Mermonkey","Desperado"]),s=new CollectionEventFeaturedInstasHelper;s.instaMonkeysTypeList=n;const l={};for(let e=0;e<a;e++)s.getCurrentPageNumber=()=>e,l[e]=s.GetPossibleInstaMonkeys();return{id:e.id,start:e.start,end:e.end,rotations:l}}async function openProfile(e,t,a){if(null==(t=await getUserProfile(t)))return;resetScroll(),document.getElementById(`${e}-content`).style.display="none",addToBackQueue({source:e,destination:"publicprofile",callback:a});let n=document.getElementById("publicprofile-content");n.style.display="flex",n.innerHTML="";let s=document.createElement("div");s.classList.add("publicprofile-div"),n.appendChild(s);let l=document.createElement("img");l.classList.add("error-modal-close"),l.src="./Assets/UI/CloseBtn.webp",l.addEventListener("click",(()=>{goBack()})),s.appendChild(l);let d=document.createElement("div");d.classList.add("profile-header","profile-banner"),d.style.backgroundImage=`linear-gradient(to bottom, transparent 50%, var(--profile-primary) 70%),url('${getProfileBanner(t)}')`,s.appendChild(d),d.appendChild(generateAvatar(100,getProfileAvatar(t)));let r=document.createElement("div");r.classList.add("profile-top-bottom"),d.appendChild(r);let i=document.createElement("div");i.classList.add("profile-top-public"),r.appendChild(i);let o=document.createElement("p");o.classList.add("profile-name","black-outline"),o.innerHTML=t.displayName,i.appendChild(o);let c=document.createElement("div");c.classList.add("rank-star-public"),i.appendChild(c);let p=document.createElement("img");p.classList.add("rank-img"),p.src="../Assets/UI/LvlHolder.webp",c.appendChild(p);let m=document.createElement("p");if(m.classList.add("rank-text","black-outline"),m.innerHTML=t.rank,c.appendChild(m),t.veteranRank>0){let e=document.createElement("div");e.classList.add("rank-star-public"),i.appendChild(e);let a=document.createElement("img");a.classList.add("rank-img"),a.src="../Assets/UI/LvlHolderVeteran.webp",e.appendChild(a);let n=document.createElement("p");n.classList.add("rank-text","black-outline"),n.innerHTML=t.veteranRank,e.appendChild(n)}let u=document.createElement("div");u.classList.add("profile-followers"),i.appendChild(u);let h=document.createElement("p");h.classList.add("followers-label","black-outline"),h.innerHTML="Followers",u.appendChild(h);let g=document.createElement("p");g.classList.add("followers-count"),g.innerHTML=t.followers.toLocaleString(),u.appendChild(g);let b=document.createElement("div");b.classList.add("below-profile-header"),s.appendChild(b);let L=document.createElement("div");L.classList.add("left-column-div"),b.appendChild(L);let v=document.createElement("div");v.classList.add("left-column-header"),L.appendChild(v);let y=document.createElement("p");y.classList.add("column-header-text","black-outline"),y.innerHTML="Medals",v.appendChild(y);let f={},C={};for(let[e,a]of Object.entries(medalMap))f["Medal"+a]=t._medalsSinglePlayer[e]||0,C["MedalCoop"+a]=t._medalsMultiplayer[e]||0;f={...f,...C},f.BlastapopoulosEliteBadge=t.bossBadgesElite.Blastapopoulos||0,f.BlastapopoulosBadge=t.bossBadgesNormal.Blastapopoulos||0,f.PhayzeEliteBadge=t.bossBadgesElite.Phayze||0,f.PhayzeBadge=t.bossBadgesNormal.Phayze||0,f.DreadbloonEliteBadge=t.bossBadgesElite.Dreadbloon||0,f.DreadbloonBadge=t.bossBadgesNormal.Dreadbloon||0,f.VortexEliteBadge=t.bossBadgesElite.Vortex||0,f.VortexBadge=t.bossBadgesNormal.Vortex||0,f.LychEliteBadge=t.bossBadgesElite.Lych||0,f.LychBadge=t.bossBadgesNormal.Lych||0,f.BloonariusEliteBadge=t.bossBadgesElite.Bloonarius||0,f.BloonariusBadge=t.bossBadgesNormal.Bloonarius||0,f.MedalEventBronzeMedal=t._medalsRace.Bronze||0,f.MedalEventSilverMedal=t._medalsRace.Silver||0,f.MedalEventDoubleSilverMedal=t._medalsRace.DoubleSilver||0,f.MedalEventGoldSilverMedal=t._medalsRace.GoldSilver||0,f.MedalEventDoubleGoldMedal=t._medalsRace.DoubleGold||0,f.MedalEventGoldDiamondMedal=t._medalsRace.GoldDiamond||0,f.MedalEventBlueDiamondMedal=t._medalsRace.BlueDiamond||0,f.MedalEventRedDiamondMedal=t._medalsRace.RedDiamond||0,f.MedalEventBlackDiamondMedal=t._medalsRace.BlackDiamond||0,f.OdysseyStarIcon=t.gameplay.totalOdysseyStars||0,f.BossMedalEventBronzeMedal=t._medalsBoss.Bronze||0,f.BossMedalEventSilverMedal=t._medalsBoss.Silver||0,f.BossMedalEventDoubleSilverMedal=t._medalsBoss.DoubleSilver||0,f.BossMedalEventGoldSilverMedal=t._medalsBoss.GoldSilver||0,f.BossMedalEventDoubleGoldMedal=t._medalsBoss.DoubleGold||0,f.BossMedalEventGoldDiamondMedal=t._medalsBoss.GoldDiamond||0,f.BossMedalEventBlueDiamondMedal=t._medalsBoss.BlueDiamond||0,f.BossMedalEventRedDiamondMedal=t._medalsBoss.RedDiamond||0,f.BossMedalEventBlackDiamondMedal=t._medalsBoss.BlackDiamond||0,f.EliteBossMedalEventBronzeMedal=t._medalsBossElite.Bronze||0,f.EliteBossMedalEventSilverMedal=t._medalsBossElite.Silver||0,f.EliteBossMedalEventDoubleSilverMedal=t._medalsBossElite.DoubleSilver||0,f.EliteBossMedalEventGoldSilverMedal=t._medalsBossElite.GoldSilver||0,f.EliteBossMedalEventDoubleGoldMedal=t._medalsBossElite.DoubleGold||0,f.EliteBossMedalEventGoldDiamondMedal=t._medalsBossElite.GoldDiamond||0,f.EliteBossMedalEventBlueDiamondMedal=t._medalsBossElite.BlueDiamond||0,f.EliteBossMedalEventRedDiamondMedal=t._medalsBossElite.RedDiamond||0,f.EliteBossMedalEventBlackDiamondMedal=t._medalsBossElite.BlackDiamond||0,f.CtLocalPlayerBronzeMedal=t._medalsCTLocal.Bronze||0,f.CtLocalPlayerSilverMedal=t._medalsCTLocal.Silver||0,f.CtLocalPlayerDoubleGoldMedal=t._medalsCTLocal.DoubleGold||0,f.CtLocalPlayerGoldDiamondMedal=t._medalsCTLocal.GoldDiamond||0,f.CtLocalPlayerBlueDiamondMedal=t._medalsCTLocal.BlueDiamond||0,f.CtLocalPlayerRedDiamondMedal=t._medalsCTLocal.RedDiamond||0,f.CtLocalPlayerBlackDiamondMedal=t._medalsCTLocal.BlackDiamond||0,f.CtGlobalPlayerBronzeMedal=t._medalsCTGlobal.Bronze||0,f.CtGlobalPlayerSilverMedal=t._medalsCTGlobal.Silver||0,f.CtGlobalPlayerDoubleSilverMedal=t._medalsCTGlobal.DoubleSilver||0,f.CtGlobalPlayerGoldSilverMedal=t._medalsCTGlobal.GoldSilver||0,f.CtGlobalPlayerDoubleGoldMedal=t._medalsCTGlobal.DoubleGold||0,f.CtGlobalPlayerGoldDiamondMedal=t._medalsCTGlobal.GoldDiamond||0,f.CtGlobalPlayerDiamondMedal=t._medalsCTGlobal.Diamond||0;let w=document.createElement("div");w.classList.add("currency-medals-div"),L.appendChild(w);let E=document.createElement("div");E.classList.add("medals-div"),w.appendChild(E);for(let[e,t]of Object.entries(f)){if(0===t)continue;let a=document.createElement("div");a.classList.add("medal-div"),a.title=constants.medalLabels[e],E.appendChild(a);let n=document.createElement("img");n.classList.add("medal-img"),n.src=getMedalIcon(e),n.style.display="none",n.addEventListener("load",(()=>{n.width<n.height?n.style.width=`${ratioCalc(3,70,256,0,n.width)}px`:n.style.height=`${ratioCalc(3,70,256,0,n.height)}px`,n.style.removeProperty("display")})),a.appendChild(n);let s=document.createElement("p");s.classList.add("medal-text","black-outline"),s.innerHTML=t.toLocaleString(),a.appendChild(s),tippy(a,{content:constants.medalLabels[e],placement:"top",theme:"speech_bubble"})}let k=document.createElement("div");k.classList.add("top-heroes-monkeys-div"),L.appendChild(k);let T=document.createElement("div");T.classList.add("top-heroes-div"),k.appendChild(T);let M=document.createElement("div");M.classList.add("top-heroes-top-div"),T.appendChild(M);let S=document.createElement("div");S.classList.add("top-heroes-top-ribbon-div"),M.appendChild(S);let I=document.createElement("p");I.classList.add("top-heroes-text","black-outline"),I.innerHTML="Top Heroes",S.appendChild(I);let x=document.createElement("div");x.classList.add("maps-progress-coop-toggle"),M.appendChild(x);let B=document.createElement("p");B.classList.add("maps-progress-coop-toggle-text","black-outline"),B.innerHTML="Show All: ",x.appendChild(B);let A=document.createElement("input");A.classList.add("maps-progress-coop-toggle-input"),A.type="checkbox",x.appendChild(A);let D=document.createElement("div");D.classList.add("top-heroes-list"),T.appendChild(D);let P=document.createElement("div");P.classList.add("top-3-heroes-div"),D.appendChild(P);let H=document.createElement("div");H.classList.add("other-heroes-div"),H.style.display="none",D.appendChild(H),A.addEventListener("change",(()=>{A.checked?H.style.display="flex":H.style.display="none"}));let O=0,R=Object.keys(constants.heroesInOrder);for(let[e,a]of Object.entries(t.heroesPlaced).sort(((e,t)=>t[1]-e[1]))){if(0===a)continue;if(!R.includes(e))continue;let t=document.createElement("div");t.classList.add("hero-div"),O<3?P.appendChild(t):H.appendChild(t);let n=document.createElement("img");n.classList.add("hero-img"),n.src=getHeroPortrait(e,1),n.style.display="none",n.addEventListener("load",(()=>{n.width<n.height?n.style.width=`${ratioCalc(3,150,1920,0,n.width)}px`:n.style.height=`${ratioCalc(3,150,1920,0,n.height)}px`,n.style.removeProperty("display")})),t.appendChild(n);let s=document.createElement("p");s.classList.add("hero-text","black-outline"),s.innerHTML=a.toLocaleString(),t.appendChild(s),O++,tippy(t,{content:`${getLocValue(e)} Placed ${a.toLocaleString()} Times`,placement:"top",theme:"speech_bubble"})}let F=document.createElement("div");F.classList.add("top-heroes-div"),k.appendChild(F);let $=document.createElement("div");$.classList.add("top-heroes-top-div"),F.appendChild($);let U=document.createElement("div");U.classList.add("top-heroes-top-ribbon-div"),$.appendChild(U);let N=document.createElement("p");N.classList.add("top-heroes-text","black-outline"),N.innerHTML="Top Towers",U.appendChild(N);let j=document.createElement("div");j.classList.add("maps-progress-coop-toggle"),$.appendChild(j);let G=document.createElement("p");G.classList.add("maps-progress-coop-toggle-text","black-outline"),G.innerHTML="Show All: ",j.appendChild(G);let V=document.createElement("input");V.classList.add("maps-progress-coop-toggle-input"),V.type="checkbox",j.appendChild(V);let _=document.createElement("div");_.classList.add("top-heroes-list"),F.appendChild(_);let q=document.createElement("div");q.classList.add("top-3-heroes-div"),_.appendChild(q);let K=document.createElement("div");K.classList.add("other-heroes-div"),K.style.display="none",_.appendChild(K),V.addEventListener("change",(()=>{V.checked?K.style.display="flex":K.style.display="none"})),O=0;let z=Object.keys(constants.towersInOrder);for(let[e,a]of Object.entries(t.towersPlaced).sort(((e,t)=>t[1]-e[1]))){if(0===a)continue;if(!z.includes(e))continue;let t=document.createElement("div");t.classList.add("hero-div"),O<3?q.appendChild(t):K.appendChild(t);let n=document.createElement("img");n.classList.add("hero-img"),n.src=getInstaContainerIcon(e,"000"),t.appendChild(n);let s=document.createElement("p");s.classList.add("hero-text","black-outline"),s.innerHTML=a.toLocaleString(),t.appendChild(s),O++,tippy(t,{content:`${getLocValue(e)} Placed ${a.toLocaleString()} Times`,placement:"top",theme:"speech_bubble"})}let J=document.createElement("div");J.classList.add("top-heroes-div"),Object.entries(t.stats.paragonsPurchasedByName).length>0&&k.appendChild(J);let W=document.createElement("div");W.classList.add("top-heroes-top-div"),J.appendChild(W);let Q=document.createElement("div");Q.classList.add("top-heroes-top-ribbon-div"),Q.style.filter="hue-rotate(250deg)",W.appendChild(Q);let Y=document.createElement("p");Y.classList.add("top-heroes-text","black-outline"),Y.innerHTML="Top Paragons",Q.appendChild(Y);let Z=document.createElement("div");Z.classList.add("maps-progress-coop-toggle"),W.appendChild(Z);let X=document.createElement("p");X.classList.add("maps-progress-coop-toggle-text","black-outline"),X.innerHTML="Show All: ",Z.appendChild(X);let ee=document.createElement("input");ee.classList.add("maps-progress-coop-toggle-input"),ee.type="checkbox",Z.appendChild(ee);let te=document.createElement("div");te.classList.add("top-heroes-list"),J.appendChild(te);let ae=document.createElement("div");ae.classList.add("top-3-heroes-div"),te.appendChild(ae);let ne=document.createElement("div");ne.classList.add("other-heroes-div"),ne.style.display="none",te.appendChild(ne),ee.addEventListener("change",(()=>{ee.checked?ne.style.display="flex":ne.style.display="none"})),O=0;for(let[e,a]of Object.entries(t.stats.paragonsPurchasedByName).sort(((e,t)=>t[1]-e[1]))){if(0===a)continue;if(!constants.paragonsAvailable.includes(e))continue;let t=document.createElement("div");t.classList.add("hero-div"),t.style.backgroundImage="url(../Assets/UI/ParagonContainer.webp)",O<3?ae.appendChild(t):ne.appendChild(t);let n=document.createElement("img");n.classList.add("hero-img"),n.src=getTowerAssetPath(e,"Paragon"),t.appendChild(n);let s=document.createElement("p");s.classList.add("hero-text","black-outline"),s.innerHTML=a.toLocaleString(),t.appendChild(s),O++,tippy(t,{content:`${getLocValue(e+" Paragon")} Placed ${a.toLocaleString()} Times`,placement:"top",theme:"speech_bubble"})}let se=document.createElement("div");se.classList.add("right-column-div"),b.appendChild(se);let le=document.createElement("div");le.classList.add("overview-right-column-header"),se.appendChild(le);let de=document.createElement("p");de.classList.add("column-header-text","black-outline"),de.innerHTML="Overall Stats",le.appendChild(de);let re={};re["Games Played"]=t.gameplay.gameCount,re["Games Won"]=t.gameplay.gamesWon,re["Highest Round (All Time)"]=t.gameplay.highestRound,re["Highest Round (CHIMPS)"]=t.gameplay.highestRoundCHIMPS,re["Highest Round (Deflation)"]=t.gameplay.highestRoundDeflation,re["Monkeys Placed"]=t.gameplay.monkeysPlaced,re["Total Pop Count"]=t.bloonsPopped.bloonsPopped,re["Total Co-Op Pop Count"]=t.bloonsPopped.coopBloonsPopped,re["Camo Bloons Popped"]=t.bloonsPopped.camosPopped,re["Lead Bloons Popped"]=t.bloonsPopped.leadsPopped,re["Purple Bloons Popped"]=t.bloonsPopped.purplesPopped,re["Regrow Bloons Popped"]=t.bloonsPopped.regrowsPopped,re["Ceramic Bloons Popped"]=t.bloonsPopped.ceramicsPopped,re["MOABs Popped"]=t.bloonsPopped.moabsPopped,re["BFBs Popped"]=t.bloonsPopped.bfbsPopped,re["ZOMGs Popped"]=t.bloonsPopped.zomgsPopped,re["DDTs Popped"]=t.bloonsPopped.ddtsPopped,re["BADs Popped"]=t.bloonsPopped.badsPopped,re["Bloons Leaked"]=t.bloonsPopped.bloonsLeaked,re["Cash Generated"]=t.gameplay.cashEarned,re["Cash Gifted"]=t.gameplay.coopCashGiven,re["Abilities Used"]=t.gameplay.abilitiesUsed,re["Powers Used"]=t.gameplay.powersUsed,re["Insta Monkeys Used"]=t.gameplay.instaMonkeysUsed,re["Daily Reward Chests Opened"]=t.gameplay.dailyRewards,re["Challenges Completed"]=t.gameplay.challengesCompleted,re.Achievements=`${t.achievements}/${constants.achievements+constants.hiddenAchievements}`,re["Odysseys Completed"]=t.gameplay.totalOdysseysCompleted,re["Lifetime Trophies"]=t.gameplay.totalTrophiesEarned,re["Necro Bloons Reanimated"]=t.bloonsPopped.necroBloonsReanimated,re["Transforming Tonics Used"]=t.bloonsPopped.transformingTonicsUsed,re["Most Experienced Monkey"]=getLocValue(t.mostExperiencedMonkey),re["Insta Monkey Collection"]=`${t.gameplay.instaMonkeyCollection}/${constants.totalInstaMonkeys}`,re["Collection Chests Opened"]=t.gameplay.collectionChestsOpened,re["Golden Bloons Popped"]=t.bloonsPopped.goldenBloonsPopped,re["Monkey Teams Wins"]=t.gameplay.monkeyTeamsWins,re["Bosses Popped"]=t.bloonsPopped.bossesPopped,re["Damage Done To Bosses"]=t.gameplay.damageDoneToBosses;let ie=document.createElement("div");ie.classList.add("profile-stats"),se.appendChild(ie);for(let[e,t]of Object.entries(re)){let a=document.createElement("div");a.classList.add("stat"),ie.appendChild(a);let n=document.createElement("p");n.classList.add("stat-name"),n.innerHTML=e,a.appendChild(n);let s=document.createElement("p");s.classList.add("stat-value"),s.innerHTML=t.toLocaleString(),a.appendChild(s)}let oe={};oe["Contested Territory Tiles Captured"]=t.stats.ctCapturedTiles,oe["Towers Sold"]=t.stats.totalTowersSold,oe["Total Tier 1 Upgrades"]=t.stats.upgradesPurchasedByTier[1],oe["Total Tier 2 Upgrades"]=t.stats.upgradesPurchasedByTier[2],oe["Total Tier 3 Upgrades"]=t.stats.upgradesPurchasedByTier[3],oe["Total Tier 4 Upgrades"]=t.stats.upgradesPurchasedByTier[4],oe["Total Tier 5 Upgrades"]=t.stats.upgradesPurchasedByTier[5];let ce=document.createElement("div");ce.classList.add("profile-stats"),se.appendChild(ce);let pe=document.createElement("div");pe.classList.add("overview-right-column-header"),ce.appendChild(pe);let me=document.createElement("p");me.classList.add("column-header-text","black-outline"),me.innerHTML="API Exclusive Stats",pe.appendChild(me);for(let[e,t]of Object.entries(oe)){if(null==t)continue;let a=document.createElement("div");a.classList.add("stat"),ce.appendChild(a);let n=document.createElement("p");n.classList.add("stat-name"),n.innerHTML=e,a.appendChild(n);let s=document.createElement("p");s.classList.add("stat-value"),s.innerHTML=t.toLocaleString(),a.appendChild(s)}}async function generateLeaderboards(){showLoading();let e=document.getElementById("leaderboards-content");e.innerHTML="";let t=document.createElement("div");t.classList.add("leaderboard-page","page-extra","fd-column","ai-center"),t.style.display="none",e.appendChild(t);let a=document.createElement("p");a.classList.add("hero-progress-header-text","leaderboards-header-text"),a.style.backgroundImage="url('../Assets/UI/BlueTxtTextureMain.webp')",a.innerHTML="Active Events",t.appendChild(a);let n=document.createElement("div");n.classList.add("selectors-div"),t.appendChild(n);let s=document.createElement("p");s.classList.add("hero-progress-header-text","leaderboards-header-text"),s.innerHTML="Finished Events",t.appendChild(s);let l=document.createElement("div");l.id="maps-progress-views",l.classList.add("maps-progress-views"),t.appendChild(l);let d=document.createElement("p");d.classList.add("maps-progress-coop-toggle-text","black-outline"),d.innerHTML="Filter:",l.appendChild(d);let r=document.createElement("div");r.classList.add("maps-progress-view","black-outline","stats-tab-yellow"),r.innerHTML="All",r.addEventListener("click",(()=>{r.classList.add("stats-tab-yellow"),i.classList.remove("stats-tab-yellow"),o.classList.remove("stats-tab-yellow"),c.classList.remove("stats-tab-yellow"),onChangeEventFilter("all")})),l.appendChild(r);let i=document.createElement("div");i.classList.add("maps-progress-view","black-outline"),i.innerHTML="Race",i.addEventListener("click",(()=>{r.classList.remove("stats-tab-yellow"),i.classList.add("stats-tab-yellow"),o.classList.remove("stats-tab-yellow"),c.classList.remove("stats-tab-yellow"),onChangeEventFilter("race")})),l.appendChild(i);let o=document.createElement("div");o.classList.add("maps-progress-view","black-outline"),o.innerHTML="Boss",o.addEventListener("click",(()=>{r.classList.remove("stats-tab-yellow"),i.classList.remove("stats-tab-yellow"),o.classList.add("stats-tab-yellow"),c.classList.remove("stats-tab-yellow"),onChangeEventFilter("boss")})),l.appendChild(o);let c=document.createElement("div");c.classList.add("maps-progress-view","black-outline"),c.innerHTML="Contested Territory",c.addEventListener("click",(()=>{r.classList.remove("stats-tab-yellow"),i.classList.remove("stats-tab-yellow"),o.classList.remove("stats-tab-yellow"),c.classList.add("stats-tab-yellow"),onChangeEventFilter("ct")})),l.appendChild(c);let p=document.createElement("div");p.id="leaderboard-selectors",p.classList.add("selectors-div"),t.appendChild(p);let m=[],u=new Date;clearAllTimers();let h=[];isStale(racesDataCachedAt)&&h.push(fetchData("https://data.ninjakiwi.com/btd6/races",(e=>{racesData=e.body,racesDataCachedAt=Date.now()}))),isStale(bossesDataCachedAt)&&h.push(fetchData("https://data.ninjakiwi.com/btd6/bosses",(e=>{bossesData=e.body,bossesDataCachedAt=Date.now()}))),isStale(CTDataCachedAt)&&h.push(fetchData("https://data.ninjakiwi.com/btd6/ct",(e=>{CTData=e.body,CTDataCachedAt=Date.now()}))),await Promise.all(h).then((()=>{t.style.display="flex",hideLoading()})),racesData.forEach((e=>{let t=document.createElement("div");t.classList.add("roundset-selector-div"),u>new Date(e.start)&&u<new Date(e.end)?n.appendChild(t):m.push([e,t,e.totalScores]),t.addEventListener("click",(()=>{showLeaderboard("leaderboards",e,"Race")}));let a=document.createElement("img");a.classList.add("roundset-selector-img"),t.appendChild(a),a.src="../Assets/UI/EventRaceBtn.webp",t.classList.add("race-roundset");let s=document.createElement("div");s.classList.add("roundset-selector-text-div","d-flex","fd-column","ai-center"),t.appendChild(s);let l=document.createElement("p");l.classList.add("selector-text","black-outline"),l.innerHTML=`${e.name}`,s.appendChild(l);let d=document.createElement("p");d.id="time-left-"+e.name,d.classList.add("selector-text","black-outline"),s.appendChild(d),new Date<new Date(e.start)?d.innerHTML="Coming Soon!":new Date(e.end)>new Date?registerTimer(d.id,new Date(e.end)):d.innerHTML=`${new Date(e.start).toLocaleDateString()} - ${new Date(e.end).toLocaleDateString()}`;let r=document.createElement("p");r.innerHTML=`Total Scores: ${e.totalScores}`,r.classList.add("selector-text","black-outline"),s.appendChild(r);let i=document.createElement("img");i.classList.add("selector-go-img"),i.src="../Assets/UI/EventLeaderboardBtn.webp",t.appendChild(i)})),bossesData.forEach((e=>{let t=`${e.bossType.toLowerCase().replace(/\b\w/g,(e=>e.toUpperCase()))} ${e.name.replace(/\D/g,"")}`,a=document.createElement("div");a.classList.add("roundset-selector-div"),u>new Date(e.start)&&u<new Date(e.end)?n.appendChild(a):m.push([e,a,e.totalScores_standard]),a.addEventListener("click",(()=>{showLeaderboard("leaderboards",e,"Boss")}));let s=document.createElement("img");s.classList.add("roundset-selector-img"),a.appendChild(s),s.src=`../Assets/BossIcon/${e.bossType[0].toUpperCase()+e.bossType.slice(1)}EventIcon.webp`,a.style.backgroundImage=`url(../Assets/EventBanner/EventBannerSmall${e.bossType[0].toUpperCase()+e.bossType.slice(1)}.webp)`,a.classList.add("boss-roundset");let l=document.createElement("div");l.classList.add("roundset-selector-text-div","d-flex","fd-column","ai-center"),a.appendChild(l);let d=document.createElement("p");d.classList.add("selector-text","black-outline"),d.innerHTML=`${t}`,l.appendChild(d);let r=document.createElement("p");r.id="time-left-"+t,r.classList.add("selector-text","black-outline"),l.appendChild(r),new Date<new Date(e.start)?r.innerHTML="Coming Soon!":new Date(e.end)>new Date?registerTimer(r.id,new Date(e.end)):r.innerHTML=`${new Date(e.start).toLocaleDateString()} - ${new Date(e.end).toLocaleDateString()}`;let i=document.createElement("p");i.innerHTML=`Total Scores: ${e.totalScores_standard}`,i.classList.add("selector-text","black-outline"),l.appendChild(i);let o=document.createElement("img");o.classList.add("selector-go-img"),o.src="../Assets/UI/EventLeaderboardBtn.webp",a.appendChild(o)})),bossesData.forEach((e=>{let t=`Elite ${e.bossType.toLowerCase().replace(/\b\w/g,(e=>e.toUpperCase()))} ${e.name.replace(/\D/g,"")}`,a=document.createElement("div");a.classList.add("roundset-selector-div"),u>new Date(e.start)&&u<new Date(e.end)?n.appendChild(a):m.push([e,a,e.totalScores_elite]),a.addEventListener("click",(()=>{showLeaderboard("leaderboards",e,"BossElite")}));let s=document.createElement("img");s.classList.add("roundset-selector-img"),a.appendChild(s),s.src=`../Assets/BossIcon/Elite${e.bossType[0].toUpperCase()+e.bossType.slice(1)}EventIcon.webp`,a.style.backgroundImage=`url(../Assets/EventBanner/EventBannerSmall${e.bossType[0].toUpperCase()+e.bossType.slice(1)}.webp)`,a.classList.add("boss-roundset");let l=document.createElement("div");l.classList.add("roundset-selector-text-div","d-flex","fd-column","ai-center"),a.appendChild(l);let d=document.createElement("p");d.classList.add("selector-text","black-outline"),d.innerHTML=`${t}`,l.appendChild(d);let r=document.createElement("p");r.id="time-left-"+t,r.classList.add("selector-text","black-outline"),l.appendChild(r),new Date<new Date(e.start)?r.innerHTML="Coming Soon!":new Date(e.end)>new Date?registerTimer(r.id,new Date(e.end)):r.innerHTML=`${new Date(e.start).toLocaleDateString()} - ${new Date(e.end).toLocaleDateString()}`;let i=document.createElement("p");i.innerHTML=`Total Scores: ${e.totalScores_elite}`,i.classList.add("selector-text","black-outline"),l.appendChild(i);let o=document.createElement("img");o.classList.add("selector-go-img"),o.src="../Assets/UI/EventLeaderboardBtn.webp",a.appendChild(o)})),CTData.forEach((e=>{let t=document.createElement("div");t.classList.add("roundset-selector-div"),u>new Date(e.start)&&u<new Date(e.end)?n.appendChild(t):m.push([e,t,e.totalScores_team]),t.addEventListener("click",(()=>{showLeaderboard("leaderboards",e,"CTTeam")}));let a=document.createElement("img");a.classList.add("roundset-selector-img"),t.appendChild(a),a.src="../Assets/UI/ContestedLeaderboardBtn.webp",t.classList.add("ct-leaderboard-btn");let s=document.createElement("div");s.classList.add("roundset-selector-text-div","d-flex","fd-column","ai-center"),t.appendChild(s);let l=document.createElement("p");l.classList.add("selector-text","black-outline"),l.innerHTML="Contested Territory - Teams",s.appendChild(l);let d=document.createElement("p");d.id="time-left-"+e.id+"-teams",d.classList.add("selector-text","black-outline"),s.appendChild(d),new Date<new Date(e.start)?d.innerHTML="Coming Soon!":new Date(e.end)>new Date?registerTimer(d.id,new Date(e.end)):d.innerHTML=`${new Date(e.start).toLocaleDateString()} - ${new Date(e.end).toLocaleDateString()}`;let r=document.createElement("p");r.innerHTML=`Total Scores: ${e.totalScores_team}`,r.classList.add("selector-text","black-outline"),s.appendChild(r);let i=document.createElement("img");i.classList.add("selector-go-img"),i.src="../Assets/UI/EventLeaderboardBtn.webp",t.appendChild(i)})),CTData.forEach((e=>{let t=document.createElement("div");t.classList.add("roundset-selector-div"),u>new Date(e.start)&&u<new Date(e.end)?n.appendChild(t):m.push([e,t,e.totalScores_player]),t.addEventListener("click",(()=>{showLeaderboard("leaderboards",e,"CTPlayer")}));let a=document.createElement("img");a.classList.add("roundset-selector-img"),t.appendChild(a),a.src="../Assets/UI/ContestedTerritoryEventBtn.webp",t.classList.add("ct-leaderboard-btn");let s=document.createElement("div");s.classList.add("roundset-selector-text-div","d-flex","fd-column","ai-center"),t.appendChild(s);let l=document.createElement("p");l.classList.add("selector-text","black-outline"),l.innerHTML="Contested Territory - Players",s.appendChild(l);let d=document.createElement("p");d.id="time-left-"+e.id,d.classList.add("selector-text","black-outline"),s.appendChild(d),new Date<new Date(e.start)?d.innerHTML="Coming Soon!":new Date(e.end)>new Date?registerTimer(d.id,new Date(e.end)):d.innerHTML=`${new Date(e.start).toLocaleDateString()} - ${new Date(e.end).toLocaleDateString()}`;let r=document.createElement("p");r.innerHTML=`Total Scores: ${e.totalScores_player}`,r.classList.add("selector-text","black-outline"),s.appendChild(r);let i=document.createElement("img");i.classList.add("selector-go-img"),i.src="../Assets/UI/EventLeaderboardBtn.webp",t.appendChild(i)})),m.sort(((e,t)=>new Date(t[0].end)-new Date(e[0].end))),m.forEach((([e,t,a])=>{u<new Date(e.start)||0!=a&&p.appendChild(t)})),0==n.childNodes.length&&(a.style.display="none",n.style.display="none")}function onChangeEventFilter(e){let t=document.getElementById("leaderboard-selectors");switch(e){case"race":t.childNodes.forEach((e=>{e.classList.contains("race-roundset")?e.style.display="flex":e.style.display="none"}));break;case"boss":t.childNodes.forEach((e=>{e.classList.contains("boss-roundset")?e.style.display="flex":e.style.display="none"}));break;case"ct":t.childNodes.forEach((e=>{e.classList.contains("ct-leaderboard-btn")?e.style.display="flex":e.style.display="none"}));break;default:t.childNodes.forEach((e=>{e.style.display="flex"}))}}function showLeaderboard(e,t,a){switch(showLoading(!0),leaderboardActiveToken++,a){case"Boss":leaderboardLink!=t.leaderboard_standard_players_1&&(leaderboardPage=1),leaderboardLink=t.leaderboard_standard_players_1;break;case"BossElite":leaderboardLink!=t.leaderboard_elite_players_1&&(leaderboardPage=1),leaderboardLink=t.leaderboard_elite_players_1;break;case"CTPlayer":leaderboardLink!=t.leaderboard_player&&(leaderboardPage=1),leaderboardLink=t.leaderboard_player;break;case"CTTeam":leaderboardLink!=t.leaderboard_team&&(leaderboardPage=1),leaderboardLink=t.leaderboard_team;break;default:leaderboardLink!=t.leaderboard&&(leaderboardPage=1),leaderboardLink=t.leaderboard}let n=document.getElementById("leaderboard-content");n.style.display="flex",n.innerHTML="",document.getElementById(`${e}-content`).style.display="none",addToBackQueue({source:e,destination:"leaderboard",callback:()=>{leaderboardLink=null,leaderboardActiveToken++}});let s=document.createElement("div");s.classList.add("full-leaderboard-div"),n.appendChild(s);let l=document.createElement("div");l.classList.add("leaderboard-top"),s.appendChild(l);let d=document.createElement("div");d.classList.add("leaderboard-header"),l.appendChild(d);let r=document.createElement("div");r.classList.add("leaderboard-header-left"),d.appendChild(r);let i=document.createElement("img");i.classList.add("modal-close"),i.src="./Assets/UI/CloseBtn.webp",i.addEventListener("click",(()=>{goBack(),leaderboardActiveToken++})),r.appendChild(i);let o=document.createElement("div");o.classList.add(`leaderboard-header-middle-${a.toLowerCase()}`),d.appendChild(o);let c=document.createElement("div");c.classList.add(`leaderboard-header-${a.toLowerCase()}`),o.appendChild(c);let p=document.createElement("p");switch(p.classList.add("leaderboard-header-title-text"),c.appendChild(p),a){case"Race":p.classList.add("black-outline"),p.innerHTML="Race Leaderboard";break;case"Boss":p.classList.add("black-outline"),p.innerHTML="Boss Leaderboard";break;case"BossElite":p.classList.add("black-outline"),p.innerHTML="Elite Boss Leaderboard";break;case"CTPlayer":p.classList.add("ct-text"),p.innerHTML="Contested Territory <br> Player Leaderboard";break;case"CTTeam":p.classList.add("ct-text"),p.innerHTML="Contested Territory <br> Team Leaderboard"}let m=createEl("div",{classList:["d-flex","jc-end"],style:{width:"80px"}});if(d.appendChild(m),new Date(t.end)>new Date){let e=createEl("img",{classList:[],style:{cursor:"pointer",width:"50px",height:"50px"},src:"./Assets/UI/RefreshBtn.webp"});e.addEventListener("click",(()=>{leaderboardLink&&delete leaderboardCache[leaderboardLink],leaderboardActiveToken++,showLoading(),generateLeaderboardEntries(t,a,leaderboardActiveToken)})),m.appendChild(e)}if("Boss"==a||"BossElite"==a){let e=document.createElement("p");e.classList.add("leaderboard-disclaimer","black-outline"),e.innerHTML="Note: Only singleplayer boss leaderboards are available on the API currently.",l.appendChild(e)}let u=document.createElement("div");u.id="leaderboard-column-labels",u.classList.add("leaderboard-column-labels"),l.appendChild(u);let h=document.createElement("div");h.id="leaderboard-entries",h.classList.add("leaderboard-entries"),s.appendChild(h),generateLeaderboardEntries(t,a,leaderboardActiveToken)}async function generateLeaderboardEntries(e,t,a=leaderboardActiveToken){await getAllLeaderboardData(leaderboardLink,a);let n=null;switch(t){case"CTTeam":n="CTTeam";break;case"CTPlayer":n="CTPlayer"}if(e.hasOwnProperty("leaderboard")&&e.leaderboard.includes("races")&&(n="GameTime"),e.hasOwnProperty("bossType"))switch("BossElite"==t?e.eliteScoringType:e.normalScoringType){case"GameTime":n="GameTime";break;case"LeastCash":n="LeastCash";break;case"LeastTiers":n="LeastTiers"}leaderboardMetadata=e,leaderboardType=t,generateLeaderboardHeader(n),document.getElementById("leaderboard-entries").innerHTML="",addLeaderboardEntries(leaderboardCache[leaderboardLink].entries,1,leaderboardCache[leaderboardLink].entries.length)}function addLeaderboardEntries(e,t,a){let n=document.getElementById("leaderboard-entries"),s=leaderboardMetadata,l=leaderboardType;if(e.length>0&&hideLoading(),null!=e)e.forEach(((d,r)=>{let i={};d.hasOwnProperty("scoreParts")&&d.scoreParts.forEach(((e,t)=>{i[e.name]=e}));let o=document.createElement("div");o.classList.add("leaderboard-entry"),"CTTeam"!=l?o.addEventListener("click",(()=>{openProfile("leaderboard",d.profile)})):o.addEventListener("click",(()=>{openTeamModalPopout(d.group)})),n.appendChild(o);let c=document.createElement("div");c.classList.add("leaderboard-entry-div"),o.appendChild(c);let p=document.createElement("p");p.classList.add("leaderboard-entry-rank","black-outline"),p.innerHTML=r+(t-1)*a+1,c.appendChild(p);let m=document.createElement("div");m.classList.add("leaderboard-entry-player"),c.appendChild(m);let u=null,h=null,g=null;"CTTeam"==l?(u=document.createElement("div"),u.classList.add("leaderboard-entry-icon-ct"),m.appendChild(u),h=document.createElement("img"),h.classList.add("leaderboard-entry-frame"),h.src="./Assets/UI/TeamFrame1.webp",u.appendChild(h),g=document.createElement("img"),g.classList.add("leaderboard-entry-emblem"),g.src="./Assets/UI/TeamIcon1.webp",u.appendChild(g)):(u=document.createElement("img"),u.classList.add("leaderboard-entry-icon"),u.src="./Assets/ProfileAvatar/ProfileAvatar01.webp",m.appendChild(u));let b=document.createElement("p");b.classList.add("leaderboard-entry-name","leaderboard-outline"),b.innerHTML=d.displayName,m.appendChild(b);let L=document.createElement("div");L.classList.add("leaderboard-entry-time-submit-div"),c.appendChild(L);let v=document.createElement("div");v.classList.add("leaderboard-entry-score"),c.appendChild(v);let y=document.createElement("img");y.classList.add("leaderboard-entry-score-icon"),y.src="./Assets/UI/StopWatch.webp",v.appendChild(y);let f=document.createElement("p");if(f.classList.add("leaderboard-entry-main-score","leaderboard-outline"),v.appendChild(f),s.hasOwnProperty("leaderboard")&&s.leaderboard.includes("races")){let e=new Date(s.start+i["Time after event start"].score),t=document.createElement("p");t.classList.add("leaderboard-entry-time-submitted","leaderboard-outline"),t.innerHTML=e.toLocaleString(),L.appendChild(t);let a=document.createElement("p");a.classList.add("leaderboard-entry-time-submitted-relative","leaderboard-outline"),a.innerHTML=relativeTime(new Date,e),L.appendChild(a),f.innerHTML=formatScoreTime(d.score)}if(s.hasOwnProperty("bossType"))switch("BossElite"==l?s.eliteScoringType:s.normalScoringType){case"GameTime":let e=new Date(s.start+i["Game Time"].score),t=document.createElement("p");t.classList.add("leaderboard-entry-time-submitted","leaderboard-outline"),t.innerHTML=e.toLocaleString(),L.appendChild(t);let a=document.createElement("p");a.classList.add("leaderboard-entry-time-submitted-relative","leaderboard-outline"),a.innerHTML=relativeTime(new Date,e),L.appendChild(a),f.innerHTML=formatScoreTime(i["Least Cash"].score);break;case"LeastCash":f.innerHTML=i["Least Cash"].score.toLocaleString(),y.src="./Assets/UI/LeastCashIconSmall.webp",y.classList.add("leaderboard-entry-score-icon-large");let n=document.createElement("div");n.classList.add("leaderboard-entry-game-time"),c.appendChild(n);let l=document.createElement("img");l.classList.add("leaderboard-entry-score-icon"),l.src="./Assets/UI/StopWatch.webp",n.appendChild(l);let d=document.createElement("p");d.classList.add("leaderboard-entry-game-time-value","leaderboard-outline"),d.innerHTML=formatScoreTime(i["Game Time"].score),n.appendChild(d);break;case"LeastTiers":f.innerHTML=i["Tier Count"].score.toLocaleString(),y.src="./Assets/UI/LeastTiersIconSmall.webp",y.classList.add("leaderboard-entry-score-icon-large");let r=document.createElement("div");r.classList.add("leaderboard-entry-game-time"),c.appendChild(r);let o=document.createElement("img");o.classList.add("leaderboard-entry-score-icon"),o.src="./Assets/UI/StopWatch.webp",r.appendChild(o);let p=document.createElement("p");p.classList.add("leaderboard-entry-game-time-value","leaderboard-outline"),p.innerHTML=formatScoreTime(i["Game Time"].score),r.appendChild(p),v.classList.add("leaderboard-entry-score-tiers")}if(s.hasOwnProperty("tiles")&&(y.src="./Assets/UI/CtPointsIconSmall.webp",y.classList.add("leaderboard-entry-score-icon-large"),f.innerHTML=d.score.toLocaleString(),m.classList.add("leaderboard-entry-team")),!preventRateLimiting){new IntersectionObserver(((s,l)=>{s.forEach((async s=>{if(s.isIntersecting){if(e.length==r+1)if(null!=leaderboardCache[leaderboardLink].next){if(0==n.getElementsByClassName("loading-text-leaderboard").length){let e=createEl("p",{classList:["loading-text-leaderboard","black-outline"],style:{fontSize:"32px",paddingBottom:"50px"},innerHTML:"Loading more entries..."});n.appendChild(e)}clearProfileRequestQueue(),getLeaderboardPage(leaderboardCache[leaderboardLink].next,leaderboardActiveToken),leaderboardCache[leaderboardLink].nextRequested=!0}else if(!leaderboardCache[leaderboardLink].ended){leaderboardCache[leaderboardLink].ended=!0;let e=createEl("p",{classList:["black-outline"],style:{fontSize:"32px",paddingBottom:"50px"},innerHTML:"End of Leaderboard"});n.appendChild(e)}1==t&&r+(t-1)*a+1<=50&&addRequestToQueue(d.profile,(async()=>{try{let e=await getUserProfile(d.profile);null!=e&&(e.hasOwnProperty("owner")?(h.src=e.frameURL,g.src=e.iconURL,c.style.backgroundImage=`url(${getProfileBanner(e)})`):(u.src=getProfileAvatar(e),c.style.backgroundImage=`url(${getProfileBanner(e)})`),l.unobserve(s.target))}catch(e){console.error("Error fetching user profile:",e)}}))}else removeRequestFromQueue(d.profile)}))})).observe(u)}if(null!=profileCache[d.profile.split("/").pop()]){let e=profileCache[d.profile.split("/").pop()];e.hasOwnProperty("owner")?(h.src=e.frameURL,g.src=e.iconURL,c.style.backgroundImage=`url(${getProfileBanner(e)})`):(u.src=getProfileAvatar(e),c.style.backgroundImage=`url(${getProfileBanner(e)})`)}})),Array.from(n.getElementsByClassName("loading-text-leaderboard")).forEach((e=>{e.remove()}));else{let e=document.createElement("p");e.classList.add("no-data-found","black-outline"),e.style.width="250px",e.innerHTML="No Data Found",n.appendChild(e)}}function generateLeaderboardHeader(e){let t=document.getElementById("leaderboard-column-labels");t.innerHTML="";let a=document.createElement("p");a.classList.add("leaderboard-column-rank","black-outline"),a.innerHTML="Rank",t.appendChild(a);let n=document.createElement("p");switch(n.classList.add("leaderboard-column-name","black-outline"),n.innerHTML="Player",t.appendChild(n),e){case"GameTime":let e=document.createElement("p");e.classList.add("leaderboard-column-time-submitted","black-outline"),e.innerHTML="Time Submitted",t.appendChild(e);let a=document.createElement("p");a.classList.add("leaderboard-column-time-score","black-outline"),a.innerHTML="Game Time",t.appendChild(a);break;case"LeastCash":let s=document.createElement("p");s.classList.add("leaderboard-column-cash-spent","black-outline"),s.innerHTML="Cash Spent",t.appendChild(s);let l=document.createElement("p");l.classList.add("leaderboard-column-time-score","black-outline"),l.innerHTML="Game Time",t.appendChild(l);break;case"LeastTiers":let d=document.createElement("p");d.classList.add("leaderboard-column-tiers-used","black-outline"),d.innerHTML="Tiers Used",t.appendChild(d);let r=document.createElement("p");r.classList.add("leaderboard-column-time-score","black-outline"),r.innerHTML="Game Time",t.appendChild(r);break;case"CTTeam":n.innerHTML="Team";case"CTPlayer":let i=document.createElement("p");i.classList.add("leaderboard-column-ct-points","black-outline"),i.innerHTML="CT Points",t.appendChild(i)}}function openTeamModalPopout(e){const t=createEl("div",{classList:["d-flex","jc-center"],style:{padding:"10px 0",minHeight:"550px"}}),a=createEl("div",{classList:[]});t.appendChild(a),createModal({header:"Contested Territory - Team Group",content:t});let n=null;(async()=>{try{n=copyLoadingIcon(t);const s=await fetch(e);if(!s.ok)throw new Error(`Failed to fetch group: ${s.status}`);const l=await s.json();let d=[];if(Array.isArray(l)?d=l:Array.isArray(l.body)?d=l.body:Array.isArray(l?.body?.entries)&&(d=l.body.entries),!d||0===d.length)return a.innerHTML="",void a.appendChild(createEl("p",{classList:["no-data-found","black-outline"],textContent:"No teams found for this group."}));d.sort(((e,t)=>(t.score||0)-(e.score||0)));const r=new Map;if(d.forEach(((t,n)=>{const s=createEl("div",{classList:["d-flex","fd-column"]}),l=createEl("div",{classList:["leaderboard-entry","team-group-entry"]}),d=createEl("div",{classList:["leaderboard-entry-div"]}),i=createEl("img",{src:"./Assets/UI/ArrowHideBtn.webp",style:{width:"40px",height:"40px",cursor:"pointer",transition:"transform .2s"},classList:["team-group-caret"]}),o=createEl("p",{classList:["leaderboard-entry-rank","black-outline"],textContent:n+1}),c=createEl("div",{classList:["team-group-rank-wrap"]});c.appendChild(o);const p=createEl("div",{classList:["leaderboard-entry-player","leaderboard-entry-team"]}),m=createEl("div",{classList:["leaderboard-entry-icon-ct"]}),u=createEl("img",{classList:["leaderboard-entry-frame"],src:"./Assets/UI/TeamFrame1.webp"}),h=createEl("img",{classList:["leaderboard-entry-emblem"],src:"./Assets/UI/TeamIcon1.webp"});m.appendChild(u),m.appendChild(h);const g=createEl("p",{classList:["leaderboard-entry-name","leaderboard-outline"],textContent:t.displayName||"Unknown Team"});p.appendChild(m),p.appendChild(g);const b=createEl("div",{classList:["leaderboard-entry-score"]}),L=createEl("img",{classList:["leaderboard-entry-score-icon","leaderboard-entry-score-icon-large"],src:"./Assets/UI/CtPointsIconSmall.webp"}),v=createEl("p",{classList:["leaderboard-entry-main-score","leaderboard-outline","fg-1","ta-center"],textContent:(t.score||0).toLocaleString()});b.appendChild(L),b.appendChild(v),d.appendChild(c),d.appendChild(p),d.appendChild(b),l.appendChild(d),l.appendChild(i);const y=createEl("div",{classList:["d-flex","ai-center","jc-between"],style:{display:"none",margin:"-10px 60px 0px 20px",border:"6px solid var(--profile-tertiary)",borderTop:"none",borderRadius:"0 0 10px 10px",paddingLeft:"10px",backgroundColor:"var(--profile-primary)"}}),f=createEl("p",{classList:["black-outline","team-group-members"],style:{fontSize:"22px"},innerHTML:'<span class="team-group-members-value">?</span>/15 Members'}),C=createEl("div",{classList:["d-flex","ai-center"],style:{gap:"8px"}}),w=createEl("p",{classList:["black-outline"],style:{fontSize:"22px"},textContent:"Owner:"});C.appendChild(w);const E=createEl("div",{classList:["challenge-creator","team-owner-block","pointer"],style:{width:"300px"}});C.appendChild(E);const k=createEl("div",{classList:["avatar"]});E.appendChild(k);const T=createEl("img",{classList:["avatar-frame","noSelect"],style:{width:"50px"},src:"../Assets/UI/InstaTowersContainer.webp"});k.appendChild(T);const M=createEl("img",{classList:["avatar-img","noSelect"],style:{width:"50px"},src:"../Assets/ProfileAvatar/ProfileAvatar01.webp"});k.appendChild(M);const S=createEl("p",{classList:["black-outline"],textContent:preventRateLimiting?"Click to Load Owner":"Loading..."});E.appendChild(S);const I=createEl("p",{classList:["black-outline"],style:{fontSize:"22px"},innerHTML:'<span class="team-group-status-value">Loading...</span>'});y.appendChild(I),y.appendChild(f),y.appendChild(C),i.addEventListener("click",(a=>{a.stopPropagation();const n="flex"===y.style.display;if(y.style.display=n?"none":"flex",i.style.transform=n?"rotate(0deg)":"rotate(180deg)",!n){const a=r.get(t.profile);a&&!a.ownerLoaded&&a.teamProfile&&function(e,t){if(!e.teamProfile||!e.teamProfile.owner)return void(e.ownerName.textContent="No Owner");const a=e.teamProfile.owner,n=async()=>{e.ownerName.textContent="Loading...";try{const n=a.split("/").pop(),s=profileCache[n],l=s||await getUserProfile(a);if(!l)return void(e.ownerName.textContent="Click to Load Owner");e.ownerName.textContent=l.displayName,e.ownerImg.src=getProfileAvatar(l),e.ownerBlock.style.backgroundImage=`linear-gradient(to right, transparent 80%, var(--profile-secondary) 100%),url(${getProfileBanner(l)})`,e.ownerBlock.onclick=()=>{goBack(),openProfile("leaderboard",a,(()=>openTeamModalPopout(t)))},e.ownerLoaded=!0}catch{e.ownerName.textContent="Error Loading Owner"}};preventRateLimiting?(e.ownerName.textContent="Click to Load Owner",e.ownerBlock.onclick=()=>{e.ownerLoaded||n()}):n()}(a,e)}})),d.addEventListener("click",(()=>i.click())),s.appendChild(l),s.appendChild(y),a.appendChild(s),r.set(t.profile,{entryDiv:d,frameEl:u,emblemEl:h,iconWrap:m,membersSpan:f.querySelector(".team-group-members-value"),statusSpan:I.querySelector(".team-group-status-value"),ownerBlock:E,ownerImg:M,ownerFrame:T,ownerName:S,extra:y,ownerLoaded:!1,teamProfile:null})})),d.length<6)for(let e=d.length;e<6;e++){const t=e+1,n=createEl("div",{classList:["d-flex","fd-column"]}),s=createEl("div",{classList:["leaderboard-entry","team-group-entry","placeholder-entry"]}),l=createEl("div",{classList:["leaderboard-entry-div"],style:{marginRight:"40px"}}),d=createEl("div",{classList:["team-group-rank-wrap"]}),r=createEl("p",{classList:["leaderboard-entry-rank","black-outline"],textContent:t});d.appendChild(r);const i=createEl("div",{classList:["leaderboard-entry-player","leaderboard-entry-team"]}),o=createEl("div",{classList:["leaderboard-entry-icon-ct"]}),c=createEl("img",{classList:["leaderboard-entry-frame"],src:"./Assets/UI/StrikethroughRound.webp"});o.appendChild(c);const p=createEl("p",{classList:["leaderboard-entry-name","leaderboard-outline"],textContent:"Team has no score or no longer exists"});i.appendChild(o),i.appendChild(p);const m=createEl("div",{classList:["leaderboard-entry-score"]}),u=createEl("img",{classList:["leaderboard-entry-score-icon","leaderboard-entry-score-icon-large"],src:"./Assets/UI/CtPointsIconSmall.webp"}),h=createEl("p",{classList:["leaderboard-entry-main-score","leaderboard-outline","fg-1","ta-center"],textContent:"0"});m.appendChild(u),m.appendChild(h),l.appendChild(d),l.appendChild(i),l.appendChild(m),s.appendChild(l),n.appendChild(s),a.appendChild(n)}setTimeout((()=>async function(e,t){const a=preventRateLimiting?1:4;let n=0;async function s(){for(;n<e.length;){const a=e[n++],s=t.get(a.profile);if(s)try{const e=a.profile.split("/").pop(),t=profileCache[e],n=t||await getUserProfile(a.profile);if(!n)continue;if(s.teamProfile=n,n.frameURL&&(s.frameEl.src=n.frameURL),n.iconURL&&(s.emblemEl.src=n.iconURL),null!=n.numMembers&&(s.membersSpan.textContent=n.numMembers),n.status)switch(n.status){case"OPEN":s.statusSpan.textContent="Public";break;case"CLOSED":s.statusSpan.textContent="Invite Only";break;case"FILTERED":s.statusSpan.textContent="Private";break;default:s.statusSpan.textContent=n.status}(n.banner||n.bannerURL)&&(s.entryDiv.style.backgroundImage=`url(${getProfileBanner(n)})`)}catch{}}}await Promise.all(Array.from({length:a},(()=>s())))}(d,r)),20)}catch(e){console.error(e),a.innerHTML="",a.appendChild(createEl("p",{classList:["no-data-found","black-outline"],textContent:"Failed to load team group."}))}finally{n?.remove()}})()}let roundPreviewFilterType,currentRoundsetView="Simple",roundsetProcessed=null,selectedRoundset=null,currentPreviewRound=0,currentIndexInModifiedRounds=0,previewActive=!1,previewModified=null,currentModifiedRounds=[],currentRoundsetEndRound=140,hiddenGroups=[],roundsetFilterSettings={},currentRoundsetData=null,bloonToRounds=new Map,roundsetPreviewButton=null;const BloonTraitBits={Camo:1,Regrow:2,Fortified:4,Lead:8,Purple:16,DDT:32,MOABClass:64};function generateRoundsets(){let e=document.getElementById("rounds-content");e.innerHTML="",clearAllTimers();let t=document.createElement("div");t.classList.add("progress-page"),e.appendChild(t);let a=document.createElement("div");a.classList.add("selectors-div"),t.appendChild(a);let n={},s={};Object.entries(constants.limitedTimeEvents).forEach((([e,t])=>{t.end>Date.now()?n[e]=t:s[e]=t})),Object.entries(n).forEach((([e,t])=>{let n=document.createElement("div");n.classList.add("roundset-selector-div","fd-column"),a.appendChild(n);let s=createEl("div",{classList:["d-flex","jc-between","ai-center","w-100"]});n.appendChild(s);let l=createEl("div",{classList:["d-flex"]});n.appendChild(l);let d=document.createElement("img");switch(d.classList.add("roundset-selector-img"),s.appendChild(d),t.type){case"Race":d.src="../Assets/UI/EventRaceBtn.webp",n.classList.add("race-roundset");break;case"Odyssey":d.src="../Assets/UI/OdysseyEventBtn.webp",n.classList.add("odyssey-roundset");break;case"Boss":d.src=`../Assets/BossIcon/${t.boss[0].toUpperCase()+t.boss.slice(1)}EventIcon.webp`,n.style.backgroundImage=`url(../Assets/EventBanner/EventBannerSmall${t.boss[0].toUpperCase()+t.boss.slice(1)}.webp)`,n.classList.add("boss-roundset")}let r=document.createElement("div");r.classList.add("roundset-selector-text-div","w-100"),s.appendChild(r);let i=document.createElement("p");i.classList.add("selector-text","black-outline"),i.innerHTML=`${t.type} Event - ${e}`,r.appendChild(i);let o=document.createElement("div");o.classList.add("d-flex","jc-center","w-100"),r.appendChild(o);let c=document.createElement("p");if(c.id="time-left-"+e,c.classList.add("selector-text","black-outline"),o.appendChild(c),new Date<new Date(t.start)?c.innerHTML="Coming Soon!":new Date(t.end)>new Date&&registerTimer(c.id,new Date(t.end)),t.roundsets)for(const[e,a]of Object.entries(t.roundsets)){let t=createEl("div",{classList:["maps-progress-view","black-outline","pointer"],style:{filter:"hue-rotate(270deg)",padding:"2px 4px",margin:"0 4px"}});t.innerHTML=a,l.appendChild(t),t.addEventListener("click",(()=>{showLoading(),showRoundsetModel("rounds",e)}))}else{let e=document.createElement("img");e.classList.add("selector-go-img"),e.src="../Assets/UI/ContinueBtn.webp",s.appendChild(e),n.addEventListener("click",(()=>{showLoading(),showRoundsetModel("rounds",t.roundset)}))}}));let l=Object.fromEntries(Object.entries(constants.roundSets).filter((([e,t])=>"normal"===t.type))),d=Object.fromEntries(Object.entries(constants.roundSets).filter((([e,t])=>"boss"===t.type))),r=Object.fromEntries(Object.entries(constants.roundSets).filter((([e,t])=>"legends"===t.type))),i=Object.fromEntries(Object.entries(constants.roundSets).filter((([e,t])=>"quest"===t.type)));Object.entries(l).forEach((([e,t])=>{let n=document.createElement("div");n.classList.add("roundset-selector-div","wood-container"),n.addEventListener("click",(()=>{showLoading(),showRoundsetModel("rounds",e)})),a.appendChild(n);let s=document.createElement("img");s.classList.add("roundset-selector-img"),s.src=`../Assets/UI/${t.icon}.webp`,n.appendChild(s);let l=document.createElement("p");l.classList.add("selector-text","black-outline"),l.innerHTML=t.name,n.appendChild(l);let d=document.createElement("img");d.classList.add("selector-go-img"),d.src="../Assets/UI/ContinueBtn.webp",n.appendChild(d)})),Object.entries(r).forEach((([e,t])=>{let n=document.createElement("div");n.classList.add("roundset-selector-div","veteran-container"),n.addEventListener("click",(()=>{showLoading(),showRoundsetModel("rounds",e)})),a.appendChild(n);let s=document.createElement("img");s.classList.add("roundset-selector-img"),s.src=`../Assets/UI/${t.icon}.webp`,n.appendChild(s);let l=document.createElement("p");l.classList.add("selector-text","black-outline"),l.innerHTML=t.name,n.appendChild(l);let d=document.createElement("img");d.classList.add("selector-go-img"),d.src="../Assets/UI/ContinueBtn.webp",n.appendChild(d)}));let o=document.createElement("p");o.classList.add("other-roundsets-selector-text","black-outline"),o.innerHTML="Boss Custom Rounds",a.appendChild(o);let c=document.createElement("div");c.classList.add("other-roundsets-selector-div"),a.appendChild(c),Object.entries(d).forEach((([e,t])=>{let a=document.createElement("div");a.classList.add("other-roundset-selector-div"),a.addEventListener("click",(()=>{showRoundsetModel("rounds",e)})),c.appendChild(a);let n=document.createElement("img");n.classList.add("other-roundset-selector-img"),n.src=`../Assets/UI/${t.icon}.webp`,a.appendChild(n)}));let p=document.createElement("p");p.classList.add("other-roundsets-selector-text","black-outline"),p.innerHTML="Quest Custom Rounds",a.appendChild(p);let m=document.createElement("div");m.classList.add("other-roundsets-selector-div"),a.appendChild(m),Object.entries(i).forEach((([e,t])=>{let a=document.createElement("div");a.classList.add("other-roundset-selector-div"),a.addEventListener("click",(()=>{showRoundsetModel("rounds",t.roundset?t.roundset:e)})),m.appendChild(a);let n=document.createElement("p");n.classList.add("other-roundset-selector-text","black-outline");let s=e.match(/(Part|Stage)(\d+)/i);!s&&t.part&&(s=[e,"Part",t.part]),null!=s&&(n.innerHTML=`${s[1]} ${s[2]}`,a.appendChild(n));let l=document.createElement("img");l.classList.add("other-roundset-selector-img"),l.src=`../Assets/QuestIcon/${t.icon}.webp`,a.appendChild(l)}));let u=document.createElement("div");u.classList.add("known-previous-events-div"),a.appendChild(u);let h=document.createElement("p");h.classList.add("other-roundsets-selector-text","black-outline"),h.innerHTML="Known Previous Events",u.appendChild(h),Object.entries(s).forEach((([e,t])=>{let n=document.createElement("div");n.classList.add("roundset-selector-div","fd-column"),a.appendChild(n);let s=createEl("div",{classList:["d-flex","jc-between","ai-center","w-100"]});n.appendChild(s);let l=createEl("div",{classList:["d-flex"]});n.appendChild(l);let d=document.createElement("img");switch(d.classList.add("roundset-selector-img"),s.appendChild(d),t.type){case"Race":d.src="../Assets/UI/EventRaceBtn.webp",n.classList.add("race-roundset");break;case"Odyssey":d.src="../Assets/UI/OdysseyEventBtn.webp",n.classList.add("odyssey-roundset");break;case"Boss":d.src=`../Assets/BossIcon/${t.boss[0].toUpperCase()+t.boss.slice(1)}EventIcon.webp`,n.style.backgroundImage=`url(../Assets/EventBanner/EventBannerSmall${t.boss[0].toUpperCase()+t.boss.slice(1)}.webp)`,n.classList.add("boss-roundset")}let r=document.createElement("div");r.classList.add("roundset-selector-text-div"),s.appendChild(r);let i=document.createElement("p");i.classList.add("selector-text","black-outline"),i.innerHTML=`${t.type} Event - ${e}`,r.appendChild(i);let o=document.createElement("div");o.classList.add("d-flex","jc-center","w-100"),r.appendChild(o);let c=document.createElement("p");if(c.id="time-left-"+e,c.classList.add("selector-text","black-outline"),o.appendChild(c),new Date<new Date(t.start)?c.innerHTML="Coming Soon!":new Date(t.end)>new Date?registerTimer(c.id,new Date(t.end)):c.innerHTML=`${new Date(t.start).toLocaleDateString()} - ${new Date(t.end).toLocaleDateString()}`,t.hasOwnProperty("roundsets"))for(const[e,a]of Object.entries(t.roundsets)){let t=createEl("div",{classList:["maps-progress-view","black-outline","pointer"],style:{filter:"hue-rotate(270deg)",padding:"2px 4px",margin:"0 4px"}});t.innerHTML=a,l.appendChild(t),t.addEventListener("click",(()=>{showLoading(),showRoundsetModel("rounds",e)}))}else{let e=document.createElement("img");e.classList.add("selector-go-img"),e.src="../Assets/UI/ContinueBtn.webp",s.appendChild(e),n.addEventListener("click",(()=>{showLoading(),showRoundsetModel("rounds",t.roundset)}))}}));let g=document.createElement("div");g.classList.add("sku-roundset-selector-div"),a.appendChild(g);let b=document.createElement("p");b.classList.add("other-roundsets-selector-text","black-outline"),b.innerHTML="Other Custom Rounds",g.appendChild(b);let L=document.createElement("p");L.classList.add("sku-roundset-selector-desc"),L.innerHTML="These mostly old roundsets will have only been used in one-off events such as Odysseys, Races, or Bosses and may not have ended up being used for their intended purpose despite their name. Take these roundsets with a grain of salt. I'm including them on the viewer for completeness sake.",g.appendChild(L);let v=document.createElement("div");v.classList.add("sku-roundsets-selector-div"),g.appendChild(v),constants.skuRoundsets.forEach((e=>{let t=document.createElement("div");t.classList.add("sku-roundset-selector-div"),t.addEventListener("click",(()=>{showRoundsetModel("rounds",e)})),v.appendChild(t);let a=document.createElement("p");a.classList.add("sku-roundset-selector-text","black-outline"),a.innerHTML=e,t.appendChild(a)}))}async function showRoundsetModel(e,t){roundsetProcessed=null,currentRoundsetData=null,roundsetFilterSettings={roundFilterStart:1,roundFilterEnd:null,roundsetStartingCash:650,roundFilterPreset:"All",roundsetReversed:!1,roundsetHideUnused:!0,roundsetShowModified:!0,roundsetFilteredBloons:[],roundsetAdvancedFilterMode:!1,roundsetBasicFilter:null,roundsetAdvancedFilterLogic:"ANY",roundsetShowHints:!0};let a=document.getElementById("roundsets-content");a.style.display="flex",a.innerHTML="",document.getElementById(`${e}-content`).style.display="none",addToBackQueue({source:e,destination:"roundsets"}),resetScroll();let n=await fetch(`./data/${t}.json`).then((e=>e.json())),s="unknown";constants.roundSets[t]&&(s=constants.roundSets[t].type),currentRoundsetData=processRoundset(t,n),null===roundsetFilterSettings.roundFilterEnd&&(roundsetFilterSettings.roundFilterEnd=Math.max(...currentRoundsetData.rounds.map((e=>e.roundNumber)))),selectedRoundset=t;let l=document.createElement("div");l.classList.add("roundset-header-bar"),a.appendChild(l);let d=document.createElement("div");d.classList.add("roundset-header-title"),l.appendChild(d);let r=document.createElement("div");r.classList.add("roundset-header-left"),d.appendChild(r);let i=createEl("img",{classList:["roundset-settings-btn","pointer"],style:{width:"50px",height:"50px"},src:"../Assets/UI/SettingsBtn.webp"});i.addEventListener("click",(()=>{openRoundsetSettingsModal(s)})),r.appendChild(i);let o=document.createElement("p");o.classList.add("roundset-header-text","black-outline"),o.innerHTML=constants.roundSets[t]?constants.roundSets[t].name:t,d.appendChild(o);let c=document.createElement("div");c.classList.add("roundset-header-right"),d.appendChild(c);let p=document.createElement("img");if(p.classList.add("modal-close"),p.src="./Assets/UI/CloseBtn.webp",p.addEventListener("click",(()=>{goBack()})),c.appendChild(p),t.startsWith("Rogue")){let a=document.createElement("div");a.classList.add("d-flex","jc-evenly"),l.appendChild(a);let n={RogueRoundSet:"Rogue Legends Default Roundset",RogueBloonierSet:"Now with more Bloons!",RogueDenseSet:"Bloons spawn more densely",RoguePinkSet:"Bloons start fast and end slow",RoguePurpleSet:"More Purples and faster Bloons. Bloon health is reduced",RogueImmuneSet:"Alternate rounds with more Bloons with immunities",RogueLeadSet:"More Lead Bloons and DDTs"};Object.entries(n).forEach((([n,s])=>{let l=document.createElement("div");l.classList.add("pointer"),l.addEventListener("click",(()=>{showLoading(),goBack(),showRoundsetModel(e,n)})),a.appendChild(l),n==t&&l.classList.add("rogue-roundset-selector-active");let d=document.createElement("img");d.classList.add("roundset-header-rogue-img"),d.style.width="100px",d.src=`../Assets/UI/${n}.webp`,l.appendChild(d),tippy(l,{content:s,placement:"top",theme:"speech_bubble",popperOptions:{modifiers:[{name:"preventOverflow",options:{boundary:"viewport",padding:{right:18}}}]}})}))}let m=document.createElement("div");m.classList.add("roundset-header-bar-bottom"),l.appendChild(m);let u=document.createElement("div");u.classList.add("maps-progress-views"),m.appendChild(u);let h=document.createElement("p");h.classList.add("maps-progress-coop-toggle-text","maps-progress-view-list","black-outline"),h.innerHTML="Display Type:",u.appendChild(h);let g=document.createElement("div");g.classList.add("maps-progress-view","stats-tab-yellow","black-outline"),g.innerHTML="Simple",u.appendChild(g);let b=document.createElement("div");b.classList.add("maps-progress-view","black-outline"),b.innerHTML="Detailed",u.appendChild(b);let L=document.createElement("div");L.classList.add("maps-progress-view","black-outline"),L.innerHTML="Preview",u.appendChild(L),roundsetPreviewButton=L;let v=document.createElement("div");v.classList.add("maps-progress-views");let y=document.createElement("div");y.classList.add("maps-progress-view","black-outline","pointer"),y.innerHTML="Clear Filters",y.id="clear-filters-btn",y.style.display="none",y.addEventListener("click",(()=>{roundsetFilterSettings.roundFilterStart=1,roundsetFilterSettings.roundFilterEnd=currentRoundsetData.rounds[currentRoundsetData.rounds.length-1].roundNumber,roundsetFilterSettings.roundFilterPreset="All",roundsetFilterSettings.roundsetBasicFilter=null,roundsetFilterSettings.roundsetFilteredBloons=[],roundsetFilterSettings.roundsetAdvancedFilterMode=!1,roundsetFilterSettings.roundsetAdvancedFilterLogic="ANY",roundsetFilterSettings.roundsetReversed=!1,roundsetFilterSettings.roundsetHideUnused=!0,roundsetFilterSettings.roundsetShowModified=!1,applyRoundFilters(s),generateRounds(currentRoundsetView,roundsetFilterSettings.roundsetReversed,s)})),v.appendChild(y),m.appendChild(v);let f=document.createElement("div");f.id="roundset-content",f.classList.add("rounds-content"),a.appendChild(f),g.addEventListener("click",(()=>{g.classList.add("stats-tab-yellow"),b.classList.remove("stats-tab-yellow"),L.classList.remove("stats-tab-yellow"),currentRoundsetView="Simple",generateRounds(currentRoundsetView,roundsetFilterSettings.roundsetReversed,s)})),b.addEventListener("click",(()=>{b.classList.add("stats-tab-yellow"),g.classList.remove("stats-tab-yellow"),L.classList.remove("stats-tab-yellow"),currentRoundsetView="Topper",generateRounds(currentRoundsetView,roundsetFilterSettings.roundsetReversed,s)})),L.addEventListener("click",(()=>{L.classList.add("stats-tab-yellow"),g.classList.remove("stats-tab-yellow"),b.classList.remove("stats-tab-yellow"),currentRoundsetView="Preview",generateRounds(currentRoundsetView,roundsetFilterSettings.roundsetReversed,s)})),currentPreviewRound=0,currentRoundsetView="Simple",generateRounds(currentRoundsetView,roundsetFilterSettings.roundsetReversed,s)}function processRoundset(e,t){const a=["Moab","Bfb","Zomg","Ddt","Bad"];let n=JSON.parse(JSON.stringify(t));n=addRoundHints(e,n);let s=0,l=0;return n.rounds.forEach((e=>{let t=0;e.bloonGroups.forEach((n=>{const s=n.bloon.toLowerCase();s.includes("camo")&&(t|=BloonTraitBits.Camo),s.includes("regrow")&&(t|=BloonTraitBits.Regrow),s.includes("fortified")&&(t|=BloonTraitBits.Fortified),s.includes("lead")&&(t|=BloonTraitBits.Lead),s.includes("purple")&&(t|=BloonTraitBits.Purple),s.includes("ddt")?t|=BloonTraitBits.DDT|BloonTraitBits.MOABClass:a.some((e=>n.bloon.includes(e)))&&(t|=BloonTraitBits.MOABClass),bloonToRounds.has(n.bloon)||bloonToRounds.set(n.bloon,new Set),bloonToRounds.get(n.bloon).add(e.roundNumber)})),e.traitMask=t,"number"==typeof e.income&&(s+=e.income,e.incomeSum=s),"number"==typeof e.rbe&&(l+=e.rbe,e.rbeSum=l)})),n}function applyRoundFilters(e){if(!currentRoundsetData)return;const t=roundsetFilterSettings.roundFilterEnd??currentRoundsetData.rounds[currentRoundsetData.rounds.length-1].roundNumber;let a=JSON.parse(JSON.stringify(currentRoundsetData));a.rounds=a.rounds.filter((e=>e.roundNumber>=roundsetFilterSettings.roundFilterStart&&e.roundNumber<=t));let n=roundsetFilterSettings.roundsetStartingCash,s=0;if(a.rounds.forEach((e=>{roundsetFilterSettings.roundsetReversed?e.bloonGroups.sort(((e,t)=>e.end-t.end)):e.bloonGroups.sort(((e,t)=>e.start-t.start)),"number"==typeof e.income&&(n+=e.income,e.incomeSum=n),"number"==typeof e.rbe&&(s+=e.rbe,e.rbeSum=s)})),null!=e)switch(e){case"quest":if(roundsetFilterSettings.roundsetHideUnused){let e=constants.roundSets[selectedRoundset].endRound;a.rounds=a.rounds.filter((t=>t.roundNumber<=e))}break;case"boss":if(roundsetFilterSettings.roundsetShowModified){let e=constants.roundSets[selectedRoundset].modifiedRounds;a.rounds=a.rounds.filter((t=>e.includes(t.roundNumber)))}}let l=0;switch(roundsetFilterSettings.roundsetBasicFilter){case"Any Camo":l|=BloonTraitBits.Camo;break;case"Any Regrow":l|=BloonTraitBits.Regrow;break;case"Any Fortified":l|=BloonTraitBits.Fortified;break;case"Lead & DDT":l|=BloonTraitBits.Lead;break;case"Purple":l|=BloonTraitBits.Purple;break;case"MOAB-Class":l|=BloonTraitBits.MOABClass}if(0!==l&&(a.rounds=a.rounds.filter((e=>(e.traitMask&l)===l))),roundsetFilterSettings.roundsetFilteredBloons.length>0){let e=roundsetFilterSettings.roundsetFilteredBloons.map((e=>bloonToRounds.get(e))).filter((e=>e&&e.size>0));if(0===e.length)a.rounds=[];else if("COMBO"===roundsetFilterSettings.roundsetAdvancedFilterLogic){e.sort(((e,t)=>e.size-t.size));let t=new Set(e[0]);for(let a=1;a<e.length;a++){for(let n of Array.from(t))e[a].has(n)||t.delete(n);if(0===t.size)break}a.rounds=a.rounds.filter((e=>t.has(e.roundNumber)))}else{let t=new Set;e.forEach((e=>e.forEach((e=>t.add(e))))),a.rounds=a.rounds.filter((e=>t.has(e.roundNumber)))}}roundsetProcessed=a;const d=document.getElementById("clear-filters-btn");d&&(d.style.display=isFiltersActive()?"":"none")}function addRoundHints(e,t){return["DefaultRoundSet","AlternateRoundSet","RogueRoundSet"].includes(e)&&t.rounds.forEach(((t,a)=>{switch(e){case"DefaultRoundSet":constants.roundHints.hasOwnProperty("Hint "+(t.roundNumber-1))&&(t.hint=constants.roundHints["Hint "+(t.roundNumber-1)]);break;case"AlternateRoundSet":constants.roundHints.hasOwnProperty("Alternate Hint "+(t.roundNumber-1))&&(t.hint=constants.roundHints["Alternate Hint "+(t.roundNumber-1)]);break;case"RogueRoundSet":constants.roundHints.hasOwnProperty("Rogue Hint "+(t.roundNumber-1))&&(t.hint=constants.roundHints["Rogue Hint "+(t.roundNumber-1)])}})),t}async function generateRounds(e,t,a){let n=document.getElementById("roundset-content");n.innerHTML="",!roundsetProcessed&&currentRoundsetData&&applyRoundFilters(a);let s=roundsetProcessed.rounds.every(((e,t,a)=>0===t||e.roundNumber===a[t-1].roundNumber+1));switch(e){case"Simple":if(resetPreview(),"boss"===a&&roundsetFilterSettings.roundsetShowModified){let e={BloonariusRoundSet:"Bloonarius Changes: Only rounds that the boss spawns from are changed. They now spawn Bloons that are one tier lower than normal with 10 seconds of delay.",LychRoundSet:"Lych Changes: Rounds 40 to 48 have extra MOABs added in for Lych to resurrect when hitting a skull. Rounds that Lych spawns from are changed to spawn Bloons that are one tier lower than normal with 10 seconds of delay.",VortexRoundSet:"Vortex Changes: A small group of rounds have Bloons upgraded to speedier ones as well as adding some extra faster bloons. Rounds that Vortex spawns from are changed to spawn Bloons that are one tier lower than normal with 10 seconds of delay.",DreadbloonRoundSet:"Dreadbloon Changes: In general summary, Zebra -> Lead, Lead -> Fortified Lead, Rainbow -> Ceramic, Ceramic -> Fortified Ceramic. After Round 50, every other Blue MOAB is fortified, and after round 70 all Blue MOABs are fortified. There are some exceptions. Rounds that Dreadbloon spawns from are changed to spawn Bloons that are one tier lower than normal with 10 seconds of delay.",PhayzeRoundSet:"Phayze Changes: Only rounds that the boss spawns from are changed. They now spawn Bloons that are one tier lower than normal with 10 seconds of delay.",BlastapopoulosRoundSet:"Blastapopoulos Changes: Only rounds that the boss spawns from are changed. They now spawn Bloons that are one tier lower than normal with 10 seconds of delay."};const t=document.createElement("div");t.classList.add("disclaimer-div");const a=document.createElement("p");a.classList.add("disclaimer"),a.style.fontSize="24px",a.style.padding="1rem",a.style.lineHeight="1.5",a.innerHTML='Showing modified rounds. Disable "Only Modified" in Roundset Settings to show all rounds.<br>'+e[selectedRoundset],t.appendChild(a),n.appendChild(t)}let e=!1;roundsetProcessed.rounds.forEach((async(t,a)=>{let s=document.createElement("div");s.id=`round-${t.roundNumber}`,s.classList.add("round-div","jc-between"),e&&s.classList.add("round-div-alt");let l=document.createElement("p");l.classList.add("round-number","black-outline","pointer"),l.innerHTML=t.roundNumber,l.addEventListener("click",(()=>{currentPreviewRound=indexOfRoundNumberOrNearest(t.roundNumber),currentRoundsetView="Preview",roundsetPreviewButton.click()})),s.appendChild(l);let d=document.createElement("div");d.id=`round-${t.roundNumber}-groups`,d.classList.add("round-bloon-groups","fg-1"),s.appendChild(d);let r=document.createDocumentFragment();t.bloonGroups.sort(((e,t)=>e.start-t.start)).forEach(((e,t)=>{let a=document.createElement("div");a.classList.add("bloon-group-div");let n=document.createElement("p");n.classList.add("bloon-group-number","black-outline"),n.innerHTML="x"+e.count,a.appendChild(n);let s=document.createElement("img");s.classList.add("bloon-group-bloon"),s.src=`../Assets/BloonIcon/${e.bloon}.webp`,s.loading="lazy",a.appendChild(s),r.appendChild(a)})),d.appendChild(r);let i=document.createElement("div");i.classList.add("d-flex","ai-center"),i.style.minWidth="120px",s.appendChild(i);let o=document.createElement("img");o.classList.add("leaderboard-entry-score-icon"),o.src="./Assets/UI/StopWatch.webp",i.appendChild(o);let c=document.createElement("p");c.classList.add("round-number","black-outline");let p=t.bloonGroups.length?Math.max(...t.bloonGroups.map((e=>e.end))):0;c.innerHTML=p.toFixed(2),i.appendChild(c),n.appendChild(s),isRoundInFilter(t.roundNumber)?(e&&s.classList.add("round-div-alt"),e=!e):s.style.display="none"})),roundsetFilterSettings.roundsetReversed&&onChangeReverse();break;case"Topper":resetPreview();let l=document.createElement("div");l.classList.add("rounds-detailed-div"),n.appendChild(l),copyLoadingIcon(l),setTimeout((()=>{let e=document.createDocumentFragment(),a=document.createElement("div");a.classList.add("disclaimer-div"),e.appendChild(a);let n=document.createElement("p");n.classList.add("disclaimer"),n.innerHTML="This layout is based on Topper's website:",a.appendChild(n);let d=document.createElement("a");d.classList.add("disclaimer-link"),d.href="https://topper64.co.uk/nk/btd6/rounds/",d.target="_blank",d.innerHTML="Topper's Round Information",a.appendChild(d);roundsetProcessed.rounds.forEach((async(a,n)=>{if(!isRoundInFilter(a.roundNumber))return;let l=document.createElement("div");l.id=`round-${a.roundNumber}`,l.classList.add("round-div-detailed"),t&&l.classList.add("round-div-reverse");let d=document.createElement("div");d.classList.add("rounds-div-header"),l.appendChild(d);let r=document.createElement("p");r.classList.add("round-number","round-number-detailed","black-outline","pointer"),r.innerHTML=`Round ${a.roundNumber}`,r.addEventListener("click",(()=>{currentPreviewRound=indexOfRoundNumberOrNearest(a.roundNumber),currentRoundsetView="Preview",roundsetPreviewButton.click()})),d.appendChild(r);let i=document.createElement("div");i.classList.add("income-div"),d.appendChild(i);let o=document.createElement("img");o.classList.add("income-img"),o.src="../Assets/UI/CoinIcon.webp",i.appendChild(o);let c=document.createElement("div");c.classList.add("income-text-div"),i.appendChild(c);let p=document.createElement("p");p.classList.add("round-income","black-outline"),p.innerHTML=`Income: ${a.income.toLocaleString()}`,c.appendChild(p);let m=document.createElement("p");m.classList.add("round-income-total","black-outline"),m.innerHTML=`Total: ${a.incomeSum.toLocaleString()}`,s&&c.appendChild(m);let u=document.createElement("div");u.classList.add("rbe-div"),d.appendChild(u);let h=document.createElement("img");h.classList.add("rbe-img"),h.src="../Assets/BloonIcon/Red.webp",u.appendChild(h);let g=document.createElement("div");g.classList.add("rbe-text-div"),u.appendChild(g);let b=document.createElement("p");b.classList.add("round-rbe","black-outline"),b.innerHTML=`RBE: ${a.rbe.toLocaleString()}`,g.appendChild(b);let L=document.createElement("p");L.classList.add("round-rbe-total","black-outline"),L.innerHTML=`Total: ${a.rbeSum.toLocaleString()}`,s&&g.appendChild(L);let v=a.bloonGroups.length?Math.max(...a.bloonGroups.map((e=>e.end))):0,y=document.createElement("p");if(y.classList.add("round-duration","black-outline"),y.innerHTML=`Duration: ${v.toFixed(2)}s`,d.appendChild(y),a.hint&&roundsetFilterSettings.roundsetShowHints){let e=document.createElement("div");e.classList.add("round-hint-div","coop-border"),l.appendChild(e);let t=document.createElement("p");t.classList.add("round-hint-x"),t.innerHTML="X",t.addEventListener("click",(()=>{e.style.display="none"})),e.appendChild(t);let n=document.createElement("p");n.classList.add("round-hint"),n.innerHTML=a.hint,e.appendChild(n)}let f=document.createElement("div");f.classList.add("timeline-div"),l.appendChild(f),a.bloonGroups.forEach(((e,t)=>{let a=document.createElement("div");a.classList.add("bloon-group-div-detailed"),f.appendChild(a);let n=document.createElement("div");n.classList.add("left-div"),a.appendChild(n);let s=document.createElement("img");s.classList.add("bloon-image"),s.src=`../Assets/BloonIcon/${e.bloon}.webp`,n.appendChild(s);let l=document.createElement("p");l.classList.add("bloon-count","black-outline"),l.innerHTML="x"+e.count,n.appendChild(l);let d=document.createElement("div");d.classList.add("timeline-right-div"),a.appendChild(d);let r=document.createElement("div");r.classList.add("bloon-bar"),d.appendChild(r);let i=document.createElement("div");i.classList.add("bloon-bar-fill"),i.style.background=bloonsData[e.bloon.replace("Camo","").replace("Regrow","").replace("Fortified","")].color,e.bloon.includes("Rainbow")||(i.style.border=`4px solid ${bloonsData[e.bloon.replace("Camo","").replace("Regrow","").replace("Fortified","")].border}`),tippy(i,{content:`${e.start.toFixed(2)}s - ${e.end.toFixed(2)}s`,placement:"top",theme:"speech_bubble",popperOptions:{modifiers:[{name:"preventOverflow",options:{boundary:"viewport",padding:{right:18}}}]}});let o=(e.end-e.start)/v*100,c=e.start/v*100;o<5&&(o=5),c+o>100&&(c=100-o),i.style.width=`${o}%`,i.style.left=`${c}%`,r.appendChild(i)})),e.appendChild(l)})),l.innerHTML="",l.appendChild(e),roundsetFilterSettings.roundsetReversed&&onChangeReverse()}),0);break;case"Preview":resetPreview(),null==roundsetProcessed.rounds[currentPreviewRound]&&(currentPreviewRound=0),(roundsetProcessed.rounds[currentPreviewRound].roundNumber<roundsetFilterSettings.roundFilterStart||roundsetProcessed.rounds[currentPreviewRound].roundNumber>roundsetFilterSettings.roundFilterEnd)&&(currentPreviewRound=Math.max(0,roundsetFilterSettings.roundFilterStart-1));let d=document.createElement("div");d.classList.add("preview-container-div"),n.appendChild(d);let r=document.createElement("div");r.classList.add("preview-div"),d.appendChild(r);let i=document.createElement("div");i.classList.add("preview-header"),r.appendChild(i);let o=document.createElement("p");o.id="round-number-preview",o.classList.add("round-number","round-number-preview","black-outline"),o.innerHTML=`Round ${roundsetProcessed.rounds[currentPreviewRound].roundNumber}`,i.appendChild(o);let c=document.createElement("input");c.id="select-round-num-preview",c.classList.add("select-round-num"),c.type="number",c.min=1,c.max=roundsetFilterSettings.roundFilterEnd,c.value=roundsetProcessed.rounds[currentPreviewRound].roundNumber,c.addEventListener("change",(()=>{let e=parseInt(c.value);e<roundsetFilterSettings.roundFilterStart&&(e=roundsetFilterSettings.roundFilterStart),e>roundsetFilterSettings.roundFilterEnd&&(e=roundsetFilterSettings.roundFilterEnd),c.value=e,currentPreviewRound=indexOfRoundNumberOrNearest(e),o.innerHTML=`Round ${roundsetProcessed.rounds[currentPreviewRound].roundNumber}`,updatePreviewRoundTimeline()})),i.appendChild(c);let p=document.createElement("div");p.classList.add("preview-right-div");let m=document.createElement("img");m.classList.add("clear-button"),m.src="../Assets/UI/DestroyBloonsBtn.webp",m.addEventListener("click",(()=>{clearPreview()})),p.appendChild(m);let u=document.createElement("img");u.classList.add("play-normal-button"),u.src="../Assets/UI/GoBtnSmall.webp",u.addEventListener("click",(()=>{speedMultiplier=1,o.innerHTML=`Round ${roundsetProcessed.rounds[currentPreviewRound].roundNumber}`,clearPreview(),startRound(roundsetProcessed.rounds[currentPreviewRound])})),p.appendChild(u);let h=document.createElement("img");h.classList.add("play-fast-button"),h.src="../Assets/UI/FastForwardBtn.webp",h.addEventListener("click",(()=>{speedMultiplier=3,o.innerHTML=`Round ${roundsetProcessed.rounds[currentPreviewRound].roundNumber}`,clearPreview(),startRound(roundsetProcessed.rounds[currentPreviewRound])})),p.appendChild(h),canvas=document.createElement("canvas"),canvas.classList.add("roundset-canvas"),canvas.width=800,canvas.height=300,r.appendChild(canvas);let g=document.createElement("div");g.classList.add("preview-footer-div","ai-center"),r.appendChild(g);let b=document.createElement("div");b.classList.add("d-flex","ai-center"),g.appendChild(b);let L=createEl("p",{classList:["black-outline"],innerHTML:"Bloon Speed:",style:{fontSize:"28px"}});b.appendChild(L);let v=document.createElement("div");v.classList.add("maps-progress-view","stats-tab-yellow","black-outline"),v.innerHTML="Easy",b.appendChild(v);let y=document.createElement("div");y.classList.add("maps-progress-view","black-outline"),y.innerHTML="Medium",b.appendChild(y);let f=document.createElement("div");switch(f.classList.add("maps-progress-view","black-outline"),f.innerHTML="Hard",b.appendChild(f),v.addEventListener("click",(()=>{difficultySpeedModifier=1,v.classList.add("stats-tab-yellow"),y.classList.remove("stats-tab-yellow"),f.classList.remove("stats-tab-yellow")})),y.addEventListener("click",(()=>{difficultySpeedModifier=1.1,v.classList.remove("stats-tab-yellow"),y.classList.add("stats-tab-yellow"),f.classList.remove("stats-tab-yellow")})),f.addEventListener("click",(()=>{difficultySpeedModifier=1.26,v.classList.remove("stats-tab-yellow"),y.classList.remove("stats-tab-yellow"),f.classList.add("stats-tab-yellow")})),selectedRoundset){case"AlternateRoundSet":f.click();break;case"AcceleratedRoundSet":case"EnduranceRoundSet":case"FastUpgradesRoundSet":case"MOABMadnessRoundSet":case"RogueRoundSet":case"RogueBloonierSet":case"RogueDenseSet":case"RoguePinkSet":case"RoguePurpleSet":case"RogueImmuneSet":case"RogueLeadSet":y.click()}let C=document.createElement("div");C.classList.add("next-prev-div"),i.appendChild(C),g.appendChild(p);let w=document.createElement("div");w.classList.add("maps-progress-view","black-outline"),w.innerHTML="Previous",w.addEventListener("click",(()=>{null!=previewModified&&previewModified.checked?(currentIndexInModifiedRounds--,currentIndexInModifiedRounds<0&&(currentIndexInModifiedRounds=currentModifiedRounds.length-1),currentPreviewRound=currentModifiedRounds[currentIndexInModifiedRounds]-1):(currentPreviewRound--,currentPreviewRound<0&&(currentPreviewRound=roundsetProcessed.rounds.length-1)),c.value=roundsetProcessed.rounds[currentPreviewRound].roundNumber,clearPreview(),updatePreviewRoundTimeline()})),C.appendChild(w);let E=document.createElement("div");E.classList.add("maps-progress-view","black-outline"),E.innerHTML="Next",E.addEventListener("click",(()=>{null!=previewModified&&previewModified.checked?(currentIndexInModifiedRounds++,currentIndexInModifiedRounds>=currentModifiedRounds.length&&(currentIndexInModifiedRounds=0),currentPreviewRound=currentModifiedRounds[currentIndexInModifiedRounds]-1):(currentPreviewRound++,currentPreviewRound>=roundsetProcessed.rounds.length&&(currentPreviewRound=0)),c.value=roundsetProcessed.rounds[currentPreviewRound].roundNumber,clearPreview(),updatePreviewRoundTimeline()})),C.appendChild(E);let k=document.createElement("div");k.id="preview-round-info-div",k.classList.add("round-info-div"),r.appendChild(k),ctx=canvas.getContext("2d"),startPreviewLoop(),updatePreviewRoundTimeline()}}function onChangeReverse(){switch(currentRoundsetView){case"Simple":roundsetProcessed.rounds.forEach(((e,t)=>{let a=document.getElementById(`round-${e.roundNumber}-groups`);Array.from(a.children).reverse().forEach((e=>a.appendChild(e)))}));break;case"Topper":let e=document.getElementsByClassName("timeline-div");for(let t of e)t.classList.toggle("timeline-div-reverse");let t=document.getElementsByClassName("timeline-right-div");for(let e of t)e.classList.toggle("flip-horizontal");break;case"Preview":document.getElementById("preview-timeline-div").classList.toggle("timeline-div-reverse");let a=document.getElementsByClassName("preview-timeline-right-div");for(let e of a)e.classList.toggle("flip-horizontal")}clearPreview()}function updatePreviewRoundTimeline(){let e=document.getElementById("preview-round-info-div");e.innerHTML="";let t=roundsetProcessed.rounds[currentPreviewRound];hiddenGroups=[];let a=document.createElement("div");a.classList.add("round-div-detailed"),e.appendChild(a);let n=document.createElement("div");n.classList.add("rounds-div-header"),a.appendChild(n);let s=document.createElement("p");s.classList.add("round-number","round-number-detailed","black-outline"),s.innerHTML=`Round ${t.roundNumber}`,n.appendChild(s);let l=document.createElement("div");l.classList.add("income-div"),n.appendChild(l);let d=document.createElement("img");d.classList.add("income-img"),d.src="../Assets/UI/CoinIcon.webp",l.appendChild(d);let r=document.createElement("div");r.classList.add("income-text-div"),l.appendChild(r);let i=document.createElement("p");i.classList.add("round-income","black-outline"),i.innerHTML=`Income: ${t.income.toLocaleString()}`,r.appendChild(i);let o=document.createElement("p");o.classList.add("round-income-total","black-outline"),o.innerHTML=`Total: ${t.incomeSum.toLocaleString()}`,r.appendChild(o);let c=document.createElement("div");c.classList.add("rbe-div"),n.appendChild(c);let p=document.createElement("img");p.classList.add("rbe-img"),p.src="../Assets/BloonIcon/Red.webp",c.appendChild(p);let m=document.createElement("div");m.classList.add("rbe-text-div"),c.appendChild(m);let u=document.createElement("p");u.classList.add("round-rbe","black-outline"),u.innerHTML=`RBE: ${t.rbe.toLocaleString()}`,m.appendChild(u);let h=document.createElement("p");h.classList.add("round-rbe-total","black-outline"),h.innerHTML=`Total: ${t.rbeSum.toLocaleString()}`,m.appendChild(h);let g=t.bloonGroups.length?Math.max(...t.bloonGroups.map((e=>e.end))):0,b=document.createElement("p");if(b.classList.add("round-duration","black-outline"),b.innerHTML=`Duration: ${g.toFixed(2)}s`,n.appendChild(b),t.hint&&roundsetFilterSettings.roundsetShowHints){let e=document.createElement("div");e.classList.add("round-hint-div","coop-border"),a.appendChild(e);let n=document.createElement("p");n.classList.add("round-hint-x"),n.innerHTML="X",n.addEventListener("click",(()=>{e.style.display="none"})),e.appendChild(n);let s=document.createElement("p");s.classList.add("round-hint"),s.innerHTML=t.hint,e.appendChild(s)}let L=document.createElement("div");L.id="preview-timeline-div",L.classList.add("timeline-div"),a.appendChild(L);t.bloonGroups.forEach(((e,t)=>{let a=document.createElement("div");a.classList.add("bloon-group-div-detailed"),a.addEventListener("click",(()=>{hiddenGroups.includes(t)?(a.style.filter="",hiddenGroups.splice(hiddenGroups.indexOf(t),1)):(hiddenGroups.push(t),a.style.filter="brightness(0.5)")})),L.appendChild(a);let n=document.createElement("div");n.classList.add("left-div"),a.appendChild(n);let s=document.createElement("img");s.classList.add("bloon-image"),s.src=`../Assets/BloonIcon/${e.bloon}.webp`,n.appendChild(s);let l=document.createElement("p");l.classList.add("bloon-count","black-outline"),l.innerHTML="x"+e.count,n.appendChild(l);let d=document.createElement("div");d.classList.add("timeline-right-div","preview-timeline-right-div"),a.appendChild(d);let r=document.createElement("div");r.classList.add("bloon-bar"),d.appendChild(r);let i=document.createElement("div");i.classList.add("bloon-bar-fill"),i.style.background=bloonsData[e.bloon.replace("Camo","").replace("Regrow","").replace("Fortified","")].color,e.bloon.includes("Rainbow")||(i.style.border=`4px solid ${bloonsData[e.bloon.replace("Camo","").replace("Regrow","").replace("Fortified","")].border}`),tippy(i,{content:`${e.start.toFixed(2)}s - ${e.end.toFixed(2)}s`,placement:"top",theme:"speech_bubble",popperOptions:{modifiers:[{name:"preventOverflow",options:{boundary:"viewport",padding:{right:18}}}]}});let o=(e.end-e.start)/g*100,c=e.start/g*100;o<5&&(o=5),c+o>100&&(c=100-o),i.style.width=`${o}%`,i.style.left=`${c}%`,r.appendChild(i)})),roundsetFilterSettings.roundsetReversed&&onChangeReverse()}function addTimelinePlayhead(e){let t=document.getElementById("preview-timeline-div"),a=document.createElement("div");a.id="preview-playhead",a.classList.add("playhead"),t.appendChild(a),a.style.animation=`playhead ${e}s linear`,a.addEventListener("animationend",(function(){a.remove()}))}function clearPreview(){document.getElementById("preview-playhead")&&document.getElementById("preview-playhead").remove(),currentRoundGroups=null,bloons.length=0}function openRoundsetSettingsModal(e){if(!roundsetProcessed)return;null===roundsetFilterSettings.roundFilterEnd&&(roundsetFilterSettings.roundFilterEnd=roundsetProcessed.rounds[roundsetProcessed.rounds.length-1].roundNumber);const t=createEl("div",{style:{padding:"16px",display:"flex",flexDirection:"column",gap:"16px"}});let a=createEl("div",{classList:["d-flex","ai-center","jc-between"],style:{gap:"8px"}});t.appendChild(a);let n=createEl("div",{classList:["d-flex"],style:{gap:"8px",flexDirection:"column"}});a.appendChild(n);let s=createEl("div",{classList:["d-flex","ai-center","jc-center"],style:{gap:"8px",flexWrap:"wrap",width:"55%"}}),l=currentRoundsetData.rounds[0].roundNumber,d=currentRoundsetData.rounds[currentRoundsetData.rounds.length-1].roundNumber,r=createEl("div",{classList:["d-flex","ai-center"]});n.appendChild(r);let i=createEl("img",{classList:["of-contain"],src:"./Assets/UI/StartRoundIconSmall.webp",style:{width:"40px",height:"40px",marginRight:"4px"}});r.appendChild(i);let o=generateNumberInput("Start Round",roundsetFilterSettings.roundFilterStart,l,d,1,(e=>{roundsetFilterSettings.roundFilterStart=e,s.querySelectorAll("div").forEach((e=>e.classList.remove("stats-tab-yellow")))}));r.appendChild(o);let c=createEl("div",{classList:["d-flex","ai-center"]});n.appendChild(c);let p=createEl("img",{classList:["of-contain"],src:"./Assets/UI/EndRoundIconSmall.webp",style:{width:"40px",height:"40px",marginRight:"4px"}});c.appendChild(p);let m=generateNumberInput("End Round",roundsetFilterSettings.roundFilterEnd,l,d,1,(e=>{roundsetFilterSettings.roundFilterEnd=e,s.querySelectorAll("div").forEach((e=>e.classList.remove("stats-tab-yellow")))}));if(m.style.flexGrow="1",c.appendChild(m),"DefaultRoundSet"===selectedRoundset){["All","Easy","Medium","Hard","Impoppable","CHIMPS"].forEach((e=>{const t=generateSelectorTab(e,e===roundsetFilterSettings.roundFilterPreset);t.addEventListener("click",(()=>{switch(roundsetFilterSettings.roundFilterPreset=e,Array.from(s.children).forEach((e=>e.classList.remove("stats-tab-yellow"))),t.classList.add("stats-tab-yellow"),e){case"All":roundsetFilterSettings.roundFilterStart=1,roundsetFilterSettings.roundFilterEnd=d;break;case"Easy":roundsetFilterSettings.roundFilterStart=1,roundsetFilterSettings.roundFilterEnd=Math.min(40,d);break;case"Medium":roundsetFilterSettings.roundFilterStart=1,roundsetFilterSettings.roundFilterEnd=Math.min(60,d);break;case"Hard":roundsetFilterSettings.roundFilterStart=3,roundsetFilterSettings.roundFilterEnd=Math.min(80,d);break;case"Impoppable":case"CHIMPS":roundsetFilterSettings.roundFilterStart=6,roundsetFilterSettings.roundFilterEnd=Math.min(100,d)}const a=o.querySelector("input"),n=m.querySelector("input");a&&(a.value=roundsetFilterSettings.roundFilterStart),n&&roundsetFilterSettings.roundFilterEnd&&(n.value=roundsetFilterSettings.roundFilterEnd)})),s.appendChild(t)})),a.appendChild(s)}else n.style.flexDirection="row",n.style.gap="50px";let u=createEl("p",{classList:["font-gardenia"],style:{fontSize:"22px",display:roundsetFilterSettings.roundsetReversed?"block":"none"},innerHTML:"In Rogue Legends, the rounds are not reversed even when the track path is."}),h=createEl("div",{classList:["d-flex"]});t.appendChild(h);let g=createEl("div",{classList:["d-flex","ai-center"]});h.appendChild(g);let b=createEl("img",{classList:["of-contain"],src:"./Assets/UI/CoinIcon.webp",style:{width:"40px",height:"40px",marginRight:"4px"}});g.appendChild(b);let L=generateNumberInput("Starting Cash",roundsetFilterSettings.roundsetStartingCash,0,99999999,50,(e=>{roundsetFilterSettings.roundsetStartingCash=e}));g.appendChild(L);let v=generateCheckbox("Reverse Mode",roundsetFilterSettings.roundsetReversed,(e=>{roundsetFilterSettings.roundsetReversed=e,u.style.display=selectedRoundset.startsWith("Rogue")&&e?"block":"none"}));if(h.appendChild(v),"quest"===e){let e=generateCheckbox("Hide Unused",roundsetFilterSettings.roundsetHideUnused,(e=>{roundsetFilterSettings.roundsetHideUnused=e}));h.appendChild(e),h.classList.add("jc-between")}else if("boss"===e){let e=generateCheckbox("Only Modified",roundsetFilterSettings.roundsetShowModified,(e=>{roundsetFilterSettings.roundsetShowModified=e}));h.appendChild(e),h.classList.add("jc-between")}else if("DefaultRoundSet"===selectedRoundset||selectedRoundset.startsWith("Rogue")){let e=generateCheckbox("Round Hints",roundsetFilterSettings.roundsetShowHints,(e=>{roundsetFilterSettings.roundsetShowHints=e}));h.appendChild(e),h.classList.add("jc-between")}else h.style.gap="32px";t.appendChild(u);let y=createEl("div",{classList:["d-flex","ai-center","jc-between"],style:{gap:"8px"}});t.appendChild(y);let f=createEl("p",{classList:["dropdown-label","black-outline"],innerHTML:"Filter by Bloons"});y.appendChild(f);let C=createEl("div",{classList:["d-flex","ai-center"],style:{gap:"6px",display:roundsetFilterSettings.roundsetAdvancedFilterMode?"flex":"none"}});y.appendChild(C);let w=createEl("p",{classList:["black-outline"],style:{fontSize:"24px"},innerHTML:"Logic:"});C.appendChild(w);const E=e=>{let t=createEl("div",{classList:["maps-progress-view","black-outline","pointer"],innerHTML:e});return roundsetFilterSettings.roundsetAdvancedFilterLogic===e&&t.classList.add("stats-tab-yellow"),t.addEventListener("click",(()=>{roundsetFilterSettings.roundsetAdvancedFilterLogic!==e&&(roundsetFilterSettings.roundsetAdvancedFilterLogic=e,Array.from(C.querySelectorAll(".maps-progress-view")).forEach((e=>e.classList.remove("stats-tab-yellow"))),t.classList.add("stats-tab-yellow"))})),t};C.appendChild(E("ANY")),C.appendChild(E("COMBO"));let k=createEl("div",{classList:["tooltip-container","d-flex","ai-center"],style:{gap:"8px"}});y.appendChild(k);let T=createEl("p",{classList:["black-outline"],style:{fontSize:"24px"},innerHTML:"Advanced"});k.appendChild(T);let M=generateToggle(roundsetFilterSettings.roundsetAdvancedFilterMode,(e=>{roundsetFilterSettings.roundsetAdvancedFilterMode=e,roundsetFilterSettings.roundsetBasicFilter=null,roundsetFilterSettings.roundsetFilteredBloons=[],C.style.display=e?"flex":"none",D()}));k.appendChild(M);let S=createEl("div",{classList:["d-flex","ai-center","jc-start"],style:{gap:"8px"}});t.appendChild(S);let I=createEl("div",{classList:["d-flex","jc-center"],style:{gap:"6px",flexWrap:"wrap"}});S.appendChild(I);let x=["Red","Blue","Green","Yellow","Pink","Black","White","Purple","Lead","Zebra","Rainbow","Ceramic"],B=["Moab","Bfb","Zomg","DdtCamo","Bad"];const A=e=>{let t=createEl("div",{classList:["pointer"],style:{backgroundImage:"url(../Assets/UI/StatsTabBlue.webp)",backgroundSize:"contain",width:"60px",height:"60px"}}),a=createEl("img",{classList:["bloon-filter-img"],style:{width:"50px",height:"50px",padding:"5px",objectFit:"contain"},src:`../Assets/BloonIcon/${e}.webp`});return t.appendChild(a),roundsetFilterSettings.roundsetFilteredBloons.includes(e)&&(t.style.backgroundImage="url(../Assets/UI/StatsTabYellow.webp)"),t.addEventListener("click",(()=>{let a=roundsetFilterSettings.roundsetFilteredBloons;a.includes(e)?(roundsetFilterSettings.roundsetFilteredBloons=a.filter((t=>t!==e)),t.style.backgroundImage="url(../Assets/UI/StatsTabBlue.webp)"):(a.push(e),t.style.backgroundImage="url(../Assets/UI/StatsTabYellow.webp)")})),t};function D(){if(I.innerHTML="",roundsetFilterSettings.roundsetAdvancedFilterMode){let e=[];x.forEach((t=>{e.push(t,`${t}Regrow`,`${t}Camo`,`${t}RegrowCamo`)}));let t=B.map((e=>`${e}Fortified`));t[3]="DdtFortifiedCamo";let a=["LeadFortified","LeadFortifiedCamo","CeramicFortified","CeramicFortifiedCamo",...B],n=["LeadRegrowFortified","LeadRegrowFortifiedCamo","CeramicRegrowFortified","CeramicRegrowFortifiedCamo",...t],s=createEl("div",{classList:["d-flex","ai-center"],style:{gap:"6px",flexWrap:"wrap",width:"530px"}});e.forEach((e=>s.appendChild(A(e)))),I.appendChild(s);let l=createEl("div",{classList:["d-flex","ai-center","jc-center"],style:{gap:"6px",flexWrap:"wrap"}}),d=createEl("div",{classList:["d-flex","ai-center"],style:{gap:"6px",flexWrap:"wrap"}});a.forEach((e=>d.appendChild(A(e)))),l.appendChild(d);let r=createEl("div",{classList:["d-flex","ai-center"],style:{gap:"6px",flexWrap:"wrap"}});n.forEach((e=>r.appendChild(A(e)))),l.appendChild(r),I.appendChild(l)}else{const e={"Any Camo":"GreenCamo","Any Regrow":"PinkRegrow","Any Fortified":"CeramicFortified",Purple:"Purple","Lead & DDT":"Lead","MOAB-Class":"Moab"};let t=createEl("div",{classList:["d-flex","ai-center"],style:{gap:"6px",flexWrap:"wrap"}});Object.keys(e).forEach((a=>{let n=createEl("div",{classList:["d-flex","ai-center"],style:{gap:"2px",width:"250px"}}),s=createEl("div",{classList:["pointer"],style:{backgroundImage:"url(../Assets/UI/StatsTabBlue.webp)",backgroundSize:"contain",width:"60px",height:"60px"}});n._iconHolder=s;let l=createEl("img",{classList:["bloon-filter-img"],style:{width:"50px",height:"50px",padding:"5px",objectFit:"contain"},src:`../Assets/BloonIcon/${e[a]}.webp`});s.appendChild(l);let d=createEl("p",{classList:["black-outline"],style:{fontSize:"20px"},innerHTML:a});n.appendChild(s),n.appendChild(d),roundsetFilterSettings.roundsetBasicFilter===a&&(s.style.backgroundImage="url(../Assets/UI/StatsTabYellow.webp)"),t.appendChild(n),n.addEventListener("click",(()=>{roundsetFilterSettings.roundsetBasicFilter===a?(roundsetFilterSettings.roundsetBasicFilter=null,s.style.backgroundImage="url(../Assets/UI/StatsTabBlue.webp)"):(Array.from(t.children).forEach((e=>{e._iconHolder&&(e._iconHolder.style.backgroundImage="url(../Assets/UI/StatsTabBlue.webp)")})),roundsetFilterSettings.roundsetBasicFilter=a,s.style.backgroundImage="url(../Assets/UI/StatsTabYellow.webp)")}))})),I.appendChild(t)}}D();const P=createEl("div",{classList:["d-flex","jc-end"],style:{marginTop:"8px",gap:"10px"}}),H=createEl("div",{classList:["maps-progress-view","black-outline","pointer"],innerHTML:"Apply",style:{padding:"6px 14px",filter:"hue-rotate(270deg)"}});return H.addEventListener("click",(()=>{if(!currentRoundsetData)return void(closeModal&&closeModal());if(null===roundsetFilterSettings.roundFilterEnd&&(roundsetFilterSettings.roundFilterEnd=roundsetProcessed.rounds[roundsetProcessed.rounds.length-1].roundNumber),roundsetFilterSettings.roundFilterStart>roundsetFilterSettings.roundFilterEnd){const e=roundsetFilterSettings.roundFilterStart;roundsetFilterSettings.roundFilterStart=roundsetFilterSettings.roundFilterEnd,roundsetFilterSettings.roundFilterEnd=e}applyRoundFilters(e),generateRounds(currentRoundsetView,roundsetFilterSettings.roundsetReversed);const t=document.getElementById("select-round-num-preview");if(t){t.min=roundsetFilterSettings.roundFilterStart,t.max=roundsetFilterSettings.roundFilterEnd,isRoundInFilter(roundsetProcessed.rounds[currentPreviewRound].roundNumber)||(currentPreviewRound=roundsetFilterSettings.roundFilterStart-1,t.value=roundsetFilterSettings.roundFilterStart,updatePreviewRoundTimeline())}closeModal&&closeModal(),goBack()})),P.appendChild(H),t.appendChild(P),createModal({header:"Roundset Settings",content:t}),t}function isRoundInFilter(e){return e>=roundsetFilterSettings.roundFilterStart&&e<=(roundsetFilterSettings.roundFilterEnd??1/0)}function indexOfRoundNumberOrNearest(e){const t=roundsetProcessed?.rounds??[];if(0===t.length)return-1;const a=t.findIndex((t=>t.roundNumber===e));return-1!==a?a:t.reduce(((a,n,s)=>{const l=t[a].roundNumber,d=Math.abs(l-e),r=Math.abs(n.roundNumber-e);return r<d||r===d&&n.roundNumber<l?s:a}),0)}function isFiltersActive(){if(!currentRoundsetData)return!1;const e=currentRoundsetData.rounds[currentRoundsetData.rounds.length-1]?.roundNumber??1/0,t=null==roundsetFilterSettings.roundFilterEnd||roundsetFilterSettings.roundFilterEnd===e,a="boss"===constants.roundSets[selectedRoundset]?.type&&!!roundsetFilterSettings.roundsetShowModified;return[1!==roundsetFilterSettings.roundFilterStart,!t,"All"!==roundsetFilterSettings.roundFilterPreset,null!==roundsetFilterSettings.roundsetBasicFilter,(roundsetFilterSettings.roundsetFilteredBloons?.length??0)>0,!0===roundsetFilterSettings.roundsetAdvancedFilterMode,a,!0===roundsetFilterSettings.roundsetReversed].some(Boolean)}let totalArtifactsTxt,noArtifactsMessage,rogueSaveData={extractedArtifacts:[],imageOptions:{avatar:"ProfileAvatar01.webp",banner:"ProfileBanner48.webp",name:null,sort:"Rarity (Ascending)"},selectedOAK:!1,clickToCollect:!1,artifactFilter:"All",artifactSort:"Name",highlightExtracted:!1,extractionFilter:"All",showStarterArtifacts:!0,showBossArtifacts:!0,categoryFilter:["Common","Rare","Legendary"]},starterArtifacts=["BouncingProjectiles3","CeramicChunker2","FrostedTips1","OneShot2","SlowerIsHarder1","SpiritOfAdventure2","SwellingSpikes1","Wackywibblywavey1"],bossArtifacts=["EssenceOfBloonarius1","EssenceOfVortex1","EssenceOfDreadbloon1","EssenceOfPhayze1","EssenceOfBlastapopoulos1"],starterKitNames={Quincy:"Quincy","Cyber Quincy":"Cyber Quincy","Wolfpack Quincy":"Wolfpack Quincy",Gwendolin:"Gwendolin",CircusGwendolin:"Circus Gwendolin","Scientist Gwendolin":"Scientist Gwendolin",StrikerJones:"Striker Jones","Biker Bones":"Biker Bones","Octo Jones":"Octo Jones",ObynGreenfoot:"Obyn Greenfoot",ObynOceanGuardian:"Ocean Guardian Obyn",MoltenObyn:"Molten Obyn",CaptainChurchill:"Captain Churchill","Sentai Captain Churchill":"Sentai Churchill","Sleigh Captain Churchill":"Sleigh Churchill",Benjamin:"Benjamin",BenJammin:"BenJammin",SushiBento:"Sushi Bento",PatFusty:"Pat Fusty",FustyTheSnowman:"Fusty the Snowman",KaijuPat:"Kaiju Pat",Ezili:"Ezili",SmudgeCatt:"Smudge Catt",Galaxili:"Galaxili",Adora:"Adora",JoanOfArcAdora:"Joan of Arc Adora",Voidora:"Voidora",Etienne:"Etienne",ETnEtienne:"ETn",BookWyrmEtienne:"Book Wyrm Etienne",Sauda:"Sauda",VikingSauda:"Viking Sauda",JiangshiSauda:"Jiangshi Sauda",AdmiralBrickell:"Admiral Brickell",DreadPirateBrickell:"Dread Pirate Brickell",LifeguardBrickell:"Lifeguard Brickell",Psi:"Psi",Psimbals:"Psimbals",DreamstatePsi:"Dreamstate Psi",Geraldo:"Geraldo",GeraldoGentlemanGadgeteer:"Gentleman Gadgeteer Geraldo",Corvus:"Corvus",Rosalia:"Rosalia",RosaliaTinkerfairy:"Rosalia Tinkerfairy",AdoraSheRa:"She-Ra Adora",Silas:"Silas",ObynSkeletor:"Skeletor Obyn"},artifactDivMap={},currentArtifacts={};function postProcessRogueData(){let e=["Common","Rare","Legendary"];function t(e,t){return e.replace(/{(\d+)}/g,((e,a)=>void 0!==t[a]?t[a]:e))}let a=["EssenceOfLych1","Token","TokenMonkeyMoney","TokenRogueXp","ProjectileCarousel1"];for(let[e,t]of Object.entries(rogueJSON.heroStarterKits))rogueJSON.artifacts[t.artifact].starterKitHero=e;for(let[a,n]of Object.entries(rogueJSON.artifacts))a.startsWith("Boost")&&delete rogueJSON.artifacts[a],n.title=getLocValue(n.nameLocKey).replace("{0}",e[n.tier]),n.description=t(getLocValue(n.descriptionLocKey),n.descriptionParams);for(let e of a)delete rogueJSON.artifacts[e];Object.entries(constants.rogueStarterKitDupes).forEach((([e,t])=>{rogueJSON.heroStarterKits[e]={...rogueJSON.heroStarterKits[t]},rogueJSON.heroStarterKits[e].heroID=e}))}function changeRogueTab(e){switch(resetScroll(),e){case"Artifacts":document.getElementById("rogue-content").style.display="none",document.getElementById("artifacts-content").style.display="flex",generateRogueArtifacts(),addToBackQueue({source:"rogue",destination:"artifacts"});break;case"Hero Starter Kits":document.getElementById("rogue-content").style.display="none",document.getElementById("starter-kits-content").style.display="flex",generateRogueHeroStarterKits(),addToBackQueue({source:"rogue",destination:"starter-kits"});break;case"Export Image":document.getElementById("rogue-content").style.display="none",document.getElementById("artifacts-content").style.display="flex",generateImageBuilder(),addToBackQueue({source:"rogue",destination:"artifacts"});break;default:document.getElementById("rogue-content").style.display="flex",document.getElementById("artifacts-content").style.display="none",document.getElementById("starter-kits-content").style.display="none",document.getElementById("starter-kits-content").style.display="none"}}function generateRogueSelectors(){hideLoading(),document.getElementById("rogue-content").innerHTML="";let e=document.createElement("div");e.classList.add("progress-page","f-wrap"),document.getElementById("rogue-content").appendChild(e);let t=document.createElement("div");t.classList.add("selectors-div"),e.appendChild(t);let a=document.createElement("p");a.classList.add("sku-roundset-selector-desc"),a.innerHTML="Note: At this time, the artifacts you have extracted are not available via the BTD6 Open Data API. You must manually mark them as extracted. This data will be saved in the current browsers local storage, and will not be cleared unless you clear your browsing data. If you prefer to keep a backup, use Export/Import Data.",t.appendChild(a);Object.entries({Artifacts:"RoguePermanantArtifactsBtn","Hero Starter Kits":"RogueStarterKitsBtn","Export Image":"ArtifactShareBtn"}).forEach((([e,a])=>{let n=document.createElement("div");n.classList.add("rogue-bg","d-flex","jc-between","ai-center","pointer"),n.style.margin="10px",n.addEventListener("click",(()=>{changeRogueTab(e)})),t.appendChild(n);let s=document.createElement("img");s.classList.add("selector-img"),s.src="../Assets/UI/"+a+".webp",n.appendChild(s);let l=document.createElement("p");l.classList.add("selector-text","black-outline"),l.innerHTML=e,n.appendChild(l);let d=document.createElement("img");d.classList.add("selector-go-img"),d.src="../Assets/UI/ContinueBtn.webp",n.appendChild(d)}));let n=document.createElement("div");n.classList.add("d-flex","jc-evenly"),t.appendChild(n);let s=document.createElement("div");s.classList.add("d-flex","ai-center"),s.style.gap="10px",n.appendChild(s);let l=document.createElement("p");l.classList.add("selector-text","black-outline"),l.innerHTML="Export Data",s.appendChild(l);let d=document.createElement("img");d.classList.add("selector-go-img","pointer"),d.style.width="56px",d.src="../Assets/UI/DownloadBtn.webp",s.appendChild(d),d.addEventListener("click",(()=>{downloadArtifactsSave()}));let r=document.createElement("div");r.classList.add("d-flex","ai-center"),r.style.gap="10px",n.appendChild(r);let i=document.createElement("p");i.classList.add("selector-text","black-outline"),i.innerHTML="Import Data",r.appendChild(i);let o=document.createElement("img");o.classList.add("pointer"),o.style.width="56px",o.src="../Assets/UI/UploadBtn.webp",r.appendChild(o),o.addEventListener("click",(()=>{importArtifactsSave()}))}function generateRogueArtifacts(){let e=document.getElementById("artifacts-content");e.innerHTML="";let t=document.createElement("div");t.classList.add("rogue-bg","d-flex","jc-between","ai-center"),t.style.height="20px",e.appendChild(t);let a=document.createElement("div");a.classList.add("d-flex","ai-center","jc-between"),a.style.width="200px",t.appendChild(a);let n=document.createElement("img");if(n.src="../Assets/UI/SettingsBtn.webp",n.style.width="50px",n.style.height="50px",n.classList.add("artifact-bag","pointer"),n.addEventListener("click",(()=>{backState="artifactSettings",generateArtifactSettings()})),a.appendChild(n),!("All"===rogueSaveData.artifactFilter&&"All"===rogueSaveData.extractionFilter&&!0===rogueSaveData.showStarterArtifacts&&!0===rogueSaveData.showBossArtifacts&&3===rogueSaveData.categoryFilter.length&&["Common","Rare","Legendary"].every((e=>rogueSaveData.categoryFilter.includes(e))))){let e=createEl("div",{classList:["maps-progress-view","black-outline","pointer","ta-center"],style:{width:"100px"},innerHTML:"Clear Filters"});a.appendChild(e),e.addEventListener("click",(()=>{rogueSaveData.artifactFilter="All",rogueSaveData.extractionFilter="All",rogueSaveData.showStarterArtifacts=!0,rogueSaveData.showBossArtifacts=!0,rogueSaveData.categoryFilter=["Common","Rare","Legendary"],saveRogueDataToLocalStorage(),generateRogueArtifacts()}))}let s=document.createElement("div");s.classList.add("pos-rel"),t.appendChild(s);let l=document.createElement("input");l.classList.add("search-box","font-gardenia","rogue-search"),l.placeholder="Search",l.style.paddingRight="40px",l.addEventListener("input",(()=>{let e=l.value.toLowerCase().replace(/[^a-z0-9]/g,"");Object.values(artifactDivMap).forEach((t=>{t.alt.toLowerCase().replace(/[^a-z0-9]/g,"").includes(e)?t.style.display="flex":t.style.display="none"})),noArtifactsMessage.style.display=Object.values(artifactDivMap).every((e=>"none"==e.style.display))?"block":"none",updateArtifactCount()}));let d=document.createElement("img");d.src="../Assets/UI/SearchIcon.webp",d.classList.add("search-icon"),s.appendChild(d),s.appendChild(l);let r=document.createElement("div");r.style.width="200px",r.classList.add("d-flex","jc-end","ai-center"),t.appendChild(r);let i=document.createElement("p");i.classList.add("rogue-progress-text","black-outline"),i.innerHTML=`${rogueSaveData.extractedArtifacts.length}/${Object.keys(rogueJSON.artifacts).length}`,r.appendChild(i),totalArtifactsTxt=i;let o=document.createElement("img");o.src="../Assets/UI/ArtifactBag.webp",o.classList.add("artifact-bag"),r.appendChild(o);let c=document.createElement("div");c.id="artifacts-container",c.classList.add("insta-monkeys-progress-container"),e.appendChild(c),generateArtifacts(),noArtifactsMessage=document.createElement("p"),noArtifactsMessage.classList.add("rogue-no-results","font-gardenia"),noArtifactsMessage.innerHTML="No artifacts to display. Check your search term, or change your filter settings.",noArtifactsMessage.style.display=Object.values(artifactDivMap).every((e=>"none"==e.style.display))?"block":"none",e.appendChild(noArtifactsMessage)}function generateArtifactSettings(){let e=document.getElementById("artifacts-content");e.innerHTML="",addToBackQueue({callback:generateRogueArtifacts});let t=document.createElement("div");t.classList.add("content-div","rogue-bg","d-flex","ai-center"),e.appendChild(t);let a=document.createElement("div");t.appendChild(a);let n=document.createElement("div");n.classList.add("maps-progress-views"),a.appendChild(n);let s=document.createElement("p");s.classList.add("settings-header","black-outline"),s.style.fontSize="32px",s.innerHTML="Artifact View Settings",n.appendChild(s);let l=document.createElement("div");l.classList.add("settings-content","d-flex","jc-evenly","f-wrap"),t.appendChild(l);let d=document.createElement("div");d.classList.add("settings-box","d-flex","fd-column","jc-between","fg-1"),d.style.gap="10px",l.appendChild(d);let r=createEl("div",{classList:["d-flex","ai-center","jc-between","fg-1"],style:{margin:"2px"}});d.appendChild(r);let i=createEl("p",{classList:["black-outline"],style:{fontSize:"24px"},innerHTML:"Extraction Tracker Mode"});r.appendChild(i);let o=generateToggle(rogueSaveData.highlightExtracted,(e=>{rogueSaveData.highlightExtracted=e,saveRogueDataToLocalStorage()}));r.appendChild(o);let c=document.createElement("p");c.style.margin="20px",c.style.lineHeight="1.5",c.classList.add("font-gardenia");let p=()=>{switch(rogueSaveData.extractionFilter){case"All":c.innerHTML="Showing all artifacts extracted and not extracted.";break;case"Only Extracted":c.innerHTML="Only extracted artifacts will be shown.";break;case"Only Unextracted":c.innerHTML="Extracted artifacts will be hidden."}};p();let m=generateDropdown("Extracted Filter:",["All","Only Extracted","Only Unextracted"],rogueSaveData.extractionFilter,(e=>{rogueSaveData.extractionFilter=e,p(),saveRogueDataToLocalStorage()}));m.classList.add("jc-between");let u=createEl("div",{classList:["d-flex","ai-center","jc-between","fg-1"],style:{margin:"2px"}});d.appendChild(u);let h=createEl("p",{classList:["black-outline"],style:{fontSize:"24px"},innerHTML:"One Click Extract"});u.appendChild(h);let g=generateToggle(rogueSaveData.clickToCollect,(e=>{rogueSaveData.clickToCollect=e,saveRogueDataToLocalStorage()}));u.appendChild(g);let b=document.createElement("div");b.classList.add("settings-box","d-flex","fd-column","fg-1"),b.style.gap="10px",l.appendChild(b);let L=generateCheckbox("Show Starter Artifacts",rogueSaveData.showStarterArtifacts,(e=>{rogueSaveData.showStarterArtifacts=e,saveRogueDataToLocalStorage()}));L.classList.add("jc-between");let v=generateCheckbox("Show Boss Artifacts",rogueSaveData.showBossArtifacts,(e=>{rogueSaveData.showBossArtifacts=e,saveRogueDataToLocalStorage()}));v.classList.add("jc-between"),b.appendChild(L),b.appendChild(v);let y=document.createElement("div");y.classList.add("settings-box","d-flex","ai-center","fd-column","fg-1"),l.appendChild(y);let f=document.createElement("p");function C(){switch(rogueSaveData.artifactFilter){case"All":f.innerHTML="All Artifacts will be included to start.";break;case"Extracted":f.innerHTML="Only Artifacts that have been extracted will be included to start.";break;case"Unextracted":f.innerHTML="Only Artifacts that have not been extracted will be included to start.";break;case"Starter Kit":f.innerHTML="Only Artifacts that are available in Hero Starter Kits will be included to start.";break;case"Non Starter Kit":f.innerHTML="Only Artifacts that are not available in Hero Starter Kits will be included to start.";break;case"One Variant":f.innerHTML="Only Artifacts that have only one tier will be included to start.";break;case"Two Variants":f.innerHTML="Only Artifacts that have only have two tiers will be included to start.";break;case"Added Update 48":f.innerHTML="Only Artifacts that were added in Update 48 will be included to start.";break;case"Added Update 49":f.innerHTML="Only Artifacts that were added in Update 49 will be included to start.";break;case"Added Update 50":f.innerHTML="Only Artifacts that were added in Update 50 will be included to start.";break;case"Added Update 51":f.innerHTML="Only Artifacts that were added in Update 51 will be included to start."}}f.classList.add("font-gardenia"),f.style.margin="20px",f.style.lineHeight="1.5",f.innerHTML="All Artifacts will be included to start.";let w=generateDropdown("Artifact Filter:",["All","Starter Kit","Non Starter Kit","One Variant","Two Variants","Added Update 48","Added Update 49","Added Update 50","Added Update 51"],rogueSaveData.artifactFilter,(e=>{rogueSaveData.artifactFilter=e,C(),saveRogueDataToLocalStorage()}));C(),y.appendChild(w),y.appendChild(f),y.appendChild(m),y.appendChild(c);let E=document.createElement("p");E.innerHTML="Rarity Filter:",E.style.fontSize="24px",E.style.padding="5px",E.classList.add("black-outline"),y.appendChild(E);let k=document.createElement("div");k.classList.add("d-flex","ai-center","fd-column"),y.appendChild(k);Object.entries({Common:"RarityNormalArtifactAllTowers",Rare:"RarityRareArtifactAllTowers",Legendary:"RarityLegendaryArtifactAllTowers"}).forEach((([e,t])=>{let a=document.createElement("div");a.classList.add("d-flex","ai-center","jc-between"),a.style.width="250px",k.appendChild(a);let n=document.createElement("img");n.src=`../Assets/RogueFrames/${t}.webp`,n.style.width="50px",a.appendChild(n);let s=generateCheckbox(e,rogueSaveData.categoryFilter.includes(e),(t=>{rogueSaveData.categoryFilter.includes(e)?rogueSaveData.categoryFilter=rogueSaveData.categoryFilter.filter((t=>t!==e)):rogueSaveData.categoryFilter.push(e),saveRogueDataToLocalStorage()}));a.appendChild(s)}));let T=document.createElement("div");T.classList.add("settings-box","d-flex","ai-center","fd-column","fg-1"),l.appendChild(T);let M=document.createElement("div");M.classList.add("preview-artifacts-div");let S=()=>{M.innerHTML="";let e=[];switch(["SplodeyDarts","SquadronTogether","DivineIntervention"].forEach((t=>{e.push(t+"1"),e.push(t+"2"),e.push(t+"3")})),rogueSaveData.artifactSort){case"Rarity (Ascending)":e=e.sort(((e,t)=>rogueJSON.artifacts[e].tier-rogueJSON.artifacts[t].tier));break;case"Rarity (Descending)":e=e.sort(((e,t)=>rogueJSON.artifacts[t].tier-rogueJSON.artifacts[e].tier));break;case"Category":e=e.sort(((e,t)=>rogueJSON.artifacts[e].rarityFrameType.localeCompare(rogueJSON.artifacts[t].rarityFrameType)))}e.forEach((e=>{M.appendChild(generateArtifactContainer(e,"preview"))}))};S();let I=generateDropdown("Sort:",["Name","Rarity (Ascending)","Rarity (Descending)"],rogueSaveData.artifactSort,(e=>{console.log(e),rogueSaveData.artifactSort=e,saveRogueDataToLocalStorage(),S()}));T.appendChild(I),T.appendChild(M);let x=document.createElement("div");x.classList.add("start-button","black-outline"),x.innerHTML="Apply",x.addEventListener("click",(()=>{goBack()})),t.appendChild(x)}function generateArtifacts(){let e=document.getElementById("artifacts-container");e.innerHTML="",artifactDivMap={};let t=document.createElement("div");t.classList.add("artifacts-div"),e.appendChild(t);let a=document.createElement("div");switch(a.classList.add("artifacts-div"),t.appendChild(a),currentArtifacts={...rogueJSON.artifacts},rogueSaveData.artifactFilter){case"Extracted":currentArtifacts=Object.fromEntries(Object.entries(currentArtifacts).filter((([e,t])=>rogueSaveData.extractedArtifacts.includes(e))));break;case"Unextracted":currentArtifacts=Object.fromEntries(Object.entries(currentArtifacts).filter((([e,t])=>!rogueSaveData.extractedArtifacts.includes(e))));break;case"Starter Kit":currentArtifacts=Object.fromEntries(Object.entries(currentArtifacts).filter((([e,t])=>t.hasOwnProperty("starterKitHero"))));break;case"Non Starter Kit":let e=[];Object.values(rogueJSON.heroStarterKits).map((e=>e.artifact)).concat(starterArtifacts).forEach((t=>{let a=rogueJSON.artifacts[t];switch(t.slice(-1)){case"1":e.push(a.baseId+"1"),e.push(a.baseId+"2"),e.push(a.baseId+"3");break;case"2":e.push(a.baseId+"2"),e.push(a.baseId+"3");break;case"3":e.push(a.baseId+"3")}})),currentArtifacts=Object.fromEntries(Object.entries(currentArtifacts).filter((([t,a])=>!e.includes(t))));break;case"Two Variants":currentArtifacts=Object.fromEntries(Object.entries(currentArtifacts).filter((([e,t])=>rogueJSON.artifacts.hasOwnProperty(t.baseId+"1")&&rogueJSON.artifacts.hasOwnProperty(t.baseId+"2")&&!rogueJSON.artifacts.hasOwnProperty(t.baseId+"3")||!rogueJSON.artifacts.hasOwnProperty(t.baseId+"1")&&rogueJSON.artifacts.hasOwnProperty(t.baseId+"2")&&rogueJSON.artifacts.hasOwnProperty(t.baseId+"3"))));break;case"One Variant":currentArtifacts=Object.fromEntries(Object.entries(currentArtifacts).filter((([e,t])=>rogueJSON.artifacts.hasOwnProperty(t.baseId+"1")&&!rogueJSON.artifacts.hasOwnProperty(t.baseId+"2")&&!rogueJSON.artifacts.hasOwnProperty(t.baseId+"3"))));break;case"Added Update 48":currentArtifacts=Object.fromEntries(Object.entries(currentArtifacts).filter((([e,t])=>48==t.added)));break;case"Added Update 49":currentArtifacts=Object.fromEntries(Object.entries(currentArtifacts).filter((([e,t])=>49==t.added)));break;case"Added Update 50":currentArtifacts=Object.fromEntries(Object.entries(currentArtifacts).filter((([e,t])=>50==t.added)));break;case"Added Update 51":currentArtifacts=Object.fromEntries(Object.entries(currentArtifacts).filter((([e,t])=>51==t.added)))}rogueSaveData.showStarterArtifacts||(currentArtifacts=Object.fromEntries(Object.entries(currentArtifacts).filter((([e,t])=>!starterArtifacts.includes(e))))),rogueSaveData.showBossArtifacts||(currentArtifacts=Object.fromEntries(Object.entries(currentArtifacts).filter((([e,t])=>!bossArtifacts.includes(e)))));const n={Common:0,Rare:1,Legendary:2};switch(currentArtifacts=Object.fromEntries(Object.entries(currentArtifacts).filter((([e,t])=>rogueSaveData.categoryFilter.includes(Object.keys(n).find((e=>n[e]===t.tier)))))),rogueSaveData.extractionFilter){case"Only Extracted":let e=rogueSaveData.extractedArtifacts.concat(starterArtifacts);currentArtifacts=Object.fromEntries(Object.entries(currentArtifacts).filter((([t,a])=>e.includes(t))));break;case"Only Unextracted":let t=rogueSaveData.extractedArtifacts.concat(starterArtifacts);currentArtifacts=Object.fromEntries(Object.entries(currentArtifacts).filter((([e,a])=>!t.includes(e))))}switch(rogueSaveData.artifactSort){case"Name":currentArtifacts=Object.fromEntries(Object.entries(currentArtifacts).sort(((e,t)=>e[1].title.replace("Legendary","3").replace("Rare","2").replace("Common","1").localeCompare(t[1].title.replace("Legendary","3").replace("Rare","2").replace("Common","1")))));break;case"Rarity (Ascending)":currentArtifacts=Object.fromEntries(Object.entries(currentArtifacts).sort(((e,t)=>e[1].tier-t[1].tier)));break;case"Rarity (Descending)":currentArtifacts=Object.fromEntries(Object.entries(currentArtifacts).sort(((e,t)=>t[1].tier-e[1].tier)));break;case"Category":currentArtifacts=Object.fromEntries(Object.entries(currentArtifacts).sort(((e,t)=>e[1].rarityFrameType.localeCompare(t[1].rarityFrameType))))}return Object.entries(currentArtifacts).forEach((([e,t])=>{if(!rogueSaveData.showStarterArtifacts&&starterArtifacts.includes(e))return;if(!rogueSaveData.showBossArtifacts&&bossArtifacts.includes(e))return;let n=generateArtifactContainer(e);n.alt=t.title,artifactDivMap[e]=n,n.addEventListener("click",(()=>{rogueSaveData.clickToCollect&&rogueSaveData.highlightExtracted&&!starterArtifacts.includes(e)?rogueSaveData.extractedArtifacts.includes(e)?(rogueSaveData.extractedArtifacts=rogueSaveData.extractedArtifacts.filter((t=>t!==e)),n.classList.add("artifact-unextracted"),updateArtifactCount(),saveRogueDataToLocalStorage()):(rogueSaveData.extractedArtifacts.push(e),n.classList.remove("artifact-unextracted"),updateArtifactCount(),saveRogueDataToLocalStorage()):generateArtifactPopout(e)})),a.appendChild(n)})),updateArtifactCount(),t}function generateArtifactContainer(e,t){let a=rogueJSON.artifacts[e],n=document.createElement("div");n.classList.add("artifact-container"),!rogueSaveData.highlightExtracted&&"force"!=t||rogueSaveData.extractedArtifacts.includes(e)||starterArtifacts.includes(e)||"preview"==t||n.classList.add("artifact-unextracted");let s=document.createElement("img");s.src=`../Assets/RogueArtifacts/${a.icon}.webp`,s.classList.add("artifact-img"),n.appendChild(s);let l=document.createElement("img");return l.src=`../Assets/RogueFrames/${getFrameIconName(a)}.webp`,l.classList.add("artifact-frame"),n.appendChild(l),"modal"!=t&&"preview"!=t&&tippy(n,{content:`<p class="artifact-title">${a.title}</p>${a.description}`,allowHTML:!0,placement:"top",hideOnClick:!1,theme:"speech_bubble",popperOptions:{modifiers:[{name:"preventOverflow",options:{boundary:"viewport",padding:{right:18}}}]}}),n}function getFrameIconName(e){let t=e.tier;switch(t){case 0:t="Normal";break;case 1:t="Rare";break;case 2:t="Legendary"}let a=e.rarityFrameType;return"AllMonkeyTowerSets"===a&&(a="AllTowers"),`Rarity${t}Artifact${a}`}function generateArtifactPopout(e){let t=rogueJSON.artifacts[e];document.querySelector(".modal-overlay")?.remove();let a=document.createElement("div");a.classList.add("rogue-artifact-modal","rogue-bg");let n=document.createElement("div");n.classList.add("modal-header"),n.style.backgroundColor="unset",a.appendChild(n);let s=document.createElement("div");s.classList.add("rogue-modal-body"),a.appendChild(s);let l=document.createElement("div");if(l.classList.add("collection-header-modal-left"),n.appendChild(l),"AllMonkeyTowerSets"!==t.rarityFrameType){let e=document.createElement("img");e.src=`../Assets/UI/${t.rarityFrameType}Icon.webp`,e.classList.add("rogue-modal-category"),l.appendChild(e)}let d=document.createElement("p");d.classList.add("collection-modal-header-text","black-outline","d-flex","ai-center"),d.style.padding="unset",d.style.height="64px",d.innerHTML=t.title,n.appendChild(d);let r=document.createElement("img");r.classList.add("collection-modal-close","pointer"),r.src="./Assets/UI/CloseBtn.webp",r.addEventListener("click",(()=>{goBack(!0)})),n.appendChild(r);let i=document.createElement("div");i.classList.add("d-flex","rogue-modal-top"),s.appendChild(i);let o=document.createElement("div");o.classList.add("d-flex"),i.appendChild(o);let c=document.createElement("div");c.classList.add("modal-trophy-div"),o.appendChild(c);let p=generateArtifactContainer(e,"modal");c.appendChild(p);let m=document.createElement("div");m.classList.add("item-details-div","jc-center","fg-1"),m.style.margin="10px",o.appendChild(m);let u=document.createElement("p");u.classList.add("trophy-store-item-description","ta-center"),u.style.marginBottom="unset",u.innerHTML=t.description,m.appendChild(u);let h=createEl("div",{classList:["d-flex","ai-center","gap-10","f-wrap"]});i.appendChild(h);let g=createEl("div",{classList:["d-flex"],style:{width:"300px"}});h.appendChild(g);let b=createEl("img",{src:"../Assets/UI/PatchNotesMonkeyIcon.webp",classList:["hero-starter-kit-img","rogue-popout-starter-icon","of-contain"]});g.appendChild(b);let L=createEl("div",{classList:["item-details-div","jc-center","fg-1"],style:{margin:"10px",minHeight:"60px"}});g.appendChild(L);let v=createEl("p",{classList:["font-gardenia","ta-center","lh-add-quarter"],style:{fontSize:"18px"},innerHTML:`Added in Update ${t.added}`});L.appendChild(v);let y=document.createElement("p");y.classList.add("trophy-store-item-obtain-method","ta-center"),y.style.marginTop="unset",m.appendChild(y);let f=document.createElement("div");f.classList.add("d-flex"),f.style.width="300px",h.appendChild(f);let C=document.createElement("img");C.src="../Assets/UI/RoguePermanantArtifactsBtn.webp",C.classList.add("hero-starter-kit-img","rogue-popout-starter-icon"),f.appendChild(C);let w,E,k=document.createElement("div");if(k.classList.add("item-details-div","jc-center","fg-1"),k.style.margin="10px",k.style.minHeight="60px",f.appendChild(k),starterArtifacts.includes(e)){let e=document.createElement("p");e.classList.add("font-gardenia","ta-center","lh-add-quarter"),e.innerHTML="This artifact is a starter artifact",e.style.fontSize="18px",k.appendChild(e)}else{w=document.createElement("div"),w.classList.add("extracted-check-div","d-flex","jc-center"),k.appendChild(w);let t=document.createElement("p");t.classList.add("maps-progress-coop-toggle-text","black-outline"),t.innerHTML="Extracted:",w.appendChild(t),E=document.createElement("input"),E.classList.add("maps-progress-coop-toggle-input"),E.style.backgroundColor="rgba(0,0,0,0.36)",E.type="checkbox",E.checked=rogueSaveData.extractedArtifacts.includes(e),w.appendChild(E)}if(t.hasOwnProperty("instaTowerToGive")){let e=createEl("div",{classList:["d-flex"],style:{width:"300px"}});h.appendChild(e);let a=t.instaTowerToGive.baseId,n=t.instaTowerToGive.tiers,s=document.createElement("div");s.classList.add("insta-monkey-tier-container"),s.style.height="80px",s.style.padding="10px 5px",e.appendChild(s);let l=document.createElement("img");l.style.width="80px",l.src=getInstaMonkeyIcon(a,n),s.appendChild(l);let d=document.createElement("p");d.classList.add("insta-monkey-tier-text","black-outline"),d.style.width="80px",d.innerHTML=`${n[0]}-${n[1]}-${n[2]}`,s.appendChild(d);let r=createEl("div",{classList:["item-details-div","jc-center","fg-1"],style:{margin:"10px",minHeight:"60px"}});e.appendChild(r);let i=createEl("p",{classList:["font-gardenia","ta-center","lh-add-quarter"],style:{fontSize:"18px"},innerHTML:`Adds ${n.join("-")} ${getLocValue(a)} on obtaining`});r.appendChild(i)}if(t.hasOwnProperty("starterKitHero")){let e=document.createElement("div");e.classList.add("d-flex"),e.style.width="300px",h.appendChild(e);let a=document.createElement("img");a.src=`${getHeroIconCircle(t.starterKitHero.replace(/ /g,""))}`,a.classList.add("hero-starter-kit-img","rogue-popout-starter-icon","of-contain"),e.appendChild(a);let n=document.createElement("div");n.classList.add("item-details-div","jc-center","fg-1"),n.style.margin="10px",n.style.minHeight="60px",e.appendChild(n);let s=document.createElement("p");s.classList.add("font-gardenia","ta-center","lh-add-quarter"),s.innerHTML=`${starterKitNames[t.starterKitHero]}'s starter kit has this artifact`,s.style.fontSize="18px",n.appendChild(s)}let T,M=[];if(rogueJSON.artifacts.hasOwnProperty(t.baseId+"1")&&M.push(t.baseId+"1"),rogueJSON.artifacts.hasOwnProperty(t.baseId+"2")&&M.push(t.baseId+"2"),rogueJSON.artifacts.hasOwnProperty(t.baseId+"3")&&M.push(t.baseId+"3"),M.length>1){let t=document.createElement("div");t.classList.add("other-variants"),s.appendChild(t);let a=document.createElement("p");a.classList.add("other-variants-title","black-outline","ta-center"),a.style.fontSize="24px",a.innerHTML="Other Variants",t.appendChild(a);let n=document.createElement("div");n.classList.add("other-variants-div","d-flex","jc-center","pointer"),t.appendChild(n),M.forEach((t=>{let a=generateArtifactContainer(t,"modal");a.addEventListener("click",(()=>{generateArtifactPopout(t)})),n.appendChild(a),t===e&&(T=a)}))}else{let e=createEl("p",{classList:["font-gardenia","ta-center","lh-add-quarter"],style:{fontSize:"18px",padding:"20px",background:"rgba(0, 0, 0, 0.3)",borderRadius:"10px"},innerHTML:"This artifact has no other variants."});s.appendChild(e)}let S=()=>{rogueSaveData.extractedArtifacts.includes(e)?(rogueSaveData.extractedArtifacts=rogueSaveData.extractedArtifacts.filter((t=>t!==e)),rogueSaveData.highlightExtracted&&(p.classList.add("artifact-unextracted"),T&&T.classList.add("artifact-unextracted"),artifactDivMap[e]&&artifactDivMap[e].classList.add("artifact-unextracted")),updateArtifactCount(),E.checked=!1,saveRogueDataToLocalStorage()):(rogueSaveData.extractedArtifacts.push(e),rogueSaveData.highlightExtracted&&(p.classList.remove("artifact-unextracted"),T&&T.classList.remove("artifact-unextracted"),artifactDivMap[e]&&artifactDivMap[e].classList.remove("artifact-unextracted")),updateArtifactCount(),E.checked=!0,saveRogueDataToLocalStorage())};starterArtifacts.includes(e)||(w.addEventListener("click",S),p.addEventListener("click",S)),createModal({content:a})}function updateArtifactCount(){let e=Object.keys(currentArtifacts).length;0===Object.keys(currentArtifacts).length&&(e=Object.keys(rogueJSON.artifacts).length);let t=`${rogueSaveData.extractedArtifacts.concat(starterArtifacts).reduce(((e,t)=>currentArtifacts.hasOwnProperty(t)?e+1:e),0)}/${e}`,a=0,n=0,s=document.querySelector(".artifacts-div");if(s){a=s.querySelectorAll('.artifact-container[style*="display: none"]').length,n=e-a-s.querySelectorAll('.artifact-unextracted[style*="display: flex"]').length,a>0&&(t=`${n}/${e-a}`)}totalArtifactsTxt&&(totalArtifactsTxt.innerHTML=rogueSaveData.highlightExtracted?t:e-a)}function generateRogueHeroStarterKits(){let e=document.getElementById("starter-kits-content");e.innerHTML="",artifactDivMap={};let t=document.createElement("div");t.classList.add("artifacts-div","hero-starter-kits"),e.appendChild(t),Object.values(rogueJSON.heroStarterKits).forEach((a=>{let n=document.createElement("div");n.classList.add("starter-kit-div"),e.appendChild(n);let s=document.createElement("img");s.src=`${getHeroSquareIcon(a.heroID.replace(/ /g,""))}`,s.classList.add("starter-kit-hero-square-img"),n.appendChild(s);let l=generateArtifactContainer(a.artifact);l.addEventListener("click",(()=>{generateArtifactPopout(a.artifact)})),n.appendChild(l),artifactDivMap[a.artifact]=l,a.startingInstas.forEach((e=>{n.appendChild(generateInstaMonkeyContainer(e))}));let d=rogueJSON.artifacts[a.artifact];if(d.hasOwnProperty("instaTowerToGive")){let e=generateInstaMonkeyContainer(d.instaTowerToGive),t=createEl("img",{src:"../Assets/UI/ArtifactBag.webp",classList:["of-contain","image-outline"],style:{width:"35px",position:"absolute"}});e.prepend(t),n.appendChild(e)}t.appendChild(n)}))}function generateInstaMonkeyContainer(e){let t=e.baseId,a=e.tiers,n=document.createElement("div");n.classList.add("insta-monkey-tier-container"),n.style.padding="10px 0px";let s=document.createElement("img");s.classList.add("insta-monkey-tier-img"),s.src=getInstaMonkeyIcon(t,a),n.appendChild(s);let l=document.createElement("p");return l.classList.add("insta-monkey-tier-text","black-outline"),l.innerHTML=`${a[0]}-${a[1]}-${a[2]}`,n.appendChild(l),n}function generateImageBuilder(){let e=document.getElementById("artifacts-content");e.innerHTML="";let t=document.createElement("div");t.classList.add("insta-monkeys-header-bar","fd-column"),t.style.width="auto",t.style.gap="10px",t.style.padding="10px",e.appendChild(t);let a=document.createElement("p");a.classList.add("black-outline"),a.style.fontSize="32px",a.innerHTML="Extracted Artifacts Image",t.appendChild(a);let n=document.createElement("p");n.classList.add("sku-roundset-selector-desc","ta-center"),n.innerHTML="This will generate a nice image to share with others of your progress in extracting the artifacts.<br>This may not work as intended on mobile, and is currently broken on Firefox due to a bug with fonts.",t.appendChild(n);let s=document.createElement("div");s.classList.add("d-flex","fd-column"),t.appendChild(s);let l=document.createElement("div");l.classList.add("rogue-profile-div","d-flex","fd-column"),l.style.width="550px",t.appendChild(l);let d=document.createElement("div");d.classList.add("rogue-banner-div","d-flex","ai-center"),d.style.backgroundImage=`linear-gradient(to right, transparent 80%, var(--profile-primary) 100%),url(../Assets/ProfileBanner/${rogueSaveData.imageOptions.banner})`,d.style.gap="50px",l.appendChild(d);let r=generateAvatar(100,`Assets/ProfileAvatar/${rogueSaveData.imageOptions.avatar}`);d.appendChild(r);let i=document.createElement("input");i.classList.add("profile-name-input","font-gardenia","ta-center"),i.style.fontSize="20px",null!=rogueSaveData.imageOptions.name?i.value=rogueSaveData.imageOptions.name:i.placeholder="Enter Name",i.addEventListener("input",(()=>{rogueSaveData.imageOptions.name=i.value,saveRogueDataToLocalStorage()})),d.appendChild(i);let o=document.createElement("div");o.classList.add("d-flex","jc-center"),o.style.gap="20px",t.appendChild(o);let c=document.createElement("div");c.classList.add("start-button","black-outline"),c.innerHTML="Change Avatar",c.style.width="auto",c.addEventListener("click",(()=>{generateAvatarSelector(rogueSaveData.imageOptions.avatar)})),o.appendChild(c);let p=document.createElement("div");p.classList.add("start-button","black-outline"),p.innerHTML="Change Banner",p.style.width="auto",p.addEventListener("click",(()=>{backState="imageBuilderModal",generateBannerSelector(rogueSaveData.imageOptions.banner)})),o.appendChild(p);let m=document.createElement("div");m.classList.add("rogue-sort-preview"),t.appendChild(m);let u=document.createElement("div");u.classList.add("maps-progress-views","jc-center"),m.appendChild(u);let h=document.createElement("p");h.classList.add("maps-progress-coop-toggle-text","black-outline"),h.classList.add("black-outline"),h.innerHTML="Sort:",u.appendChild(h);let g=document.createElement("div");g.classList.add("map-progress-filter-difficulty"),u.appendChild(g);let b=document.createElement("select");b.classList.add("map-progress-filter-difficulty-select"),b.value=rogueSaveData.artifactSort;["Name","Rarity (Ascending)","Rarity (Descending)"].forEach((e=>{let t=document.createElement("option");t.value=e,t.innerHTML=e,b.appendChild(t)})),g.appendChild(b),b.value=rogueSaveData.imageOptions.sort;let L=document.createElement("div");L.classList.add("preview-artifacts-div"),m.appendChild(L);let v=()=>{L.innerHTML="";let e=[];switch(["SplodeyDarts","SquadronTogether","DivineIntervention"].forEach((t=>{e.push(t+"1"),e.push(t+"2"),e.push(t+"3")})),rogueSaveData.imageOptions.sort){case"Rarity (Ascending)":e=e.sort(((e,t)=>rogueJSON.artifacts[e].tier-rogueJSON.artifacts[t].tier));break;case"Rarity (Descending)":e=e.sort(((e,t)=>rogueJSON.artifacts[t].tier-rogueJSON.artifacts[e].tier));break;case"Category":e=e.sort(((e,t)=>rogueJSON.artifacts[e].rarityFrameType.localeCompare(rogueJSON.artifacts[t].rarityFrameType)))}e.forEach((e=>{L.appendChild(generateArtifactContainer(e,"preview"))}))};v(),b.addEventListener("change",(()=>{rogueSaveData.imageOptions.sort=b.value,saveRogueDataToLocalStorage(),v()}));let y=document.createElement("div");y.classList.add("start-button","black-outline"),y.innerHTML="Download Image",y.style.width="auto",y.addEventListener("click",(()=>{downloadImage()})),t.appendChild(y),rogueSaveData.selectedOAK||Object.entries(localStorageOAK).forEach((([e,t])=>{let a=document.createElement("div");a.classList.add("previous-oak-entry","d-flex","jc-between","ai-center"),a.style.backgroundImage=`linear-gradient(to right, transparent 80%, var(--profile-primary) 100%),url(${t.banner})`,s.appendChild(a),a.appendChild(generateAvatar(100,t.avatar));let n=document.createElement("p");n.classList.add("profile-name","black-outline"),n.innerHTML=t.displayName,a.appendChild(n);let l=document.createElement("img");l.classList.add("delete-button"),l.src="./Assets/UI/ContinueBtn.webp",l.addEventListener("click",(()=>{rogueSaveData.imageOptions.avatar=t.avatar.split("/")[2],rogueSaveData.imageOptions.banner=t.banner.split("/")[2],rogueSaveData.imageOptions.name=t.displayName,i.value=t.displayName,d.style.backgroundImage=`linear-gradient(to right, transparent 80%, var(--profile-primary) 100%),url(../Assets/ProfileBanner/${rogueSaveData.imageOptions.banner})`,r.querySelector(".avatar-img").src=`Assets/ProfileAvatar/${rogueSaveData.imageOptions.avatar}`,i.value=rogueSaveData.imageOptions.name,s.innerHTML="",rogueSaveData.selectedOAK=!0,saveRogueDataToLocalStorage()})),a.appendChild(l)}))}function generateAvatarSelector(){let e=document.createElement("div");e.classList.add("error-modal-overlay"),document.body.appendChild(e),addToBackQueue({callback:()=>{e.remove()}});let t=document.createElement("div");t.classList.add("collection-modal","rogue-bg"),e.appendChild(t);let a=document.createElement("div");a.classList.add("collection-modal-header"),a.style.backgroundColor="unset",t.appendChild(a);let n=document.createElement("div");n.classList.add("rogue-modal-body"),t.appendChild(n);let s=document.createElement("div");s.classList.add("d-flex","jc-center","ai-center","f-wrap"),n.appendChild(s);for(let t=1;t<=constants.profileAvatars;t++){if(107==t)continue;let a=generateAvatar(100,`Assets/ProfileAvatar/ProfileAvatar${t<10?"0"+t:t}.webp`);a.addEventListener("click",(()=>{document.querySelector(".rogue-profile-div .avatar-img").src=`Assets/ProfileAvatar/ProfileAvatar${t<10?"0"+t:t}.webp`,rogueSaveData.imageOptions.avatar=`ProfileAvatar${t<10?"0"+t:t}.webp`,saveRogueDataToLocalStorage(),e.remove(),backState="home"})),s.appendChild(a)}}function generateBannerSelector(){let e=document.createElement("div");e.classList.add("error-modal-overlay"),document.body.appendChild(e),addToBackQueue({callback:()=>{e.remove()}});let t=document.createElement("div");t.classList.add("collection-modal","rogue-bg"),e.appendChild(t);let a=document.createElement("div");a.classList.add("collection-modal-header"),a.style.backgroundColor="unset",t.appendChild(a);let n=document.createElement("div");n.classList.add("rogue-modal-body"),t.appendChild(n);let s=document.createElement("div");s.classList.add("d-flex","jc-center","ai-center","f-wrap"),n.appendChild(s);for(let t=1;t<=constants.profileBanners;t++){let a=document.createElement("img");a.src=`Assets/ProfileBanner/ProfileBanner${t}.webp`,a.classList.add("profile-banner-img"),a.addEventListener("click",(()=>{document.querySelector(".rogue-banner-div").style.backgroundImage=`linear-gradient(to right, transparent 80%, var(--profile-primary) 100%),url(../Assets/ProfileBanner/ProfileBanner${t}.webp)`,rogueSaveData.imageOptions.banner=`ProfileBanner${t}.webp`,saveRogueDataToLocalStorage(),e.remove(),backState="home"})),s.appendChild(a)}for(let t=1;t<=constants.teamsBanners;t++){let a=document.createElement("img");a.src=`Assets/ProfileBanner/TeamsBanner${t}.webp`,a.classList.add("profile-banner-img"),a.addEventListener("click",(()=>{document.querySelector(".rogue-banner-div").style.backgroundImage=`linear-gradient(to right, transparent 80%, var(--profile-primary) 100%),url(../Assets/ProfileBanner/TeamsBanner${t}.webp)`,rogueSaveData.imageOptions.banner=`TeamsBanner${t}.webp`,saveRogueDataToLocalStorage(),e.remove()})),s.appendChild(a)}}function downloadImage(){let e=document.getElementById("rogue-image-content");e.innerHTML="";let t=document.createElement("div");t.classList.add("rogue-image","totem-bg"),e.appendChild(t);let a=document.createElement("div");a.classList.add("rogue-image-header"),t.appendChild(a),a.style.backgroundImage="url(../Assets/UI/RogueTopBarLong.webp)";let n=document.createElement("div");n.classList.add("rogue-profile-div","rogue-header-sides"),n.style.backgroundImage=`url(../Assets/ProfileBanner/${rogueSaveData.imageOptions.banner})`,a.appendChild(n),n.appendChild(generateAvatar(100,`Assets/ProfileAvatar/${rogueSaveData.imageOptions.avatar}`));let s=document.createElement("p");s.classList.add("profile-name","black-outline"),s.style.fontSize="40px",s.innerHTML=rogueSaveData.imageOptions.name,n.appendChild(s);let l=document.createElement("div");l.classList.add("rogue-title-div"),a.appendChild(l);const d=document.createElement("h1");d.classList.add("title","rogue-title"),d.innerHTML="Extracted Artifacts",l.appendChild(d);let r=document.createElement("div");r.classList.add("rogue-header-sides","rogue-right-div"),a.appendChild(r);let i=document.createElement("p");i.classList.add("rogue-progress-text-export","black-outline"),i.innerHTML=`${rogueSaveData.extractedArtifacts.length+8}/${Object.keys(rogueJSON.artifacts).length}`,r.appendChild(i);let o=document.createElement("img");o.src="../Assets/UI/ArtifactBag.webp",o.classList.add("artifact-bag-export"),r.appendChild(o);let c=document.createElement("div");c.classList.add("rogue-image-artifacts"),t.appendChild(c);let p=document.createElement("div");c.appendChild(p);let m=document.createElement("div");m.classList.add("artifacts-div"),p.appendChild(m);let u=document.createElement("div");u.classList.add("artifacts-div"),u.style.justifyContent="space-between",p.appendChild(u);let h={...rogueJSON.artifacts};switch(rogueSaveData.imageOptions.sort){case"Rarity (Ascending)":h=Object.fromEntries(Object.entries(h).sort(((e,t)=>e[1].tier-t[1].tier)));break;case"Rarity (Descending)":h=Object.fromEntries(Object.entries(h).sort(((e,t)=>t[1].tier-e[1].tier)))}Object.keys(h).forEach((e=>{u.appendChild(generateArtifactContainer(e,"force"))}));let g=document.createElement("div");g.classList.add("rogue-bottom-text-div","d-flex","jc-between"),g.style.fontSize="24px",g.style.padding="10px 20px",t.appendChild(g);let b=document.createElement("p");b.classList.add("rogue-bottom-text","black-outline"),b.innerHTML=(new Date).toLocaleDateString(),g.appendChild(b);let L=document.createElement("p");L.classList.add("rogue-bottom-text","black-outline"),L.innerHTML="Generated From btd6apiexplorer.github.io/rogue",g.appendChild(L),showLoading(),document.getElementById("rogue-image-content").style.display="block",setTimeout((function(){htmlToImage.toJpeg(document.getElementById("rogue-image-content"),{width:2100,quality:.85,style:{opacity:1},pixelRatio:2}).then((function(e){var t=document.createElement("a");t.href=e,t.download=`RogueLegendsArtifacts_${(new Date).toLocaleDateString()}.jpeg`,t.click(),hideLoading()})).then((function(){document.getElementById("rogue-image-content").style.display="none"}))}),1e3)}function downloadArtifactsSave(){let e=localStorage.getItem("rogueSaveData"),t=document.createElement("a");t.href="data:text/plain;charset=utf-8,"+encodeURIComponent(e),t.download=`RogueLegendsArtifactsSave_${(new Date).toLocaleDateString()}.json`,t.click()}function importArtifactsSave(){let e=document.createElement("input");e.type="file",e.accept=".json",e.click(),e.addEventListener("change",(e=>{let t=e.target.files[0],a=new FileReader;a.onload=function(e){let t=e.target.result;localStorage.setItem("rogueSaveData",t),console.log("Imported Save Data"),loadRogueDataFromLocalStorage()},a.readAsText(t)}))}function saveRogueDataToLocalStorage(){localStorage.setItem("rogueSaveData",JSON.stringify(rogueSaveData))}function loadRogueDataFromLocalStorage(){let e=localStorage.getItem("rogueSaveData");e&&(rogueSaveData=JSON.parse(e)),readLocalStorage()}fetchRogueDependencies(),loadRogueDataFromLocalStorage();let readyFlags=[0,0,0,0,0],pressedStart=!1,timerInterval=null,activeTimers=new Map,constants={},locJSON={},achievementsJSON={},achievementsHelper={},trophyStoreItemsJSON={},teamsStoreItemsJSON={},rogueJSON={},backQueue=[],backButton=createEl("img",{src:"../Assets/UI/BackBtn.webp",classList:["back-button","pointer"]});function goBack(e){let t=backQueue.pop();t.source&&(document.getElementById(t.destination+"-content").style.display="none",document.getElementById(t.source+"-content").style.display="flex"),t.callback&&t.callback(),changeHexBGColor(constants.BGColor),0===backQueue.length&&backButton.classList.remove("visible"),e||resetScroll()}function addToBackQueue(e){backQueue.push(e),backButton.classList.add("visible")}function clearBackQueue(){backQueue=[],backButton.classList.remove("visible")}function createEl(e,t={}){const a=document.createElement(e);if(t.classList&&a.classList.add(...t.classList),t.innerHTML&&(a.innerHTML=t.innerHTML),t.textContent&&(a.textContent=t.textContent),t.id&&(a.id=t.id),t.src&&(a.src=t.src),t.placeholder&&(a.placeholder=t.placeholder),t.style&&Object.assign(a.style,t.style),t.onclick&&(a.onclick=t.onclick),t.attributes)for(const[e,n]of Object.entries(t.attributes))a.setAttribute(e,n);return t.children&&t.children.forEach((e=>a.appendChild(e))),a}function createModal({header:e="",content:t="",footer:a="",classList:n=[]}={}){const s=createEl("div",{classList:["modal-overlay",...n]}),l=createEl("div",{classList:["modal-box"]}),d=createEl("div",{classList:["modal-header"]});""!=e&&l.appendChild(d);const r=createEl("div",{classList:["collection-header-modal-left"]});d.appendChild(r);const i=createEl("p",{classList:["collection-modal-header-text","black-outline"],innerHTML:e});d.appendChild(i);const o=createEl("img",{classList:["collection-modal-close","pointer"],src:"./Assets/UI/CloseBtn.webp"});o.addEventListener("click",(()=>{goBack(!0)})),d.appendChild(o);const c=createEl("div",{classList:["modal-content"]});if(l.appendChild(c),"string"==typeof t?c.innerHTML=t:t&&c.appendChild(t),a){const e=createEl("div",{classList:["modal-footer"]});"string"==typeof a?e.innerHTML=a:e.appendChild(a),l.appendChild(e)}s.appendChild(l),document.body.appendChild(s),backQueue[backQueue.length-1]?.callback!==closeModal&&addToBackQueue({callback:closeModal})}function closeModal(){document.querySelector(".modal-overlay")?.remove()}function showLoading(e){let t=0;if(!e){let n=new MutationObserver((e=>{e.forEach((e=>{"childList"===e.type&&e.addedNodes.forEach((e=>{"IMG"===e.nodeName&&(t++,e.addEventListener("load",a),e.addEventListener("error",a))}))}))}));function a(){t--,0===t&&(document.getElementById("loading").style.transform="scale(0)",n.disconnect())}n.observe(document.body,{childList:!0,subtree:!0})}document.getElementById("loading").style.removeProperty("transform")}function hideLoading(){document.getElementById("loading").style.transform="scale(0)"}function fetchConstants(){return fetch("./data/Constants.json").then((e=>e.json())).then((e=>{constants=e,readyFlags[4]=1})).catch((e=>{console.error("Error:",e),errorModal(e,"js")}))}function fetchLocKeys(){return fetch("./data/English.json").then((e=>e.json())).then((e=>{locJSON=e}))}async function fetchRogueDependencies(){return await fetchLocKeys(),fetch("./data/rogueData.json").then((e=>e.json())).then((e=>{rogueJSON=e,postProcessRogueData()})).catch((e=>{console.error("Error:",e),errorModal(e,"js")}))}async function fetchInstaDependencies(){await fetchLocKeys(),generateStats(),generateInstaData(),changeProgressTab("InstaMonkeys"),clearBackQueue(),hideLoading()}async function fetchMainDependencies(){Object.keys(constants.heroesInOrder).includes(btd6usersave.primaryHero)||(btd6usersave.primaryHero=Object.keys(constants.heroesInOrder)[0]),await fetchLocKeys(),await fetchRogueDependencies(),Promise.all([fetch("./data/Achievements150.json").then((e=>e.json())),fetch("./data/trophyStoreItems.json").then((e=>e.json())),fetch("./data/teamsStoreItems.json").then((e=>e.json()))]).then((([e,t,a])=>{achievementsJSON=e,trophyStoreItemsJSON=t,teamsStoreItemsJSON=a,readyFlags[2]=1,readyFlags[3]=1,loadSettings(),generateIfReady()})).catch((e=>{console.error("Error:",e),errorModal(e,"js")})),showLoading()}function resetScroll(){document.body.scrollTop=0,document.documentElement.scrollTop=0}function loadSettings(){let e=JSON.parse(localStorage.getItem("BTD6OAKSettings"));e&&(preventRateLimiting=e.ProfileLoading,useNamedMonkeys=e.UseNamedMonkeys,showTeamsItems=e.TeamsStoreItems)}function saveSettings(){let e={ProfileLoading:preventRateLimiting,UseNamedMonkeys:useNamedMonkeys,TeamsStoreItems:showTeamsItems};localStorage.setItem("BTD6OAKSettings",JSON.stringify(e))}function generateAvatar(e,t){let a=document.createElement("div");a.style.width=`${e}px`,a.style.height=`${e}px`,a.classList.add("avatar");let n=document.createElement("img");n.classList.add("avatar-frame","noSelect"),n.style.width=`${e}px`,n.src="../Assets/UI/InstaTowersContainer.webp",a.appendChild(n);let s=document.createElement("img");return s.classList.add("avatar-img","noSelect"),s.style.width=`${e}px`,s.src=t,a.appendChild(s),a}function openBTD6Link(e){window.location.href=e}function openBTD6Site(e){window.open(e,"_blank")}function copyLoadingIcon(e){let t=document.getElementsByClassName("loading-icon")[0].cloneNode(!0);return t.classList.add("loading-icon-leaderboard"),t.style.height="unset",e.appendChild(t),t}function formatTime(e){return[Math.floor(e/3600),Math.floor(e%3600/60),Math.floor(e%60)].map((e=>e<10?"0"+e:e)).join(":")}function formatScoreTime(e){let t=Math.floor(e/1e3),a=e%1e3,n=Math.floor(t/3600);t%=3600;let s=Math.floor(t/60),l=t%60;s=s.toString().padStart(2,"0"),l=l.toString().padStart(2,"0"),a=a.toString().padStart(3,"0");let d=`${s}:${l}.${a}`;return n>0&&(n=n.toString().padStart(2,"0"),d=`${n}:${d}`),d}function getRemainingTime(e){return(e-new Date)/1e3}function updateTimer(e,t){const a=document.getElementById(t);if(!a)return"missing";const n=getRemainingTime(e);if(n>172800){const e=Math.ceil(n/86400);a.textContent=`${e} days left`,a.style.width="130px"}else{if(n<0)return a.textContent="Finished",a.style.textAlign="right","finished";a.style.width="100px",a.textContent=formatTime(n)}}function relativeTime(e,t){const a=[{name:"year",ms:31536e6},{name:"month",ms:2592e6},{name:"day",ms:864e5},{name:"hour",ms:36e5},{name:"minute",ms:6e4},{name:"second",ms:1e3}],n=e-t;for(const e of a){if(n<e.ms)continue;let t=Math.round(n/e.ms);return`${t} ${e.name}${t>1?"s":""} ago`}}function changeHexBGColor(e){null!=e?document.body.style.backgroundColor=`rgb(${255*e[0]},${255*e[1]},${255*e[2]})`:document.body.style.removeProperty("background-color")}function ratioCalc(e,t,a,n,s){switch(e){case 1:return a*(n/s);case 2:return t*(s/n);case 3:return s*(t/a);case 4:return n*(a/t)}}function processRewardsString(e){let t={},a=e.split("#"),n=0;for(let e of a){t[n]={};let a=e.split(":"),s=a[0];if(!["MonkeyMoney","Power","InstaMonkey","KnowledgePoints","RandomInstaMonkey","Trophy"].includes(s)){t[n].type="Other",t[n].value=s,n++;continue}let l=a[1].split(",");switch(s){case"MonkeyMoney":t[n].type="MonkeyMoney",t[n].amount=parseInt(l[0]);break;case"Power":t[n].type="Power",t[n].power=l[0],t[n].amount=parseInt(l[1]),null==l[1]&&(t[n].amount=1);break;case"InstaMonkey":t[n].type="InstaMonkey",t[n].tower=l[0],t[n].tiers=l[1];break;case"KnowledgePoints":t[n].type="KnowledgePoints",t[n].amount=parseInt(l[0]);break;case"RandomInstaMonkey":t[n].type="RandomInstaMonkey",t[n].tier=l[0],t[n].amount=parseInt(l[1]);break;case"Trophy":t[n].type="Trophy",t[n].trophy=l[0]}n++}return t}function generateLoginDiv(e){let t=createEl("div",{classList:["d-flex","ai-center","jc-center","fd-column","bg-color-primary"]}),a=createEl("p",{classList:["site-info-header","black-outline"],innerHTML:"Login with your OAK Token!"});t.appendChild(a);const n=createEl("div");Object.entries(localStorageOAK).forEach((([t,a])=>{const s=createEl("div",{classList:["previous-oak-entry","d-flex","ai-center","ps-relative"],style:{backgroundImage:`linear-gradient(to right, transparent 80%, var(--profile-primary) 100%),url(${a.banner})`}});s.appendChild(generateAvatar(100,a.avatar)),s.appendChild(createEl("p",{classList:["profile-name","tc-white","font-luckiest","black-outline"],innerHTML:a.displayName}));const l=createEl("img",{classList:["use-button","ps-absolute"],src:"./Assets/UI/ContinueBtn.webp"});l.addEventListener("click",(async()=>{pressedStart||(pressedStart=!0,document.getElementById("loading").style.removeProperty("transform"),oak_token=t,await getSaveData(t),loggedIn=!0,e?e(oak_token):fetchMainDependencies())})),s.appendChild(l);const d=createEl("img",{classList:["delete-button","ps-absolute"],src:"./Assets/UI/CloseBtn.webp"});d.addEventListener("click",(()=>{delete localStorageOAK[t],writeLocalStorage(),n.removeChild(s)})),s.appendChild(d),n.appendChild(s)})),t.appendChild(n);let s=document.createElement("div");s.classList.add("site-access-div"),t.appendChild(s);let l=document.createElement("div");l.classList.add("oak-entry-div"),t.appendChild(l);let d=document.createElement("input");d.classList.add("key-entry"),d.placeholder="Enter your OAK here",l.appendChild(d);let r=document.createElement("div");r.classList.add("start-button","black-outline"),r.innerHTML="Start",r.addEventListener("click",(async()=>{let e=d.value;e.length<5||e.length>30||!e.startsWith("oak_")?errorModal('Please enter a valid OAK! This will start with "oak_".'):pressedStart||(document.getElementById("loading").style.removeProperty("transform"),pressedStart=!0,loggedIn=!0,oak_token=d.value,await getSaveData(oak_token),fetchMainDependencies())})),l.appendChild(r);let i=document.createElement("div");i.classList.add("get-oak-div"),t.appendChild(i);let o=document.createElement("p");o.classList.add("where-text"),o.innerHTML="Don't have an OAK token? Read here:",i.appendChild(o);let c=document.createElement("p");c.classList.add("where-button","black-outline"),c.style.width="220px",c.innerHTML="View OAK Guide",c.addEventListener("click",(()=>{openOAKInstructionsModal()})),i.appendChild(c);let p=document.createElement("div");return p.id="oak-instructions-div",p.classList.add("oak-instructions-div"),p.style.display="none",t.appendChild(p),t}function openOAKInstructionsModal(){let e=createEl("div",{style:{padding:"10px"}});return e.appendChild(createEl("p",{classList:["oak-instructions-header","black-outline"],innerHTML:"What is an Open Access Key?"})),e.appendChild(createEl("p",{classList:["oak-instructions-text"],innerHTML:"An Open Access Key (OAK) is a unique key that allows you to access your Bloons TD 6 data from Ninja Kiwi's Open Data API. The site will use this to fetch your information from the API to be displayed in a familiar way. <br><br>NOTE: Progress tracking is not available for BTD6+ on Apple Arcade and BTD6 Netflix as OAK tokens are unavailable."})),e.appendChild(createEl("p",{classList:["oak-instructions-header","black-outline"],innerHTML:"How do I get one?"})),e.appendChild(createEl("p",{classList:["oak-instructions-text"],innerHTML:"Step 1: Login and Backup your progress with a Ninja Kiwi Account in BTD6. You can do this by going to settings from the main menu and clicking on the Account button."})),e.appendChild(createEl("img",{classList:["oak-instruction-img"],src:"./Assets/UI/OAKTutorial1.webp"})),e.appendChild(createEl("p",{classList:["oak-instructions-text"],innerHTML:'Step 2: Select "Open Data API" at the bottom right of the account screen.'})),e.appendChild(createEl("img",{classList:["oak-instruction-img"],src:"./Assets/UI/OAKTutorial2.webp"})),e.appendChild(createEl("p",{classList:["oak-instructions-text"],innerHTML:'Step 3: Generate a key and copy that in to the above text field. It should start with "oak_". Then click "Start" to begin!'})),e.appendChild(createEl("img",{classList:["oak-instruction-img"],src:"./Assets/UI/OAKTutorial3.webp"})),e.appendChild(createEl("p",{classList:["oak-instructions-text"],innerHTML:'You can read more about the Open Data API here: <a href="https://ninja.kiwi/opendatafaq" target="_blank", style="color:white";>Open Data API Article</a><br><br>Privacy Note: This app does not store any data being sent to or retrieved from Ninja Kiwi\'s Open Data API outside of your browser/device. The localStorage browser feature is used to prevent users from having to re-enter their OAK token every time they visit the site. If you would like to delete this stored data, you can do so by clicking the "X" on the profile you would like to delete on this homepage or clearing your browsing data.'})),createModal({header:"OAK Instructions",content:e}),e}function errorModal(e,t,a){if(isErrorModalOpen&&!a)return;let n=document.createElement("div");n.classList.add("error-modal-overlay"),document.body.appendChild(n);let s=document.createElement("div");s.id="error-modal",s.classList.add("error-modal"),n.appendChild(s);let l=document.createElement("div");l.id="error-modal-header",l.classList.add("error-modal-header"),s.appendChild(l);let d=document.createElement("img");d.id="error-modal-header-img",d.classList.add("error-modal-header-img"),d.src="./Assets/UI/BadConnectionBtn.webp",l.appendChild(d);let r=document.createElement("p");r.classList.add("error-modal-header-text","black-outline"),r.innerHTML="Error",l.appendChild(r);let i=document.createElement("div");i.classList.add("error-modal-dummy"),l.appendChild(i);let o=document.createElement("div");o.id="error-modal-content",o.classList.add("error-modal-content"),o.innerHTML=""+e,s.appendChild(o);let c=document.createElement("div");if(c.classList.add("error-modal-content"),"Invalid user ID / Player Does not play this game"===e)c.innerHTML="Please try again or create a new Open Access Key.",s.appendChild(c);if("ratelimit"==t){let e=document.createElement("div");e.classList.add("error-toggle-div"),s.appendChild(e);let t=document.createElement("p");t.classList.add("maps-progress-coop-toggle-text","black-outline"),t.innerHTML="Manually Load Profiles: ",e.appendChild(t);let a=document.createElement("input");a.classList.add("maps-progress-coop-toggle-input"),a.type="checkbox",a.checked=preventRateLimiting,a.addEventListener("change",(()=>{preventRateLimiting=!!a.checked})),e.appendChild(a)}let p=document.createElement("div");p.classList.add("error-modal-ok-button-div"),s.appendChild(p);let m=document.createElement("div");m.classList.add("start-button","modal-ok-button","black-outline"),m.innerHTML="OK",m.addEventListener("click",(()=>{isErrorModalOpen=!1,document.body.removeChild(n)})),p.appendChild(m);let u=document.createElement("img");u.classList.add("error-modal-close"),u.src="./Assets/UI/CloseBtn.webp",u.addEventListener("click",(()=>{isErrorModalOpen=!1,document.body.removeChild(n)})),o.appendChild(u),isErrorModalOpen=!0}backButton.addEventListener("click",(()=>{goBack()})),document.querySelector(".header").prepend(backButton);const rtf=new Intl.RelativeTimeFormat("en",{style:"long"});function getRelativeTimeString(e){const t=e-Date.now(),a=Math.abs(t),n=36e5,s=24*n;let l,d;return a>=s?(l=Math.round(t/s),d="day"):a>=n?(l=Math.round(t/n),d="hour"):(l=Math.round(t/6e4),d="minute"),rtf.format(l,d)}function registerTimer(e,t){t instanceof Date||(t=new Date(t)),activeTimers.set(e,t),ensureTimerLoop(),updateTimer(t,e)}function ensureTimerLoop(){null==timerInterval&&(timerInterval=setInterval((()=>{if(0===activeTimers.size)return clearInterval(timerInterval),void(timerInterval=null);for(let[e,t]of activeTimers){const a=updateTimer(t,e);"missing"!==a&&"finished"!==a||activeTimers.delete(e)}}),1e3))}function clearAllTimers(){activeTimers.clear(),timerInterval&&(clearInterval(timerInterval),timerInterval=null)}function generateCheckbox(e,t,a){let n=document.createElement("div");n.classList.add("checkbox-div");let s=document.createElement("p");s.classList.add("checkbox-label","black-outline"),s.innerHTML=e,n.appendChild(s);let l=document.createElement("input");return l.classList.add("checkbox-input"),l.type="checkbox",l.checked=t,a&&l.addEventListener("change",(()=>{a(l.checked)})),n.appendChild(l),n}function generateDropdown(e,t,a,n){let s=document.createElement("div");s.classList.add("d-flex","ai-center");let l=document.createElement("p");l.classList.add("dropdown-label","black-outline"),l.innerHTML=e,s.appendChild(l);let d=document.createElement("select");return d.classList.add("dropdown-select"),t.forEach((e=>{let t=document.createElement("option");t.value=e,t.innerHTML=e,d.appendChild(t)})),s.appendChild(d),d.value=a,d.addEventListener("change",(()=>{n(d.value)})),s.appendChild(d),s}function generateToggle(e=!1,t){let a=document.createElement("label");a.classList.add("setting-input-label","switch");let n=document.createElement("input");n.classList.add("setting-input"),n.type="checkbox",n.checked=e,a.appendChild(n);let s=document.createElement("span");return s.classList.add("toggle-img","slider"),a.appendChild(s),n.addEventListener("change",(()=>{t&&t(n.checked)})),a}function generateButton(e,t,a){let n=document.createElement("button");return n.classList.add("where-button","black-outline"),n.style.width=t,n.innerHTML=e,n.addEventListener("click",a),n}function generateNumberInput(e,t,a,n,s,l){let d=document.createElement("div");d.classList.add("d-flex","ai-center","jc-between"),d.style.gap="10px",d.style.flexWrap="wrap";let r=document.createElement("p");r.classList.add("black-outline"),r.style.fontSize="24px",r.innerHTML=e,d.appendChild(r);let i=document.createElement("input");return i.classList.add("font-gardenia","ta-center"),i.value=t,i.min=a,i.max=n,i.step=s,i.style.width="80px",i.style.height="30px",i.style.color="white",i.style.fontSize="24px",i.style.backgroundColor="var(--profile-tertiary)",i.addEventListener("change",(()=>{let e=parseFloat(i.value);isNaN(e)||(e<a&&(e=a),e>n&&(e=n),i.value=e,l(e))})),d.appendChild(i),d}function generateSelectorTab(e,t=!1){const a=document.createElement("div");return a.classList.add("maps-progress-view","black-outline"),t&&a.classList.add("stats-tab-yellow"),a.textContent=e,a}