let e,t={},d="Simple",n=null,a=null,s=0,l=0,i=!1,o=null,r=[],c=140,u=[];function m(){let e=0;function t(){e--,0===e&&(document.getElementById("loading").style.transform="scale(0)")}new MutationObserver((d=>{d.forEach((d=>{"childList"===d.type&&d.addedNodes.forEach((d=>{"IMG"===d.nodeName&&(e++,d.addEventListener("load",t))}))}))})).observe(document.body,{childList:!0,subtree:!0}),document.getElementById("loading").style.removeProperty("transform")}function p(){document.getElementById("loading").style.transform="scale(0)"}fetch("./data/Constants.json").then((e=>e.json())).then((e=>{t=e,y()})).catch((e=>{console.error("Error:",e),N(e,"js")}));const h=document.createElement("div");document.body.appendChild(h),document.body.classList.add("hex-bg");const g=document.createElement("div");g.classList.add("header"),h.appendChild(g);const b=document.createElement("div");b.classList.add("header-div"),g.appendChild(b);const v=document.createElement("h1");v.classList.add("title"),v.innerHTML="Bloons TD 6 Roundsets",b.appendChild(v);const L=document.createElement("div");L.classList.add("content"),h.appendChild(L);const w=document.createElement("div");w.id="extras-content",w.classList.add("extras","content-div"),w.style.display="flex",L.appendChild(w);const E=document.createElement("div");function y(){let e=document.getElementById("extras-content");e.innerHTML="";let d=document.createElement("div");d.classList.add("progress-page","page-extra"),e.appendChild(d);let n=document.createElement("p");n.classList.add("roundset-header-text","black-outline"),n.innerHTML="Select a roundset to view:",d.appendChild(n);let a=document.createElement("div");a.classList.add("selectors-div"),d.appendChild(a);let s={},l={};Object.entries(t.limitedTimeEvents).forEach((([e,t])=>{t.end>Date.now()?s[e]=t:l[e]=t})),Object.entries(s).forEach((([e,t])=>{let d=document.createElement("div");d.classList.add("roundset-selector-div"),d.addEventListener("click",(()=>{m(),C("extras",t.roundset)})),a.appendChild(d);let n=document.createElement("img");switch(n.classList.add("roundset-selector-img"),d.appendChild(n),t.type){case"Race":n.src="../Assets/UI/EventRaceBtn.webp",d.classList.add("race-roundset");break;case"Odyssey":n.src="../Assets/UI/OdysseyEventBtn.webp",d.classList.add("odyssey-roundset");break;case"Boss":n.src=`../Assets/BossIcon/${t.boss[0].toUpperCase()+t.boss.slice(1)}EventIcon.webp`,d.classList.add("boss-roundset")}let s=document.createElement("div");s.classList.add("roundset-selector-text-div"),d.appendChild(s);let l=document.createElement("p");l.classList.add("selector-text","black-outline"),l.innerHTML=`${t.type} Event - ${e}`,s.appendChild(l);let i=document.createElement("p");i.id="time-left-"+e,i.classList.add("selector-text","black-outline"),s.appendChild(i),new Date<new Date(t.start)?i.innerHTML="Coming Soon!":new Date(t.end)>new Date&&(D(new Date(t.end),i.id),timerInterval=setInterval((()=>D(new Date(t.end),i.id)),1e3));let o=document.createElement("img");o.classList.add("selector-go-img"),o.src="../Assets/UI/ContinueBtn.webp",d.appendChild(o)}));let i=Object.fromEntries(Object.entries(t.roundSets).filter((([e,t])=>"normal"===t.type))),o=Object.fromEntries(Object.entries(t.roundSets).filter((([e,t])=>"boss"===t.type))),r=Object.fromEntries(Object.entries(t.roundSets).filter((([e,t])=>"legends"===t.type))),c=Object.fromEntries(Object.entries(t.roundSets).filter((([e,t])=>"quest"===t.type)));Object.entries(i).forEach((([e,t])=>{let d=document.createElement("div");d.classList.add("roundset-selector-div","wood-container"),d.addEventListener("click",(()=>{m(),C("extras",e)})),a.appendChild(d);let n=document.createElement("img");n.classList.add("roundset-selector-img"),n.src=`../Assets/UI/${t.icon}.webp`,d.appendChild(n);let s=document.createElement("p");s.classList.add("selector-text","black-outline"),s.innerHTML=t.name,d.appendChild(s);let l=document.createElement("img");l.classList.add("selector-go-img"),l.src="../Assets/UI/ContinueBtn.webp",d.appendChild(l)})),Object.entries(r).forEach((([e,t])=>{let d=document.createElement("div");d.classList.add("roundset-selector-div","veteran-container"),d.addEventListener("click",(()=>{m(),C("extras",e)})),a.appendChild(d);let n=document.createElement("img");n.classList.add("roundset-selector-img"),n.src=`../Assets/UI/${t.icon}.webp`,d.appendChild(n);let s=document.createElement("p");s.classList.add("selector-text","black-outline"),s.innerHTML=t.name,d.appendChild(s);let l=document.createElement("img");l.classList.add("selector-go-img"),l.src="../Assets/UI/ContinueBtn.webp",d.appendChild(l)}));let u=document.createElement("p");u.classList.add("other-roundsets-selector-text","black-outline"),u.innerHTML="Boss Custom Rounds",a.appendChild(u);let p=document.createElement("div");p.classList.add("other-roundsets-selector-div"),a.appendChild(p),Object.entries(o).forEach((([e,t])=>{let d=document.createElement("div");d.classList.add("other-roundset-selector-div"),d.addEventListener("click",(()=>{C("extras",e)})),p.appendChild(d);let n=document.createElement("img");n.classList.add("other-roundset-selector-img"),n.src=`../Assets/UI/${t.icon}.webp`,d.appendChild(n)}));let h=document.createElement("p");h.classList.add("other-roundsets-selector-text","black-outline"),h.innerHTML="Quest Custom Rounds",a.appendChild(h);let g=document.createElement("div");g.classList.add("other-roundsets-selector-div"),a.appendChild(g),Object.entries(c).forEach((([e,t])=>{let d=document.createElement("div");d.classList.add("other-roundset-selector-div"),d.addEventListener("click",(()=>{C("extras",e)})),g.appendChild(d);let n=document.createElement("p");n.classList.add("other-roundset-selector-text","black-outline");let a=e.match(/(Part|Stage)(\d+)/i);null!=a&&(n.innerHTML=`${a[1]} ${a[2]}`,d.appendChild(n));let s=document.createElement("img");s.classList.add("other-roundset-selector-img"),s.src=`../Assets/QuestIcon/${t.icon}.webp`,d.appendChild(s)}));let b=document.createElement("div");b.classList.add("known-previous-events-div"),a.appendChild(b);let v=document.createElement("p");v.classList.add("other-roundsets-selector-text","black-outline"),v.innerHTML="Known Previous Events",b.appendChild(v),Object.entries(l).forEach((([e,t])=>{let d=document.createElement("div");d.classList.add("roundset-selector-div"),d.addEventListener("click",(()=>{m(),C("extras",t.roundset)})),a.appendChild(d);let n=document.createElement("img");switch(n.classList.add("roundset-selector-img"),d.appendChild(n),t.type){case"Race":n.src="../Assets/UI/EventRaceBtn.webp",d.classList.add("race-roundset");break;case"Odyssey":n.src="../Assets/UI/OdysseyEventBtn.webp",d.classList.add("odyssey-roundset");break;case"Boss":n.src=`../Assets/BossIcon/${t.boss[0].toUpperCase()+t.boss.slice(1)}EventIcon.webp`,d.style.backgroundImage=`url(../Assets/EventBanner/EventBannerSmall${t.boss[0].toUpperCase()+t.boss.slice(1)}.webp)`,d.classList.add("boss-roundset")}let s=document.createElement("div");s.classList.add("roundset-selector-text-div"),d.appendChild(s);let l=document.createElement("p");l.classList.add("selector-text","black-outline"),l.innerHTML=`${t.type} Event - ${e}`,s.appendChild(l);let i=document.createElement("p");i.id="time-left-"+e,i.classList.add("selector-text","black-outline"),s.appendChild(i),new Date<new Date(t.start)?i.innerHTML="Coming Soon!":new Date(t.end)>new Date?(D(new Date(t.end),i.id),timerInterval=setInterval((()=>D(new Date(t.end),i.id)),1e3)):i.innerHTML=`${new Date(t.start).toLocaleDateString()} - ${new Date(t.end).toLocaleDateString()}`;let o=document.createElement("img");o.classList.add("selector-go-img"),o.src="../Assets/UI/ContinueBtn.webp",d.appendChild(o)}));let L=document.createElement("div");L.classList.add("sku-roundset-selector-div"),a.appendChild(L);let w=document.createElement("p");w.classList.add("other-roundsets-selector-text","black-outline"),w.innerHTML="Other Custom Rounds",L.appendChild(w);let E=document.createElement("p");E.classList.add("sku-roundset-selector-desc"),E.innerHTML="These mostly old roundsets will have only been used in one-off events such as Odysseys, Races, or Bosses and may not have ended up being used for their intended purpose despite their name. Take these roundsets with a grain of salt. I'm including them on the viewer for completeness sake.",L.appendChild(E);let y=document.createElement("div");y.classList.add("sku-roundsets-selector-div"),L.appendChild(y),t.skuRoundsets.forEach((e=>{let t=document.createElement("div");t.classList.add("sku-roundset-selector-div"),t.addEventListener("click",(()=>{C("extras",e)})),y.appendChild(t);let d=document.createElement("p");d.classList.add("sku-roundset-selector-text","black-outline"),d.innerHTML=e,t.appendChild(d)}));let f=document.createElement("p");f.classList.add("sku-roundset-selector-desc"),f.style.textAlign="center",f.innerHTML='This is a standalone form of the roundset viewer from a project called Bloons TD 6 API Explorer which allows you to view current and previous event data available on the API as well as track your progress. You can view it here: <a href="https://BTD6APIExplorer.github.io">Bloons TD 6 API Explorer</a>',d.appendChild(f)}async function C(l,i){let u=document.getElementById("roundset-content");u.style.display="flex",u.innerHTML="",document.getElementById(`${l}-content`).style.display="none",P();let p=await fetch(`./data/${i}.json`).then((e=>e.json())),h="unknown";t.roundSets[i]&&(h=t.roundSets[i].type),n=x(i,p),a=i;let g=document.createElement("div");g.classList.add("roundset-header-bar"),u.appendChild(g);let b=document.createElement("div");b.classList.add("roundset-header-title"),g.appendChild(b);let v=document.createElement("div");v.classList.add("roundset-header-left"),b.appendChild(v);let L=document.createElement("p");L.classList.add("roundset-header-text","black-outline"),L.innerHTML=t.roundSets[i]?t.roundSets[i].name:i,b.appendChild(L);let w=document.createElement("div");w.classList.add("roundset-header-right"),b.appendChild(w);let E=document.createElement("img");if(E.classList.add("modal-close"),E.src="./Assets/UI/CloseBtn.webp",E.addEventListener("click",(()=>{u.style.display="none",document.getElementById(`${l}-content`).style.display="flex"})),w.appendChild(E),i.startsWith("Rogue")){let e=document.createElement("div");e.classList.add("d-flex","jc-evenly"),g.appendChild(e),["RogueRoundSet","RogueBloonierSet","RogueDenseSet","RoguePinkSet","RoguePurpleSet","RogueImmuneSet","RogueLeadSet"].forEach((t=>{let d=document.createElement("div");d.classList.add("pointer"),d.addEventListener("click",(()=>{m(),C(l,t)})),e.appendChild(d),t==i&&(d.style.border="5px #00ff00 solid",d.style.borderRadius="20px");let n=document.createElement("img");n.classList.add("roundset-header-rogue-img"),n.style.width="100px",n.src=`../Assets/UI/${t}.webp`,d.appendChild(n)}))}let y=document.createElement("div");y.classList.add("roundset-header-bar-bottom"),g.appendChild(y);let f=document.createElement("div");f.classList.add("maps-progress-views"),y.appendChild(f);let T=document.createElement("p");T.classList.add("maps-progress-coop-toggle-text","maps-progress-view-list","black-outline"),T.innerHTML="Display Type:",f.appendChild(T);let I=document.createElement("div");I.classList.add("maps-progress-view","stats-tab-yellow","black-outline"),I.innerHTML="Simple",f.appendChild(I);let M=document.createElement("div");M.classList.add("maps-progress-view","black-outline"),M.innerHTML="Detailed",f.appendChild(M);let H=document.createElement("div");H.classList.add("maps-progress-view","black-outline"),H.innerHTML="Preview",f.appendChild(H);let F=document.createElement("div");F.classList.add("maps-progress-filter"),y.appendChild(F);let A=document.createElement("div");A.classList.add("map-progress-filter-difficulty");let S=document.createElement("p");S.classList.add("maps-progress-coop-toggle-text","black-outline"),A.appendChild(S);let $=document.createElement("input");$.id="roundset-modified-checkbox",$.classList.add("maps-progress-coop-toggle-input"),$.type="checkbox",A.appendChild($),"boss"==h?(r=[],n.rounds.forEach(((e,t)=>{e.hasOwnProperty("modified")&&r.push(e.roundNumber)})),$.checked=!0,F.appendChild(A),S.innerHTML="Only Modified:",e="modified",o=$):"quest"==h?(r=[],n.rounds.forEach(((e,d)=>{e.roundNumber>t.roundSets[i].endRound||r.push(e.roundNumber)})),S.innerHTML="Hide Unused:",e="unused",c=t.roundSets[i].endRound,F.appendChild(A),$.checked=!0,o=$):o=null;let D=document.createElement("div");D.classList.add("maps-progress-coop-toggle"),F.appendChild(D);let O=document.createElement("p");O.classList.add("maps-progress-coop-toggle-text","black-outline"),O.innerHTML="Reverse:",D.appendChild(O);let N=document.createElement("input");N.id="roundset-reverse-checkbox",N.classList.add("maps-progress-coop-toggle-input"),N.type="checkbox",D.appendChild(N);let U=document.createElement("div");U.id="rounds-content",U.classList.add("rounds-content"),u.appendChild(U),I.addEventListener("click",(()=>{I.classList.add("stats-tab-yellow"),M.classList.remove("stats-tab-yellow"),H.classList.remove("stats-tab-yellow"),d="Simple",k(d,N.checked,$.checked)})),M.addEventListener("click",(()=>{M.classList.add("stats-tab-yellow"),I.classList.remove("stats-tab-yellow"),H.classList.remove("stats-tab-yellow"),d="Topper",k(d,N.checked,$.checked)})),H.addEventListener("click",(()=>{H.classList.add("stats-tab-yellow"),I.classList.remove("stats-tab-yellow"),M.classList.remove("stats-tab-yellow"),d="Preview",k(d,N.checked,$.checked)})),N.addEventListener("change",(()=>{B(N.checked)})),$.addEventListener("change",(()=>{R($.checked)})),s=0,d="Simple",k(d,N.checked,$.checked),R($.checked)}function f(e,t){return null!=t&&t.rounds.forEach(((t,d)=>{let n=e.rounds.findIndex((e=>e.roundNumber==t.roundNumber));t.addToRound?-1!=n&&(e.rounds[n].bloonGroups=e.rounds[n].bloonGroups.concat(t.bloonGroups),e.rounds[n].addToRound=!0):-1!=n&&(e.rounds[n]=t)})),e}function x(e,d){return["DefaultRoundSet","AlternateRoundSet","RogueRoundSet"].includes(e)&&d.rounds.forEach(((d,n)=>{switch(e){case"DefaultRoundSet":t.roundHints.hasOwnProperty("Hint "+(d.roundNumber-1))&&(d.hint=t.roundHints["Hint "+(d.roundNumber-1)]);break;case"AlternateRoundSet":t.roundHints.hasOwnProperty("Alternate Hint "+(d.roundNumber-1))&&(d.hint=t.roundHints["Alternate Hint "+(d.roundNumber-1)]);break;case"RogueRoundSet":t.roundHints.hasOwnProperty("Rogue Hint "+(d.roundNumber-1))&&(d.hint=t.roundHints["Rogue Hint "+(d.roundNumber-1)])}})),d}async function k(e,t,d){let c=document.getElementById("rounds-content");c.innerHTML="";let u=!0,m=[];n.rounds.forEach(((e,t)=>{m.push(e.roundNumber)}));for(let e=0;e<m.length;e++)if(m[e]!=e+1){u=!1;break}switch(e){case"Simple":H();let e=!1;n.rounds.forEach((async(t,d)=>{let n=document.createElement("div");n.id=`round-${t.roundNumber}`,n.classList.add("round-div"),e&&n.classList.add("round-div-alt");let a=document.createElement("p");a.classList.add("round-number","black-outline"),a.innerHTML=t.roundNumber,n.appendChild(a);let s=document.createElement("div");s.id=`round-${t.roundNumber}-groups`,s.classList.add("round-bloon-groups"),n.appendChild(s);let l=document.createDocumentFragment();t.bloonGroups.sort(((e,t)=>e.start-t.start)).forEach(((e,t)=>{let d=document.createElement("div");d.classList.add("bloon-group-div");let n=document.createElement("p");n.classList.add("bloon-group-number","black-outline"),n.innerHTML="x"+e.count,d.appendChild(n);let a=document.createElement("img");a.classList.add("bloon-group-bloon"),a.src=`../Assets/BloonIcon/${e.bloon}.webp`,a.loading="lazy",d.appendChild(a),l.appendChild(d)})),s.appendChild(l),c.appendChild(n),e=!e})),document.getElementById("roundset-reverse-checkbox").checked&&B(),null!=o&&o.checked&&R(!0);break;case"Topper":H();let d=document.createElement("div");d.classList.add("rounds-detailed-div"),c.appendChild(d),F(d),setTimeout((()=>{let e=document.createDocumentFragment(),a=document.createElement("div");a.classList.add("disclaimer-div"),e.appendChild(a);let s=document.createElement("p");s.classList.add("disclaimer"),s.innerHTML="This layout is based on Topper's website:",a.appendChild(s);let l=document.createElement("a");l.classList.add("disclaimer-link"),l.href="https://topper64.co.uk/nk/btd6/rounds/",l.target="_blank",l.innerHTML="Topper's Round Information",a.appendChild(l);n.rounds.forEach((async(d,n)=>{let a=document.createElement("div");a.id=`round-${d.roundNumber}`,a.classList.add("round-div-detailed"),t&&a.classList.add("round-div-reverse");let s=document.createElement("div");s.classList.add("rounds-div-header"),a.appendChild(s);let l=document.createElement("p");l.classList.add("round-number","round-number-detailed","black-outline"),l.innerHTML=`Round ${d.roundNumber}`,s.appendChild(l);let i=document.createElement("div");i.classList.add("income-div"),s.appendChild(i);let o=document.createElement("img");o.classList.add("income-img"),o.src="../Assets/UI/CoinIcon.webp",i.appendChild(o);let r=document.createElement("div");r.classList.add("income-text-div"),i.appendChild(r);let c=document.createElement("p");c.classList.add("round-income","black-outline"),c.innerHTML=`Income: ${d.income.toLocaleString()}`,r.appendChild(c);let m=document.createElement("p");m.classList.add("round-income-total","black-outline"),m.innerHTML=`Total: ${d.incomeSum.toLocaleString()}`,u&&r.appendChild(m);let p=document.createElement("div");p.classList.add("rbe-div"),s.appendChild(p);let h=document.createElement("img");h.classList.add("rbe-img"),h.src="../Assets/BloonIcon/Red.webp",p.appendChild(h);let g=document.createElement("div");g.classList.add("rbe-text-div"),p.appendChild(g);let b=document.createElement("p");b.classList.add("round-rbe","black-outline"),b.innerHTML=`RBE: ${d.rbe.toLocaleString()}`,g.appendChild(b);let v=document.createElement("p");v.classList.add("round-rbe-total","black-outline"),v.innerHTML=`Total: ${d.rbeSum.toLocaleString()}`,u&&g.appendChild(v);let L=d.bloonGroups.length?Math.max(...d.bloonGroups.map((e=>e.end))):0,w=document.createElement("p");if(w.classList.add("round-duration","black-outline"),w.innerHTML=`Duration: ${L.toFixed(2)}s`,s.appendChild(w),d.hint){let e=document.createElement("div");e.classList.add("round-hint-div","coop-border"),a.appendChild(e);let t=document.createElement("p");t.classList.add("round-hint-x"),t.innerHTML="X",t.addEventListener("click",(()=>{e.style.display="none"})),e.appendChild(t);let n=document.createElement("p");n.classList.add("round-hint"),n.innerHTML=d.hint,e.appendChild(n)}let E=document.createElement("div");E.classList.add("timeline-div"),a.appendChild(E),d.bloonGroups.forEach(((e,t)=>{let d=document.createElement("div");d.classList.add("bloon-group-div-detailed"),E.appendChild(d);let n=document.createElement("div");n.classList.add("left-div"),d.appendChild(n);let a=document.createElement("img");a.classList.add("bloon-image"),a.src=`../Assets/BloonIcon/${e.bloon}.webp`,n.appendChild(a);let s=document.createElement("p");s.classList.add("bloon-count","black-outline"),s.innerHTML="x"+e.count,n.appendChild(s);let l=document.createElement("div");l.classList.add("timeline-right-div"),d.appendChild(l);let i=document.createElement("div");i.classList.add("bloon-bar"),l.appendChild(i);let o=document.createElement("div");o.classList.add("bloon-bar-fill"),o.style.background=Z[e.bloon.replace("Camo","").replace("Regrow","").replace("Fortified","")].color,e.bloon.includes("Rainbow")||(o.style.border=`4px solid ${Z[e.bloon.replace("Camo","").replace("Regrow","").replace("Fortified","")].border}`);let r=(e.end-e.start)/L*100,c=e.start/L*100;r<5&&(r=5),c+r>100&&(c=100-r),o.style.width=`${r}%`,o.style.left=`${c}%`,i.appendChild(o)})),e.appendChild(a)})),d.innerHTML="",d.appendChild(e),document.getElementById("roundset-reverse-checkbox").checked&&B(),null!=o&&o.checked&&R(!0)}),0);break;case"Preview":H();let m=document.createElement("div");m.classList.add("preview-container-div"),c.appendChild(m);let p=document.createElement("div");p.classList.add("preview-div"),m.appendChild(p);let h=document.createElement("div");h.classList.add("preview-header"),p.appendChild(h);let g=document.createElement("p");g.id="round-number-preview",g.classList.add("round-number","round-number-preview","black-outline"),g.innerHTML=`Round ${n.rounds[s].roundNumber}`,h.appendChild(g);let b=document.createElement("input");b.id="select-round-num-preview",b.classList.add("select-round-num"),b.type="number",b.min=1,b.max=n.rounds.length,b.value=s+1,b.addEventListener("change",(()=>{b.value<1&&(b.value=1),b.value>n.rounds.length&&(b.value=n.rounds.length),g.innerHTML=`Round ${n.rounds[s].roundNumber}`,s=b.value-1,T()})),h.appendChild(b);let v=document.createElement("div");v.classList.add("preview-right-div"),h.appendChild(v);let L=document.createElement("img");L.classList.add("clear-button"),L.src="../Assets/UI/DestroyBloonsBtn.webp",L.addEventListener("click",(()=>{M()})),v.appendChild(L);let w=document.createElement("img");w.classList.add("play-normal-button"),w.src="../Assets/UI/GoBtnSmall.webp",w.addEventListener("click",(()=>{G=1,g.innerHTML=`Round ${n.rounds[s].roundNumber}`,M(),ee(n.rounds[s])})),v.appendChild(w);let E=document.createElement("img");E.classList.add("play-fast-button"),E.src="../Assets/UI/FastForwardBtn.webp",E.addEventListener("click",(()=>{G=3,g.innerHTML=`Round ${n.rounds[s].roundNumber}`,M(),ee(n.rounds[s])})),v.appendChild(E),U=document.createElement("canvas"),U.classList.add("roundset-canvas"),U.width=800,U.height=300,p.appendChild(U);let y=document.createElement("div");y.classList.add("preview-footer-div"),p.appendChild(y);let C=document.createElement("div");C.classList.add("difficulty-div"),y.appendChild(C);let f=document.createElement("div");f.classList.add("maps-progress-view","stats-tab-yellow","black-outline"),f.innerHTML="Easy",C.appendChild(f);let x=document.createElement("div");x.classList.add("maps-progress-view","black-outline"),x.innerHTML="Medium",C.appendChild(x);let k=document.createElement("div");switch(k.classList.add("maps-progress-view","black-outline"),k.innerHTML="Hard",C.appendChild(k),f.addEventListener("click",(()=>{J=1,f.classList.add("stats-tab-yellow"),x.classList.remove("stats-tab-yellow"),k.classList.remove("stats-tab-yellow")})),x.addEventListener("click",(()=>{J=1.1,f.classList.remove("stats-tab-yellow"),x.classList.add("stats-tab-yellow"),k.classList.remove("stats-tab-yellow")})),k.addEventListener("click",(()=>{J=1.26,f.classList.remove("stats-tab-yellow"),x.classList.remove("stats-tab-yellow"),k.classList.add("stats-tab-yellow")})),a){case"AlternateRoundSet":k.click();break;case"AcceleratedRoundSet":case"EnduranceRoundSet":case"FastUpgradesRoundSet":case"MOABMadnessRoundSet":case"RogueRoundSet":case"RogueBloonierSet":case"RogueDenseSet":case"RoguePinkSet":case"RoguePurpleSet":case"RogueImmuneSet":case"RogueLeadSet":x.click()}let I=document.createElement("div");I.classList.add("next-prev-div"),y.appendChild(I);let A=document.createElement("div");A.classList.add("maps-progress-view","black-outline"),A.innerHTML="Previous",A.addEventListener("click",(()=>{null!=o&&o.checked?(l--,l<0&&(l=r.length-1),s=r[l]-1):(s--,s<0&&(s=n.rounds.length-1)),b.value=s+1,M(),T()})),I.appendChild(A);let S=document.createElement("div");S.classList.add("maps-progress-view","black-outline"),S.innerHTML="Next",S.addEventListener("click",(()=>{null!=o&&o.checked?(l++,l>=r.length&&(l=0),s=r[l]-1):(s++,s>=n.rounds.length&&(s=0)),b.value=s+1,M(),T()})),I.appendChild(S);let $=document.createElement("div");$.id="preview-round-info-div",$.classList.add("round-info-div"),p.appendChild($),j=U.getContext("2d");let D=performance.now();i=!0,requestAnimationFrame((function e(){if(!i)return;const t=performance.now(),d=(t-D)/1e3;D=t,X(d),V(),requestAnimationFrame(e)})),null!=o&&o.checked&&R(!0),T(),document.getElementById("roundset-reverse-checkbox").checked&&B()}}function R(t){switch(d){case"Simple":let d=!1;n.rounds.forEach((async(n,a)=>{let s=document.getElementById(`round-${n.roundNumber}`);t&&"modified"===e&&!n.hasOwnProperty("modified")||t&&"unused"===e&&n.roundNumber>c?s.style.display="none":(s.style.display="flex",d?s.classList.add("round-div-alt"):Array.from(s.classList).includes("round-div-alt")&&s.classList.remove("round-div-alt"),d=!d)}));break;case"Topper":n.rounds.forEach((async(d,n)=>{let a=document.getElementById(`round-${d.roundNumber}`);t&&"modified"===e&&!d.hasOwnProperty("modified")||t&&"unused"===e&&d.roundNumber>c?a.style.display="none":a.style.display="flex"}));break;case"Preview":switch(e){case"modified":t?(l=0,s=r[0]-1,document.getElementById("round-number-preview").innerHTML=`Round ${r[0]}`,document.getElementById("select-round-num-preview").value=r[0],T()):(s=0,document.getElementById("round-number-preview").innerHTML=`Round ${s+1}`,document.getElementById("select-round-num-preview").value=s+1,T());break;case"unused":t?c<s+1&&(s=0,document.getElementById("round-number-preview").innerHTML=`Round ${s+1}`,document.getElementById("select-round-num-preview").value=s+1,T()):(s=0,document.getElementById("round-number-preview").innerHTML=`Round ${s+1}`,document.getElementById("select-round-num-preview").value=s+1,T())}}}function B(){switch(d){case"Simple":n.rounds.forEach(((e,t)=>{let d=document.getElementById(`round-${e.roundNumber}-groups`);Array.from(d.children).reverse().forEach((e=>d.appendChild(e)))}));break;case"Topper":let e=document.getElementsByClassName("timeline-div");for(let t of e)t.classList.toggle("timeline-div-reverse");let t=document.getElementsByClassName("timeline-right-div");for(let e of t)e.classList.toggle("flip-horizontal");break;case"Preview":document.getElementById("preview-timeline-div").classList.toggle("timeline-div-reverse");let d=document.getElementsByClassName("preview-timeline-right-div");for(let e of d)e.classList.toggle("flip-horizontal")}M()}function T(){let e=document.getElementById("preview-round-info-div");e.innerHTML="";let t=n.rounds[s];u=[];let d=document.createElement("div");d.classList.add("round-div-detailed"),e.appendChild(d);let a=document.createElement("div");a.classList.add("rounds-div-header"),d.appendChild(a);let l=document.createElement("p");l.classList.add("round-number","round-number-detailed","black-outline"),l.innerHTML=`Round ${t.roundNumber}`,a.appendChild(l);let i=document.createElement("div");i.classList.add("income-div"),a.appendChild(i);let o=document.createElement("img");o.classList.add("income-img"),o.src="../Assets/UI/CoinIcon.webp",i.appendChild(o);let r=document.createElement("div");r.classList.add("income-text-div"),i.appendChild(r);let c=document.createElement("p");c.classList.add("round-income","black-outline"),c.innerHTML=`Income: ${t.income.toLocaleString()}`,r.appendChild(c);let m=document.createElement("p");m.classList.add("round-income-total","black-outline"),m.innerHTML=`Total: ${t.incomeSum.toLocaleString()}`,r.appendChild(m);let p=document.createElement("div");p.classList.add("rbe-div"),a.appendChild(p);let h=document.createElement("img");h.classList.add("rbe-img"),h.src="../Assets/BloonIcon/Red.webp",p.appendChild(h);let g=document.createElement("div");g.classList.add("rbe-text-div"),p.appendChild(g);let b=document.createElement("p");b.classList.add("round-rbe","black-outline"),b.innerHTML=`RBE: ${t.rbe.toLocaleString()}`,g.appendChild(b);let v=document.createElement("p");v.classList.add("round-rbe-total","black-outline"),v.innerHTML=`Total: ${t.rbeSum.toLocaleString()}`,g.appendChild(v);let L=t.bloonGroups.length?Math.max(...t.bloonGroups.map((e=>e.end))):0,w=document.createElement("p");if(w.classList.add("round-duration","black-outline"),w.innerHTML=`Duration: ${L.toFixed(2)}s`,a.appendChild(w),t.hint){let e=document.createElement("div");e.classList.add("round-hint-div","coop-border"),d.appendChild(e);let n=document.createElement("p");n.classList.add("round-hint-x"),n.innerHTML="X",n.addEventListener("click",(()=>{e.style.display="none"})),e.appendChild(n);let a=document.createElement("p");a.classList.add("round-hint"),a.innerHTML=t.hint,e.appendChild(a)}let E=document.createElement("div");E.id="preview-timeline-div",E.classList.add("timeline-div"),d.appendChild(E);t.bloonGroups.forEach(((e,t)=>{let d=document.createElement("div");d.classList.add("bloon-group-div-detailed"),d.addEventListener("click",(()=>{u.includes(t)?(d.style.filter="",u.splice(u.indexOf(t),1)):(u.push(t),d.style.filter="brightness(0.5)")})),E.appendChild(d);let n=document.createElement("div");n.classList.add("left-div"),d.appendChild(n);let a=document.createElement("img");a.classList.add("bloon-image"),a.src=`../Assets/BloonIcon/${e.bloon}.webp`,n.appendChild(a);let s=document.createElement("p");s.classList.add("bloon-count","black-outline"),s.innerHTML="x"+e.count,n.appendChild(s);let l=document.createElement("div");l.classList.add("timeline-right-div","preview-timeline-right-div"),d.appendChild(l);let i=document.createElement("div");i.classList.add("bloon-bar"),l.appendChild(i);let o=document.createElement("div");o.classList.add("bloon-bar-fill"),o.style.background=Z[e.bloon.replace("Camo","").replace("Regrow","").replace("Fortified","")].color,e.bloon.includes("Rainbow")||(o.style.border=`4px solid ${Z[e.bloon.replace("Camo","").replace("Regrow","").replace("Fortified","")].border}`);let r=(e.end-e.start)/L*100,c=e.start/L*100;r<5&&(r=5),c+r>100&&(c=100-r),o.style.width=`${r}%`,o.style.left=`${c}%`,i.appendChild(o)})),document.getElementById("roundset-reverse-checkbox").checked&&B()}function I(e){let t=document.getElementById("preview-timeline-div"),d=document.createElement("div");d.id="preview-playhead",d.classList.add("playhead"),t.appendChild(d),d.style.animation=`playhead ${e}s linear`,d.addEventListener("animationend",(function(){d.remove()}))}function M(){document.getElementById("preview-playhead")&&document.getElementById("preview-playhead").remove(),_=null,K.length=0}function H(){i=!1,M()}function F(e){let t=document.getElementsByClassName("loading-icon")[0].cloneNode(!0);t.classList.add("loading-icon-leaderboard"),t.style.height="unset",e.appendChild(t)}function A(e){null!=e?document.body.style.backgroundColor=`rgb(${255*e[0]},${255*e[1]},${255*e[2]})`:document.body.style.removeProperty("background-color")}function S(e){return[Math.floor(e/3600),Math.floor(e%3600/60),Math.floor(e%60)].map((e=>e<10?"0"+e:e)).join(":")}function $(e){return(e-new Date)/1e3}function D(e,t){const d=$(e),n=document.getElementById(t);if(d>172800){const e=Math.ceil(d/86400);n.textContent=`${e} days left`}else n.textContent=d<0?"Finished":S(d)}function O(e,t,d,n,a){switch(e){case 1:return d*(n/a);case 2:return t*(a/n);case 3:return a*(t/d);case 4:return n*(d/t)}}function P(){document.body.scrollTop=0,document.documentElement.scrollTop=0}function N(e,t,d){if(isErrorModalOpen&&!d)return;let n=document.createElement("div");n.classList.add("error-modal-overlay"),document.body.appendChild(n);let a=document.createElement("div");a.id="error-modal",a.classList.add("error-modal"),n.appendChild(a);let s=document.createElement("div");s.id="error-modal-header",s.classList.add("error-modal-header"),a.appendChild(s);let l=document.createElement("img");l.id="error-modal-header-img",l.classList.add("error-modal-header-img"),l.src="./Assets/UI/BadConnectionBtn.webp",s.appendChild(l);let i=document.createElement("p");i.classList.add("error-modal-header-text","black-outline"),i.innerHTML="Error",s.appendChild(i);let o=document.createElement("div");o.classList.add("error-modal-dummy"),s.appendChild(o);let r=document.createElement("div");r.id="error-modal-content",r.classList.add("error-modal-content"),r.innerHTML=""+e,a.appendChild(r);let c=document.createElement("div");if(c.classList.add("error-modal-content"),"Invalid user ID / Player Does not play this game"===e)c.innerHTML="Please try again or create a new Open Access Key.",a.appendChild(c);if("ratelimit"==t){let e=document.createElement("div");e.classList.add("error-toggle-div"),a.appendChild(e);let t=document.createElement("p");t.classList.add("maps-progress-coop-toggle-text","black-outline"),t.innerHTML="Manually Load Profiles: ",e.appendChild(t);let d=document.createElement("input");d.classList.add("maps-progress-coop-toggle-input"),d.type="checkbox",d.checked=preventRateLimiting,d.addEventListener("change",(()=>{d.checked?preventRateLimiting=!0:preventRateLimiting=!1})),e.appendChild(d)}let u=document.createElement("div");u.classList.add("error-modal-ok-button-div"),a.appendChild(u);let m=document.createElement("div");m.classList.add("start-button","modal-ok-button","black-outline"),m.innerHTML="OK",m.addEventListener("click",(()=>{isErrorModalOpen=!1,document.body.removeChild(n)})),u.appendChild(m);let p=document.createElement("img");p.classList.add("error-modal-close"),p.src="./Assets/UI/CloseBtn.webp",p.addEventListener("click",(()=>{isErrorModalOpen=!1,document.body.removeChild(n)})),r.appendChild(p),isErrorModalOpen=!0}let U,j;E.id="roundset-content",E.classList.add("roundset","sub-content-div"),L.appendChild(E);let G=1,Z={Red:{name:"Red",rbe:1,speed:25,layer:1,scale:.8,color:"#ED0F0F",border:"#690000"},Blue:{name:"Blue",rbe:2,speed:35,layer:2,scale:.85,color:"#2797E0",border:"#004772"},Green:{name:"Green",rbe:3,speed:45,layer:3,scale:.9,color:"#77A80F",border:"#3D5400"},Yellow:{name:"Yellow",rbe:4,speed:80,layer:4,scale:.95,color:"#FFD50F",border:"#8E620C"},Pink:{name:"Pink",rbe:5,speed:87.5,layer:5,scale:1,color:"#F15060",border:"#A92626"},Black:{name:"Black",rbe:11,speed:45,layer:6,scale:.58,color:"#161616",border:"#414141"},Purple:{name:"Purple",rbe:11,speed:75,layer:7,scale:.95,color:"#9326E0",border:"#00E4FF"},White:{name:"White",rbe:12,speed:50,layer:6,scale:.58,color:"#D7D7D7",border:"#727272"},Lead:{name:"Lead",rbe:23,speed:25,layer:7,scale:.95,color:"#7E7E7E",border:"#2F2F2F"},Zebra:{name:"Zebra",rbe:23,speed:45,layer:7,scale:.9,color:"repeating-linear-gradient(145deg, #040404, #040404 10px, #ffffff 10px, #ffffff 20px)",border:"#5A5A5A"},Rainbow:{name:"Rainbow",rbe:47,speed:55,layer:8,scale:1,color:"linear-gradient(180deg, rgba(228,26,26,1) 0%, rgba(255,159,0,1) 16%, rgba(255,224,0,1) 33%, rgba(125,181,4,1) 48%, rgba(83,176,222,1) 66%, rgba(226,74,226,1) 84%, rgba(132,21,132,1) 100%)",border:"transparent"},Ceramic:{name:"Ceramic",rbe:47,speed:62.5,layer:9,scale:1,color:"#BE6C1D",border:"#61370B"},Moab:{name:"Moab",rbe:616,speed:25,layer:10,color:"#2AC2FF",border:"#FFFFFF"},Bfb:{name:"Bfb",rbe:3164,speed:6.25,layer:11,color:"#C00505",border:"#FFFFFF"},Zomg:{name:"Zomg",rbe:16656,speed:4.5,layer:12,color:"#575757",border:"#B7F700"},Ddt:{name:"Ddt",rbe:3164,speed:66,layer:12,color:"#3C3C3C",border:"#A5A5A5"},Bad:{name:"Bad",rbe:16464,speed:4.5,layer:13,color:"#AB02AC",border:"#500151"}},W=new Image;W.src="../Assets/BloonIcon/preview_bloons_spritesheet.webp";let Y={CeramicCamo:{x:1153,y:0,width:129,height:163},CeramicFortified:{x:993,y:547,width:140,height:163},CeramicFortifiedCamo:{x:993,y:711,width:140,height:163},CeramicRegrow:{x:0,y:782,width:176,height:162},CeramicRegrowCamo:{x:177,y:782,width:176,height:162},CeramicRegrowFortified:{x:629,y:0,width:186,height:162},CeramicRegrowFortifiedCamo:{x:629,y:163,width:186,height:162},Black:{x:1283,y:790,width:78,height:97},BlackCamo:{x:1283,y:888,width:78,height:97},BlackRegrow:{x:833,y:945,width:105,height:97},BlackRegrowCamo:{x:708,y:782,width:105,height:97},Blue:{x:1283,y:148,width:110,height:139},BlueCamo:{x:1283,y:288,width:110,height:139},BlueRegrow:{x:408,y:641,width:150,height:138},BlueRegrowCamo:{x:993,y:146,width:150,height:138},Ceramic:{x:1153,y:164,width:129,height:163},LeadFortifiedCamo:{x:993,y:875,width:133,height:156},LeadRegrow:{x:816,y:326,width:168,height:154},LeadRegrowCamo:{x:816,y:481,width:168,height:154},LeadRegrowFortified:{x:629,y:326,width:178,height:154},LeadRegrowFortifiedCamo:{x:629,y:481,width:178,height:154},Green:{x:878,y:1100,width:116,height:147},GreenCamo:{x:995,y:1100,width:116,height:147},GreenRegrow:{x:468,y:474,width:159,height:145},GreenRegrowCamo:{x:629,y:636,width:159,height:145},Lead:{x:134,y:1100,width:123,height:156},LeadCamo:{x:258,y:1100,width:123,height:156},LeadFortified:{x:0,y:1100,width:133,height:156},WhiteRegrow:{x:1153,y:1132,width:105,height:97},WhiteRegrowCamo:{x:1283,y:428,width:105,height:97},Yellow:{x:382,y:1100,width:123,height:156},YellowCamo:{x:506,y:1100,width:123,height:156},YellowRegrow:{x:816,y:636,width:168,height:154},YellowRegrowCamo:{x:0,y:945,width:168,height:154},Zebra:{x:1153,y:984,width:116,height:147},ZebraCamo:{x:1283,y:0,width:116,height:147},ZebraRegrow:{x:816,y:791,width:159,height:145},ZebraRegrowCamo:{x:993,y:0,width:159,height:145},Pink:{x:1153,y:328,width:129,height:163},PinkCamo:{x:1153,y:492,width:129,height:163},PinkRegrow:{x:354,y:782,width:176,height:162},PinkRegrowCamo:{x:531,y:782,width:176,height:162},Purple:{x:630,y:1100,width:123,height:156},PurpleCamo:{x:754,y:1100,width:123,height:156},PurpleRegrow:{x:169,y:945,width:168,height:154},PurpleRegrowCamo:{x:338,y:945,width:168,height:154},Rainbow:{x:1153,y:656,width:129,height:163},RainbowCamo:{x:1153,y:820,width:129,height:163},RainbowRegrow:{x:816,y:0,width:176,height:162},RainbowRegrowCamo:{x:816,y:163,width:176,height:162},Red:{x:1283,y:526,width:103,height:131},RedCamo:{x:1283,y:658,width:103,height:131},RedRegrow:{x:993,y:285,width:143,height:130},RedRegrowCamo:{x:993,y:416,width:143,height:130},White:{x:1283,y:986,width:78,height:97},WhiteCamo:{x:1283,y:1084,width:78,height:97},Bad:{x:0,y:238,width:326,height:235},BadFortified:{x:0,y:0,width:326,height:237},Bfb:{x:234,y:474,width:233,height:164},BfbFortified:{x:0,y:474,width:233,height:166},DdtCamo:{x:0,y:641,width:203,height:140},DdtFortifiedCamo:{x:204,y:641,width:203,height:140},Moab:{x:670,y:945,width:162,height:105},MoabFortified:{x:507,y:945,width:162,height:110},Zomg:{x:327,y:0,width:301,height:194},ZomgFortified:{x:327,y:195,width:301,height:194}};class q{constructor(e,t){this.speed=Z[e.replace("Camo","").replace("Regrow","").replace("Fortified","")].speed,this.scale=Z[e.replace("Camo","").replace("Regrow","").replace("Fortified","")].scale,this.x=-O(1,0,100,Y[e].width,Y[e].height),this.y=100+(100-100*this.scale)/2,this.type=e,this.groupIndex=t,this.width=O(1,0,100,Y[e].width,Y[e].height)}move(e){this.x+=this.speed*e*6.86*G*Q*J}shouldDelete(){return this.x>=800}render(e){if(u.includes(this.groupIndex))return;let t=Y[this.type];e.drawImage(W,t.x,t.y,t.width,t.height,this.x,this.y,this.scale*this.width,100*this.scale)}}class z{constructor(e,t){this.speed=Z[e.replace("Camo","").replace("Regrow","").replace("Fortified","")].speed,this.x=-1.62*Y[e].width,this.type=e,this.groupIndex=t}move(e){this.x+=this.speed*e*6.86*G*Q*J}shouldDelete(){return this.x>=800}render(e){if(u.includes(this.groupIndex))return;let t=Y[this.type];e.drawImage(W,t.x,t.y,t.width,t.height,this.x,150-1.62*t.height/2,1.62*t.width,1.62*t.height)}}const K=[];let _,J=1,Q=1;const X=e=>{const t=performance.now();K.forEach(((t,d)=>{t.move(e),t.shouldDelete()&&K.splice(d,1)})),null!=_&&_.bloonGroups.forEach((d=>{if(t>=d.startTime&&d.count>0)if(0==d.activeTime&&(d.spawnBloon(),d.count--),d.activeTime+=e,d.spawnAccumulator+=e,0===d.spawnInterval){for(let e=0;e<d.count;e++)d.spawnBloon();d.count=0,d.spawnAccumulator=0}else for(;d.spawnAccumulator>=d.spawnInterval;){const e=Math.floor(d.spawnAccumulator/d.spawnInterval);for(let t=0;t<e;t++)d.spawnBloon(),d.count--;d.spawnAccumulator-=d.spawnInterval*e}}))},V=()=>{j.clearRect(0,0,U.width,U.height),K.forEach((e=>e.render(j)))};function ee(e){if(Q=de(e.roundNumber),_=JSON.parse(JSON.stringify(e)),document.getElementById("roundset-reverse-checkbox").checked){let t=Math.max(...e.bloonGroups.map((e=>e.end)));for(let e of _.bloonGroups){let d=e.end-e.start;e.start=t-e.end,e.end=e.start+d}}I(Math.max(..._.bloonGroups.map((e=>e.end)))/G),_.bloonGroups.forEach(((e,t)=>{e.startTime=performance.now()+1e3*e.start/G,e.activeTime=0,e.spawnAccumulator=0,e.spawnInterval=(e.end-e.start)/(e.count-1)/G,isFinite(e.spawnInterval)||(e.spawnInterval=0),e.spawnBloon=te(e,t)}))}function te(e,t){return function(){let d=e.bloon,n=["Moab","MoabFortified","Bfb","BfbFortified","Zomg","ZomgFortified","DdtCamo","DdtFortifiedCamo","Bad","BadFortified"].includes(d)?new z(d,t):new q(d,t),a=Z[d.replace("Camo","").replace("Regrow","").replace("Fortified","")].layer,s=K.findIndex((e=>Z[e.type.replace("Camo","").replace("Regrow","").replace("Fortified","")].layer>a));-1===s?K.push(n):K.splice(s,0,n)}}function de(e){let t=0;return t=e<=80?1:e<=100?1+.02*(e-80):e<=150?1.6+.02*(e-101):e<=200?3+.02*(e-151):e<=250?4.5+.02*(e-201):6+.02*(e-252),t}