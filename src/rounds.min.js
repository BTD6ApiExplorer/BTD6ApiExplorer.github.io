let roundPreviewFilterType,currentRoundsetView="Simple",roundsetProcessed=null,selectedRoundset=null,currentPreviewRound=0,currentIndexInModifiedRounds=0,previewActive=!1,previewModified=null,currentModifiedRounds=[],currentRoundsetEndRound=140,hiddenGroups=[],roundsetFilterSettings={},currentRoundsetData=null,bloonToRounds=new Map,roundsetPreviewButton=null;const BloonTraitBits={Camo:1,Regrow:2,Fortified:4,Lead:8,Purple:16,DDT:32,MOABClass:64};function generateRoundsets(){let e=document.getElementById("rounds-content");e.innerHTML="";let t=document.createElement("div");t.classList.add("progress-page"),e.appendChild(t);let n=document.createElement("div");n.classList.add("selectors-div"),t.appendChild(n);let r={},d={};Object.entries(constants.limitedTimeEvents).forEach((([e,t])=>{t.end>Date.now()?r[e]=t:d[e]=t})),Object.entries(r).forEach((([e,t])=>{let r=document.createElement("div");r.classList.add("roundset-selector-div"),r.addEventListener("click",(()=>{showLoading(),showRoundsetModel("rounds",t.roundset)})),n.appendChild(r);let d=document.createElement("img");switch(d.classList.add("roundset-selector-img"),r.appendChild(d),t.type){case"Race":d.src="../Assets/UI/EventRaceBtn.webp",r.classList.add("race-roundset");break;case"Odyssey":d.src="../Assets/UI/OdysseyEventBtn.webp",r.classList.add("odyssey-roundset");break;case"Boss":d.src=`../Assets/BossIcon/${t.boss[0].toUpperCase()+t.boss.slice(1)}EventIcon.webp`,r.classList.add("boss-roundset")}let s=document.createElement("div");s.classList.add("roundset-selector-text-div"),r.appendChild(s);let o=document.createElement("p");o.classList.add("selector-text","black-outline"),o.innerHTML=`${t.type} Event - ${e}`,s.appendChild(o);let i=document.createElement("p");i.id="time-left-"+e,i.classList.add("selector-text","black-outline"),s.appendChild(i),new Date<new Date(t.start)?i.innerHTML="Coming Soon!":new Date(t.end)>new Date&&(updateTimer(new Date(t.end),i.id),timerInterval=setInterval((()=>updateTimer(new Date(t.end),i.id)),1e3));let a=document.createElement("img");a.classList.add("selector-go-img"),a.src="../Assets/UI/ContinueBtn.webp",r.appendChild(a)}));let s=Object.fromEntries(Object.entries(constants.roundSets).filter((([e,t])=>"normal"===t.type))),o=Object.fromEntries(Object.entries(constants.roundSets).filter((([e,t])=>"boss"===t.type))),i=Object.fromEntries(Object.entries(constants.roundSets).filter((([e,t])=>"legends"===t.type))),a=Object.fromEntries(Object.entries(constants.roundSets).filter((([e,t])=>"quest"===t.type)));Object.entries(s).forEach((([e,t])=>{let r=document.createElement("div");r.classList.add("roundset-selector-div","wood-container"),r.addEventListener("click",(()=>{showLoading(),showRoundsetModel("rounds",e)})),n.appendChild(r);let d=document.createElement("img");d.classList.add("roundset-selector-img"),d.src=`../Assets/UI/${t.icon}.webp`,r.appendChild(d);let s=document.createElement("p");s.classList.add("selector-text","black-outline"),s.innerHTML=t.name,r.appendChild(s);let o=document.createElement("img");o.classList.add("selector-go-img"),o.src="../Assets/UI/ContinueBtn.webp",r.appendChild(o)})),Object.entries(i).forEach((([e,t])=>{let r=document.createElement("div");r.classList.add("roundset-selector-div","veteran-container"),r.addEventListener("click",(()=>{showLoading(),showRoundsetModel("rounds",e)})),n.appendChild(r);let d=document.createElement("img");d.classList.add("roundset-selector-img"),d.src=`../Assets/UI/${t.icon}.webp`,r.appendChild(d);let s=document.createElement("p");s.classList.add("selector-text","black-outline"),s.innerHTML=t.name,r.appendChild(s);let o=document.createElement("img");o.classList.add("selector-go-img"),o.src="../Assets/UI/ContinueBtn.webp",r.appendChild(o)}));let l=document.createElement("p");l.classList.add("other-roundsets-selector-text","black-outline"),l.innerHTML="Boss Custom Rounds",n.appendChild(l);let c=document.createElement("div");c.classList.add("other-roundsets-selector-div"),n.appendChild(c),Object.entries(o).forEach((([e,t])=>{let n=document.createElement("div");n.classList.add("other-roundset-selector-div"),n.addEventListener("click",(()=>{showRoundsetModel("rounds",e)})),c.appendChild(n);let r=document.createElement("img");r.classList.add("other-roundset-selector-img"),r.src=`../Assets/UI/${t.icon}.webp`,n.appendChild(r)}));let u=document.createElement("p");u.classList.add("other-roundsets-selector-text","black-outline"),u.innerHTML="Quest Custom Rounds",n.appendChild(u);let p=document.createElement("div");p.classList.add("other-roundsets-selector-div"),n.appendChild(p),Object.entries(a).forEach((([e,t])=>{let n=document.createElement("div");n.classList.add("other-roundset-selector-div"),n.addEventListener("click",(()=>{showRoundsetModel("rounds",e)})),p.appendChild(n);let r=document.createElement("p");r.classList.add("other-roundset-selector-text","black-outline");let d=e.match(/(Part|Stage)(\d+)/i);null!=d&&(r.innerHTML=`${d[1]} ${d[2]}`,n.appendChild(r));let s=document.createElement("img");s.classList.add("other-roundset-selector-img"),s.src=`../Assets/QuestIcon/${t.icon}.webp`,n.appendChild(s)}));let m=document.createElement("div");m.classList.add("known-previous-events-div"),n.appendChild(m);let h=document.createElement("p");h.classList.add("other-roundsets-selector-text","black-outline"),h.innerHTML="Known Previous Events",m.appendChild(h),Object.entries(d).forEach((([e,t])=>{let r=document.createElement("div");r.classList.add("roundset-selector-div"),r.addEventListener("click",(()=>{showLoading(),showRoundsetModel("rounds",t.roundset)})),n.appendChild(r);let d=document.createElement("img");switch(d.classList.add("roundset-selector-img"),r.appendChild(d),t.type){case"Race":d.src="../Assets/UI/EventRaceBtn.webp",r.classList.add("race-roundset");break;case"Odyssey":d.src="../Assets/UI/OdysseyEventBtn.webp",r.classList.add("odyssey-roundset");break;case"Boss":d.src=`../Assets/BossIcon/${t.boss[0].toUpperCase()+t.boss.slice(1)}EventIcon.webp`,r.style.backgroundImage=`url(../Assets/EventBanner/EventBannerSmall${t.boss[0].toUpperCase()+t.boss.slice(1)}.webp)`,r.classList.add("boss-roundset")}let s=document.createElement("div");s.classList.add("roundset-selector-text-div"),r.appendChild(s);let o=document.createElement("p");o.classList.add("selector-text","black-outline"),o.innerHTML=`${t.type} Event - ${e}`,s.appendChild(o);let i=document.createElement("p");i.id="time-left-"+e,i.classList.add("selector-text","black-outline"),s.appendChild(i),new Date<new Date(t.start)?i.innerHTML="Coming Soon!":new Date(t.end)>new Date?(updateTimer(new Date(t.end),i.id),timerInterval=setInterval((()=>updateTimer(new Date(t.end),i.id)),1e3)):i.innerHTML=`${new Date(t.start).toLocaleDateString()} - ${new Date(t.end).toLocaleDateString()}`;let a=document.createElement("img");a.classList.add("selector-go-img"),a.src="../Assets/UI/ContinueBtn.webp",r.appendChild(a)}));let g=document.createElement("div");g.classList.add("sku-roundset-selector-div"),n.appendChild(g);let b=document.createElement("p");b.classList.add("other-roundsets-selector-text","black-outline"),b.innerHTML="Other Custom Rounds",g.appendChild(b);let w=document.createElement("p");w.classList.add("sku-roundset-selector-desc"),w.innerHTML="These mostly old roundsets will have only been used in one-off events such as Odysseys, Races, or Bosses and may not have ended up being used for their intended purpose despite their name. Take these roundsets with a grain of salt. I'm including them on the viewer for completeness sake.",g.appendChild(w);let v=document.createElement("div");v.classList.add("sku-roundsets-selector-div"),g.appendChild(v),constants.skuRoundsets.forEach((e=>{let t=document.createElement("div");t.classList.add("sku-roundset-selector-div"),t.addEventListener("click",(()=>{showRoundsetModel("rounds",e)})),v.appendChild(t);let n=document.createElement("p");n.classList.add("sku-roundset-selector-text","black-outline"),n.innerHTML=e,t.appendChild(n)}))}async function showRoundsetModel(e,t){roundsetProcessed=null,currentRoundsetData=null,roundsetFilterSettings={roundFilterStart:1,roundFilterEnd:null,roundsetStartingCash:650,roundFilterPreset:"All",roundsetReversed:!1,roundsetHideUnused:!0,roundsetShowModified:!0,roundsetFilteredBloons:[],roundsetAdvancedFilterMode:!1,roundsetBasicFilter:null,roundsetAdvancedFilterLogic:"ANY",roundsetShowHints:!0};let n=document.getElementById("roundsets-content");n.style.display="flex",n.innerHTML="",document.getElementById(`${e}-content`).style.display="none",addToBackQueue({source:e,destination:"roundsets"}),resetScroll();let r=await fetch(`./data/${t}.json`).then((e=>e.json())),d="unknown";constants.roundSets[t]&&(d=constants.roundSets[t].type),currentRoundsetData=processRoundset(t,r),null===roundsetFilterSettings.roundFilterEnd&&(roundsetFilterSettings.roundFilterEnd=currentRoundsetData.rounds[currentRoundsetData.rounds.length-1].roundNumber),selectedRoundset=t;let s=document.createElement("div");s.classList.add("roundset-header-bar"),n.appendChild(s);let o=document.createElement("div");o.classList.add("roundset-header-title"),s.appendChild(o);let i=document.createElement("div");i.classList.add("roundset-header-left"),o.appendChild(i);let a=createEl("img",{classList:["roundset-settings-btn","pointer"],style:{width:"50px",height:"50px"},src:"../Assets/UI/SettingsBtn.webp"});a.addEventListener("click",(()=>{openRoundsetSettingsModal(d)})),i.appendChild(a);let l=document.createElement("p");l.classList.add("roundset-header-text","black-outline"),l.innerHTML=constants.roundSets[t]?constants.roundSets[t].name:t,o.appendChild(l);let c=document.createElement("div");c.classList.add("roundset-header-right"),o.appendChild(c);let u=document.createElement("img");if(u.classList.add("modal-close"),u.src="./Assets/UI/CloseBtn.webp",u.addEventListener("click",(()=>{goBack()})),c.appendChild(u),t.startsWith("Rogue")){let n=document.createElement("div");n.classList.add("d-flex","jc-evenly"),s.appendChild(n);let r={RogueRoundSet:"Rogue Legends Default Roundset",RogueBloonierSet:"Now with more Bloons!",RogueDenseSet:"Bloons spawn more densely",RoguePinkSet:"Bloons start fast and end slow",RoguePurpleSet:"More Purples and faster Bloons. Bloon health is reduced",RogueImmuneSet:"Alternate rounds with more Bloons with immunities",RogueLeadSet:"More Lead Bloons and DDTs"};Object.entries(r).forEach((([r,d])=>{let s=document.createElement("div");s.classList.add("pointer"),s.addEventListener("click",(()=>{showLoading(),goBack(),showRoundsetModel(e,r)})),n.appendChild(s),r==t&&s.classList.add("rogue-roundset-selector-active");let o=document.createElement("img");o.classList.add("roundset-header-rogue-img"),o.style.width="100px",o.src=`../Assets/UI/${r}.webp`,s.appendChild(o),tippy(s,{content:d,placement:"top",theme:"speech_bubble",popperOptions:{modifiers:[{name:"preventOverflow",options:{boundary:"viewport",padding:{right:18}}}]}})}))}let p=document.createElement("div");p.classList.add("roundset-header-bar-bottom"),s.appendChild(p);let m=document.createElement("div");m.classList.add("maps-progress-views"),p.appendChild(m);let h=document.createElement("p");h.classList.add("maps-progress-coop-toggle-text","maps-progress-view-list","black-outline"),h.innerHTML="Display Type:",m.appendChild(h);let g=document.createElement("div");g.classList.add("maps-progress-view","stats-tab-yellow","black-outline"),g.innerHTML="Simple",m.appendChild(g);let b=document.createElement("div");b.classList.add("maps-progress-view","black-outline"),b.innerHTML="Detailed",m.appendChild(b);let w=document.createElement("div");w.classList.add("maps-progress-view","black-outline"),w.innerHTML="Preview",m.appendChild(w),roundsetPreviewButton=w;let v=document.createElement("div");v.classList.add("maps-progress-views");let f=document.createElement("div");f.classList.add("maps-progress-view","black-outline","pointer"),f.innerHTML="Clear Filters",f.id="clear-filters-btn",f.style.display="none",f.addEventListener("click",(()=>{roundsetFilterSettings.roundFilterStart=1,roundsetFilterSettings.roundFilterEnd=null,roundsetFilterSettings.roundFilterPreset="All",roundsetFilterSettings.roundsetBasicFilter=null,roundsetFilterSettings.roundsetFilteredBloons=[],roundsetFilterSettings.roundsetAdvancedFilterMode=!1,roundsetFilterSettings.roundsetAdvancedFilterLogic="ANY",roundsetFilterSettings.roundsetReversed=!1,roundsetFilterSettings.roundsetHideUnused=!0,roundsetFilterSettings.roundsetShowModified=!1,applyRoundFilters(d),generateRounds(currentRoundsetView,roundsetFilterSettings.roundsetReversed,d)})),v.appendChild(f),p.appendChild(v);let L=document.createElement("div");L.id="roundset-content",L.classList.add("rounds-content"),n.appendChild(L),g.addEventListener("click",(()=>{g.classList.add("stats-tab-yellow"),b.classList.remove("stats-tab-yellow"),w.classList.remove("stats-tab-yellow"),currentRoundsetView="Simple",generateRounds(currentRoundsetView,roundsetFilterSettings.roundsetReversed,d)})),b.addEventListener("click",(()=>{b.classList.add("stats-tab-yellow"),g.classList.remove("stats-tab-yellow"),w.classList.remove("stats-tab-yellow"),currentRoundsetView="Topper",generateRounds(currentRoundsetView,roundsetFilterSettings.roundsetReversed,d)})),w.addEventListener("click",(()=>{w.classList.add("stats-tab-yellow"),g.classList.remove("stats-tab-yellow"),b.classList.remove("stats-tab-yellow"),currentRoundsetView="Preview",generateRounds(currentRoundsetView,roundsetFilterSettings.roundsetReversed,d)})),currentPreviewRound=0,currentRoundsetView="Simple",generateRounds(currentRoundsetView,roundsetFilterSettings.roundsetReversed,d)}function processRoundset(e,t){const n=["Moab","Bfb","Zomg","Ddt","Bad"];let r=JSON.parse(JSON.stringify(t));r=addRoundHints(e,r);let d=0,s=0;return r.rounds.forEach((e=>{let t=0;e.bloonGroups.forEach((r=>{const d=r.bloon.toLowerCase();d.includes("camo")&&(t|=BloonTraitBits.Camo),d.includes("regrow")&&(t|=BloonTraitBits.Regrow),d.includes("fortified")&&(t|=BloonTraitBits.Fortified),d.includes("lead")&&(t|=BloonTraitBits.Lead),d.includes("purple")&&(t|=BloonTraitBits.Purple),d.includes("ddt")?t|=BloonTraitBits.DDT|BloonTraitBits.MOABClass:n.some((e=>r.bloon.includes(e)))&&(t|=BloonTraitBits.MOABClass),bloonToRounds.has(r.bloon)||bloonToRounds.set(r.bloon,new Set),bloonToRounds.get(r.bloon).add(e.roundNumber)})),e.traitMask=t,"number"==typeof e.income&&(d+=e.income,e.incomeSum=d),"number"==typeof e.rbe&&(s+=e.rbe,e.rbeSum=s)})),r}function applyRoundFilters(e){if(!currentRoundsetData)return;const t=roundsetFilterSettings.roundFilterEnd??currentRoundsetData.rounds[currentRoundsetData.rounds.length-1].roundNumber;let n=JSON.parse(JSON.stringify(currentRoundsetData));n.rounds=n.rounds.filter((e=>e.roundNumber>=roundsetFilterSettings.roundFilterStart&&e.roundNumber<=t));let r=roundsetFilterSettings.roundsetStartingCash,d=0;if(n.rounds.forEach((e=>{roundsetFilterSettings.roundsetReversed?e.bloonGroups.sort(((e,t)=>e.end-t.end)):e.bloonGroups.sort(((e,t)=>e.start-t.start)),"number"==typeof e.income&&(r+=e.income,e.incomeSum=r),"number"==typeof e.rbe&&(d+=e.rbe,e.rbeSum=d)})),null!=e)switch(e){case"quest":if(roundsetFilterSettings.roundsetHideUnused){let e=constants.roundSets[selectedRoundset].endRound;n.rounds=n.rounds.filter((t=>t.roundNumber<=e))}break;case"boss":if(roundsetFilterSettings.roundsetShowModified){let e=constants.roundSets[selectedRoundset].modifiedRounds;n.rounds=n.rounds.filter((t=>e.includes(t.roundNumber)))}}let s=0;switch(roundsetFilterSettings.roundsetBasicFilter){case"Any Camo":s|=BloonTraitBits.Camo;break;case"Any Regrow":s|=BloonTraitBits.Regrow;break;case"Any Fortified":s|=BloonTraitBits.Fortified;break;case"Lead & DDT":s|=BloonTraitBits.Lead;break;case"Purple":s|=BloonTraitBits.Purple;break;case"MOAB-Class":s|=BloonTraitBits.MOABClass}if(0!==s&&(n.rounds=n.rounds.filter((e=>(e.traitMask&s)===s))),roundsetFilterSettings.roundsetFilteredBloons.length>0){let e=roundsetFilterSettings.roundsetFilteredBloons.map((e=>bloonToRounds.get(e))).filter((e=>e&&e.size>0));if(0===e.length)n.rounds=[];else if("COMBO"===roundsetFilterSettings.roundsetAdvancedFilterLogic){e.sort(((e,t)=>e.size-t.size));let t=new Set(e[0]);for(let n=1;n<e.length;n++){for(let r of Array.from(t))e[n].has(r)||t.delete(r);if(0===t.size)break}n.rounds=n.rounds.filter((e=>t.has(e.roundNumber)))}else{let t=new Set;e.forEach((e=>e.forEach((e=>t.add(e))))),n.rounds=n.rounds.filter((e=>t.has(e.roundNumber)))}}roundsetProcessed=n;const o=document.getElementById("clear-filters-btn");o&&(o.style.display=isFiltersActive()?"":"none")}function addRoundHints(e,t){return["DefaultRoundSet","AlternateRoundSet","RogueRoundSet"].includes(e)&&t.rounds.forEach(((t,n)=>{switch(e){case"DefaultRoundSet":constants.roundHints.hasOwnProperty("Hint "+(t.roundNumber-1))&&(t.hint=constants.roundHints["Hint "+(t.roundNumber-1)]);break;case"AlternateRoundSet":constants.roundHints.hasOwnProperty("Alternate Hint "+(t.roundNumber-1))&&(t.hint=constants.roundHints["Alternate Hint "+(t.roundNumber-1)]);break;case"RogueRoundSet":constants.roundHints.hasOwnProperty("Rogue Hint "+(t.roundNumber-1))&&(t.hint=constants.roundHints["Rogue Hint "+(t.roundNumber-1)])}})),t}async function generateRounds(e,t,n){let r=document.getElementById("roundset-content");r.innerHTML="",!roundsetProcessed&&currentRoundsetData&&applyRoundFilters(n);let d=roundsetProcessed.rounds.every(((e,t,n)=>0===t||e.roundNumber===n[t-1].roundNumber+1));switch(e){case"Simple":if(resetPreview(),"boss"===n&&roundsetFilterSettings.roundsetShowModified){let e={BloonariusRoundSet:"Bloonarius Changes: Only rounds that the boss spawns from are changed. They now spawn Bloons that are one tier lower than normal with 10 seconds of delay.",LychRoundSet:"Lych Changes: Rounds 40 to 48 have extra MOABs added in for Lych to resurrect when hitting a skull. Rounds that Lych spawns from are changed to spawn Bloons that are one tier lower than normal with 10 seconds of delay.",VortexRoundSet:"Vortex Changes: A small group of rounds have Bloons upgraded to speedier ones as well as adding some extra faster bloons. Rounds that Vortex spawns from are changed to spawn Bloons that are one tier lower than normal with 10 seconds of delay.",DreadbloonRoundSet:"Dreadbloon Changes: In general summary, Zebra -> Lead, Lead -> Fortified Lead, Rainbow -> Ceramic, Ceramic -> Fortified Ceramic. There are some exceptions. After Round 50, every other Blue MOAB is fortified, and after round 70 all Blue MOABs are fortified. Rounds that Dreadbloon spawns from are changed to spawn Bloons that are one tier lower than normal with 10 seconds of delay.",PhayzeRoundSet:"Phayze Changes: Only rounds that the boss spawns from are changed. They now spawn Bloons that are one tier lower than normal with 10 seconds of delay.",BlastapopoulosRoundSet:"Blastapopoulos Changes: Only rounds that the boss spawns from are changed. They now spawn Bloons that are one tier lower than normal with 10 seconds of delay."};const t=document.createElement("div");t.classList.add("disclaimer-div");const n=document.createElement("p");n.classList.add("disclaimer"),n.style.fontSize="24px",n.style.padding="1rem",n.style.lineHeight="1.5",n.innerHTML='Showing modified rounds. Disable "Only Modified" in Roundset Settings to show all rounds.<br>'+e[selectedRoundset],t.appendChild(n),r.appendChild(t)}let e=!1;roundsetProcessed.rounds.forEach((async(t,n)=>{let d=document.createElement("div");d.id=`round-${t.roundNumber}`,d.classList.add("round-div","jc-between"),e&&d.classList.add("round-div-alt");let s=document.createElement("p");s.classList.add("round-number","black-outline","pointer"),s.innerHTML=t.roundNumber,s.addEventListener("click",(()=>{currentPreviewRound=indexOfRoundNumberOrNearest(t.roundNumber),currentRoundsetView="Preview",roundsetPreviewButton.click()})),d.appendChild(s);let o=document.createElement("div");o.id=`round-${t.roundNumber}-groups`,o.classList.add("round-bloon-groups","fg-1"),d.appendChild(o);let i=document.createDocumentFragment();t.bloonGroups.sort(((e,t)=>e.start-t.start)).forEach(((e,t)=>{let n=document.createElement("div");n.classList.add("bloon-group-div");let r=document.createElement("p");r.classList.add("bloon-group-number","black-outline"),r.innerHTML="x"+e.count,n.appendChild(r);let d=document.createElement("img");d.classList.add("bloon-group-bloon"),d.src=`../Assets/BloonIcon/${e.bloon}.webp`,d.loading="lazy",n.appendChild(d),i.appendChild(n)})),o.appendChild(i);let a=document.createElement("div");a.classList.add("d-flex","ai-center"),a.style.minWidth="120px",d.appendChild(a);let l=document.createElement("img");l.classList.add("leaderboard-entry-score-icon"),l.src="./Assets/UI/StopWatch.webp",a.appendChild(l);let c=document.createElement("p");c.classList.add("round-number","black-outline");let u=t.bloonGroups.length?Math.max(...t.bloonGroups.map((e=>e.end))):0;c.innerHTML=u.toFixed(2),a.appendChild(c),r.appendChild(d),isRoundInFilter(t.roundNumber)?(e&&d.classList.add("round-div-alt"),e=!e):d.style.display="none"})),roundsetFilterSettings.roundsetReversed&&onChangeReverse();break;case"Topper":resetPreview();let s=document.createElement("div");s.classList.add("rounds-detailed-div"),r.appendChild(s),copyLoadingIcon(s),setTimeout((()=>{let e=document.createDocumentFragment(),n=document.createElement("div");n.classList.add("disclaimer-div"),e.appendChild(n);let r=document.createElement("p");r.classList.add("disclaimer"),r.innerHTML="This layout is based on Topper's website:",n.appendChild(r);let o=document.createElement("a");o.classList.add("disclaimer-link"),o.href="https://topper64.co.uk/nk/btd6/rounds/",o.target="_blank",o.innerHTML="Topper's Round Information",n.appendChild(o);roundsetProcessed.rounds.forEach((async(n,r)=>{if(!isRoundInFilter(n.roundNumber))return;let s=document.createElement("div");s.id=`round-${n.roundNumber}`,s.classList.add("round-div-detailed"),t&&s.classList.add("round-div-reverse");let o=document.createElement("div");o.classList.add("rounds-div-header"),s.appendChild(o);let i=document.createElement("p");i.classList.add("round-number","round-number-detailed","black-outline","pointer"),i.innerHTML=`Round ${n.roundNumber}`,i.addEventListener("click",(()=>{currentPreviewRound=indexOfRoundNumberOrNearest(n.roundNumber),currentRoundsetView="Preview",roundsetPreviewButton.click()})),o.appendChild(i);let a=document.createElement("div");a.classList.add("income-div"),o.appendChild(a);let l=document.createElement("img");l.classList.add("income-img"),l.src="../Assets/UI/CoinIcon.webp",a.appendChild(l);let c=document.createElement("div");c.classList.add("income-text-div"),a.appendChild(c);let u=document.createElement("p");u.classList.add("round-income","black-outline"),u.innerHTML=`Income: ${n.income.toLocaleString()}`,c.appendChild(u);let p=document.createElement("p");p.classList.add("round-income-total","black-outline"),p.innerHTML=`Total: ${n.incomeSum.toLocaleString()}`,d&&c.appendChild(p);let m=document.createElement("div");m.classList.add("rbe-div"),o.appendChild(m);let h=document.createElement("img");h.classList.add("rbe-img"),h.src="../Assets/BloonIcon/Red.webp",m.appendChild(h);let g=document.createElement("div");g.classList.add("rbe-text-div"),m.appendChild(g);let b=document.createElement("p");b.classList.add("round-rbe","black-outline"),b.innerHTML=`RBE: ${n.rbe.toLocaleString()}`,g.appendChild(b);let w=document.createElement("p");w.classList.add("round-rbe-total","black-outline"),w.innerHTML=`Total: ${n.rbeSum.toLocaleString()}`,d&&g.appendChild(w);let v=n.bloonGroups.length?Math.max(...n.bloonGroups.map((e=>e.end))):0,f=document.createElement("p");if(f.classList.add("round-duration","black-outline"),f.innerHTML=`Duration: ${v.toFixed(2)}s`,o.appendChild(f),n.hint&&roundsetFilterSettings.roundsetShowHints){let e=document.createElement("div");e.classList.add("round-hint-div","coop-border"),s.appendChild(e);let t=document.createElement("p");t.classList.add("round-hint-x"),t.innerHTML="X",t.addEventListener("click",(()=>{e.style.display="none"})),e.appendChild(t);let r=document.createElement("p");r.classList.add("round-hint"),r.innerHTML=n.hint,e.appendChild(r)}let L=document.createElement("div");L.classList.add("timeline-div"),s.appendChild(L),n.bloonGroups.forEach(((e,t)=>{let n=document.createElement("div");n.classList.add("bloon-group-div-detailed"),L.appendChild(n);let r=document.createElement("div");r.classList.add("left-div"),n.appendChild(r);let d=document.createElement("img");d.classList.add("bloon-image"),d.src=`../Assets/BloonIcon/${e.bloon}.webp`,r.appendChild(d);let s=document.createElement("p");s.classList.add("bloon-count","black-outline"),s.innerHTML="x"+e.count,r.appendChild(s);let o=document.createElement("div");o.classList.add("timeline-right-div"),n.appendChild(o);let i=document.createElement("div");i.classList.add("bloon-bar"),o.appendChild(i);let a=document.createElement("div");a.classList.add("bloon-bar-fill"),a.style.background=bloonsData[e.bloon.replace("Camo","").replace("Regrow","").replace("Fortified","")].color,e.bloon.includes("Rainbow")||(a.style.border=`4px solid ${bloonsData[e.bloon.replace("Camo","").replace("Regrow","").replace("Fortified","")].border}`),tippy(a,{content:`${e.start.toFixed(2)}s - ${e.end.toFixed(2)}s`,placement:"top",theme:"speech_bubble",popperOptions:{modifiers:[{name:"preventOverflow",options:{boundary:"viewport",padding:{right:18}}}]}});let l=(e.end-e.start)/v*100,c=e.start/v*100;l<5&&(l=5),c+l>100&&(c=100-l),a.style.width=`${l}%`,a.style.left=`${c}%`,i.appendChild(a)})),e.appendChild(s)})),s.innerHTML="",s.appendChild(e),roundsetFilterSettings.roundsetReversed&&onChangeReverse()}),0);break;case"Preview":resetPreview(),null==roundsetProcessed.rounds[currentPreviewRound]&&(currentPreviewRound=0),(roundsetProcessed.rounds[currentPreviewRound].roundNumber<roundsetFilterSettings.roundFilterStart||roundsetProcessed.rounds[currentPreviewRound].roundNumber>roundsetFilterSettings.roundFilterEnd)&&(currentPreviewRound=Math.max(0,roundsetFilterSettings.roundFilterStart-1));let o=document.createElement("div");o.classList.add("preview-container-div"),r.appendChild(o);let i=document.createElement("div");i.classList.add("preview-div"),o.appendChild(i);let a=document.createElement("div");a.classList.add("preview-header"),i.appendChild(a);let l=document.createElement("p");l.id="round-number-preview",l.classList.add("round-number","round-number-preview","black-outline"),l.innerHTML=`Round ${roundsetProcessed.rounds[currentPreviewRound].roundNumber}`,a.appendChild(l);let c=document.createElement("input");c.id="select-round-num-preview",c.classList.add("select-round-num"),c.type="number",c.min=1,c.max=roundsetFilterSettings.roundFilterEnd,c.value=roundsetProcessed.rounds[currentPreviewRound].roundNumber,c.addEventListener("change",(()=>{let e=parseInt(c.value);e<roundsetFilterSettings.roundFilterStart&&(e=roundsetFilterSettings.roundFilterStart),e>roundsetFilterSettings.roundFilterEnd&&(e=roundsetFilterSettings.roundFilterEnd),c.value=e,currentPreviewRound=indexOfRoundNumberOrNearest(e),l.innerHTML=`Round ${roundsetProcessed.rounds[currentPreviewRound].roundNumber}`,updatePreviewRoundTimeline()})),a.appendChild(c);let u=document.createElement("div");u.classList.add("preview-right-div");let p=document.createElement("img");p.classList.add("clear-button"),p.src="../Assets/UI/DestroyBloonsBtn.webp",p.addEventListener("click",(()=>{clearPreview()})),u.appendChild(p);let m=document.createElement("img");m.classList.add("play-normal-button"),m.src="../Assets/UI/GoBtnSmall.webp",m.addEventListener("click",(()=>{speedMultiplier=1,l.innerHTML=`Round ${roundsetProcessed.rounds[currentPreviewRound].roundNumber}`,clearPreview(),startRound(roundsetProcessed.rounds[currentPreviewRound])})),u.appendChild(m);let h=document.createElement("img");h.classList.add("play-fast-button"),h.src="../Assets/UI/FastForwardBtn.webp",h.addEventListener("click",(()=>{speedMultiplier=3,l.innerHTML=`Round ${roundsetProcessed.rounds[currentPreviewRound].roundNumber}`,clearPreview(),startRound(roundsetProcessed.rounds[currentPreviewRound])})),u.appendChild(h),canvas=document.createElement("canvas"),canvas.classList.add("roundset-canvas"),canvas.width=800,canvas.height=300,i.appendChild(canvas);let g=document.createElement("div");g.classList.add("preview-footer-div","ai-center"),i.appendChild(g);let b=document.createElement("div");b.classList.add("d-flex","ai-center"),g.appendChild(b);let w=createEl("p",{classList:["black-outline"],innerHTML:"Bloon Speed:",style:{fontSize:"28px"}});b.appendChild(w);let v=document.createElement("div");v.classList.add("maps-progress-view","stats-tab-yellow","black-outline"),v.innerHTML="Easy",b.appendChild(v);let f=document.createElement("div");f.classList.add("maps-progress-view","black-outline"),f.innerHTML="Medium",b.appendChild(f);let L=document.createElement("div");switch(L.classList.add("maps-progress-view","black-outline"),L.innerHTML="Hard",b.appendChild(L),v.addEventListener("click",(()=>{difficultySpeedModifier=1,v.classList.add("stats-tab-yellow"),f.classList.remove("stats-tab-yellow"),L.classList.remove("stats-tab-yellow")})),f.addEventListener("click",(()=>{difficultySpeedModifier=1.1,v.classList.remove("stats-tab-yellow"),f.classList.add("stats-tab-yellow"),L.classList.remove("stats-tab-yellow")})),L.addEventListener("click",(()=>{difficultySpeedModifier=1.26,v.classList.remove("stats-tab-yellow"),f.classList.remove("stats-tab-yellow"),L.classList.add("stats-tab-yellow")})),selectedRoundset){case"AlternateRoundSet":L.click();break;case"AcceleratedRoundSet":case"EnduranceRoundSet":case"FastUpgradesRoundSet":case"MOABMadnessRoundSet":case"RogueRoundSet":case"RogueBloonierSet":case"RogueDenseSet":case"RoguePinkSet":case"RoguePurpleSet":case"RogueImmuneSet":case"RogueLeadSet":f.click()}let y=document.createElement("div");y.classList.add("next-prev-div"),a.appendChild(y),g.appendChild(u);let E=document.createElement("div");E.classList.add("maps-progress-view","black-outline"),E.innerHTML="Previous",E.addEventListener("click",(()=>{null!=previewModified&&previewModified.checked?(currentIndexInModifiedRounds--,currentIndexInModifiedRounds<0&&(currentIndexInModifiedRounds=currentModifiedRounds.length-1),currentPreviewRound=currentModifiedRounds[currentIndexInModifiedRounds]-1):(currentPreviewRound--,currentPreviewRound<0&&(currentPreviewRound=roundsetProcessed.rounds.length-1)),c.value=roundsetProcessed.rounds[currentPreviewRound].roundNumber,clearPreview(),updatePreviewRoundTimeline()})),y.appendChild(E);let C=document.createElement("div");C.classList.add("maps-progress-view","black-outline"),C.innerHTML="Next",C.addEventListener("click",(()=>{null!=previewModified&&previewModified.checked?(currentIndexInModifiedRounds++,currentIndexInModifiedRounds>=currentModifiedRounds.length&&(currentIndexInModifiedRounds=0),currentPreviewRound=currentModifiedRounds[currentIndexInModifiedRounds]-1):(currentPreviewRound++,currentPreviewRound>=roundsetProcessed.rounds.length&&(currentPreviewRound=0)),c.value=roundsetProcessed.rounds[currentPreviewRound].roundNumber,clearPreview(),updatePreviewRoundTimeline()})),y.appendChild(C);let S=document.createElement("div");S.id="preview-round-info-div",S.classList.add("round-info-div"),i.appendChild(S),ctx=canvas.getContext("2d"),startPreviewLoop(),updatePreviewRoundTimeline()}}function onChangeReverse(){switch(currentRoundsetView){case"Simple":roundsetProcessed.rounds.forEach(((e,t)=>{let n=document.getElementById(`round-${e.roundNumber}-groups`);Array.from(n.children).reverse().forEach((e=>n.appendChild(e)))}));break;case"Topper":let e=document.getElementsByClassName("timeline-div");for(let t of e)t.classList.toggle("timeline-div-reverse");let t=document.getElementsByClassName("timeline-right-div");for(let e of t)e.classList.toggle("flip-horizontal");break;case"Preview":document.getElementById("preview-timeline-div").classList.toggle("timeline-div-reverse");let n=document.getElementsByClassName("preview-timeline-right-div");for(let e of n)e.classList.toggle("flip-horizontal")}clearPreview()}function updatePreviewRoundTimeline(){let e=document.getElementById("preview-round-info-div");e.innerHTML="";let t=roundsetProcessed.rounds[currentPreviewRound];hiddenGroups=[];let n=document.createElement("div");n.classList.add("round-div-detailed"),e.appendChild(n);let r=document.createElement("div");r.classList.add("rounds-div-header"),n.appendChild(r);let d=document.createElement("p");d.classList.add("round-number","round-number-detailed","black-outline"),d.innerHTML=`Round ${t.roundNumber}`,r.appendChild(d);let s=document.createElement("div");s.classList.add("income-div"),r.appendChild(s);let o=document.createElement("img");o.classList.add("income-img"),o.src="../Assets/UI/CoinIcon.webp",s.appendChild(o);let i=document.createElement("div");i.classList.add("income-text-div"),s.appendChild(i);let a=document.createElement("p");a.classList.add("round-income","black-outline"),a.innerHTML=`Income: ${t.income.toLocaleString()}`,i.appendChild(a);let l=document.createElement("p");l.classList.add("round-income-total","black-outline"),l.innerHTML=`Total: ${t.incomeSum.toLocaleString()}`,i.appendChild(l);let c=document.createElement("div");c.classList.add("rbe-div"),r.appendChild(c);let u=document.createElement("img");u.classList.add("rbe-img"),u.src="../Assets/BloonIcon/Red.webp",c.appendChild(u);let p=document.createElement("div");p.classList.add("rbe-text-div"),c.appendChild(p);let m=document.createElement("p");m.classList.add("round-rbe","black-outline"),m.innerHTML=`RBE: ${t.rbe.toLocaleString()}`,p.appendChild(m);let h=document.createElement("p");h.classList.add("round-rbe-total","black-outline"),h.innerHTML=`Total: ${t.rbeSum.toLocaleString()}`,p.appendChild(h);let g=t.bloonGroups.length?Math.max(...t.bloonGroups.map((e=>e.end))):0,b=document.createElement("p");if(b.classList.add("round-duration","black-outline"),b.innerHTML=`Duration: ${g.toFixed(2)}s`,r.appendChild(b),t.hint&&roundsetFilterSettings.roundsetShowHints){let e=document.createElement("div");e.classList.add("round-hint-div","coop-border"),n.appendChild(e);let r=document.createElement("p");r.classList.add("round-hint-x"),r.innerHTML="X",r.addEventListener("click",(()=>{e.style.display="none"})),e.appendChild(r);let d=document.createElement("p");d.classList.add("round-hint"),d.innerHTML=t.hint,e.appendChild(d)}let w=document.createElement("div");w.id="preview-timeline-div",w.classList.add("timeline-div"),n.appendChild(w);t.bloonGroups.forEach(((e,t)=>{let n=document.createElement("div");n.classList.add("bloon-group-div-detailed"),n.addEventListener("click",(()=>{hiddenGroups.includes(t)?(n.style.filter="",hiddenGroups.splice(hiddenGroups.indexOf(t),1)):(hiddenGroups.push(t),n.style.filter="brightness(0.5)")})),w.appendChild(n);let r=document.createElement("div");r.classList.add("left-div"),n.appendChild(r);let d=document.createElement("img");d.classList.add("bloon-image"),d.src=`../Assets/BloonIcon/${e.bloon}.webp`,r.appendChild(d);let s=document.createElement("p");s.classList.add("bloon-count","black-outline"),s.innerHTML="x"+e.count,r.appendChild(s);let o=document.createElement("div");o.classList.add("timeline-right-div","preview-timeline-right-div"),n.appendChild(o);let i=document.createElement("div");i.classList.add("bloon-bar"),o.appendChild(i);let a=document.createElement("div");a.classList.add("bloon-bar-fill"),a.style.background=bloonsData[e.bloon.replace("Camo","").replace("Regrow","").replace("Fortified","")].color,e.bloon.includes("Rainbow")||(a.style.border=`4px solid ${bloonsData[e.bloon.replace("Camo","").replace("Regrow","").replace("Fortified","")].border}`),tippy(a,{content:`${e.start.toFixed(2)}s - ${e.end.toFixed(2)}s`,placement:"top",theme:"speech_bubble",popperOptions:{modifiers:[{name:"preventOverflow",options:{boundary:"viewport",padding:{right:18}}}]}});let l=(e.end-e.start)/g*100,c=e.start/g*100;l<5&&(l=5),c+l>100&&(c=100-l),a.style.width=`${l}%`,a.style.left=`${c}%`,i.appendChild(a)})),roundsetFilterSettings.roundsetReversed&&onChangeReverse()}function addTimelinePlayhead(e){let t=document.getElementById("preview-timeline-div"),n=document.createElement("div");n.id="preview-playhead",n.classList.add("playhead"),t.appendChild(n),n.style.animation=`playhead ${e}s linear`,n.addEventListener("animationend",(function(){n.remove()}))}function clearPreview(){document.getElementById("preview-playhead")&&document.getElementById("preview-playhead").remove(),currentRoundGroups=null,bloons.length=0}function openRoundsetSettingsModal(e){if(!roundsetProcessed)return;null===roundsetFilterSettings.roundFilterEnd&&(roundsetFilterSettings.roundFilterEnd=roundsetProcessed.rounds[roundsetProcessed.rounds.length-1].roundNumber);const t=createEl("div",{style:{padding:"16px",display:"flex",flexDirection:"column",gap:"16px"}});let n=createEl("div",{classList:["d-flex","ai-center","jc-between"],style:{gap:"8px"}});t.appendChild(n);let r=createEl("div",{classList:["d-flex"],style:{gap:"8px",flexDirection:"column"}});n.appendChild(r);let d=createEl("div",{classList:["d-flex","ai-center","jc-center"],style:{gap:"8px",flexWrap:"wrap",width:"60%"}}),s=currentRoundsetData.rounds[0].roundNumber,o=currentRoundsetData.rounds[currentRoundsetData.rounds.length-1].roundNumber,i=createEl("div",{classList:["d-flex","ai-center"]});r.appendChild(i);let a=createEl("img",{classList:["of-contain"],src:"./Assets/UI/StartRoundIconSmall.webp",style:{width:"40px",height:"40px",marginRight:"4px"}});i.appendChild(a);let l=generateNumberInput("Start Round",roundsetFilterSettings.roundFilterStart,s,o,1,(e=>{roundsetFilterSettings.roundFilterStart=e,d.querySelectorAll("div").forEach((e=>e.classList.remove("stats-tab-yellow")))}));i.appendChild(l);let c=createEl("div",{classList:["d-flex","ai-center"]});r.appendChild(c);let u=createEl("img",{classList:["of-contain"],src:"./Assets/UI/EndRoundIconSmall.webp",style:{width:"40px",height:"40px",marginRight:"4px"}});c.appendChild(u);let p=generateNumberInput("End Round",roundsetFilterSettings.roundFilterEnd,s,o,1,(e=>{roundsetFilterSettings.roundFilterEnd=e,d.querySelectorAll("div").forEach((e=>e.classList.remove("stats-tab-yellow")))}));if(p.style.flexGrow="1",c.appendChild(p),"DefaultRoundSet"===selectedRoundset){["All","Easy","Medium","Hard","Impoppable","CHIMPS"].forEach((e=>{const t=generateSelectorTab(e,e===roundsetFilterSettings.roundFilterPreset);t.addEventListener("click",(()=>{switch(roundsetFilterSettings.roundFilterPreset=e,Array.from(d.children).forEach((e=>e.classList.remove("stats-tab-yellow"))),t.classList.add("stats-tab-yellow"),e){case"All":roundsetFilterSettings.roundFilterStart=1,roundsetFilterSettings.roundFilterEnd=o;break;case"Easy":roundsetFilterSettings.roundFilterStart=1,roundsetFilterSettings.roundFilterEnd=Math.min(40,o);break;case"Medium":roundsetFilterSettings.roundFilterStart=1,roundsetFilterSettings.roundFilterEnd=Math.min(60,o);break;case"Hard":roundsetFilterSettings.roundFilterStart=3,roundsetFilterSettings.roundFilterEnd=Math.min(80,o);break;case"Impoppable":case"CHIMPS":roundsetFilterSettings.roundFilterStart=6,roundsetFilterSettings.roundFilterEnd=Math.min(100,o)}const n=l.querySelector("input"),r=p.querySelector("input");n&&(n.value=roundsetFilterSettings.roundFilterStart),r&&roundsetFilterSettings.roundFilterEnd&&(r.value=roundsetFilterSettings.roundFilterEnd)})),d.appendChild(t)})),n.appendChild(d)}else r.style.flexDirection="row",r.style.gap="50px";let m=createEl("p",{classList:["font-gardenia"],style:{fontSize:"22px",display:roundsetFilterSettings.roundsetReversed?"block":"none"},innerHTML:"In Rogue Legends, the rounds are not reversed even when the track path is."}),h=createEl("div",{classList:["d-flex"]});t.appendChild(h);let g=createEl("div",{classList:["d-flex","ai-center"]});h.appendChild(g);let b=createEl("img",{classList:["of-contain"],src:"./Assets/UI/CoinIcon.webp",style:{width:"40px",height:"40px",marginRight:"4px"}});g.appendChild(b);let w=generateNumberInput("Starting Cash",roundsetFilterSettings.roundsetStartingCash,0,99999999,50,(e=>{roundsetFilterSettings.roundsetStartingCash=e}));g.appendChild(w);let v=generateCheckbox("Reverse Mode",roundsetFilterSettings.roundsetReversed,(e=>{roundsetFilterSettings.roundsetReversed=e,m.style.display=selectedRoundset.startsWith("Rogue")&&e?"block":"none"}));if(h.appendChild(v),"quest"===e){let e=generateCheckbox("Hide Unused",roundsetFilterSettings.roundsetHideUnused,(e=>{roundsetFilterSettings.roundsetHideUnused=e}));h.appendChild(e),h.classList.add("jc-between")}else if("boss"===e){let e=generateCheckbox("Only Modified",roundsetFilterSettings.roundsetShowModified,(e=>{roundsetFilterSettings.roundsetShowModified=e}));h.appendChild(e),h.classList.add("jc-between")}else if("DefaultRoundSet"===selectedRoundset||selectedRoundset.startsWith("Rogue")){let e=generateCheckbox("Round Hints",roundsetFilterSettings.roundsetShowHints,(e=>{roundsetFilterSettings.roundsetShowHints=e}));h.appendChild(e),h.classList.add("jc-between")}else h.style.gap="32px";t.appendChild(m);let f=createEl("div",{classList:["d-flex","ai-center","jc-between"],style:{gap:"8px"}});t.appendChild(f);let L=createEl("p",{classList:["dropdown-label","black-outline"],innerHTML:"Filter by Bloons"});f.appendChild(L);let y=createEl("div",{classList:["d-flex","ai-center"],style:{gap:"6px",display:roundsetFilterSettings.roundsetAdvancedFilterMode?"flex":"none"}});f.appendChild(y);let E=createEl("p",{classList:["black-outline"],style:{fontSize:"24px"},innerHTML:"Logic:"});y.appendChild(E);const C=e=>{let t=createEl("div",{classList:["maps-progress-view","black-outline","pointer"],innerHTML:e});return roundsetFilterSettings.roundsetAdvancedFilterLogic===e&&t.classList.add("stats-tab-yellow"),t.addEventListener("click",(()=>{roundsetFilterSettings.roundsetAdvancedFilterLogic!==e&&(roundsetFilterSettings.roundsetAdvancedFilterLogic=e,Array.from(y.querySelectorAll(".maps-progress-view")).forEach((e=>e.classList.remove("stats-tab-yellow"))),t.classList.add("stats-tab-yellow"))})),t};y.appendChild(C("ANY")),y.appendChild(C("COMBO"));let S=createEl("div",{classList:["tooltip-container","d-flex","ai-center"],style:{gap:"8px"}});f.appendChild(S);let R=createEl("p",{classList:["black-outline"],style:{fontSize:"24px"},innerHTML:"Advanced"});S.appendChild(R);let F=generateToggle(roundsetFilterSettings.roundsetAdvancedFilterMode,(e=>{roundsetFilterSettings.roundsetAdvancedFilterMode=e,roundsetFilterSettings.roundsetBasicFilter=null,roundsetFilterSettings.roundsetFilteredBloons=[],y.style.display=e?"flex":"none",T()}));S.appendChild(F);let k=createEl("div",{classList:["d-flex","ai-center","jc-start"],style:{gap:"8px"}});t.appendChild(k);let x=createEl("div",{classList:["d-flex","jc-center"],style:{gap:"6px",flexWrap:"wrap"}});k.appendChild(x);let M=["Red","Blue","Green","Yellow","Pink","Black","White","Purple","Lead","Zebra","Rainbow","Ceramic"],B=["Moab","Bfb","Zomg","DdtCamo","Bad"];const I=e=>{let t=createEl("div",{classList:["pointer"],style:{backgroundImage:"url(../Assets/UI/StatsTabBlue.webp)",backgroundSize:"contain",width:"60px",height:"60px"}}),n=createEl("img",{classList:["bloon-filter-img"],style:{width:"50px",height:"50px",padding:"5px",objectFit:"contain"},src:`../Assets/BloonIcon/${e}.webp`});return t.appendChild(n),roundsetFilterSettings.roundsetFilteredBloons.includes(e)&&(t.style.backgroundImage="url(../Assets/UI/StatsTabYellow.webp)"),t.addEventListener("click",(()=>{let n=roundsetFilterSettings.roundsetFilteredBloons;n.includes(e)?(roundsetFilterSettings.roundsetFilteredBloons=n.filter((t=>t!==e)),t.style.backgroundImage="url(../Assets/UI/StatsTabBlue.webp)"):(n.push(e),t.style.backgroundImage="url(../Assets/UI/StatsTabYellow.webp)")})),t};function T(){if(x.innerHTML="",roundsetFilterSettings.roundsetAdvancedFilterMode){let e=[];M.forEach((t=>{e.push(t,`${t}Regrow`,`${t}Camo`,`${t}RegrowCamo`)}));let t=B.map((e=>`${e}Fortified`));t[3]="DDTFortifiedCamo";let n=["LeadFortified","LeadFortifiedCamo","CeramicFortified","CeramicFortifiedCamo",...B],r=["LeadRegrowFortified","LeadRegrowFortifiedCamo","CeramicRegrowFortified","CeramicRegrowFortifiedCamo",...t],d=createEl("div",{classList:["d-flex","ai-center"],style:{gap:"6px",flexWrap:"wrap",width:"530px"}});e.forEach((e=>d.appendChild(I(e)))),x.appendChild(d);let s=createEl("div",{classList:["d-flex","ai-center","jc-center"],style:{gap:"6px",flexWrap:"wrap"}}),o=createEl("div",{classList:["d-flex","ai-center"],style:{gap:"6px",flexWrap:"wrap"}});n.forEach((e=>o.appendChild(I(e)))),s.appendChild(o);let i=createEl("div",{classList:["d-flex","ai-center"],style:{gap:"6px",flexWrap:"wrap"}});r.forEach((e=>i.appendChild(I(e)))),s.appendChild(i),x.appendChild(s)}else{const e={"Any Camo":"GreenCamo","Any Regrow":"PinkRegrow","Any Fortified":"CeramicFortified",Purple:"Purple","Lead & DDT":"Lead","MOAB-Class":"Moab"};let t=createEl("div",{classList:["d-flex","ai-center"],style:{gap:"6px",flexWrap:"wrap"}});Object.keys(e).forEach((n=>{let r=createEl("div",{classList:["d-flex","ai-center"],style:{gap:"2px",width:"250px"}}),d=createEl("div",{classList:["pointer"],style:{backgroundImage:"url(../Assets/UI/StatsTabBlue.webp)",backgroundSize:"contain",width:"60px",height:"60px"}});r._iconHolder=d;let s=createEl("img",{classList:["bloon-filter-img"],style:{width:"50px",height:"50px",padding:"5px",objectFit:"contain"},src:`../Assets/BloonIcon/${e[n]}.webp`});d.appendChild(s);let o=createEl("p",{classList:["black-outline"],style:{fontSize:"20px"},innerHTML:n});r.appendChild(d),r.appendChild(o),roundsetFilterSettings.roundsetBasicFilter===n&&(d.style.backgroundImage="url(../Assets/UI/StatsTabYellow.webp)"),t.appendChild(r),r.addEventListener("click",(()=>{roundsetFilterSettings.roundsetBasicFilter===n?(roundsetFilterSettings.roundsetBasicFilter=null,d.style.backgroundImage="url(../Assets/UI/StatsTabBlue.webp)"):(Array.from(t.children).forEach((e=>{e._iconHolder&&(e._iconHolder.style.backgroundImage="url(../Assets/UI/StatsTabBlue.webp)")})),roundsetFilterSettings.roundsetBasicFilter=n,d.style.backgroundImage="url(../Assets/UI/StatsTabYellow.webp)")}))})),x.appendChild(t)}}T();const A=createEl("div",{classList:["d-flex","jc-end"],style:{marginTop:"8px",gap:"10px"}}),P=createEl("div",{classList:["maps-progress-view","black-outline","pointer"],innerHTML:"Apply",style:{padding:"6px 14px",filter:"hue-rotate(270deg)"}});return P.addEventListener("click",(()=>{if(!currentRoundsetData)return void(closeModal&&closeModal());if(null===roundsetFilterSettings.roundFilterEnd&&(roundsetFilterSettings.roundFilterEnd=roundsetProcessed.rounds[roundsetProcessed.rounds.length-1].roundNumber),roundsetFilterSettings.roundFilterStart>roundsetFilterSettings.roundFilterEnd){const e=roundsetFilterSettings.roundFilterStart;roundsetFilterSettings.roundFilterStart=roundsetFilterSettings.roundFilterEnd,roundsetFilterSettings.roundFilterEnd=e}applyRoundFilters(e),generateRounds(currentRoundsetView,roundsetFilterSettings.roundsetReversed);const t=document.getElementById("select-round-num-preview");if(t){t.min=roundsetFilterSettings.roundFilterStart,t.max=roundsetFilterSettings.roundFilterEnd,isRoundInFilter(roundsetProcessed.rounds[currentPreviewRound].roundNumber)||(currentPreviewRound=roundsetFilterSettings.roundFilterStart-1,t.value=roundsetFilterSettings.roundFilterStart,updatePreviewRoundTimeline())}closeModal&&closeModal(),goBack()})),A.appendChild(P),t.appendChild(A),createModal({header:"Roundset Settings",content:t}),t}function isRoundInFilter(e){return e>=roundsetFilterSettings.roundFilterStart&&e<=(roundsetFilterSettings.roundFilterEnd??1/0)}function indexOfRoundNumberOrNearest(e){const t=roundsetProcessed?.rounds??[];if(0===t.length)return-1;const n=t.findIndex((t=>t.roundNumber===e));return-1!==n?n:t.reduce(((n,r,d)=>{const s=t[n].roundNumber,o=Math.abs(s-e),i=Math.abs(r.roundNumber-e);return i<o||i===o&&r.roundNumber<s?d:n}),0)}function isFiltersActive(){if(!currentRoundsetData)return!1;const e=currentRoundsetData.rounds[currentRoundsetData.rounds.length-1]?.roundNumber??1/0,t=null==roundsetFilterSettings.roundFilterEnd||roundsetFilterSettings.roundFilterEnd===e,n="boss"===constants.roundSets[selectedRoundset]?.type&&!!roundsetFilterSettings.roundsetShowModified;return[1!==roundsetFilterSettings.roundFilterStart,!t,"All"!==roundsetFilterSettings.roundFilterPreset,null!==roundsetFilterSettings.roundsetBasicFilter,(roundsetFilterSettings.roundsetFilteredBloons?.length??0)>0,!0===roundsetFilterSettings.roundsetAdvancedFilterMode,n,!0===roundsetFilterSettings.roundsetReversed].some(Boolean)}let canvas,ctx,previewFrameId=null,speedMultiplier=1,bloonsData={Red:{name:"Red",rbe:1,speed:25,layer:1,scale:.8,color:"#ED0F0F",border:"#690000"},Blue:{name:"Blue",rbe:2,speed:35,layer:2,scale:.85,color:"#2797E0",border:"#004772"},Green:{name:"Green",rbe:3,speed:45,layer:3,scale:.9,color:"#77A80F",border:"#3D5400"},Yellow:{name:"Yellow",rbe:4,speed:80,layer:4,scale:.95,color:"#FFD50F",border:"#8E620C"},Pink:{name:"Pink",rbe:5,speed:87.5,layer:5,scale:1,color:"#F15060",border:"#A92626"},Black:{name:"Black",rbe:11,speed:45,layer:6,scale:.58,color:"#161616",border:"#414141"},Purple:{name:"Purple",rbe:11,speed:75,layer:7,scale:.95,color:"#9326E0",border:"#00E4FF"},White:{name:"White",rbe:12,speed:50,layer:6,scale:.58,color:"#D7D7D7",border:"#727272"},Lead:{name:"Lead",rbe:23,speed:25,layer:7,scale:.95,color:"#7E7E7E",border:"#2F2F2F"},Zebra:{name:"Zebra",rbe:23,speed:45,layer:7,scale:.9,color:"repeating-linear-gradient(145deg, #040404, #040404 10px, #ffffff 10px, #ffffff 20px)",border:"#5A5A5A"},Rainbow:{name:"Rainbow",rbe:47,speed:55,layer:8,scale:1,color:"linear-gradient(180deg, rgba(228,26,26,1) 0%, rgba(255,159,0,1) 16%, rgba(255,224,0,1) 33%, rgba(125,181,4,1) 48%, rgba(83,176,222,1) 66%, rgba(226,74,226,1) 84%, rgba(132,21,132,1) 100%)",border:"transparent"},Ceramic:{name:"Ceramic",rbe:47,speed:62.5,layer:9,scale:1,color:"#BE6C1D",border:"#61370B"},Moab:{name:"Moab",rbe:616,speed:25,layer:10,color:"#2AC2FF",border:"#FFFFFF"},Bfb:{name:"Bfb",rbe:3164,speed:6.25,layer:11,color:"#C00505",border:"#FFFFFF"},Zomg:{name:"Zomg",rbe:16656,speed:4.5,layer:12,color:"#575757",border:"#B7F700"},Ddt:{name:"Ddt",rbe:3164,speed:66,layer:12,color:"#3C3C3C",border:"#A5A5A5"},Bad:{name:"Bad",rbe:16464,speed:4.5,layer:13,color:"#AB02AC",border:"#500151"}},bloons_spritesheet=new Image;bloons_spritesheet.src="../Assets/BloonIcon/preview_bloons_spritesheet.webp";let bloonImageMap={CeramicCamo:{x:1153,y:0,width:129,height:163},CeramicFortified:{x:993,y:547,width:140,height:163},CeramicFortifiedCamo:{x:993,y:711,width:140,height:163},CeramicRegrow:{x:0,y:782,width:176,height:162},CeramicRegrowCamo:{x:177,y:782,width:176,height:162},CeramicRegrowFortified:{x:629,y:0,width:186,height:162},CeramicRegrowFortifiedCamo:{x:629,y:163,width:186,height:162},Black:{x:1283,y:790,width:78,height:97},BlackCamo:{x:1283,y:888,width:78,height:97},BlackRegrow:{x:833,y:945,width:105,height:97},BlackRegrowCamo:{x:708,y:782,width:105,height:97},Blue:{x:1283,y:148,width:110,height:139},BlueCamo:{x:1283,y:288,width:110,height:139},BlueRegrow:{x:408,y:641,width:150,height:138},BlueRegrowCamo:{x:993,y:146,width:150,height:138},Ceramic:{x:1153,y:164,width:129,height:163},LeadFortifiedCamo:{x:993,y:875,width:133,height:156},LeadRegrow:{x:816,y:326,width:168,height:154},LeadRegrowCamo:{x:816,y:481,width:168,height:154},LeadRegrowFortified:{x:629,y:326,width:178,height:154},LeadRegrowFortifiedCamo:{x:629,y:481,width:178,height:154},Green:{x:878,y:1100,width:116,height:147},GreenCamo:{x:995,y:1100,width:116,height:147},GreenRegrow:{x:468,y:474,width:159,height:145},GreenRegrowCamo:{x:629,y:636,width:159,height:145},Lead:{x:134,y:1100,width:123,height:156},LeadCamo:{x:258,y:1100,width:123,height:156},LeadFortified:{x:0,y:1100,width:133,height:156},WhiteRegrow:{x:1153,y:1132,width:105,height:97},WhiteRegrowCamo:{x:1283,y:428,width:105,height:97},Yellow:{x:382,y:1100,width:123,height:156},YellowCamo:{x:506,y:1100,width:123,height:156},YellowRegrow:{x:816,y:636,width:168,height:154},YellowRegrowCamo:{x:0,y:945,width:168,height:154},Zebra:{x:1153,y:984,width:116,height:147},ZebraCamo:{x:1283,y:0,width:116,height:147},ZebraRegrow:{x:816,y:791,width:159,height:145},ZebraRegrowCamo:{x:993,y:0,width:159,height:145},Pink:{x:1153,y:328,width:129,height:163},PinkCamo:{x:1153,y:492,width:129,height:163},PinkRegrow:{x:354,y:782,width:176,height:162},PinkRegrowCamo:{x:531,y:782,width:176,height:162},Purple:{x:630,y:1100,width:123,height:156},PurpleCamo:{x:754,y:1100,width:123,height:156},PurpleRegrow:{x:169,y:945,width:168,height:154},PurpleRegrowCamo:{x:338,y:945,width:168,height:154},Rainbow:{x:1153,y:656,width:129,height:163},RainbowCamo:{x:1153,y:820,width:129,height:163},RainbowRegrow:{x:816,y:0,width:176,height:162},RainbowRegrowCamo:{x:816,y:163,width:176,height:162},Red:{x:1283,y:526,width:103,height:131},RedCamo:{x:1283,y:658,width:103,height:131},RedRegrow:{x:993,y:285,width:143,height:130},RedRegrowCamo:{x:993,y:416,width:143,height:130},White:{x:1283,y:986,width:78,height:97},WhiteCamo:{x:1283,y:1084,width:78,height:97},Bad:{x:0,y:238,width:326,height:235},BadFortified:{x:0,y:0,width:326,height:237},Bfb:{x:234,y:474,width:233,height:164},BfbFortified:{x:0,y:474,width:233,height:166},DdtCamo:{x:0,y:641,width:203,height:140},DdtFortifiedCamo:{x:204,y:641,width:203,height:140},Moab:{x:670,y:945,width:162,height:105},MoabFortified:{x:507,y:945,width:162,height:110},Zomg:{x:327,y:0,width:301,height:194},ZomgFortified:{x:327,y:195,width:301,height:194}};class Bloon{constructor(e,t){this.speed=bloonsData[e.replace("Camo","").replace("Regrow","").replace("Fortified","")].speed,this.scale=bloonsData[e.replace("Camo","").replace("Regrow","").replace("Fortified","")].scale,this.x=-ratioCalc(1,0,100,bloonImageMap[e].width,bloonImageMap[e].height),this.y=100+(100-100*this.scale)/2,this.type=e,this.groupIndex=t,this.width=ratioCalc(1,0,100,bloonImageMap[e].width,bloonImageMap[e].height)}move(e){this.x+=this.speed*e*6.86*speedMultiplier*roundSpeedModifier*difficultySpeedModifier}shouldDelete(){return this.x>=800}render(e){if(hiddenGroups.includes(this.groupIndex))return;let t=bloonImageMap[this.type];e.drawImage(bloons_spritesheet,t.x,t.y,t.width,t.height,this.x,this.y,this.scale*this.width,100*this.scale)}}class Blimp{constructor(e,t){this.speed=bloonsData[e.replace("Camo","").replace("Regrow","").replace("Fortified","")].speed,this.x=-1.62*bloonImageMap[e].width,this.type=e,this.groupIndex=t}move(e){this.x+=this.speed*e*6.86*speedMultiplier*roundSpeedModifier*difficultySpeedModifier}shouldDelete(){return this.x>=800}render(e){if(hiddenGroups.includes(this.groupIndex))return;let t=bloonImageMap[this.type];e.drawImage(bloons_spritesheet,t.x,t.y,t.width,t.height,this.x,150-1.62*t.height/2,1.62*t.width,1.62*t.height)}}const bloons=[];let currentRoundGroups,difficultySpeedModifier=1,roundSpeedModifier=1;function resetPreview(){previewActive=!1,previewFrameId&&(cancelAnimationFrame(previewFrameId),previewFrameId=null),clearPreview()}function startPreviewLoop(){previewFrameId&&(cancelAnimationFrame(previewFrameId),previewFrameId=null),previewActive=!0;let e=performance.now();previewFrameId=requestAnimationFrame((function t(){if(!previewActive)return;const n=performance.now(),r=(n-e)/1e3;e=n,update(r),render(),previewFrameId=requestAnimationFrame(t)}))}const update=e=>{const t=performance.now();for(let t=bloons.length-1;t>=0;t--){const n=bloons[t];n.move(e),n.shouldDelete()&&bloons.splice(t,1)}null!=currentRoundGroups&&currentRoundGroups.bloonGroups.forEach((e=>{if(t>=e.startTime&&e.spawned<e.total){const n=(t-e.startTime)/1e3;if(0===e.spawnInterval){const t=e.total-e.spawned;for(let r=0;r<t;r++)e.spawnBloon(n),e.spawned++}else{const t=Math.min(e.total,Math.floor(n/e.spawnInterval)+1);for(;e.spawned<t;){const t=e.spawned,r=Math.max(0,n-t*e.spawnInterval);e.spawnBloon(r),e.spawned++}}}}))},render=()=>{ctx.clearRect(0,0,canvas.width,canvas.height),bloons.forEach((e=>e.render(ctx)))};function startRound(e){if(roundSpeedModifier=calcRoundSpeed(e.roundNumber),currentRoundGroups=JSON.parse(JSON.stringify(e)),roundsetFilterSettings.roundsetReversed){let t=Math.max(...e.bloonGroups.map((e=>e.end)));for(let e of currentRoundGroups.bloonGroups){let n=e.end-e.start;e.start=t-e.end,e.end=e.start+n}}addTimelinePlayhead(Math.max(...currentRoundGroups.bloonGroups.map((e=>e.end)))/speedMultiplier),currentRoundGroups.bloonGroups.forEach(((e,t)=>{e.startTime=performance.now()+1e3*e.start/speedMultiplier,e.total=e.count,e.spawned=0,e.activeTime=0,e.spawnAccumulator=0,e.spawnInterval=(e.end-e.start)/(e.count-1)/speedMultiplier,(!isFinite(e.spawnInterval)||e.spawnInterval<0)&&(e.spawnInterval=0),e.spawnBloon=spawnBloon(e,t)}))}function spawnBloon(e,t){return function(n=0){let r=e.bloon,d=["Moab","MoabFortified","Bfb","BfbFortified","Zomg","ZomgFortified","DdtCamo","DdtFortifiedCamo","Bad","BadFortified"].includes(r)?new Blimp(r,t):new Bloon(r,t);n>0&&d.move(n);let s=bloonsData[r.replace("Camo","").replace("Regrow","").replace("Fortified","")].layer,o=bloons.findIndex((e=>bloonsData[e.type.replace("Camo","").replace("Regrow","").replace("Fortified","")].layer>s));-1===o?bloons.push(d):bloons.splice(o,0,d)}}function calcRoundSpeed(e){let t=0;return t=e<=80?1:e<=100?1+.02*(e-80):e<=150?1.6+.02*(e-101):e<=200?3+.02*(e-151):e<=250?4.5+.02*(e-201):6+.02*(e-252),t}let readyFlags=[0,0,0,0,0],pressedStart=!1,timerInterval=null,constants={},locJSON={},achievementsJSON={},achievementsHelper={},trophyStoreItemsJSON={},teamsStoreItemsJSON={},rogueJSON={},backQueue=[],backButton=createEl("img",{src:"../Assets/UI/BackBtn.webp",classList:["back-button","pointer"]});function goBack(e){let t=backQueue.pop();t.source&&(document.getElementById(t.destination+"-content").style.display="none",document.getElementById(t.source+"-content").style.display="flex"),t.callback&&t.callback(),timerInterval&&clearInterval(timerInterval),changeHexBGColor(constants.BGColor),0===backQueue.length&&backButton.classList.remove("visible"),e||resetScroll()}function addToBackQueue(e){backQueue.push(e),backButton.classList.add("visible")}function clearBackQueue(){backQueue=[],backButton.classList.remove("visible")}function createEl(e,t={}){const n=document.createElement(e);if(t.classList&&n.classList.add(...t.classList),t.innerHTML&&(n.innerHTML=t.innerHTML),t.textContent&&(n.textContent=t.textContent),t.id&&(n.id=t.id),t.src&&(n.src=t.src),t.placeholder&&(n.placeholder=t.placeholder),t.style&&Object.assign(n.style,t.style),t.onclick&&(n.onclick=t.onclick),t.attributes)for(const[e,r]of Object.entries(t.attributes))n.setAttribute(e,r);return t.children&&t.children.forEach((e=>n.appendChild(e))),n}function createModal({header:e="",content:t="",footer:n="",classList:r=[]}={}){const d=createEl("div",{classList:["modal-overlay",...r]}),s=createEl("div",{classList:["modal-box"]}),o=createEl("div",{classList:["modal-header"]});""!=e&&s.appendChild(o);const i=createEl("div",{classList:["collection-header-modal-left"]});o.appendChild(i);const a=createEl("p",{classList:["collection-modal-header-text","black-outline"],innerHTML:e});o.appendChild(a);const l=createEl("img",{classList:["collection-modal-close","pointer"],src:"./Assets/UI/CloseBtn.webp"});l.addEventListener("click",(()=>{goBack(!0)})),o.appendChild(l);const c=createEl("div",{classList:["modal-content"]});if(s.appendChild(c),"string"==typeof t?c.innerHTML=t:t&&c.appendChild(t),n){const e=createEl("div",{classList:["modal-footer"]});"string"==typeof n?e.innerHTML=n:e.appendChild(n),s.appendChild(e)}d.appendChild(s),document.body.appendChild(d),addToBackQueue({callback:closeModal})}function closeModal(){document.querySelector(".modal-overlay")?.remove()}function showLoading(){let e=0;function t(){e--,0===e&&(document.getElementById("loading").style.transform="scale(0)")}new MutationObserver((n=>{n.forEach((n=>{"childList"===n.type&&n.addedNodes.forEach((n=>{"IMG"===n.nodeName&&(e++,n.addEventListener("load",t),n.addEventListener("error",t))}))}))})).observe(document.body,{childList:!0,subtree:!0}),document.getElementById("loading").style.removeProperty("transform")}function hideLoading(){document.getElementById("loading").style.transform="scale(0)"}function fetchConstants(){return fetch("./data/Constants.json").then((e=>e.json())).then((e=>{constants=e,readyFlags[4]=1})).catch((e=>{console.error("Error:",e),errorModal(e,"js")}))}function fetchLocKeys(){return fetch("./data/English.json").then((e=>e.json())).then((e=>{locJSON=e}))}async function fetchRogueDependencies(){return await fetchLocKeys(),fetch("./data/rogueData.json").then((e=>e.json())).then((e=>{rogueJSON=e,postProcessRogueData()})).catch((e=>{console.error("Error:",e),errorModal(e,"js")}))}async function fetchInstaDependencies(){await fetchLocKeys(),generateStats(),generateInstaData(),changeProgressTab("InstaMonkeys"),clearBackQueue(),hideLoading()}async function fetchMainDependencies(){Object.keys(constants.heroesInOrder).includes(btd6usersave.primaryHero)||(btd6usersave.primaryHero=Object.keys(constants.heroesInOrder)[0]),await fetchLocKeys(),await fetchRogueDependencies(),Promise.all([fetch("./data/Achievements150.json").then((e=>e.json())),fetch("./data/trophyStoreItems.json").then((e=>e.json())),fetch("./data/teamsStoreItems.json").then((e=>e.json()))]).then((([e,t,n])=>{achievementsJSON=e,trophyStoreItemsJSON=t,teamsStoreItemsJSON=n,readyFlags[2]=1,readyFlags[3]=1,loadSettings(),generateIfReady()})).catch((e=>{console.error("Error:",e),errorModal(e,"js")})),showLoading()}function resetScroll(){document.body.scrollTop=0,document.documentElement.scrollTop=0}function loadSettings(){let e=JSON.parse(localStorage.getItem("BTD6OAKSettings"));e&&(preventRateLimiting=e.ProfileLoading,useNamedMonkeys=e.UseNamedMonkeys,showTeamsItems=e.TeamsStoreItems)}function saveSettings(){let e={ProfileLoading:preventRateLimiting,UseNamedMonkeys:useNamedMonkeys,TeamsStoreItems:showTeamsItems};localStorage.setItem("BTD6OAKSettings",JSON.stringify(e))}function generateAvatar(e,t){let n=document.createElement("div");n.style.width=`${e}px`,n.style.height=`${e}px`,n.classList.add("avatar");let r=document.createElement("img");r.classList.add("avatar-frame","noSelect"),r.style.width=`${e}px`,r.src="../Assets/UI/InstaTowersContainer.webp",n.appendChild(r);let d=document.createElement("img");return d.classList.add("avatar-img","noSelect"),d.style.width=`${e}px`,d.src=t,n.appendChild(d),n}function openBTD6Link(e){window.location.href=e}function openBTD6Site(e){window.open(e,"_blank")}function copyLoadingIcon(e){let t=document.getElementsByClassName("loading-icon")[0].cloneNode(!0);t.classList.add("loading-icon-leaderboard"),t.style.height="unset",e.appendChild(t)}function formatTime(e){return[Math.floor(e/3600),Math.floor(e%3600/60),Math.floor(e%60)].map((e=>e<10?"0"+e:e)).join(":")}function formatScoreTime(e){let t=Math.floor(e/1e3),n=e%1e3,r=Math.floor(t/3600);t%=3600;let d=Math.floor(t/60),s=t%60;d=d.toString().padStart(2,"0"),s=s.toString().padStart(2,"0"),n=n.toString().padStart(3,"0");let o=`${d}:${s}.${n}`;return r>0&&(r=r.toString().padStart(2,"0"),o=`${r}:${o}`),o}function getRemainingTime(e){return(e-new Date)/1e3}function updateTimer(e,t){const n=getRemainingTime(e),r=document.getElementById(t);if(n>172800){const e=Math.ceil(n/86400);r.textContent=`${e} days left`,r.style.width="130px"}else n<0?(r.textContent="Finished",r.style.textAlign="right"):(r.style.width="100px",r.textContent=formatTime(n))}function relativeTime(e,t){const n=[{name:"year",ms:31536e6},{name:"month",ms:2592e6},{name:"day",ms:864e5},{name:"hour",ms:36e5},{name:"minute",ms:6e4},{name:"second",ms:1e3}],r=e-t;for(const e of n){if(r<e.ms)continue;let t=Math.round(r/e.ms);return`${t} ${e.name}${t>1?"s":""} ago`}}function changeHexBGColor(e){null!=e?document.body.style.backgroundColor=`rgb(${255*e[0]},${255*e[1]},${255*e[2]})`:document.body.style.removeProperty("background-color")}function ratioCalc(e,t,n,r,d){switch(e){case 1:return n*(r/d);case 2:return t*(d/r);case 3:return d*(t/n);case 4:return r*(n/t)}}function processRewardsString(e){let t={},n=e.split("#"),r=0;for(let e of n){t[r]={};let n=e.split(":"),d=n[0];if(!["MonkeyMoney","Power","InstaMonkey","KnowledgePoints","RandomInstaMonkey","Trophy"].includes(d)){t[r].type="Other",t[r].value=d,r++;continue}let s=n[1].split(",");switch(d){case"MonkeyMoney":t[r].type="MonkeyMoney",t[r].amount=parseInt(s[0]);break;case"Power":t[r].type="Power",t[r].power=s[0],t[r].amount=parseInt(s[1]),null==s[1]&&(t[r].amount=1);break;case"InstaMonkey":t[r].type="InstaMonkey",t[r].tower=s[0],t[r].tiers=s[1];break;case"KnowledgePoints":t[r].type="KnowledgePoints",t[r].amount=parseInt(s[0]);break;case"RandomInstaMonkey":t[r].type="RandomInstaMonkey",t[r].tier=s[0],t[r].amount=parseInt(s[1]);break;case"Trophy":t[r].type="Trophy",t[r].trophy=s[0]}r++}return t}function generateLoginDiv(e){let t=createEl("div",{classList:["d-flex","ai-center","jc-center","fd-column","bg-color-primary"]}),n=createEl("p",{classList:["site-info-header","black-outline"],innerHTML:"Login with your OAK Token!"});t.appendChild(n);const r=createEl("div");Object.entries(localStorageOAK).forEach((([t,n])=>{const d=createEl("div",{classList:["previous-oak-entry","d-flex","ai-center","ps-relative"],style:{backgroundImage:`linear-gradient(to right, transparent 80%, var(--profile-primary) 100%),url(${n.banner})`}});d.appendChild(generateAvatar(100,n.avatar)),d.appendChild(createEl("p",{classList:["profile-name","tc-white","font-luckiest","black-outline"],innerHTML:n.displayName}));const s=createEl("img",{classList:["use-button","ps-absolute"],src:"./Assets/UI/ContinueBtn.webp"});s.addEventListener("click",(async()=>{pressedStart||(pressedStart=!0,document.getElementById("loading").style.removeProperty("transform"),oak_token=t,await getSaveData(t),loggedIn=!0,e?e(oak_token):fetchMainDependencies())})),d.appendChild(s);const o=createEl("img",{classList:["delete-button","ps-absolute"],src:"./Assets/UI/CloseBtn.webp"});o.addEventListener("click",(()=>{delete localStorageOAK[t],writeLocalStorage(),r.removeChild(d)})),d.appendChild(o),r.appendChild(d)})),t.appendChild(r);let d=document.createElement("div");d.classList.add("site-access-div"),t.appendChild(d);let s=document.createElement("div");s.classList.add("oak-entry-div"),t.appendChild(s);let o=document.createElement("input");o.classList.add("key-entry"),o.placeholder="Enter your OAK here",s.appendChild(o);let i=document.createElement("div");i.classList.add("start-button","black-outline"),i.innerHTML="Start",i.addEventListener("click",(async()=>{let e=o.value;e.length<5||e.length>30||!e.startsWith("oak_")?errorModal('Please enter a valid OAK! This will start with "oak_".'):pressedStart||(document.getElementById("loading").style.removeProperty("transform"),pressedStart=!0,loggedIn=!0,oak_token=o.value,await getSaveData(oak_token),fetchMainDependencies())})),s.appendChild(i);let a=document.createElement("div");a.classList.add("get-oak-div"),t.appendChild(a);let l=document.createElement("p");l.classList.add("where-text"),l.innerHTML="Don't have an OAK token? Read here:",a.appendChild(l);let c=document.createElement("p");c.classList.add("where-button","black-outline"),c.style.width="220px",c.innerHTML="View OAK Guide",c.addEventListener("click",(()=>{openOAKInstructionsModal()})),a.appendChild(c);let u=document.createElement("div");return u.id="oak-instructions-div",u.classList.add("oak-instructions-div"),u.style.display="none",t.appendChild(u),t}function openOAKInstructionsModal(){let e=createEl("div",{style:{padding:"10px"}});return e.appendChild(createEl("p",{classList:["oak-instructions-header","black-outline"],innerHTML:"What is an Open Access Key?"})),e.appendChild(createEl("p",{classList:["oak-instructions-text"],innerHTML:"An Open Access Key (OAK) is a unique key that allows you to access your Bloons TD 6 data from Ninja Kiwi's Open Data API. The site will use this to fetch your information from the API to be displayed in a familiar way. <br><br>NOTE: Progress tracking is not available for BTD6+ on Apple Arcade and BTD6 Netflix as OAK tokens are unavailable."})),e.appendChild(createEl("p",{classList:["oak-instructions-header","black-outline"],innerHTML:"How do I get one?"})),e.appendChild(createEl("p",{classList:["oak-instructions-text"],innerHTML:"Step 1: Login and Backup your progress with a Ninja Kiwi Account in BTD6. You can do this by going to settings from the main menu and clicking on the Account button."})),e.appendChild(createEl("img",{classList:["oak-instruction-img"],src:"./Assets/UI/OAKTutorial1.webp"})),e.appendChild(createEl("p",{classList:["oak-instructions-text"],innerHTML:'Step 2: Select "Open Data API" at the bottom right of the account screen.'})),e.appendChild(createEl("img",{classList:["oak-instruction-img"],src:"./Assets/UI/OAKTutorial2.webp"})),e.appendChild(createEl("p",{classList:["oak-instructions-text"],innerHTML:'Step 3: Generate a key and copy that in to the above text field. It should start with "oak_". Then click "Start" to begin!'})),e.appendChild(createEl("img",{classList:["oak-instruction-img"],src:"./Assets/UI/OAKTutorial3.webp"})),e.appendChild(createEl("p",{classList:["oak-instructions-text"],innerHTML:'You can read more about the Open Data API here: <a href="https://ninja.kiwi/opendatafaq" target="_blank", style="color:white";>Open Data API Article</a><br><br>Privacy Note: This app does not store any data being sent to or retrieved from Ninja Kiwi\'s Open Data API outside of your browser/device. The localStorage browser feature is used to prevent users from having to re-enter their OAK token every time they visit the site. If you would like to delete this stored data, you can do so by clicking the "X" on the profile you would like to delete on this homepage or clearing your browsing data.'})),createModal({header:"OAK Instructions",content:e}),e}function errorModal(e,t,n){if(isErrorModalOpen&&!n)return;let r=document.createElement("div");r.classList.add("error-modal-overlay"),document.body.appendChild(r);let d=document.createElement("div");d.id="error-modal",d.classList.add("error-modal"),r.appendChild(d);let s=document.createElement("div");s.id="error-modal-header",s.classList.add("error-modal-header"),d.appendChild(s);let o=document.createElement("img");o.id="error-modal-header-img",o.classList.add("error-modal-header-img"),o.src="./Assets/UI/BadConnectionBtn.webp",s.appendChild(o);let i=document.createElement("p");i.classList.add("error-modal-header-text","black-outline"),i.innerHTML="Error",s.appendChild(i);let a=document.createElement("div");a.classList.add("error-modal-dummy"),s.appendChild(a);let l=document.createElement("div");l.id="error-modal-content",l.classList.add("error-modal-content"),l.innerHTML=""+e,d.appendChild(l);let c=document.createElement("div");if(c.classList.add("error-modal-content"),"Invalid user ID / Player Does not play this game"===e)c.innerHTML="Please try again or create a new Open Access Key.",d.appendChild(c);if("ratelimit"==t){let e=document.createElement("div");e.classList.add("error-toggle-div"),d.appendChild(e);let t=document.createElement("p");t.classList.add("maps-progress-coop-toggle-text","black-outline"),t.innerHTML="Manually Load Profiles: ",e.appendChild(t);let n=document.createElement("input");n.classList.add("maps-progress-coop-toggle-input"),n.type="checkbox",n.checked=preventRateLimiting,n.addEventListener("change",(()=>{n.checked?preventRateLimiting=!0:preventRateLimiting=!1})),e.appendChild(n)}let u=document.createElement("div");u.classList.add("error-modal-ok-button-div"),d.appendChild(u);let p=document.createElement("div");p.classList.add("start-button","modal-ok-button","black-outline"),p.innerHTML="OK",p.addEventListener("click",(()=>{isErrorModalOpen=!1,document.body.removeChild(r)})),u.appendChild(p);let m=document.createElement("img");m.classList.add("error-modal-close"),m.src="./Assets/UI/CloseBtn.webp",m.addEventListener("click",(()=>{isErrorModalOpen=!1,document.body.removeChild(r)})),l.appendChild(m),isErrorModalOpen=!0}backButton.addEventListener("click",(()=>{goBack()})),document.querySelector(".header").prepend(backButton);const rtf=new Intl.RelativeTimeFormat("en",{style:"long"});function getRelativeTimeString(e){const t=e-Date.now(),n=Math.abs(t),r=36e5,d=24*r;let s,o;return n>=d?(s=Math.round(t/d),o="day"):n>=r?(s=Math.round(t/r),o="hour"):(s=Math.round(t/6e4),o="minute"),rtf.format(s,o)}