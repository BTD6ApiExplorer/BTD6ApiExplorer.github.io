let e,t={},d="Simple",n=null,a=0,l=0,i=!1,o=null,s=[],r=140,c=[];function m(){let e=0;function t(){e--,0===e&&(document.getElementById("loading").style.transform="scale(0)")}new MutationObserver((d=>{d.forEach((d=>{"childList"===d.type&&d.addedNodes.forEach((d=>{"IMG"===d.nodeName&&(e++,d.addEventListener("load",t))}))}))})).observe(document.body,{childList:!0,subtree:!0}),document.getElementById("loading").style.removeProperty("transform")}function u(){document.getElementById("loading").style.transform="scale(0)"}fetch("./data/Constants.json").then((e=>e.json())).then((e=>{t=e,y()})).catch((e=>{console.error("Error:",e),N(e,"js")}));const p=document.createElement("div");document.body.appendChild(p),document.body.classList.add("hex-bg");const h=document.createElement("div");h.classList.add("header"),p.appendChild(h);const g=document.createElement("div");g.classList.add("header-div"),h.appendChild(g);const b=document.createElement("h1");b.classList.add("title"),b.innerHTML="Bloons TD 6 Roundsets",g.appendChild(b);const v=document.createElement("div");v.classList.add("content"),p.appendChild(v);const L=document.createElement("div");L.id="extras-content",L.classList.add("extras","content-div"),L.style.display="flex",v.appendChild(L);const w=document.createElement("div");function y(){let e=document.getElementById("extras-content");e.innerHTML="";let d=document.createElement("div");d.classList.add("progress-page","page-extra"),e.appendChild(d);let n=document.createElement("p");n.classList.add("roundset-header-text","black-outline"),n.innerHTML="Select a roundset to view:",d.appendChild(n);let a=document.createElement("div");a.classList.add("selectors-div"),d.appendChild(a);let l={};Object.entries(t.limitedTimeEvents).forEach((([e,t])=>{t.start<Date.now()&&t.end>Date.now()&&(l[e]=t)})),Object.entries(l).forEach((([e,t])=>{let d=document.createElement("div");d.classList.add("roundset-selector-div"),d.addEventListener("click",(()=>{m(),E("extras",t.roundset)})),a.appendChild(d);let n=document.createElement("img");switch(n.classList.add("roundset-selector-img"),d.appendChild(n),t.type){case"Race":n.src="../Assets/UI/EventRaceBtn.webp",d.classList.add("race-roundset");break;case"Odyssey":n.src="../Assets/UI/OdysseyEventBtn.webp",d.classList.add("odyssey-roundset");break;case"Boss":n.src="../Assets/UI/BossesBtn.webp",d.classList.add("boss-roundset")}let l=document.createElement("div");l.classList.add("roundset-selector-text-div"),d.appendChild(l);let i=document.createElement("p");i.classList.add("selector-text","black-outline"),i.innerHTML=`${t.type} Event - ${e}`,l.appendChild(i);let o=document.createElement("p");o.id="time-left-"+e,o.classList.add("selector-text","black-outline"),l.appendChild(o),new Date<new Date(t.start)?raceTimeLeft.innerHTML="Coming Soon!":new Date(t.end)>new Date&&(A(new Date(t.end),o.id),timerInterval=setInterval((()=>A(new Date(t.end),o.id)),1e3));let s=document.createElement("img");s.classList.add("selector-go-img"),s.src="../Assets/UI/ContinueBtn.webp",d.appendChild(s)}));let i=Object.fromEntries(Object.entries(t.roundSets).filter((([e,t])=>"quest"!=t.type))),o=Object.fromEntries(Object.entries(t.roundSets).filter((([e,t])=>"quest"===t.type)));Object.entries(i).forEach((([e,t])=>{let d=document.createElement("div");d.classList.add("roundset-selector-div"),"boss"==t.type?d.classList.add("veteran-container"):d.classList.add("wood-container"),d.addEventListener("click",(()=>{m(),E("extras",e)})),a.appendChild(d);let n=document.createElement("img");n.classList.add("roundset-selector-img"),n.src=`../Assets/UI/${t.icon}.webp`,d.appendChild(n);let l=document.createElement("p");l.classList.add("selector-text","black-outline"),l.innerHTML=t.name,d.appendChild(l);let i=document.createElement("img");i.classList.add("selector-go-img"),i.src="../Assets/UI/ContinueBtn.webp",d.appendChild(i)}));let s=document.createElement("p");s.classList.add("other-roundsets-selector-text","black-outline"),s.innerHTML="Quest Custom Rounds",a.appendChild(s);let r=document.createElement("div");r.classList.add("other-roundsets-selector-div"),a.appendChild(r),Object.entries(o).forEach((([e,t])=>{let d=document.createElement("div");d.classList.add("other-roundset-selector-div"),d.addEventListener("click",(()=>{E("extras",e)})),r.appendChild(d);let n=document.createElement("p");n.classList.add("other-roundset-selector-text","black-outline");let a=e.match(/(Part|Stage)(\d+)/i);null!=a&&(n.innerHTML=`${a[1]} ${a[2]}`,d.appendChild(n));let l=document.createElement("img");l.classList.add("other-roundset-selector-img"),l.src=`../Assets/QuestIcon/${t.icon}.webp`,d.appendChild(l)}));let c=document.createElement("div");c.classList.add("sku-roundset-selector-div"),a.appendChild(c);let u=document.createElement("p");u.classList.add("other-roundsets-selector-text","black-outline"),u.innerHTML="Other Custom Rounds",c.appendChild(u);let p=document.createElement("p");p.classList.add("sku-roundset-selector-desc"),p.innerHTML="These mostly old roundsets will have only been used in one-off events such as Odysseys, Races, or Bosses and may not have ended up being used for their intended purpose despite their name. Take these roundsets with a grain of salt. I'm including them on the viewer for completeness sake.",c.appendChild(p);let h=document.createElement("div");h.classList.add("sku-roundsets-selector-div"),c.appendChild(h),t.skuRoundsets.forEach((e=>{let t=document.createElement("div");t.classList.add("sku-roundset-selector-div"),t.addEventListener("click",(()=>{E("extras",e)})),h.appendChild(t);let d=document.createElement("p");d.classList.add("sku-roundset-selector-text","black-outline"),d.innerHTML=e,t.appendChild(d)}));let g=document.createElement("p");g.classList.add("sku-roundset-selector-desc"),g.style.textAlign="center",g.innerHTML='This is a standalone form of the roundset viewer from a project called Bloons TD 6 API Explorer which allows you to view current and previous event data available on the API as well as track your progress. You can view it here: <a href="https://BTD6APIExplorer.github.io">Bloons TD 6 API Explorer</a>',d.appendChild(g)}async function E(l,i){let c=document.getElementById("roundset-content");c.style.display="flex",c.innerHTML="",document.getElementById(`${l}-content`).style.display="none",S();let m=await fetch(`./data/${i}.json`).then((e=>e.json())),u="unknown";t.roundSets[i]&&(u=t.roundSets[i].type),n=C(m);let p=document.createElement("div");p.classList.add("roundset-header-bar"),c.appendChild(p);let h=document.createElement("div");h.classList.add("roundset-header-title"),p.appendChild(h);let g=document.createElement("div");g.classList.add("roundset-header-left"),h.appendChild(g);let b=document.createElement("p");b.classList.add("roundset-header-text","black-outline"),b.innerHTML=t.roundSets[i]?t.roundSets[i].name:i,h.appendChild(b);let v=document.createElement("div");v.classList.add("roundset-header-right"),h.appendChild(v);let L=document.createElement("img");L.classList.add("modal-close"),L.src="./Assets/UI/CloseBtn.webp",L.addEventListener("click",(()=>{c.style.display="none",document.getElementById(`${l}-content`).style.display="flex"})),v.appendChild(L);let w=document.createElement("div");w.classList.add("roundset-header-bar-bottom"),p.appendChild(w);let y=document.createElement("div");y.classList.add("maps-progress-views"),w.appendChild(y);let E=document.createElement("p");E.classList.add("maps-progress-coop-toggle-text","maps-progress-view-list","black-outline"),E.innerHTML="Display Type:",y.appendChild(E);let B=document.createElement("div");B.classList.add("maps-progress-view","stats-tab-yellow","black-outline"),B.innerHTML="Simple",y.appendChild(B);let T=document.createElement("div");T.classList.add("maps-progress-view","black-outline"),T.innerHTML="Detailed",y.appendChild(T);let M=document.createElement("div");M.classList.add("maps-progress-view","black-outline"),M.innerHTML="Preview",y.appendChild(M);let I=document.createElement("div");I.classList.add("maps-progress-filter"),w.appendChild(I);let R=document.createElement("div");R.classList.add("map-progress-filter-difficulty");let F=document.createElement("p");F.classList.add("maps-progress-coop-toggle-text","black-outline"),R.appendChild(F);let H=document.createElement("input");H.id="roundset-modified-checkbox",H.classList.add("maps-progress-coop-toggle-input"),H.type="checkbox",R.appendChild(H),"boss"==u?(s=[],n.rounds.forEach(((e,t)=>{e.hasOwnProperty("modified")&&s.push(e.roundNumber)})),H.checked=!0,I.appendChild(R),F.innerHTML="Only Modified:",e="modified",o=H):"quest"==u?(s=[],n.rounds.forEach(((e,d)=>{e.roundNumber>t.roundSets[i].endRound||s.push(e.roundNumber)})),F.innerHTML="Hide Unused:",e="unused",r=t.roundSets[i].endRound,I.appendChild(R),H.checked=!0,o=H):o=null;let $=document.createElement("div");$.classList.add("maps-progress-coop-toggle"),I.appendChild($);let A=document.createElement("p");A.classList.add("maps-progress-coop-toggle-text","black-outline"),A.innerHTML="Reverse:",$.appendChild(A);let D=document.createElement("input");D.id="roundset-reverse-checkbox",D.classList.add("maps-progress-coop-toggle-input"),D.type="checkbox",$.appendChild(D);let N=document.createElement("div");N.id="rounds-content",N.classList.add("rounds-content"),c.appendChild(N),B.addEventListener("click",(()=>{B.classList.add("stats-tab-yellow"),T.classList.remove("stats-tab-yellow"),M.classList.remove("stats-tab-yellow"),d="Simple",f(d,D.checked,H.checked)})),T.addEventListener("click",(()=>{T.classList.add("stats-tab-yellow"),B.classList.remove("stats-tab-yellow"),M.classList.remove("stats-tab-yellow"),d="Topper",f(d,D.checked,H.checked)})),M.addEventListener("click",(()=>{M.classList.add("stats-tab-yellow"),B.classList.remove("stats-tab-yellow"),T.classList.remove("stats-tab-yellow"),d="Preview",f(d,D.checked,H.checked)})),D.addEventListener("change",(()=>{k(D.checked)})),H.addEventListener("change",(()=>{x(H.checked)})),a=0,d="Simple",f(d,D.checked,H.checked),x(H.checked)}function C(e,t){return null!=t&&t.rounds.forEach(((t,d)=>{let n=e.rounds.findIndex((e=>e.roundNumber==t.roundNumber));t.addToRound?-1!=n&&(e.rounds[n].bloonGroups=e.rounds[n].bloonGroups.concat(t.bloonGroups),e.rounds[n].addToRound=!0):-1!=n&&(e.rounds[n]=t)})),e}async function f(e,t,d){let r=document.getElementById("rounds-content");r.innerHTML="";let c=!0,m=[];n.rounds.forEach(((e,t)=>{m.push(e.roundNumber)}));for(let e=0;e<m.length;e++)if(m[e]!=e+1){c=!1;break}switch(e){case"Simple":I();let e=!1;n.rounds.forEach((async(t,d)=>{let n=document.createElement("div");n.id=`round-${t.roundNumber}`,n.classList.add("round-div"),e&&n.classList.add("round-div-alt");let a=document.createElement("p");a.classList.add("round-number","black-outline"),a.innerHTML=t.roundNumber,n.appendChild(a);let l=document.createElement("div");l.id=`round-${t.roundNumber}-groups`,l.classList.add("round-bloon-groups"),n.appendChild(l);let i=document.createDocumentFragment();t.bloonGroups.sort(((e,t)=>e.start-t.start)).forEach(((e,t)=>{let d=document.createElement("div");d.classList.add("bloon-group-div");let n=document.createElement("p");n.classList.add("bloon-group-number","black-outline"),n.innerHTML="x"+e.count,d.appendChild(n);let a=document.createElement("img");a.classList.add("bloon-group-bloon"),a.src=`../Assets/BloonIcon/${e.bloon}.webp`,a.loading="lazy",d.appendChild(a),i.appendChild(d)})),l.appendChild(i),r.appendChild(n),e=!e})),document.getElementById("roundset-reverse-checkbox").checked&&k(),null!=o&&o.checked&&x(!0);break;case"Topper":I();let d=document.createElement("div");d.classList.add("rounds-detailed-div"),r.appendChild(d),R(d),setTimeout((()=>{let e=document.createDocumentFragment(),a=document.createElement("div");a.classList.add("disclaimer-div"),e.appendChild(a);let l=document.createElement("p");l.classList.add("disclaimer"),l.innerHTML="This layout is based on Topper's website:",a.appendChild(l);let i=document.createElement("a");i.classList.add("disclaimer-link"),i.href="https://topper64.co.uk/nk/btd6/rounds/",i.target="_blank",i.innerHTML="Topper's Round Information",a.appendChild(i);n.rounds.forEach((async(d,n)=>{let a=document.createElement("div");a.id=`round-${d.roundNumber}`,a.classList.add("round-div-detailed"),t&&a.classList.add("round-div-reverse");let l=document.createElement("div");l.classList.add("rounds-div-header"),a.appendChild(l);let i=document.createElement("p");i.classList.add("round-number","round-number-detailed","black-outline"),i.innerHTML=`Round ${d.roundNumber}`,l.appendChild(i);let o=document.createElement("div");o.classList.add("income-div"),l.appendChild(o);let s=document.createElement("img");s.classList.add("income-img"),s.src="../Assets/UI/CoinIcon.webp",o.appendChild(s);let r=document.createElement("div");r.classList.add("income-text-div"),o.appendChild(r);let m=document.createElement("p");m.classList.add("round-income","black-outline"),m.innerHTML=`Income: ${d.income.toLocaleString()}`,r.appendChild(m);let u=document.createElement("p");u.classList.add("round-income-total","black-outline"),u.innerHTML=`Total: ${d.incomeSum.toLocaleString()}`,c&&r.appendChild(u);let p=document.createElement("div");p.classList.add("rbe-div"),l.appendChild(p);let h=document.createElement("img");h.classList.add("rbe-img"),h.src="../Assets/BloonIcon/Red.webp",p.appendChild(h);let g=document.createElement("div");g.classList.add("rbe-text-div"),p.appendChild(g);let b=document.createElement("p");b.classList.add("round-rbe","black-outline"),b.innerHTML=`RBE: ${d.rbe.toLocaleString()}`,g.appendChild(b);let v=document.createElement("p");v.classList.add("round-rbe-total","black-outline"),v.innerHTML=`Total: ${d.rbeSum.toLocaleString()}`,c&&g.appendChild(v);let L=d.bloonGroups.length?Math.max(...d.bloonGroups.map((e=>e.end))):0,w=document.createElement("p");w.classList.add("round-duration","black-outline"),w.innerHTML=`Duration: ${L.toFixed(2)}s`,l.appendChild(w);let y=document.createElement("div");y.classList.add("timeline-div"),a.appendChild(y),d.bloonGroups.forEach(((e,t)=>{let d=document.createElement("div");d.classList.add("bloon-group-div-detailed"),y.appendChild(d);let n=document.createElement("div");n.classList.add("left-div"),d.appendChild(n);let a=document.createElement("img");a.classList.add("bloon-image"),a.src=`../Assets/BloonIcon/${e.bloon}.webp`,n.appendChild(a);let l=document.createElement("p");l.classList.add("bloon-count","black-outline"),l.innerHTML="x"+e.count,n.appendChild(l);let i=document.createElement("div");i.classList.add("timeline-right-div"),d.appendChild(i);let o=document.createElement("div");o.classList.add("bloon-bar"),i.appendChild(o);let s=document.createElement("div");s.classList.add("bloon-bar-fill"),s.style.background=j[e.bloon.replace("Camo","").replace("Regrow","").replace("Fortified","")].color,e.bloon.includes("Rainbow")||(s.style.border=`4px solid ${j[e.bloon.replace("Camo","").replace("Regrow","").replace("Fortified","")].border}`);let r=(e.end-e.start)/L*100,c=e.start/L*100;r<5&&(r=5),c+r>100&&(c=100-r),s.style.width=`${r}%`,s.style.left=`${c}%`,o.appendChild(s)})),e.appendChild(a)})),d.innerHTML="",d.appendChild(e),document.getElementById("roundset-reverse-checkbox").checked&&k(),null!=o&&o.checked&&x(!0)}),0);break;case"Preview":I();let m=document.createElement("div");m.classList.add("preview-container-div"),r.appendChild(m);let u=document.createElement("div");u.classList.add("preview-div"),m.appendChild(u);let p=document.createElement("div");p.classList.add("preview-header"),u.appendChild(p);let h=document.createElement("p");h.id="round-number-preview",h.classList.add("round-number","round-number-preview","black-outline"),h.innerHTML=`Round ${n.rounds[a].roundNumber}`,p.appendChild(h);let g=document.createElement("input");g.id="select-round-num-preview",g.classList.add("select-round-num"),g.type="number",g.min=1,g.max=n.rounds.length,g.value=a+1,g.addEventListener("change",(()=>{g.value<1&&(g.value=1),g.value>n.rounds.length&&(g.value=n.rounds.length),h.innerHTML=`Round ${n.rounds[a].roundNumber}`,a=g.value-1,B()})),p.appendChild(g);let b=document.createElement("div");b.classList.add("preview-right-div"),p.appendChild(b);let v=document.createElement("img");v.classList.add("clear-button"),v.src="../Assets/UI/DestroyBloonsBtn.webp",v.addEventListener("click",(()=>{M()})),b.appendChild(v);let L=document.createElement("img");L.classList.add("play-normal-button"),L.src="../Assets/UI/GoBtnSmall.webp",L.addEventListener("click",(()=>{G=1,h.innerHTML=`Round ${n.rounds[a].roundNumber}`,M(),V(n.rounds[a])})),b.appendChild(L);let w=document.createElement("img");w.classList.add("play-fast-button"),w.src="../Assets/UI/FastForwardBtn.webp",w.addEventListener("click",(()=>{G=3,h.innerHTML=`Round ${n.rounds[a].roundNumber}`,M(),V(n.rounds[a])})),b.appendChild(w),P=document.createElement("canvas"),P.classList.add("roundset-canvas"),P.width=800,P.height=300,u.appendChild(P);let y=document.createElement("div");y.classList.add("preview-footer-div"),u.appendChild(y);let E=document.createElement("div");E.classList.add("difficulty-div"),y.appendChild(E);let C=document.createElement("div");C.classList.add("maps-progress-view","stats-tab-yellow","black-outline"),C.innerHTML="Easy",E.appendChild(C);let f=document.createElement("div");f.classList.add("maps-progress-view","black-outline"),f.innerHTML="Medium",E.appendChild(f);let T=document.createElement("div");T.classList.add("maps-progress-view","black-outline"),T.innerHTML="Hard",E.appendChild(T),C.addEventListener("click",(()=>{_=1,C.classList.add("stats-tab-yellow"),f.classList.remove("stats-tab-yellow"),T.classList.remove("stats-tab-yellow")})),f.addEventListener("click",(()=>{_=1.1,C.classList.remove("stats-tab-yellow"),f.classList.add("stats-tab-yellow"),T.classList.remove("stats-tab-yellow")})),T.addEventListener("click",(()=>{_=1.26,C.classList.remove("stats-tab-yellow"),f.classList.remove("stats-tab-yellow"),T.classList.add("stats-tab-yellow")}));let F=document.createElement("div");F.classList.add("next-prev-div"),y.appendChild(F);let H=document.createElement("div");H.classList.add("maps-progress-view","black-outline"),H.innerHTML="Previous",H.addEventListener("click",(()=>{null!=o&&o.checked?(l--,l<0&&(l=s.length-1),a=s[l]-1):(a--,a<0&&(a=n.rounds.length-1)),g.value=a+1,M(),B()})),F.appendChild(H);let $=document.createElement("div");$.classList.add("maps-progress-view","black-outline"),$.innerHTML="Next",$.addEventListener("click",(()=>{null!=o&&o.checked?(l++,l>=s.length&&(l=0),a=s[l]-1):(a++,a>=n.rounds.length&&(a=0)),g.value=a+1,M(),B()})),F.appendChild($);let A=document.createElement("div");A.id="preview-round-info-div",A.classList.add("round-info-div"),u.appendChild(A),O=P.getContext("2d");let D=performance.now();i=!0,requestAnimationFrame((function e(){if(!i)return;const t=performance.now(),d=(t-D)/1e3;D=t,K(d),Q(),requestAnimationFrame(e)})),null!=o&&o.checked&&x(!0),B(),document.getElementById("roundset-reverse-checkbox").checked&&k()}}function x(t){switch(d){case"Simple":let d=!1;n.rounds.forEach((async(n,a)=>{let l=document.getElementById(`round-${n.roundNumber}`);t&&"modified"===e&&!n.hasOwnProperty("modified")||t&&"unused"===e&&n.roundNumber>r?l.style.display="none":(l.style.display="flex",d?l.classList.add("round-div-alt"):Array.from(l.classList).includes("round-div-alt")&&l.classList.remove("round-div-alt"),d=!d)}));break;case"Topper":n.rounds.forEach((async(d,n)=>{let a=document.getElementById(`round-${d.roundNumber}`);t&&"modified"===e&&!d.hasOwnProperty("modified")||t&&"unused"===e&&d.roundNumber>r?a.style.display="none":a.style.display="flex"}));break;case"Preview":switch(e){case"modified":t?(l=0,a=s[0]-1,document.getElementById("round-number-preview").innerHTML=`Round ${s[0]}`,document.getElementById("select-round-num-preview").value=s[0],B()):(a=0,document.getElementById("round-number-preview").innerHTML=`Round ${a+1}`,document.getElementById("select-round-num-preview").value=a+1,B());break;case"unused":t?r<a+1&&(a=0,document.getElementById("round-number-preview").innerHTML=`Round ${a+1}`,document.getElementById("select-round-num-preview").value=a+1,B()):(a=0,document.getElementById("round-number-preview").innerHTML=`Round ${a+1}`,document.getElementById("select-round-num-preview").value=a+1,B())}}}function k(){switch(d){case"Simple":n.rounds.forEach(((e,t)=>{let d=document.getElementById(`round-${e.roundNumber}-groups`);Array.from(d.children).reverse().forEach((e=>d.appendChild(e)))}));break;case"Topper":let e=document.getElementsByClassName("timeline-div");for(let t of e)t.classList.toggle("timeline-div-reverse");let t=document.getElementsByClassName("timeline-right-div");for(let e of t)e.classList.toggle("flip-horizontal");break;case"Preview":document.getElementById("preview-timeline-div").classList.toggle("timeline-div-reverse");let d=document.getElementsByClassName("preview-timeline-right-div");for(let e of d)e.classList.toggle("flip-horizontal")}M()}function B(){let e=document.getElementById("preview-round-info-div");e.innerHTML="";let t=n.rounds[a];c=[];let d=document.createElement("div");d.classList.add("round-div-detailed"),e.appendChild(d);let l=document.createElement("div");l.classList.add("rounds-div-header"),d.appendChild(l);let i=document.createElement("p");i.classList.add("round-number","round-number-detailed","black-outline"),i.innerHTML=`Round ${t.roundNumber}`,l.appendChild(i);let o=document.createElement("div");o.classList.add("income-div"),l.appendChild(o);let s=document.createElement("img");s.classList.add("income-img"),s.src="../Assets/UI/CoinIcon.webp",o.appendChild(s);let r=document.createElement("div");r.classList.add("income-text-div"),o.appendChild(r);let m=document.createElement("p");m.classList.add("round-income","black-outline"),m.innerHTML=`Income: ${t.income.toLocaleString()}`,r.appendChild(m);let u=document.createElement("p");u.classList.add("round-income-total","black-outline"),u.innerHTML=`Total: ${t.incomeSum.toLocaleString()}`,r.appendChild(u);let p=document.createElement("div");p.classList.add("rbe-div"),l.appendChild(p);let h=document.createElement("img");h.classList.add("rbe-img"),h.src="../Assets/BloonIcon/Red.webp",p.appendChild(h);let g=document.createElement("div");g.classList.add("rbe-text-div"),p.appendChild(g);let b=document.createElement("p");b.classList.add("round-rbe","black-outline"),b.innerHTML=`RBE: ${t.rbe.toLocaleString()}`,g.appendChild(b);let v=document.createElement("p");v.classList.add("round-rbe-total","black-outline"),v.innerHTML=`Total: ${t.rbeSum.toLocaleString()}`,g.appendChild(v);let L=t.bloonGroups.length?Math.max(...t.bloonGroups.map((e=>e.end))):0,w=document.createElement("p");w.classList.add("round-duration","black-outline"),w.innerHTML=`Duration: ${L.toFixed(2)}s`,l.appendChild(w);let y=document.createElement("div");y.id="preview-timeline-div",y.classList.add("timeline-div"),d.appendChild(y);t.bloonGroups.forEach(((e,t)=>{let d=document.createElement("div");d.classList.add("bloon-group-div-detailed"),d.addEventListener("click",(()=>{c.includes(t)?(d.style.filter="",c.splice(c.indexOf(t),1)):(c.push(t),d.style.filter="brightness(0.5)")})),y.appendChild(d);let n=document.createElement("div");n.classList.add("left-div"),d.appendChild(n);let a=document.createElement("img");a.classList.add("bloon-image"),a.src=`../Assets/BloonIcon/${e.bloon}.webp`,n.appendChild(a);let l=document.createElement("p");l.classList.add("bloon-count","black-outline"),l.innerHTML="x"+e.count,n.appendChild(l);let i=document.createElement("div");i.classList.add("timeline-right-div","preview-timeline-right-div"),d.appendChild(i);let o=document.createElement("div");o.classList.add("bloon-bar"),i.appendChild(o);let s=document.createElement("div");s.classList.add("bloon-bar-fill"),s.style.background=j[e.bloon.replace("Camo","").replace("Regrow","").replace("Fortified","")].color,e.bloon.includes("Rainbow")||(s.style.border=`4px solid ${j[e.bloon.replace("Camo","").replace("Regrow","").replace("Fortified","")].border}`);let r=(e.end-e.start)/L*100,m=e.start/L*100;r<5&&(r=5),m+r>100&&(m=100-r),s.style.width=`${r}%`,s.style.left=`${m}%`,o.appendChild(s)})),document.getElementById("roundset-reverse-checkbox").checked&&k()}function T(e){let t=document.getElementById("preview-timeline-div"),d=document.createElement("div");d.id="preview-playhead",d.classList.add("playhead"),t.appendChild(d),d.style.animation=`playhead ${e}s linear`,d.addEventListener("animationend",(function(){d.remove()}))}function M(){document.getElementById("preview-playhead")&&document.getElementById("preview-playhead").remove(),z=null,q.length=0}function I(){i=!1,M()}function R(e){let t=document.getElementsByClassName("loading-icon")[0].cloneNode(!0);t.classList.add("loading-icon-leaderboard"),t.style.height="unset",e.appendChild(t)}function F(e){null!=e?document.body.style.backgroundColor=`rgb(${255*e[0]},${255*e[1]},${255*e[2]})`:document.body.style.removeProperty("background-color")}function H(e){return[Math.floor(e/3600),Math.floor(e%3600/60),Math.floor(e%60)].map((e=>e<10?"0"+e:e)).join(":")}function $(e){return(e-new Date)/1e3}function A(e,t){const d=$(e),n=document.getElementById(t);if(d>172800){const e=Math.ceil(d/86400);n.textContent=`${e} days left`}else n.textContent=H(d)}function D(e,t,d,n,a){switch(e){case 1:return d*(n/a);case 2:return t*(a/n);case 3:return a*(t/d);case 4:return n*(d/t)}}function S(){document.body.scrollTop=0,document.documentElement.scrollTop=0}function N(e,t,d){if(isErrorModalOpen&&!d)return;let n=document.createElement("div");n.classList.add("error-modal-overlay"),document.body.appendChild(n);let a=document.createElement("div");a.id="error-modal",a.classList.add("error-modal"),n.appendChild(a);let l=document.createElement("div");l.id="error-modal-header",l.classList.add("error-modal-header"),a.appendChild(l);let i=document.createElement("img");i.id="error-modal-header-img",i.classList.add("error-modal-header-img"),i.src="./Assets/UI/BadConnectionBtn.webp",l.appendChild(i);let o=document.createElement("p");o.classList.add("error-modal-header-text","black-outline"),o.innerHTML="Error",l.appendChild(o);let s=document.createElement("div");s.classList.add("error-modal-dummy"),l.appendChild(s);let r=document.createElement("div");r.id="error-modal-content",r.classList.add("error-modal-content"),r.innerHTML=""+e,a.appendChild(r);let c=document.createElement("div");if(c.classList.add("error-modal-content"),"Invalid user ID / Player Does not play this game"===e)c.innerHTML="Please try again or create a new Open Access Key.",a.appendChild(c);if("ratelimit"==t){let e=document.createElement("div");e.classList.add("error-toggle-div"),a.appendChild(e);let t=document.createElement("p");t.classList.add("maps-progress-coop-toggle-text","black-outline"),t.innerHTML="Manually Load Profiles: ",e.appendChild(t);let d=document.createElement("input");d.classList.add("maps-progress-coop-toggle-input"),d.type="checkbox",d.checked=preventRateLimiting,d.addEventListener("change",(()=>{d.checked?preventRateLimiting=!0:preventRateLimiting=!1})),e.appendChild(d)}let m=document.createElement("div");m.classList.add("error-modal-ok-button-div"),a.appendChild(m);let u=document.createElement("div");u.classList.add("start-button","modal-ok-button","black-outline"),u.innerHTML="OK",u.addEventListener("click",(()=>{isErrorModalOpen=!1,document.body.removeChild(n)})),m.appendChild(u);let p=document.createElement("img");p.classList.add("error-modal-close"),p.src="./Assets/UI/CloseBtn.webp",p.addEventListener("click",(()=>{isErrorModalOpen=!1,document.body.removeChild(n)})),r.appendChild(p),isErrorModalOpen=!0}let P,O;w.id="roundset-content",w.classList.add("roundset","sub-content-div"),v.appendChild(w);let G=1,j={Red:{name:"Red",rbe:1,speed:25,layer:1,scale:.8,color:"#ED0F0F",border:"#690000"},Blue:{name:"Blue",rbe:2,speed:35,layer:2,scale:.85,color:"#2797E0",border:"#004772"},Green:{name:"Green",rbe:3,speed:45,layer:3,scale:.9,color:"#77A80F",border:"#3D5400"},Yellow:{name:"Yellow",rbe:4,speed:80,layer:4,scale:.95,color:"#FFD50F",border:"#8E620C"},Pink:{name:"Pink",rbe:5,speed:87.5,layer:5,scale:1,color:"#F15060",border:"#A92626"},Black:{name:"Black",rbe:11,speed:45,layer:6,scale:.58,color:"#161616",border:"#414141"},Purple:{name:"Purple",rbe:11,speed:75,layer:7,scale:.95,color:"#9326E0",border:"#00E4FF"},White:{name:"White",rbe:12,speed:50,layer:6,scale:.58,color:"#D7D7D7",border:"#727272"},Lead:{name:"Lead",rbe:23,speed:25,layer:7,scale:.95,color:"#7E7E7E",border:"#2F2F2F"},Zebra:{name:"Zebra",rbe:23,speed:45,layer:7,scale:.9,color:"repeating-linear-gradient(145deg, #040404, #040404 10px, #ffffff 10px, #ffffff 20px)",border:"#5A5A5A"},Rainbow:{name:"Rainbow",rbe:47,speed:55,layer:8,scale:1,color:"linear-gradient(180deg, rgba(228,26,26,1) 0%, rgba(255,159,0,1) 16%, rgba(255,224,0,1) 33%, rgba(125,181,4,1) 48%, rgba(83,176,222,1) 66%, rgba(226,74,226,1) 84%, rgba(132,21,132,1) 100%)",border:"transparent"},Ceramic:{name:"Ceramic",rbe:47,speed:62.5,layer:9,scale:1,color:"#BE6C1D",border:"#61370B"},Moab:{name:"Moab",rbe:616,speed:25,layer:10,color:"#2AC2FF",border:"#FFFFFF"},Bfb:{name:"Bfb",rbe:3164,speed:6.25,layer:11,color:"#C00505",border:"#FFFFFF"},Zomg:{name:"Zomg",rbe:16656,speed:4.5,layer:12,color:"#575757",border:"#B7F700"},Ddt:{name:"Ddt",rbe:3164,speed:66,layer:12,color:"#3C3C3C",border:"#A5A5A5"},Bad:{name:"Bad",rbe:16464,speed:4.5,layer:13,color:"#AB02AC",border:"#500151"}},U=new Image;U.src="../Assets/BloonIcon/preview_bloons_spritesheet.webp";let Z={CeramicCamo:{x:1153,y:0,width:129,height:163},CeramicFortified:{x:993,y:547,width:140,height:163},CeramicFortifiedCamo:{x:993,y:711,width:140,height:163},CeramicRegrow:{x:0,y:782,width:176,height:162},CeramicRegrowCamo:{x:177,y:782,width:176,height:162},CeramicRegrowFortified:{x:629,y:0,width:186,height:162},CeramicRegrowFortifiedCamo:{x:629,y:163,width:186,height:162},Black:{x:1283,y:790,width:78,height:97},BlackCamo:{x:1283,y:888,width:78,height:97},BlackRegrow:{x:833,y:945,width:105,height:97},BlackRegrowCamo:{x:708,y:782,width:105,height:97},Blue:{x:1283,y:148,width:110,height:139},BlueCamo:{x:1283,y:288,width:110,height:139},BlueRegrow:{x:408,y:641,width:150,height:138},BlueRegrowCamo:{x:993,y:146,width:150,height:138},Ceramic:{x:1153,y:164,width:129,height:163},LeadFortifiedCamo:{x:993,y:875,width:133,height:156},LeadRegrow:{x:816,y:326,width:168,height:154},LeadRegrowCamo:{x:816,y:481,width:168,height:154},LeadRegrowFortified:{x:629,y:326,width:178,height:154},LeadRegrowFortifiedCamo:{x:629,y:481,width:178,height:154},Green:{x:878,y:1100,width:116,height:147},GreenCamo:{x:995,y:1100,width:116,height:147},GreenRegrow:{x:468,y:474,width:159,height:145},GreenRegrowCamo:{x:629,y:636,width:159,height:145},Lead:{x:134,y:1100,width:123,height:156},LeadCamo:{x:258,y:1100,width:123,height:156},LeadFortified:{x:0,y:1100,width:133,height:156},WhiteRegrow:{x:1153,y:1132,width:105,height:97},WhiteRegrowCamo:{x:1283,y:428,width:105,height:97},Yellow:{x:382,y:1100,width:123,height:156},YellowCamo:{x:506,y:1100,width:123,height:156},YellowRegrow:{x:816,y:636,width:168,height:154},YellowRegrowCamo:{x:0,y:945,width:168,height:154},Zebra:{x:1153,y:984,width:116,height:147},ZebraCamo:{x:1283,y:0,width:116,height:147},ZebraRegrow:{x:816,y:791,width:159,height:145},ZebraRegrowCamo:{x:993,y:0,width:159,height:145},Pink:{x:1153,y:328,width:129,height:163},PinkCamo:{x:1153,y:492,width:129,height:163},PinkRegrow:{x:354,y:782,width:176,height:162},PinkRegrowCamo:{x:531,y:782,width:176,height:162},Purple:{x:630,y:1100,width:123,height:156},PurpleCamo:{x:754,y:1100,width:123,height:156},PurpleRegrow:{x:169,y:945,width:168,height:154},PurpleRegrowCamo:{x:338,y:945,width:168,height:154},Rainbow:{x:1153,y:656,width:129,height:163},RainbowCamo:{x:1153,y:820,width:129,height:163},RainbowRegrow:{x:816,y:0,width:176,height:162},RainbowRegrowCamo:{x:816,y:163,width:176,height:162},Red:{x:1283,y:526,width:103,height:131},RedCamo:{x:1283,y:658,width:103,height:131},RedRegrow:{x:993,y:285,width:143,height:130},RedRegrowCamo:{x:993,y:416,width:143,height:130},White:{x:1283,y:986,width:78,height:97},WhiteCamo:{x:1283,y:1084,width:78,height:97},Bad:{x:0,y:238,width:326,height:235},BadFortified:{x:0,y:0,width:326,height:237},Bfb:{x:234,y:474,width:233,height:164},BfbFortified:{x:0,y:474,width:233,height:166},DdtCamo:{x:0,y:641,width:203,height:140},DdtFortifiedCamo:{x:204,y:641,width:203,height:140},Moab:{x:670,y:945,width:162,height:105},MoabFortified:{x:507,y:945,width:162,height:110},Zomg:{x:327,y:0,width:301,height:194},ZomgFortified:{x:327,y:195,width:301,height:194}};class Y{constructor(e,t){this.speed=j[e.replace("Camo","").replace("Regrow","").replace("Fortified","")].speed,this.scale=j[e.replace("Camo","").replace("Regrow","").replace("Fortified","")].scale,this.x=-D(1,0,100,Z[e].width,Z[e].height),this.y=100+(100-100*this.scale)/2,this.type=e,this.groupIndex=t,this.width=D(1,0,100,Z[e].width,Z[e].height)}move(e){this.x+=this.speed*e*6.86*G*J*_}shouldDelete(){return this.x>=800}render(e){if(c.includes(this.groupIndex))return;let t=Z[this.type];e.drawImage(U,t.x,t.y,t.width,t.height,this.x,this.y,this.scale*this.width,100*this.scale)}}class W{constructor(e,t){this.speed=j[e.replace("Camo","").replace("Regrow","").replace("Fortified","")].speed,this.x=-1.62*Z[e].width,this.type=e,this.groupIndex=t}move(e){this.x+=this.speed*e*6.86*G*J*_}shouldDelete(){return this.x>=800}render(e){if(c.includes(this.groupIndex))return;let t=Z[this.type];e.drawImage(U,t.x,t.y,t.width,t.height,this.x,150-1.62*t.height/2,1.62*t.width,1.62*t.height)}}const q=[];let z,_=1,J=1;const K=e=>{const t=performance.now();q.forEach(((t,d)=>{t.move(e),t.shouldDelete()&&q.splice(d,1)})),null!=z&&z.bloonGroups.forEach((d=>{if(t>=d.startTime&&d.count>0)if(0==d.activeTime&&(d.spawnBloon(),d.count--),d.activeTime+=e,d.spawnAccumulator+=e,0===d.spawnInterval){for(let e=0;e<d.count;e++)d.spawnBloon();d.count=0,d.spawnAccumulator=0}else for(;d.spawnAccumulator>=d.spawnInterval;){const e=Math.floor(d.spawnAccumulator/d.spawnInterval);for(let t=0;t<e;t++)d.spawnBloon(),d.count--;d.spawnAccumulator-=d.spawnInterval*e}}))},Q=()=>{O.clearRect(0,0,P.width,P.height),q.forEach((e=>e.render(O)))};function V(e){if(J=ee(e.roundNumber),z=JSON.parse(JSON.stringify(e)),document.getElementById("roundset-reverse-checkbox").checked){let t=Math.max(...e.bloonGroups.map((e=>e.end)));for(let e of z.bloonGroups){let d=e.end-e.start;e.start=t-e.end,e.end=e.start+d}}T(Math.max(...z.bloonGroups.map((e=>e.end)))/G),z.bloonGroups.forEach(((e,t)=>{e.startTime=performance.now()+1e3*e.start/G,e.activeTime=0,e.spawnAccumulator=0,e.spawnInterval=(e.end-e.start)/(e.count-1)/G,isFinite(e.spawnInterval)||(e.spawnInterval=0),e.spawnBloon=X(e,t)}))}function X(e,t){return function(){let d=e.bloon,n=["Moab","MoabFortified","Bfb","BfbFortified","Zomg","ZomgFortified","DdtCamo","DdtFortifiedCamo","Bad","BadFortified"].includes(d)?new W(d,t):new Y(d,t),a=j[d.replace("Camo","").replace("Regrow","").replace("Fortified","")].layer,l=q.findIndex((e=>j[e.type.replace("Camo","").replace("Regrow","").replace("Fortified","")].layer>a));-1===l?q.push(n):q.splice(l,0,n)}}function ee(e){let t=0;return t=e<=80?1:e<=100?1+.02*(e-80):e<=150?1.6+.02*(e-101):e<=200?3+.02*(e-151):e<=250?4.5+.02*(e-201):6+.02*(e-252),t}