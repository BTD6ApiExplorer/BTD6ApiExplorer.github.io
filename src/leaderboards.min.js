let leaderboardNext,leaderboardType,oak_token="",btd6usersave={},_btd6usersave={},btd6publicprofile={},_btd6publicprofile={},racesData=null,leaderboardData=null,leaderboardLink=null,leaderboardPage=1,leaderboardPageEntryCount=null,localStorageOAK={},refreshRateLimited=!1,profileCache={},bossesData=null,CTData=null,DCData=null,challengesCache={},browserData=null,browserLink=null,browserPage=1,browserPageEntryCount=null,browserFilter="newest",cacheBust=!1,isErrorModalOpen=!1,customMapsCache={},rateLimited=!1,preventRateLimiting=!1,maxRequests=100,baseInterval=200,requestCount=0,completedRequests=0,lastResetTime=Date.now(),requestQueue=[],isProcessing=!1,leaderboardCache={},leaderboardMetadata={},leaderboardActiveToken=0,racesDataCachedAt=null,bossesDataCachedAt=null,CTDataCachedAt=null,challengesDataCachedAt=null;const TIMEOUT_TTL=6e5,isStale=e=>!e||Date.now()-e>6e5;function addRequestToQueue(e,t){requestQueue.push({id:e,request:t}),isProcessing||processRequestQueue()}function removeRequestFromQueue(e){requestQueue=requestQueue.filter((t=>t.id!==e))}function calculateDelay(){const e=requestCount/(maxRequests/2);return baseInterval+baseInterval*Math.pow(e,2)}async function processRequestQueue(){isProcessing||(isProcessing=!0,function e(){if(0===requestQueue.length)return void(isProcessing=!1);const t=Date.now();if(t-lastResetTime>=18e4&&(requestCount=0,lastResetTime=t),requestCount<maxRequests){const e=requestQueue.shift();requestCount++,e.request()}const a=calculateDelay();setTimeout(e,a)}())}async function fetchData(e,t){let a=null;try{cacheBust?(a=await fetch(e,{cache:"reload"}),cacheBust=!1,rateLimited=!1):(a=await fetch(e),rateLimited=!1)}catch(e){return navigator.onLine?(rateLimited=!0,requestQueue=[],hideLoading(),pressedStart=!1,`You have hit the rate limit. [${e}]`):(errorModal("You are currently offline. Please check your internet connection.","api"),`You are currently offline. [${e}]`)}try{let e=await a.json();return 1==e.success?t(e):"Rate limit"==e.reason?(isErrorModalOpen=!0,errorModal("You have hit the rate limit. Please try again later.","api")):(document.getElementById("loading").style.transform="scale(0)",pressedStart=!1,errorModal(e.error,"api")),e}catch(e){return errorModal(`Something went wrong with the request. Response Code: ${a.status} [${e}]`,"api"),`Something went wrong with the request. Response Code: ${a.status} [${e}]`}}async function getSaveData(e){cacheBust=!0;let t=!0,a=new Promise((async(a,n)=>{await fetchData(`https://data.ninjakiwi.com/btd6/save/${e}`,(e=>{btd6usersave=e.body,_btd6usersave=e.model,readyFlags[0]=1,t=!1,a()}))}));if(await a,t&&!rateLimited){let t=document.getElementsByClassName("error-modal-overlay");for(element of t)element.parentNode.removeChild(element);return delete localStorageOAK[e],writeLocalStorage(),void errorModal("Your Open Access Key has expired. Please make a new one and try again.","expire",!0)}await getPublicProfileData(e)}async function getPublicProfileData(e){return cacheBust=!0,new Promise(((t,a)=>{fetchData(`https://data.ninjakiwi.com/btd6/users/${e}`,(a=>{btd6publicprofile=a.body,_btd6publicprofile=a.model,localStorageOAK[e]={displayName:btd6publicprofile.displayName,avatar:getProfileAvatar(btd6publicprofile),banner:getProfileBanner(btd6publicprofile)},writeLocalStorage(),readyFlags[1]=1,t()}))}))}async function getRacesData(){null==racesData||isStale(racesDataCachedAt)?await fetchData("https://data.ninjakiwi.com/btd6/races",(e=>{racesData=e.body,racesDataCachedAt=Date.now(),generateRaces()})):generateRaces(),addToBackQueue({callback:generateEvents})}async function getRaceMetadata(e){return racesData&&racesData[e]&&"string"==typeof racesData[e].metadata?fetchData(racesData[e].metadata,(t=>(racesData[e].metadata=t.body,racesData[e]))):racesData[e]}async function getLeaderboardData(){return leaderboardLink?(leaderboardData=null,fetchData(`${leaderboardLink}?page=${leaderboardPage}`,(e=>(leaderboardData=e.body,leaderboardPageEntryCount=leaderboardData.length,document.getElementById("leaderboard-footer-page-number").innerHTML=`Page ${leaderboardPage} (#${leaderboardPage*leaderboardPageEntryCount-(leaderboardPageEntryCount-1)} - ${leaderboardPage*leaderboardPageEntryCount})`,leaderboardData)))):errorModal("Leaderboard Fetch Error: No leaderboard data found")}async function getAllLeaderboardData(e){return null==e&&(e=leaderboardLink),requestQueue=[],(null==leaderboardCache[leaderboardLink]||leaderboardCache[leaderboardLink]._cachedAt&&Date.now()-leaderboardCache[leaderboardLink]._cachedAt>6e5)&&(leaderboardCache[leaderboardLink]={entries:[],_cachedAt:Date.now()},getLeaderboardPage(e)),leaderboardCache[leaderboardLink]}async function getLeaderboardPage(e,t=leaderboardActiveToken){null!=e&&(leaderboardCache[leaderboardLink].nextRequested||(requestCount++,await fetchData(e,(a=>{t===leaderboardActiveToken&&(leaderboardCache[leaderboardLink].entries=leaderboardCache[leaderboardLink].entries.concat(a.body),leaderboardCache[leaderboardLink]._cachedAt=Date.now(),leaderboardCache[leaderboardLink].hasOwnProperty("entryPerPage")||(leaderboardCache[leaderboardLink].entryPerPage=a.body.length),addLeaderboardEntries(a.body,isNaN(e.split("=")[1])?1:parseInt(e.split("=")[1]),leaderboardCache[leaderboardLink].entryPerPage?leaderboardCache[leaderboardLink].entryPerPage:a.body.length),leaderboardCache[leaderboardLink].next=a.next,leaderboardCache[leaderboardLink].nextRequested=!1)}))))}async function getBossesData(){null==bossesData||isStale(bossesDataCachedAt)?await fetchData("https://data.ninjakiwi.com/btd6/bosses",(e=>{bossesData=e.body,bossesDataCachedAt=Date.now(),generateBosses(showElite)})):generateBosses(showElite),addToBackQueue({callback:generateEvents})}async function getBossMetadata(e,t){return bossesData&&bossesData[e]&&"string"==typeof bossesData[e][t?"metadataElite":"metadataStandard"]?fetchData(bossesData[e][t?"metadataElite":"metadataStandard"],(a=>(bossesData[e][t?"metadataElite":"metadataStandard"]=a.body,bossesData[e]))):bossesData[e]}async function getCTData(){null==CTData||isStale(CTDataCachedAt)?await fetchData("https://data.ninjakiwi.com/btd6/ct",(e=>{CTData=e.body,CTDataCachedAt=Date.now(),generateCTs()})):generateCTs(),addToBackQueue({callback:generateEvents})}async function getCTTiles(e){let t=null;return await fetchData(e,(e=>(t=e.body,t))),t}async function getDailyChallengesData(){if(null!=DCData&&!isStale(challengesDataCachedAt))return addToBackQueue({callback:generateEvents}),DCData;await fetchData("https://data.ninjakiwi.com/btd6/challenges/filter/daily",(e=>(DCData=e.body,addToBackQueue({callback:generateEvents}),challengesDataCachedAt=Date.now(),DCData)))}async function getChallengeMetadata(e){return(null==challengesCache[e]||isStale(challengesCache[e]._cachedAt))&&await fetchData(`https://data.ninjakiwi.com/btd6/challenges/challenge/${e}`,(t=>(challengesCache[e]=t.body,challengesCache[e]._cachedAt=Date.now(),challengesCache[e]))),challengesCache[e]}async function getBrowserData(){return browserLink?(browserData=null,fetchData(`${browserLink}${browserFilter}?page=${browserPage}`,(e=>(browserData=e.body,browserPageEntryCount=browserData.length,document.getElementById("browser-footer-page-number").innerHTML=`Page ${browserPage} of 4`,leaderboardData)))):errorModal("Content Browser Fetch Error: No data found")}async function getUserProfile(e){let t=e.split("/").pop();return null==profileCache[t]&&await fetchData(e,(e=>{profileCache[t]={...e.body,_cachedAt:Date.now()}})),profileCache[t]}async function getCustomMapMetadata(e){return null==customMapsCache[e]&&await fetchData(`https://data.ninjakiwi.com/btd6/maps/map/${e}`,(t=>(customMapsCache[e]=t.body,customMapsCache[e]))),customMapsCache[e]}function readLocalStorage(){null!=localStorage.getItem("BTD6OAKStorage")&&(localStorageOAK=JSON.parse(localStorage.getItem("BTD6OAKStorage")))}function writeLocalStorage(){localStorage.setItem("BTD6OAKStorage",JSON.stringify(localStorageOAK))}function challengeIdToDate(e){e.substring(0,3),parseInt(e.substring(3,7));let t=e.substring(7);return[parseInt(t.substring(0,4)),parseInt(t.substring(4,6)),parseInt(t.substring(6,8))]}function getChallengeIdFromInt(e,t){let a=new Date(2024,4,25),n=(t?2101:2114)-parseInt(e);return a.setDate(a.getDate()-n),(t?"adv":"rot")+e+a.toISOString().substring(0,10).replace(/-/g,"")}function getChallengeIDFromDate(e,t){let a=new Date(e),n=new Date(2024,4,25).getTime()-a.getTime();return(t?"adv":"rot")+((t?2101:2114)-Math.floor(n/864e5))+e.replace(/-/g,"")}function clearProfileRequestQueue(){requestQueue=[],isProcessing=!1}processRequestQueue();const achievementNameFixMap={Clicker:"Bloons Master","Superior Clicker":"Superior Bloons Master","Ultimate Clicker":"Ultimate Bloons Master","Knowledgable Primate":"Knowledgeable Primate","Triple Threat":"Triple threat","Small Bloons":"Alchermistman and Bloonacleboy","Master of Life":"Master of life","What did it cost":"What did it cost? - Everything","2 Mega Pops":"2 MegaPops","Looking fab":"Lookin fab",GoldenTicket:"Golden Ticket","Axis of Havok":"Axis of Havoc","Co-op Popper!":"Co-op Popper",CouponCrazy:"Coupon Crazy",LimitedRun:"Limited Run",ALaCode:"A La Code",InstantGratification:"Instant Gratification","Achievement Of Achievements":"Achievement of Achievements","What is this new Bloonery":"What is this new Bloonery?","Who's the Boss":"Who's the Boss?","I'llBeBack":"I'll Be Back",SoSpiiiceyNinjaKiwi:"So Spiiicey Ninja Kiwi",DavidsVsGoliath:"Davids vs Goliath",ToolsToDarwin:"Tools to Darwin",BigSpender:"Big Spender",NotLackingCriticalInformation:"Not Lacking Critical Information",StubbornStrategy:"Stubborn Strategy","Hook Line And Sinker":"Hook, Line, and Sinker",CrashOfTheTitans:"Crash of the Titans","So Shiny":"So Shiny!","Ultimate Team Up":"Ultimate Team-up",StudentLoans:"Student Loans",StickySituation:"Sticky Situation",NoHarvest:"No Harvest",ReadyPlayerOne:"Ready Player One?",TheDailyReid:"The Daily Reid",InstaCentury:"Insta Century"},reverseAchievementNameFixMap=Object.entries(achievementNameFixMap).reduce(((e,[t,a])=>(e[a]=t,e)),{}),skinNameFixMap={ObynOceanGuardian:"OceanObyn",MoltenObyn:"MountainObyn",JoanOfArcAdora:"JoanOfArc",CyberQuincy:"QuincyCyber",ETnEtienne:"ETn",SentaiCaptainChurchill:"SentaiChurchill",SleighCaptainChurchill:"SleighChurchill",TinkerfairyRosalia:"RosaliaTinkerfairy"},upgradeNameFixMap={Spikeopult:"Spike-o-pult",BuccaneerLongRange:"LongRange",BuccaneerGrapeShot:"GrapeShot",BuccaneerCrowsNest:"CrowsNest",BuccaneerHotShot:"HotShot",BuccaneerCarrierFlagship:"CarrierFlagship",BuccaneerCannonShip:"CannonShip",BuccaneerMerchantman:"Merchantman",BuccaneerFavoredTrades:"FavoredTrades",BuccaneerAircraftCarrier:"AircraftCarrier",BuccaneerDestroyer:"Destroyer",BuccaneerTradeEmpire:"TradeEmpire",BuccaneerPirateLord:"PirateLord",BuccaneerMonkeyPirates:"MonkeyPirates",HeattippedDarts:"HeatTippedDart",BioncBoomerang:"BionicBoomerang",LargeCalibre:"LongCalibre",LaserBlasts:"LaserBlast",GuidedMagic:"GuildedMagic",MortarRapidReload:"RapidReload",SupplyDrop:"CashDrop",PlasmaBlasts:"PlasmaBlast",XXXLTrap:"XXXL",OversizeNails:"OversizedNails",CenteredPath:"FlightOrders",Shockwave:"ShellShock",Monkeyopolis:"Metropolis",Spectre:"Specter",TrueSunGod:"TrueSonGod",HydraRocketPods:"HydraRockets",DartMonkeyParagon:"ApexPlasmaMaster",BoomerangMonkeyParagon:"GlaiveDominus",NinjaMonkeyParagon:"AscendedShadow",EngineerMonkeyParagon:"MasterBuilder",WizardMonkeyParagon:"MagusPerfectus",MonkeyAceParagon:"GoliathDoomship",MonkeyBuccaneerParagon:"NavarchOfTheSeas",MonkeySubParagon:"NauticSiegeCore",SmartSpikes:"DirectedSpikes",TackShooterParagon:"CycloneOfFireAndMetal"};let locJSONOverrides={"Directed Spikes":"Smart Spikes","Directed Spikes Description":"Smart Spikes Description",CircusGwendolinSkinName:"HarlegwenGwendolinSkinName",CircusGwendolinSkinDescription:"HarlegwenGwendolinSkinDescription",OctoJonesSkinName:"OctoJonesStrikerJonesSkinName",OctoJonesSkinDescription:"OctoJonesStrikerJonesSkinDescription",MoltenObynSkinName:"ObynMountainGuardianSkinName",MoltenObynSkinDescription:"ObynMountainGuardianSkinDescription",SushiBentoSkinName:"SushiBentoBenjaminSkinName",SushiBentoSkinDescription:"SushiBentoBenjaminSkinDescription",KaijuPatSkinName:"KaijuPatFustySkinName",KaijuPatSkinDescription:"KaijuPatFustySkinDescription",GalaxiliSkinName:"GalaxiliEziliSkinName",GalaxiliSkinDescription:"GalaxiliEziliSkinDescription",VoidoraSkinName:"VoidoraAdoraSkinName",VoidoraSkinDescription:"VoidoraAdoraSkinDescription",VikingSaudaSkinName:"VikingSaudaSaudaSkinName",VikingSaudaSkinDescription:"VikingSaudaSaudaSkinDescription",JiangshiSaudaSkinName:"JiangshiSaudaSaudaSkinName",JiangshiSaudaSkinDescription:"JiangshiSaudaSaudaSkinDescription",DreadPirateBrickellSkinName:"DreadPirateBrickellAdmiralBrickellSkinName",DreadPirateBrickellSkinDescription:"DreadPirateBrickellAdmiralBrickellSkinDescription",LifeguardBrickellSkinName:"LifeguardBrickellAdmiralBrickellSkinName",LifeguardBrickellSkinDescription:"LifeguardBrickellAdmiralBrickellSkinDescription",PsimbalsSkinName:"PsimbalsPsiSkinName",PsimbalsSkinDescription:"PsimbalsPsiSkinDescription",GeraldoGentlemanGadgeteerSkinName:"GentlemonkeyGadgeteerGeraldoSkinName",GeraldoGentlemanGadgeteerSkinDescription:"GentlemonkeyGadgeteerGeraldoSkinDescription","Mode Easy":"Easy","Mode Medium":"Medium","Mode Hard":"Hard","Mode Impoppable":"Impoppable","Mode Sandbox":"Sandbox",RosaliaTinkerfairySkinName:"TinkerfairyRosaliaSkinName",RosaliaTinkerfairySkinDescription:"TinkerfairyRosaliaSkinDescription"},medalMap={Easy:"Bronze",PrimaryOnly:"Bronze01",Deflation:"Bronze02",Medium:"Silver",MilitaryOnly:"Silver01",Apopalypse:"Silver03",Reverse:"Silver02",Hard:"Gold",MagicOnly:"Gold01",DoubleMoabHealth:"Gold03",HalfCash:"Gold04",AlternateBloonsRounds:"Gold02",Impoppable:"Impoppable",Clicks:"ImpoppableRuby","CHIMPS-BLACK":"ImpoppableHematite"},saveSkintoSkinMap={"Scientist Gwendolin":"ScientistGwendolin","Biker Bones":"BikerBones","Sentai Captain Churchill":"SentaiCaptainChurchill","Cyber Quincy":"Cyber Quincy","Octo Jones":"OctoJones","Sleigh Captain Churchill":"SleighCaptainChurchill","Wolfpack Quincy":"WolfpackQuincy",ScientistGwendolin:"Scientist Gwendolin",BikerBones:"Biker Bones",SentaiCaptainChurchill:"Sentai Captain Churchill",CyberQuincy:"Cyber Quincy",OctoJones:"Octo Jones",SleighCaptainChurchill:"Sleigh Captain Churchill",WolfpackQuincy:"Wolfpack Quincy"},knownProblematicMaps=["ZMYVERW","ZMYUWTV","ZMYUDTK","ZMYVPGA","ZMYVPFH","ZMYWHPC"];function getTowerAssetPath(e,t){return"WizardMonkey"==e?`Assets/TowerIcon/${t}-Wizard.webp`:`Assets/TowerIcon/${t}-${e}.webp`}function getInstaContainerIcon(e,t){return"WizardMonkey"==e?`Assets/UI/InstaContainer/${t}-Wizard.webp`:`Assets/UI/InstaContainer/${t}-${e}.webp`}function getInstaMonkeyIcon(e,t){let a=Math.max(t[0],t[1],t[2]);switch(Math.max(t[0],t[1],t[2])){case parseInt(t[0]):a=`${a}00`;break;case parseInt(t[1]):a=`0${a}0`;break;case parseInt(t[2]):a=`00${a}`}return"WizardMonkey"==e?`Assets/InstaMonkeyIcon/${a}-WizardInsta.webp`:`Assets/InstaMonkeyIcon/${a}-${e}Insta.webp`}function getUpgradeAssetPath(e){return e=e.replace(/[^a-zA-Z0-9]/g,""),upgradeNameFixMap[e]?`Assets/UpgradeIcon/${upgradeNameFixMap[e]}UpgradeIcon.webp`:`Assets/UpgradeIcon/${e}UpgradeIcon.webp`}function getKnowledgeAssetPath(e){return"SubAdmiral"==e?"Assets/KnowledgeIcon/NavalUpgradesIcon.webp":`Assets/KnowledgeIcon/${e}Icon.webp`}function getHeroPortrait(e,t){return 1==t?`Assets/Portrait/${e}Portrait.webp`:`Assets/Portrait/${e}PortraitLvl${t}.webp`}function getHeroSquareIcon(e){return`Assets/HeroIconSquare/HeroIcon${e=skinNameFixMap[e]||e}.webp`}function getHeroIconCircle(e){return`Assets/HeroIconCircle/HeroIcon${e=skinNameFixMap[e]||e}.webp`}function getSkinAssetPath(e,t){return e=skinNameFixMap[e]||e,1==t?`Assets/Portrait/${e}Portrait.webp`:`Assets/Portrait/${e}PortraitLvl${t}.webp`}function getMapIcon(e){return"#ouch"==e?"Assets/MapIcon/MapSelectouchButton.webp":`Assets/MapIcon/MapSelect${e}Button.webp`}function getPowerIcon(e){return`Assets/PowerIcon/${e}Icon.webp`}function getAchievementIcon(e,t){return t?"Assets/AchievementIcon/HiddenIcon.webp":`Assets/AchievementIcon/${e}Icon.webp`}function fixAchievementName(e){return achievementNameFixMap[e]||e}function getMedalIcon(e){return`Assets/MedalIcon/${e}.webp`}function getModeIcon(e){return`Assets/ModeIcon/${e}Btn.webp`}function getRewardIcon(e){switch(e.type){case"MonkeyMoney":return"Assets/UI/BloonjaminsIcon.webp";case"Power":return getPowerIcon(e.power);case"InstaMonkey":return getInstaMonkeyIcon(e.tower,e.tiers);case"KnowledgePoints":return"Assets/UI/KnowledgeIcon.webp";case"RandomInstaMonkey":return`Assets/UI/InstaRandomTier${0==e.tier?1:e.tier}.webp`;case"Trophy":return"Assets/UI/TrophyIcon.webp";default:return`Assets/UI/${e.value}Icon.webp`}}function getProfileIcon(e){return`Assets/ProfileAvatar/${e}.webp`}function getProfileAvatar(e){if(0==e.avatar)return"Assets/ProfileAvatar/ProfileAvatar01.webp";let t=parseInt(e.avatar.replace(/\D/g,""));return""==e.avatar||isNaN(t)?"Assets/ProfileAvatar/ProfileAvatar01.webp":t<=constants.profileAvatars?`Assets/ProfileAvatar/${e.avatar}.webp`:e.avatarURL}function getProfileBanner(e){if(0==e.banner)return"Assets/ProfileBanner/TeamsBannerDeafult.webp";let t=parseInt(e.banner.replace(/\D/g,""));return""==e.banner||isNaN(t)?"Assets/ProfileBanner/TeamsBannerDeafult.webp":t<=constants.profileBanners?`Assets/ProfileBanner/${e.banner}.webp`:e.bannerURL}function getCustomMapIcon(e){return knownProblematicMaps.includes(e)?`Assets/CustomMapIcon/${e}.webp`:`https://data.ninjakiwi.com/btd6/maps/map/${e}/preview`}function getLocValue(e){return locJSONOverrides[e]?locJSON[locJSONOverrides[e]]:locJSON[e]?locJSON[e]:e}function getCollectionEventSkinIcon(e){switch(e){case"totem":return"CollectingEventTotemBtn";case"fireworks":return"CollectingEventFireworksBtn";case"halloween":return"CollectingEventHalloweenBtn"}}function generateCheckbox(e,t,a){let n=document.createElement("div");n.classList.add("checkbox-div");let l=document.createElement("p");l.classList.add("checkbox-label","black-outline"),l.innerHTML=e,n.appendChild(l);let r=document.createElement("input");return r.classList.add("checkbox-input"),r.type="checkbox",r.checked=t,a&&r.addEventListener("change",(()=>{a(r.checked)})),n.appendChild(r),n}function generateDropdown(e,t,a,n){let l=document.createElement("div");l.classList.add("d-flex","ai-center");let r=document.createElement("p");r.classList.add("dropdown-label","black-outline"),r.innerHTML=e,l.appendChild(r);let s=document.createElement("select");return s.classList.add("dropdown-select"),t.forEach((e=>{let t=document.createElement("option");t.value=e,t.innerHTML=e,s.appendChild(t)})),l.appendChild(s),s.value=a,s.addEventListener("change",(()=>{n(s.value)})),l.appendChild(s),l}function generateToggle(e=!1,t){let a=document.createElement("label");a.classList.add("setting-input-label","switch");let n=document.createElement("input");n.classList.add("setting-input"),n.type="checkbox",n.checked=e,a.appendChild(n);let l=document.createElement("span");return l.classList.add("toggle-img","slider"),a.appendChild(l),n.addEventListener("change",(()=>{t&&t(n.checked)})),a}function generateButton(e,t,a){let n=document.createElement("button");return n.classList.add("where-button","black-outline"),n.style.width=t,n.innerHTML=e,n.addEventListener("click",a),n}function generateNumberInput(e,t,a,n,l,r){let s=document.createElement("div");s.classList.add("d-flex","ai-center","jc-between"),s.style.gap="10px",s.style.flexWrap="wrap";let o=document.createElement("p");o.classList.add("black-outline"),o.style.fontSize="24px",o.innerHTML=e,s.appendChild(o);let d=document.createElement("input");return d.classList.add("font-gardenia","ta-center"),d.value=t,d.min=a,d.max=n,d.step=l,d.style.width="80px",d.style.height="30px",d.style.color="white",d.style.fontSize="24px",d.style.backgroundColor="var(--profile-tertiary)",d.addEventListener("change",(()=>{let e=parseFloat(d.value);isNaN(e)||(e<a&&(e=a),e>n&&(e=n),d.value=e,r(e))})),s.appendChild(d),s}function generateSelectorTab(e,t=!1){const a=document.createElement("div");return a.classList.add("maps-progress-view","black-outline"),t&&a.classList.add("stats-tab-yellow"),a.textContent=e,a}async function openProfile(e,t,a){if(null==(t=await getUserProfile(t)))return;resetScroll(),document.getElementById(`${e}-content`).style.display="none",addToBackQueue({source:e,destination:"publicprofile",callback:a});let n=document.getElementById("publicprofile-content");n.style.display="flex",n.innerHTML="";let l=document.createElement("div");l.classList.add("publicprofile-div"),n.appendChild(l);let r=document.createElement("img");r.classList.add("error-modal-close"),r.src="./Assets/UI/CloseBtn.webp",r.addEventListener("click",(()=>{goBack()})),l.appendChild(r);let s=document.createElement("div");s.classList.add("profile-header","profile-banner"),s.style.backgroundImage=`linear-gradient(to bottom, transparent 50%, var(--profile-primary) 70%),url('${getProfileBanner(t)}')`,l.appendChild(s),s.appendChild(generateAvatar(100,getProfileAvatar(t)));let o=document.createElement("div");o.classList.add("profile-top-bottom"),s.appendChild(o);let d=document.createElement("div");d.classList.add("profile-top-public"),o.appendChild(d);let i=document.createElement("p");i.classList.add("profile-name","black-outline"),i.innerHTML=t.displayName,d.appendChild(i);let c=document.createElement("div");c.classList.add("rank-star-public"),d.appendChild(c);let p=document.createElement("img");p.classList.add("rank-img"),p.src="../Assets/UI/LvlHolder.webp",c.appendChild(p);let m=document.createElement("p");if(m.classList.add("rank-text","black-outline"),m.innerHTML=t.rank,c.appendChild(m),t.veteranRank>0){let e=document.createElement("div");e.classList.add("rank-star-public"),d.appendChild(e);let a=document.createElement("img");a.classList.add("rank-img"),a.src="../Assets/UI/LvlHolderVeteran.webp",e.appendChild(a);let n=document.createElement("p");n.classList.add("rank-text","black-outline"),n.innerHTML=t.veteranRank,e.appendChild(n)}let u=document.createElement("div");u.classList.add("profile-followers"),d.appendChild(u);let h=document.createElement("p");h.classList.add("followers-label","black-outline"),h.innerHTML="Followers",u.appendChild(h);let b=document.createElement("p");b.classList.add("followers-count"),b.innerHTML=t.followers.toLocaleString(),u.appendChild(b);let g=document.createElement("div");g.classList.add("below-profile-header"),l.appendChild(g);let L=document.createElement("div");L.classList.add("left-column-div"),g.appendChild(L);let y=document.createElement("div");y.classList.add("left-column-header"),L.appendChild(y);let C=document.createElement("p");C.classList.add("column-header-text","black-outline"),C.innerHTML="Medals",y.appendChild(C);let v={},k={};for(let[e,a]of Object.entries(medalMap))v["Medal"+a]=t._medalsSinglePlayer[e]||0,k["MedalCoop"+a]=t._medalsMultiplayer[e]||0;v={...v,...k},v.BlastapopoulosEliteBadge=t.bossBadgesElite.Blastapopoulos||0,v.BlastapopoulosBadge=t.bossBadgesNormal.Blastapopoulos||0,v.PhayzeEliteBadge=t.bossBadgesElite.Phayze||0,v.PhayzeBadge=t.bossBadgesNormal.Phayze||0,v.DreadbloonEliteBadge=t.bossBadgesElite.Dreadbloon||0,v.DreadbloonBadge=t.bossBadgesNormal.Dreadbloon||0,v.VortexEliteBadge=t.bossBadgesElite.Vortex||0,v.VortexBadge=t.bossBadgesNormal.Vortex||0,v.LychEliteBadge=t.bossBadgesElite.Lych||0,v.LychBadge=t.bossBadgesNormal.Lych||0,v.BloonariusEliteBadge=t.bossBadgesElite.Bloonarius||0,v.BloonariusBadge=t.bossBadgesNormal.Bloonarius||0,v.MedalEventBronzeMedal=t._medalsRace.Bronze||0,v.MedalEventSilverMedal=t._medalsRace.Silver||0,v.MedalEventDoubleSilverMedal=t._medalsRace.DoubleSilver||0,v.MedalEventGoldSilverMedal=t._medalsRace.GoldSilver||0,v.MedalEventDoubleGoldMedal=t._medalsRace.DoubleGold||0,v.MedalEventGoldDiamondMedal=t._medalsRace.GoldDiamond||0,v.MedalEventBlueDiamondMedal=t._medalsRace.BlueDiamond||0,v.MedalEventRedDiamondMedal=t._medalsRace.RedDiamond||0,v.MedalEventBlackDiamondMedal=t._medalsRace.BlackDiamond||0,v.OdysseyStarIcon=t.gameplay.totalOdysseyStars||0,v.BossMedalEventBronzeMedal=t._medalsBoss.Bronze||0,v.BossMedalEventSilverMedal=t._medalsBoss.Silver||0,v.BossMedalEventDoubleSilverMedal=t._medalsBoss.DoubleSilver||0,v.BossMedalEventGoldSilverMedal=t._medalsBoss.GoldSilver||0,v.BossMedalEventDoubleGoldMedal=t._medalsBoss.DoubleGold||0,v.BossMedalEventGoldDiamondMedal=t._medalsBoss.GoldDiamond||0,v.BossMedalEventBlueDiamondMedal=t._medalsBoss.BlueDiamond||0,v.BossMedalEventRedDiamondMedal=t._medalsBoss.RedDiamond||0,v.BossMedalEventBlackDiamondMedal=t._medalsBoss.BlackDiamond||0,v.EliteBossMedalEventBronzeMedal=t._medalsBossElite.Bronze||0,v.EliteBossMedalEventSilverMedal=t._medalsBossElite.Silver||0,v.EliteBossMedalEventDoubleSilverMedal=t._medalsBossElite.DoubleSilver||0,v.EliteBossMedalEventGoldSilverMedal=t._medalsBossElite.GoldSilver||0,v.EliteBossMedalEventDoubleGoldMedal=t._medalsBossElite.DoubleGold||0,v.EliteBossMedalEventGoldDiamondMedal=t._medalsBossElite.GoldDiamond||0,v.EliteBossMedalEventBlueDiamondMedal=t._medalsBossElite.BlueDiamond||0,v.EliteBossMedalEventRedDiamondMedal=t._medalsBossElite.RedDiamond||0,v.EliteBossMedalEventBlackDiamondMedal=t._medalsBossElite.BlackDiamond||0,v.CtLocalPlayerBronzeMedal=t._medalsCTLocal.Bronze||0,v.CtLocalPlayerSilverMedal=t._medalsCTLocal.Silver||0,v.CtLocalPlayerDoubleGoldMedal=t._medalsCTLocal.DoubleGold||0,v.CtLocalPlayerGoldDiamondMedal=t._medalsCTLocal.GoldDiamond||0,v.CtLocalPlayerBlueDiamondMedal=t._medalsCTLocal.BlueDiamond||0,v.CtLocalPlayerRedDiamondMedal=t._medalsCTLocal.RedDiamond||0,v.CtLocalPlayerBlackDiamondMedal=t._medalsCTLocal.BlackDiamond||0,v.CtGlobalPlayerBronzeMedal=t._medalsCTGlobal.Bronze||0,v.CtGlobalPlayerSilverMedal=t._medalsCTGlobal.Silver||0,v.CtGlobalPlayerDoubleSilverMedal=t._medalsCTGlobal.DoubleSilver||0,v.CtGlobalPlayerGoldSilverMedal=t._medalsCTGlobal.GoldSilver||0,v.CtGlobalPlayerDoubleGoldMedal=t._medalsCTGlobal.DoubleGold||0,v.CtGlobalPlayerGoldDiamondMedal=t._medalsCTGlobal.GoldDiamond||0,v.CtGlobalPlayerDiamondMedal=t._medalsCTGlobal.Diamond||0;let f=document.createElement("div");f.classList.add("currency-medals-div"),L.appendChild(f);let E=document.createElement("div");E.classList.add("medals-div"),f.appendChild(E);for(let[e,t]of Object.entries(v)){if(0===t)continue;let a=document.createElement("div");a.classList.add("medal-div"),a.title=constants.medalLabels[e],E.appendChild(a);let n=document.createElement("img");n.classList.add("medal-img"),n.src=getMedalIcon(e),n.style.display="none",n.addEventListener("load",(()=>{n.width<n.height?n.style.width=`${ratioCalc(3,70,256,0,n.width)}px`:n.style.height=`${ratioCalc(3,70,256,0,n.height)}px`,n.style.removeProperty("display")})),a.appendChild(n);let l=document.createElement("p");l.classList.add("medal-text","black-outline"),l.innerHTML=t.toLocaleString(),a.appendChild(l),tippy(a,{content:constants.medalLabels[e],placement:"top",theme:"speech_bubble"})}let w=document.createElement("div");w.classList.add("top-heroes-monkeys-div"),L.appendChild(w);let T=document.createElement("div");T.classList.add("top-heroes-div"),w.appendChild(T);let S=document.createElement("div");S.classList.add("top-heroes-top-div"),T.appendChild(S);let M=document.createElement("div");M.classList.add("top-heroes-top-ribbon-div"),S.appendChild(M);let D=document.createElement("p");D.classList.add("top-heroes-text","black-outline"),D.innerHTML="Top Heroes",M.appendChild(D);let B=document.createElement("div");B.classList.add("maps-progress-coop-toggle"),S.appendChild(B);let P=document.createElement("p");P.classList.add("maps-progress-coop-toggle-text","black-outline"),P.innerHTML="Show All: ",B.appendChild(P);let I=document.createElement("input");I.classList.add("maps-progress-coop-toggle-input"),I.type="checkbox",B.appendChild(I);let A=document.createElement("div");A.classList.add("top-heroes-list"),T.appendChild(A);let x=document.createElement("div");x.classList.add("top-3-heroes-div"),A.appendChild(x);let H=document.createElement("div");H.classList.add("other-heroes-div"),H.style.display="none",A.appendChild(H),I.addEventListener("change",(()=>{I.checked?H.style.display="flex":H.style.display="none"}));let O=0,N=Object.keys(constants.heroesInOrder);for(let[e,a]of Object.entries(t.heroesPlaced).sort(((e,t)=>t[1]-e[1]))){if(0===a)continue;if(!N.includes(e))continue;let t=document.createElement("div");t.classList.add("hero-div"),O<3?x.appendChild(t):H.appendChild(t);let n=document.createElement("img");n.classList.add("hero-img"),n.src=getHeroPortrait(e,1),n.style.display="none",n.addEventListener("load",(()=>{n.width<n.height?n.style.width=`${ratioCalc(3,150,1920,0,n.width)}px`:n.style.height=`${ratioCalc(3,150,1920,0,n.height)}px`,n.style.removeProperty("display")})),t.appendChild(n);let l=document.createElement("p");l.classList.add("hero-text","black-outline"),l.innerHTML=a.toLocaleString(),t.appendChild(l),O++,tippy(t,{content:`${getLocValue(e)} Placed ${a.toLocaleString()} Times`,placement:"top",theme:"speech_bubble"})}let R=document.createElement("div");R.classList.add("top-heroes-div"),w.appendChild(R);let $=document.createElement("div");$.classList.add("top-heroes-top-div"),R.appendChild($);let G=document.createElement("div");G.classList.add("top-heroes-top-ribbon-div"),$.appendChild(G);let U=document.createElement("p");U.classList.add("top-heroes-text","black-outline"),U.innerHTML="Top Towers",G.appendChild(U);let _=document.createElement("div");_.classList.add("maps-progress-coop-toggle"),$.appendChild(_);let j=document.createElement("p");j.classList.add("maps-progress-coop-toggle-text","black-outline"),j.innerHTML="Show All: ",_.appendChild(j);let K=document.createElement("input");K.classList.add("maps-progress-coop-toggle-input"),K.type="checkbox",_.appendChild(K);let F=document.createElement("div");F.classList.add("top-heroes-list"),R.appendChild(F);let Q=document.createElement("div");Q.classList.add("top-3-heroes-div"),F.appendChild(Q);let q=document.createElement("div");q.classList.add("other-heroes-div"),q.style.display="none",F.appendChild(q),K.addEventListener("change",(()=>{K.checked?q.style.display="flex":q.style.display="none"})),O=0;let z=Object.keys(constants.towersInOrder);for(let[e,a]of Object.entries(t.towersPlaced).sort(((e,t)=>t[1]-e[1]))){if(0===a)continue;if(!z.includes(e))continue;let t=document.createElement("div");t.classList.add("hero-div"),O<3?Q.appendChild(t):q.appendChild(t);let n=document.createElement("img");n.classList.add("hero-img"),n.src=getInstaContainerIcon(e,"000"),t.appendChild(n);let l=document.createElement("p");l.classList.add("hero-text","black-outline"),l.innerHTML=a.toLocaleString(),t.appendChild(l),O++,tippy(t,{content:`${getLocValue(e)} Placed ${a.toLocaleString()} Times`,placement:"top",theme:"speech_bubble"})}let J=document.createElement("div");J.classList.add("top-heroes-div"),Object.entries(t.stats.paragonsPurchasedByName).length>0&&w.appendChild(J);let W=document.createElement("div");W.classList.add("top-heroes-top-div"),J.appendChild(W);let V=document.createElement("div");V.classList.add("top-heroes-top-ribbon-div"),V.style.filter="hue-rotate(250deg)",W.appendChild(V);let Y=document.createElement("p");Y.classList.add("top-heroes-text","black-outline"),Y.innerHTML="Top Paragons",V.appendChild(Y);let Z=document.createElement("div");Z.classList.add("maps-progress-coop-toggle"),W.appendChild(Z);let X=document.createElement("p");X.classList.add("maps-progress-coop-toggle-text","black-outline"),X.innerHTML="Show All: ",Z.appendChild(X);let ee=document.createElement("input");ee.classList.add("maps-progress-coop-toggle-input"),ee.type="checkbox",Z.appendChild(ee);let te=document.createElement("div");te.classList.add("top-heroes-list"),J.appendChild(te);let ae=document.createElement("div");ae.classList.add("top-3-heroes-div"),te.appendChild(ae);let ne=document.createElement("div");ne.classList.add("other-heroes-div"),ne.style.display="none",te.appendChild(ne),ee.addEventListener("change",(()=>{ee.checked?ne.style.display="flex":ne.style.display="none"})),O=0;for(let[e,a]of Object.entries(t.stats.paragonsPurchasedByName).sort(((e,t)=>t[1]-e[1]))){if(0===a)continue;if(!constants.paragonsAvailable.includes(e))continue;let t=document.createElement("div");t.classList.add("hero-div"),t.style.backgroundImage="url(../Assets/UI/ParagonContainer.webp)",O<3?ae.appendChild(t):ne.appendChild(t);let n=document.createElement("img");n.classList.add("hero-img"),n.src=getTowerAssetPath(e,"Paragon"),t.appendChild(n);let l=document.createElement("p");l.classList.add("hero-text","black-outline"),l.innerHTML=a.toLocaleString(),t.appendChild(l),O++,tippy(t,{content:`${getLocValue(e+" Paragon")} Placed ${a.toLocaleString()} Times`,placement:"top",theme:"speech_bubble"})}let le=document.createElement("div");le.classList.add("right-column-div"),g.appendChild(le);let re=document.createElement("div");re.classList.add("overview-right-column-header"),le.appendChild(re);let se=document.createElement("p");se.classList.add("column-header-text","black-outline"),se.innerHTML="Overall Stats",re.appendChild(se);let oe={};oe["Games Played"]=t.gameplay.gameCount,oe["Games Won"]=t.gameplay.gamesWon,oe["Highest Round (All Time)"]=t.gameplay.highestRound,oe["Highest Round (CHIMPS)"]=t.gameplay.highestRoundCHIMPS,oe["Highest Round (Deflation)"]=t.gameplay.highestRoundDeflation,oe["Monkeys Placed"]=t.gameplay.monkeysPlaced,oe["Total Pop Count"]=t.bloonsPopped.bloonsPopped,oe["Total Co-Op Pop Count"]=t.bloonsPopped.coopBloonsPopped,oe["Camo Bloons Popped"]=t.bloonsPopped.camosPopped,oe["Lead Bloons Popped"]=t.bloonsPopped.leadsPopped,oe["Purple Bloons Popped"]=t.bloonsPopped.purplesPopped,oe["Regrow Bloons Popped"]=t.bloonsPopped.regrowsPopped,oe["Ceramic Bloons Popped"]=t.bloonsPopped.ceramicsPopped,oe["MOABs Popped"]=t.bloonsPopped.moabsPopped,oe["BFBs Popped"]=t.bloonsPopped.bfbsPopped,oe["ZOMGs Popped"]=t.bloonsPopped.zomgsPopped,oe["DDTs Popped"]=t.bloonsPopped.ddtsPopped,oe["BADs Popped"]=t.bloonsPopped.badsPopped,oe["Bloons Leaked"]=t.bloonsPopped.bloonsLeaked,oe["Cash Generated"]=t.gameplay.cashEarned,oe["Cash Gifted"]=t.gameplay.coopCashGiven,oe["Abilities Used"]=t.gameplay.abilitiesUsed,oe["Powers Used"]=t.gameplay.powersUsed,oe["Insta Monkeys Used"]=t.gameplay.instaMonkeysUsed,oe["Daily Reward Chests Opened"]=t.gameplay.dailyRewards,oe["Challenges Completed"]=t.gameplay.challengesCompleted,oe.Achievements=`${t.achievements}/${constants.achievements+constants.hiddenAchievements}`,oe["Odysseys Completed"]=t.gameplay.totalOdysseysCompleted,oe["Lifetime Trophies"]=t.gameplay.totalTrophiesEarned,oe["Necro Bloons Reanimated"]=t.bloonsPopped.necroBloonsReanimated,oe["Transforming Tonics Used"]=t.bloonsPopped.transformingTonicsUsed,oe["Most Experienced Monkey"]=getLocValue(t.mostExperiencedMonkey),oe["Insta Monkey Collection"]=`${t.gameplay.instaMonkeyCollection}/${constants.totalInstaMonkeys}`,oe["Collection Chests Opened"]=t.gameplay.collectionChestsOpened,oe["Golden Bloons Popped"]=t.bloonsPopped.goldenBloonsPopped,oe["Monkey Teams Wins"]=t.gameplay.monkeyTeamsWins,oe["Bosses Popped"]=t.bloonsPopped.bossesPopped,oe["Damage Done To Bosses"]=t.gameplay.damageDoneToBosses;let de=document.createElement("div");de.classList.add("profile-stats"),le.appendChild(de);for(let[e,t]of Object.entries(oe)){let a=document.createElement("div");a.classList.add("stat"),de.appendChild(a);let n=document.createElement("p");n.classList.add("stat-name"),n.innerHTML=e,a.appendChild(n);let l=document.createElement("p");l.classList.add("stat-value"),l.innerHTML=t.toLocaleString(),a.appendChild(l)}let ie={};ie["Contested Territory Tiles Captured"]=t.stats.ctCapturedTiles,ie["Towers Sold"]=t.stats.totalTowersSold,ie["Total Tier 1 Upgrades"]=t.stats.upgradesPurchasedByTier[1],ie["Total Tier 2 Upgrades"]=t.stats.upgradesPurchasedByTier[2],ie["Total Tier 3 Upgrades"]=t.stats.upgradesPurchasedByTier[3],ie["Total Tier 4 Upgrades"]=t.stats.upgradesPurchasedByTier[4],ie["Total Tier 5 Upgrades"]=t.stats.upgradesPurchasedByTier[5];let ce=document.createElement("div");ce.classList.add("profile-stats"),le.appendChild(ce);let pe=document.createElement("div");pe.classList.add("overview-right-column-header"),ce.appendChild(pe);let me=document.createElement("p");me.classList.add("column-header-text","black-outline"),me.innerHTML="API Exclusive Stats",pe.appendChild(me);for(let[e,t]of Object.entries(ie)){if(null==t)continue;let a=document.createElement("div");a.classList.add("stat"),ce.appendChild(a);let n=document.createElement("p");n.classList.add("stat-name"),n.innerHTML=e,a.appendChild(n);let l=document.createElement("p");l.classList.add("stat-value"),l.innerHTML=t.toLocaleString(),a.appendChild(l)}}async function generateLeaderboards(){showLoading();let e=document.getElementById("leaderboards-content");e.innerHTML="";let t=document.createElement("div");t.classList.add("leaderboard-page","page-extra","fd-column","ai-center"),t.style.display="none",e.appendChild(t);let a=document.createElement("p");a.classList.add("hero-progress-header-text","leaderboards-header-text"),a.style.backgroundImage="url('../Assets/UI/BlueTxtTextureMain.webp')",a.innerHTML="Active Events",t.appendChild(a);let n=document.createElement("div");n.classList.add("selectors-div"),t.appendChild(n);let l=document.createElement("p");l.classList.add("hero-progress-header-text","leaderboards-header-text"),l.innerHTML="Finished Events",t.appendChild(l);let r=document.createElement("div");r.id="maps-progress-views",r.classList.add("maps-progress-views"),t.appendChild(r);let s=document.createElement("p");s.classList.add("maps-progress-coop-toggle-text","black-outline"),s.innerHTML="Filter:",r.appendChild(s);let o=document.createElement("div");o.classList.add("maps-progress-view","black-outline","stats-tab-yellow"),o.innerHTML="All",o.addEventListener("click",(()=>{o.classList.add("stats-tab-yellow"),d.classList.remove("stats-tab-yellow"),i.classList.remove("stats-tab-yellow"),c.classList.remove("stats-tab-yellow"),onChangeEventFilter("all")})),r.appendChild(o);let d=document.createElement("div");d.classList.add("maps-progress-view","black-outline"),d.innerHTML="Race",d.addEventListener("click",(()=>{o.classList.remove("stats-tab-yellow"),d.classList.add("stats-tab-yellow"),i.classList.remove("stats-tab-yellow"),c.classList.remove("stats-tab-yellow"),onChangeEventFilter("race")})),r.appendChild(d);let i=document.createElement("div");i.classList.add("maps-progress-view","black-outline"),i.innerHTML="Boss",i.addEventListener("click",(()=>{o.classList.remove("stats-tab-yellow"),d.classList.remove("stats-tab-yellow"),i.classList.add("stats-tab-yellow"),c.classList.remove("stats-tab-yellow"),onChangeEventFilter("boss")})),r.appendChild(i);let c=document.createElement("div");c.classList.add("maps-progress-view","black-outline"),c.innerHTML="Contested Territory",c.addEventListener("click",(()=>{o.classList.remove("stats-tab-yellow"),d.classList.remove("stats-tab-yellow"),i.classList.remove("stats-tab-yellow"),c.classList.add("stats-tab-yellow"),onChangeEventFilter("ct")})),r.appendChild(c);let p=document.createElement("div");p.id="leaderboard-selectors",p.classList.add("selectors-div"),t.appendChild(p);let m=[],u=new Date;clearAllTimers();let h=[];isStale(racesDataCachedAt)&&h.push(fetchData("https://data.ninjakiwi.com/btd6/races",(e=>{racesData=e.body,racesDataCachedAt=Date.now()}))),isStale(bossesDataCachedAt)&&h.push(fetchData("https://data.ninjakiwi.com/btd6/bosses",(e=>{bossesData=e.body,bossesDataCachedAt=Date.now()}))),isStale(CTDataCachedAt)&&h.push(fetchData("https://data.ninjakiwi.com/btd6/ct",(e=>{CTData=e.body,CTDataCachedAt=Date.now()}))),await Promise.all(h).then((()=>{t.style.display="flex",hideLoading()})),racesData.forEach((e=>{let t=document.createElement("div");t.classList.add("roundset-selector-div"),u>new Date(e.start)&&u<new Date(e.end)?n.appendChild(t):m.push([e,t,e.totalScores]),t.addEventListener("click",(()=>{showLeaderboard("leaderboards",e,"Race")}));let a=document.createElement("img");a.classList.add("roundset-selector-img"),t.appendChild(a),a.src="../Assets/UI/EventRaceBtn.webp",t.classList.add("race-roundset");let l=document.createElement("div");l.classList.add("roundset-selector-text-div","d-flex","fd-column","ai-center"),t.appendChild(l);let r=document.createElement("p");r.classList.add("selector-text","black-outline"),r.innerHTML=`${e.name}`,l.appendChild(r);let s=document.createElement("p");s.id="time-left-"+e.name,s.classList.add("selector-text","black-outline"),l.appendChild(s),new Date<new Date(e.start)?s.innerHTML="Coming Soon!":new Date(e.end)>new Date?registerTimer(s.id,new Date(e.end)):s.innerHTML=`${new Date(e.start).toLocaleDateString()} - ${new Date(e.end).toLocaleDateString()}`;let o=document.createElement("p");o.innerHTML=`Total Scores: ${e.totalScores}`,o.classList.add("selector-text","black-outline"),l.appendChild(o);let d=document.createElement("img");d.classList.add("selector-go-img"),d.src="../Assets/UI/EventLeaderboardBtn.webp",t.appendChild(d)})),bossesData.forEach((e=>{let t=`${e.bossType.toLowerCase().replace(/\b\w/g,(e=>e.toUpperCase()))} ${e.name.replace(/\D/g,"")}`,a=document.createElement("div");a.classList.add("roundset-selector-div"),u>new Date(e.start)&&u<new Date(e.end)?n.appendChild(a):m.push([e,a,e.totalScores_standard]),a.addEventListener("click",(()=>{showLeaderboard("leaderboards",e,"Boss")}));let l=document.createElement("img");l.classList.add("roundset-selector-img"),a.appendChild(l),l.src=`../Assets/BossIcon/${e.bossType[0].toUpperCase()+e.bossType.slice(1)}EventIcon.webp`,a.style.backgroundImage=`url(../Assets/EventBanner/EventBannerSmall${e.bossType[0].toUpperCase()+e.bossType.slice(1)}.webp)`,a.classList.add("boss-roundset");let r=document.createElement("div");r.classList.add("roundset-selector-text-div","d-flex","fd-column","ai-center"),a.appendChild(r);let s=document.createElement("p");s.classList.add("selector-text","black-outline"),s.innerHTML=`${t}`,r.appendChild(s);let o=document.createElement("p");o.id="time-left-"+t,o.classList.add("selector-text","black-outline"),r.appendChild(o),new Date<new Date(e.start)?o.innerHTML="Coming Soon!":new Date(e.end)>new Date?registerTimer(o.id,new Date(e.end)):o.innerHTML=`${new Date(e.start).toLocaleDateString()} - ${new Date(e.end).toLocaleDateString()}`;let d=document.createElement("p");d.innerHTML=`Total Scores: ${e.totalScores_standard}`,d.classList.add("selector-text","black-outline"),r.appendChild(d);let i=document.createElement("img");i.classList.add("selector-go-img"),i.src="../Assets/UI/EventLeaderboardBtn.webp",a.appendChild(i)})),bossesData.forEach((e=>{let t=`Elite ${e.bossType.toLowerCase().replace(/\b\w/g,(e=>e.toUpperCase()))} ${e.name.replace(/\D/g,"")}`,a=document.createElement("div");a.classList.add("roundset-selector-div"),u>new Date(e.start)&&u<new Date(e.end)?n.appendChild(a):m.push([e,a,e.totalScores_elite]),a.addEventListener("click",(()=>{showLeaderboard("leaderboards",e,"BossElite")}));let l=document.createElement("img");l.classList.add("roundset-selector-img"),a.appendChild(l),l.src=`../Assets/BossIcon/Elite${e.bossType[0].toUpperCase()+e.bossType.slice(1)}EventIcon.webp`,a.style.backgroundImage=`url(../Assets/EventBanner/EventBannerSmall${e.bossType[0].toUpperCase()+e.bossType.slice(1)}.webp)`,a.classList.add("boss-roundset");let r=document.createElement("div");r.classList.add("roundset-selector-text-div","d-flex","fd-column","ai-center"),a.appendChild(r);let s=document.createElement("p");s.classList.add("selector-text","black-outline"),s.innerHTML=`${t}`,r.appendChild(s);let o=document.createElement("p");o.id="time-left-"+t,o.classList.add("selector-text","black-outline"),r.appendChild(o),new Date<new Date(e.start)?o.innerHTML="Coming Soon!":new Date(e.end)>new Date?registerTimer(o.id,new Date(e.end)):o.innerHTML=`${new Date(e.start).toLocaleDateString()} - ${new Date(e.end).toLocaleDateString()}`;let d=document.createElement("p");d.innerHTML=`Total Scores: ${e.totalScores_elite}`,d.classList.add("selector-text","black-outline"),r.appendChild(d);let i=document.createElement("img");i.classList.add("selector-go-img"),i.src="../Assets/UI/EventLeaderboardBtn.webp",a.appendChild(i)})),CTData.forEach((e=>{let t=document.createElement("div");t.classList.add("roundset-selector-div"),u>new Date(e.start)&&u<new Date(e.end)?n.appendChild(t):m.push([e,t,e.totalScores_team]),t.addEventListener("click",(()=>{showLeaderboard("leaderboards",e,"CTTeam")}));let a=document.createElement("img");a.classList.add("roundset-selector-img"),t.appendChild(a),a.src="../Assets/UI/ContestedLeaderboardBtn.webp",t.classList.add("ct-leaderboard-btn");let l=document.createElement("div");l.classList.add("roundset-selector-text-div","d-flex","fd-column","ai-center"),t.appendChild(l);let r=document.createElement("p");r.classList.add("selector-text","black-outline"),r.innerHTML="Contested Territory - Teams",l.appendChild(r);let s=document.createElement("p");s.id="time-left-"+e.id+"-teams",s.classList.add("selector-text","black-outline"),l.appendChild(s),new Date<new Date(e.start)?s.innerHTML="Coming Soon!":new Date(e.end)>new Date?registerTimer(s.id,new Date(e.end)):s.innerHTML=`${new Date(e.start).toLocaleDateString()} - ${new Date(e.end).toLocaleDateString()}`;let o=document.createElement("p");o.innerHTML=`Total Scores: ${e.totalScores_team}`,o.classList.add("selector-text","black-outline"),l.appendChild(o);let d=document.createElement("img");d.classList.add("selector-go-img"),d.src="../Assets/UI/EventLeaderboardBtn.webp",t.appendChild(d)})),CTData.forEach((e=>{let t=document.createElement("div");t.classList.add("roundset-selector-div"),u>new Date(e.start)&&u<new Date(e.end)?n.appendChild(t):m.push([e,t,e.totalScores_player]),t.addEventListener("click",(()=>{showLeaderboard("leaderboards",e,"CTPlayer")}));let a=document.createElement("img");a.classList.add("roundset-selector-img"),t.appendChild(a),a.src="../Assets/UI/ContestedTerritoryEventBtn.webp",t.classList.add("ct-leaderboard-btn");let l=document.createElement("div");l.classList.add("roundset-selector-text-div","d-flex","fd-column","ai-center"),t.appendChild(l);let r=document.createElement("p");r.classList.add("selector-text","black-outline"),r.innerHTML="Contested Territory - Players",l.appendChild(r);let s=document.createElement("p");s.id="time-left-"+e.id,s.classList.add("selector-text","black-outline"),l.appendChild(s),new Date<new Date(e.start)?s.innerHTML="Coming Soon!":new Date(e.end)>new Date?registerTimer(s.id,new Date(e.end)):s.innerHTML=`${new Date(e.start).toLocaleDateString()} - ${new Date(e.end).toLocaleDateString()}`;let o=document.createElement("p");o.innerHTML=`Total Scores: ${e.totalScores_player}`,o.classList.add("selector-text","black-outline"),l.appendChild(o);let d=document.createElement("img");d.classList.add("selector-go-img"),d.src="../Assets/UI/EventLeaderboardBtn.webp",t.appendChild(d)})),m.sort(((e,t)=>new Date(t[0].end)-new Date(e[0].end))),m.forEach((([e,t,a])=>{u<new Date(e.start)||0!=a&&p.appendChild(t)})),0==n.childNodes.length&&(a.style.display="none",n.style.display="none")}function onChangeEventFilter(e){let t=document.getElementById("leaderboard-selectors");switch(e){case"race":t.childNodes.forEach((e=>{e.classList.contains("race-roundset")?e.style.display="flex":e.style.display="none"}));break;case"boss":t.childNodes.forEach((e=>{e.classList.contains("boss-roundset")?e.style.display="flex":e.style.display="none"}));break;case"ct":t.childNodes.forEach((e=>{e.classList.contains("ct-leaderboard-btn")?e.style.display="flex":e.style.display="none"}));break;default:t.childNodes.forEach((e=>{e.style.display="flex"}))}}function showLeaderboard(e,t,a){switch(showLoading(!0),leaderboardActiveToken++,a){case"Boss":leaderboardLink!=t.leaderboard_standard_players_1&&(leaderboardPage=1),leaderboardLink=t.leaderboard_standard_players_1;break;case"BossElite":leaderboardLink!=t.leaderboard_elite_players_1&&(leaderboardPage=1),leaderboardLink=t.leaderboard_elite_players_1;break;case"CTPlayer":leaderboardLink!=t.leaderboard_player&&(leaderboardPage=1),leaderboardLink=t.leaderboard_player;break;case"CTTeam":leaderboardLink!=t.leaderboard_team&&(leaderboardPage=1),leaderboardLink=t.leaderboard_team;break;default:leaderboardLink!=t.leaderboard&&(leaderboardPage=1),leaderboardLink=t.leaderboard}let n=document.getElementById("leaderboard-content");n.style.display="flex",n.innerHTML="",document.getElementById(`${e}-content`).style.display="none",addToBackQueue({source:e,destination:"leaderboard",callback:()=>{leaderboardLink=null,leaderboardActiveToken++}});let l=document.createElement("div");l.classList.add("full-leaderboard-div"),n.appendChild(l);let r=document.createElement("div");r.classList.add("leaderboard-top"),l.appendChild(r);let s=document.createElement("div");s.classList.add("leaderboard-header"),r.appendChild(s);let o=document.createElement("div");o.classList.add("leaderboard-header-left"),s.appendChild(o);let d=document.createElement("img");d.classList.add("modal-close"),d.src="./Assets/UI/CloseBtn.webp",d.addEventListener("click",(()=>{goBack(),leaderboardActiveToken++})),o.appendChild(d);let i=document.createElement("div");i.classList.add(`leaderboard-header-middle-${a.toLowerCase()}`),s.appendChild(i);let c=document.createElement("div");c.classList.add(`leaderboard-header-${a.toLowerCase()}`),i.appendChild(c);let p=document.createElement("p");switch(p.classList.add("leaderboard-header-title-text"),c.appendChild(p),a){case"Race":p.classList.add("black-outline"),p.innerHTML="Race Leaderboard";break;case"Boss":p.classList.add("black-outline"),p.innerHTML="Boss Leaderboard";break;case"BossElite":p.classList.add("black-outline"),p.innerHTML="Elite Boss Leaderboard";break;case"CTPlayer":p.classList.add("ct-text"),p.innerHTML="Contested Territory <br> Player Leaderboard";break;case"CTTeam":p.classList.add("ct-text"),p.innerHTML="Contested Territory <br> Team Leaderboard"}let m=createEl("div",{classList:["d-flex","jc-end"],style:{width:"80px"}});if(s.appendChild(m),new Date(t.end)>new Date){let e=createEl("img",{classList:[],style:{cursor:"pointer",width:"50px",height:"50px"},src:"./Assets/UI/RefreshBtn.webp"});e.addEventListener("click",(()=>{leaderboardLink&&delete leaderboardCache[leaderboardLink],leaderboardActiveToken++,showLoading(),generateLeaderboardEntries(t,a,leaderboardActiveToken)})),m.appendChild(e)}if("Boss"==a||"BossElite"==a){let e=document.createElement("p");e.classList.add("leaderboard-disclaimer","black-outline"),e.innerHTML="Note: Only singleplayer boss leaderboards are available on the API currently.",r.appendChild(e)}let u=document.createElement("div");u.id="leaderboard-column-labels",u.classList.add("leaderboard-column-labels"),r.appendChild(u);let h=document.createElement("div");h.id="leaderboard-entries",h.classList.add("leaderboard-entries"),l.appendChild(h),generateLeaderboardEntries(t,a,leaderboardActiveToken)}async function generateLeaderboardEntries(e,t,a=leaderboardActiveToken){await getAllLeaderboardData(leaderboardLink,a);let n=null;switch(t){case"CTTeam":n="CTTeam";break;case"CTPlayer":n="CTPlayer"}if(e.hasOwnProperty("leaderboard")&&e.leaderboard.includes("races")&&(n="GameTime"),e.hasOwnProperty("bossType"))switch("BossElite"==t?e.eliteScoringType:e.normalScoringType){case"GameTime":n="GameTime";break;case"LeastCash":n="LeastCash";break;case"LeastTiers":n="LeastTiers"}leaderboardMetadata=e,leaderboardType=t,generateLeaderboardHeader(n),document.getElementById("leaderboard-entries").innerHTML="",addLeaderboardEntries(leaderboardCache[leaderboardLink].entries,1,leaderboardCache[leaderboardLink].entries.length)}function addLeaderboardEntries(e,t,a){let n=document.getElementById("leaderboard-entries"),l=leaderboardMetadata,r=leaderboardType;if(e.length>0&&hideLoading(),null!=e)e.forEach(((s,o)=>{let d={};s.hasOwnProperty("scoreParts")&&s.scoreParts.forEach(((e,t)=>{d[e.name]=e}));let i=document.createElement("div");i.classList.add("leaderboard-entry"),"CTTeam"!=r?i.addEventListener("click",(()=>{openProfile("leaderboard",s.profile)})):i.addEventListener("click",(()=>{openTeamModalPopout(s.group)})),n.appendChild(i);let c=document.createElement("div");c.classList.add("leaderboard-entry-div"),i.appendChild(c);let p=document.createElement("p");p.classList.add("leaderboard-entry-rank","black-outline"),p.innerHTML=o+(t-1)*a+1,c.appendChild(p);let m=document.createElement("div");m.classList.add("leaderboard-entry-player"),c.appendChild(m);let u=null,h=null,b=null;"CTTeam"==r?(u=document.createElement("div"),u.classList.add("leaderboard-entry-icon-ct"),m.appendChild(u),h=document.createElement("img"),h.classList.add("leaderboard-entry-frame"),h.src="./Assets/UI/TeamFrame1.webp",u.appendChild(h),b=document.createElement("img"),b.classList.add("leaderboard-entry-emblem"),b.src="./Assets/UI/TeamIcon1.webp",u.appendChild(b)):(u=document.createElement("img"),u.classList.add("leaderboard-entry-icon"),u.src="./Assets/ProfileAvatar/ProfileAvatar01.webp",m.appendChild(u));let g=document.createElement("p");g.classList.add("leaderboard-entry-name","leaderboard-outline"),g.innerHTML=s.displayName,m.appendChild(g);let L=document.createElement("div");L.classList.add("leaderboard-entry-time-submit-div"),c.appendChild(L);let y=document.createElement("div");y.classList.add("leaderboard-entry-score"),c.appendChild(y);let C=document.createElement("img");C.classList.add("leaderboard-entry-score-icon"),C.src="./Assets/UI/StopWatch.webp",y.appendChild(C);let v=document.createElement("p");if(v.classList.add("leaderboard-entry-main-score","leaderboard-outline"),y.appendChild(v),l.hasOwnProperty("leaderboard")&&l.leaderboard.includes("races")){let e=new Date(l.start+d["Time after event start"].score),t=document.createElement("p");t.classList.add("leaderboard-entry-time-submitted","leaderboard-outline"),t.innerHTML=e.toLocaleString(),L.appendChild(t);let a=document.createElement("p");a.classList.add("leaderboard-entry-time-submitted-relative","leaderboard-outline"),a.innerHTML=relativeTime(new Date,e),L.appendChild(a),v.innerHTML=formatScoreTime(s.score)}if(l.hasOwnProperty("bossType"))switch("BossElite"==r?l.eliteScoringType:l.normalScoringType){case"GameTime":let e=new Date(l.start+d["Game Time"].score),t=document.createElement("p");t.classList.add("leaderboard-entry-time-submitted","leaderboard-outline"),t.innerHTML=e.toLocaleString(),L.appendChild(t);let a=document.createElement("p");a.classList.add("leaderboard-entry-time-submitted-relative","leaderboard-outline"),a.innerHTML=relativeTime(new Date,e),L.appendChild(a),v.innerHTML=formatScoreTime(d["Least Cash"].score);break;case"LeastCash":v.innerHTML=d["Least Cash"].score.toLocaleString(),C.src="./Assets/UI/LeastCashIconSmall.webp",C.classList.add("leaderboard-entry-score-icon-large");let n=document.createElement("div");n.classList.add("leaderboard-entry-game-time"),c.appendChild(n);let r=document.createElement("img");r.classList.add("leaderboard-entry-score-icon"),r.src="./Assets/UI/StopWatch.webp",n.appendChild(r);let s=document.createElement("p");s.classList.add("leaderboard-entry-game-time-value","leaderboard-outline"),s.innerHTML=formatScoreTime(d["Game Time"].score),n.appendChild(s);break;case"LeastTiers":v.innerHTML=d["Tier Count"].score.toLocaleString(),C.src="./Assets/UI/LeastTiersIconSmall.webp",C.classList.add("leaderboard-entry-score-icon-large");let o=document.createElement("div");o.classList.add("leaderboard-entry-game-time"),c.appendChild(o);let i=document.createElement("img");i.classList.add("leaderboard-entry-score-icon"),i.src="./Assets/UI/StopWatch.webp",o.appendChild(i);let p=document.createElement("p");p.classList.add("leaderboard-entry-game-time-value","leaderboard-outline"),p.innerHTML=formatScoreTime(d["Game Time"].score),o.appendChild(p),y.classList.add("leaderboard-entry-score-tiers")}if(l.hasOwnProperty("tiles")&&(C.src="./Assets/UI/CtPointsIconSmall.webp",C.classList.add("leaderboard-entry-score-icon-large"),v.innerHTML=s.score.toLocaleString(),m.classList.add("leaderboard-entry-team")),!preventRateLimiting){new IntersectionObserver(((l,r)=>{l.forEach((async l=>{if(l.isIntersecting){if(e.length==o+1)if(null!=leaderboardCache[leaderboardLink].next){if(0==n.getElementsByClassName("loading-text-leaderboard").length){let e=createEl("p",{classList:["loading-text-leaderboard","black-outline"],style:{fontSize:"32px",paddingBottom:"50px"},innerHTML:"Loading more entries..."});n.appendChild(e)}clearProfileRequestQueue(),getLeaderboardPage(leaderboardCache[leaderboardLink].next,leaderboardActiveToken),leaderboardCache[leaderboardLink].nextRequested=!0}else if(!leaderboardCache[leaderboardLink].ended){leaderboardCache[leaderboardLink].ended=!0;let e=createEl("p",{classList:["black-outline"],style:{fontSize:"32px",paddingBottom:"50px"},innerHTML:"End of Leaderboard"});n.appendChild(e)}1==t&&o+(t-1)*a+1<=50&&addRequestToQueue(s.profile,(async()=>{try{let e=await getUserProfile(s.profile);null!=e&&(e.hasOwnProperty("owner")?(h.src=e.frameURL,b.src=e.iconURL,c.style.backgroundImage=`url(${getProfileBanner(e)})`):(u.src=getProfileAvatar(e),c.style.backgroundImage=`url(${getProfileBanner(e)})`),r.unobserve(l.target))}catch(e){console.error("Error fetching user profile:",e)}}))}else removeRequestFromQueue(s.profile)}))})).observe(u)}if(null!=profileCache[s.profile.split("/").pop()]){let e=profileCache[s.profile.split("/").pop()];e.hasOwnProperty("owner")?(h.src=e.frameURL,b.src=e.iconURL,c.style.backgroundImage=`url(${getProfileBanner(e)})`):(u.src=getProfileAvatar(e),c.style.backgroundImage=`url(${getProfileBanner(e)})`)}})),Array.from(n.getElementsByClassName("loading-text-leaderboard")).forEach((e=>{e.remove()}));else{let e=document.createElement("p");e.classList.add("no-data-found","black-outline"),e.style.width="250px",e.innerHTML="No Data Found",n.appendChild(e)}}function generateLeaderboardHeader(e){let t=document.getElementById("leaderboard-column-labels");t.innerHTML="";let a=document.createElement("p");a.classList.add("leaderboard-column-rank","black-outline"),a.innerHTML="Rank",t.appendChild(a);let n=document.createElement("p");switch(n.classList.add("leaderboard-column-name","black-outline"),n.innerHTML="Player",t.appendChild(n),e){case"GameTime":let e=document.createElement("p");e.classList.add("leaderboard-column-time-submitted","black-outline"),e.innerHTML="Time Submitted",t.appendChild(e);let a=document.createElement("p");a.classList.add("leaderboard-column-time-score","black-outline"),a.innerHTML="Game Time",t.appendChild(a);break;case"LeastCash":let l=document.createElement("p");l.classList.add("leaderboard-column-cash-spent","black-outline"),l.innerHTML="Cash Spent",t.appendChild(l);let r=document.createElement("p");r.classList.add("leaderboard-column-time-score","black-outline"),r.innerHTML="Game Time",t.appendChild(r);break;case"LeastTiers":let s=document.createElement("p");s.classList.add("leaderboard-column-tiers-used","black-outline"),s.innerHTML="Tiers Used",t.appendChild(s);let o=document.createElement("p");o.classList.add("leaderboard-column-time-score","black-outline"),o.innerHTML="Game Time",t.appendChild(o);break;case"CTTeam":n.innerHTML="Team";case"CTPlayer":let d=document.createElement("p");d.classList.add("leaderboard-column-ct-points","black-outline"),d.innerHTML="CT Points",t.appendChild(d)}}function openTeamModalPopout(e){const t=createEl("div",{classList:["d-flex","jc-center"],style:{padding:"10px 0",minHeight:"550px"}}),a=createEl("div",{classList:[]});t.appendChild(a),createModal({header:"Contested Territory - Team Group",content:t});let n=null;(async()=>{try{n=copyLoadingIcon(t);const l=await fetch(e);if(!l.ok)throw new Error(`Failed to fetch group: ${l.status}`);const r=await l.json();let s=[];if(Array.isArray(r)?s=r:Array.isArray(r.body)?s=r.body:Array.isArray(r?.body?.entries)&&(s=r.body.entries),!s||0===s.length)return a.innerHTML="",void a.appendChild(createEl("p",{classList:["no-data-found","black-outline"],textContent:"No teams found for this group."}));s.sort(((e,t)=>(t.score||0)-(e.score||0)));const o=new Map;if(s.forEach(((t,n)=>{const l=createEl("div",{classList:["d-flex","fd-column"]}),r=createEl("div",{classList:["leaderboard-entry","team-group-entry"]}),s=createEl("div",{classList:["leaderboard-entry-div"]}),d=createEl("img",{src:"./Assets/UI/ArrowHideBtn.webp",style:{width:"40px",height:"40px",cursor:"pointer",transition:"transform .2s"},classList:["team-group-caret"]}),i=createEl("p",{classList:["leaderboard-entry-rank","black-outline"],textContent:n+1}),c=createEl("div",{classList:["team-group-rank-wrap"]});c.appendChild(i);const p=createEl("div",{classList:["leaderboard-entry-player","leaderboard-entry-team"]}),m=createEl("div",{classList:["leaderboard-entry-icon-ct"]}),u=createEl("img",{classList:["leaderboard-entry-frame"],src:"./Assets/UI/TeamFrame1.webp"}),h=createEl("img",{classList:["leaderboard-entry-emblem"],src:"./Assets/UI/TeamIcon1.webp"});m.appendChild(u),m.appendChild(h);const b=createEl("p",{classList:["leaderboard-entry-name","leaderboard-outline"],textContent:t.displayName||"Unknown Team"});p.appendChild(m),p.appendChild(b);const g=createEl("div",{classList:["leaderboard-entry-score"]}),L=createEl("img",{classList:["leaderboard-entry-score-icon","leaderboard-entry-score-icon-large"],src:"./Assets/UI/CtPointsIconSmall.webp"}),y=createEl("p",{classList:["leaderboard-entry-main-score","leaderboard-outline","fg-1","ta-center"],textContent:(t.score||0).toLocaleString()});g.appendChild(L),g.appendChild(y),s.appendChild(c),s.appendChild(p),s.appendChild(g),r.appendChild(s),r.appendChild(d);const C=createEl("div",{classList:["d-flex","ai-center","jc-between"],style:{display:"none",margin:"-10px 60px 0px 20px",border:"6px solid var(--profile-tertiary)",borderTop:"none",borderRadius:"0 0 10px 10px",paddingLeft:"10px",backgroundColor:"var(--profile-primary)"}}),v=createEl("p",{classList:["black-outline","team-group-members"],style:{fontSize:"22px"},innerHTML:'<span class="team-group-members-value">?</span>/15 Members'}),k=createEl("div",{classList:["d-flex","ai-center"],style:{gap:"8px"}}),f=createEl("p",{classList:["black-outline"],style:{fontSize:"22px"},textContent:"Owner:"});k.appendChild(f);const E=createEl("div",{classList:["challenge-creator","team-owner-block","pointer"],style:{width:"300px"}});k.appendChild(E);const w=createEl("div",{classList:["avatar"]});E.appendChild(w);const T=createEl("img",{classList:["avatar-frame","noSelect"],style:{width:"50px"},src:"../Assets/UI/InstaTowersContainer.webp"});w.appendChild(T);const S=createEl("img",{classList:["avatar-img","noSelect"],style:{width:"50px"},src:"../Assets/ProfileAvatar/ProfileAvatar01.webp"});w.appendChild(S);const M=createEl("p",{classList:["black-outline"],textContent:preventRateLimiting?"Click to Load Owner":"Loading..."});E.appendChild(M);const D=createEl("p",{classList:["black-outline"],style:{fontSize:"22px"},innerHTML:'<span class="team-group-status-value">Loading...</span>'});C.appendChild(D),C.appendChild(v),C.appendChild(k),d.addEventListener("click",(a=>{a.stopPropagation();const n="flex"===C.style.display;if(C.style.display=n?"none":"flex",d.style.transform=n?"rotate(0deg)":"rotate(180deg)",!n){const a=o.get(t.profile);a&&!a.ownerLoaded&&a.teamProfile&&function(e,t){if(!e.teamProfile||!e.teamProfile.owner)return void(e.ownerName.textContent="No Owner");const a=e.teamProfile.owner,n=async()=>{e.ownerName.textContent="Loading...";try{const n=a.split("/").pop(),l=profileCache[n],r=l||await getUserProfile(a);if(!r)return void(e.ownerName.textContent="Click to Load Owner");e.ownerName.textContent=r.displayName,e.ownerImg.src=getProfileAvatar(r),e.ownerBlock.style.backgroundImage=`linear-gradient(to right, transparent 80%, var(--profile-secondary) 100%),url(${getProfileBanner(r)})`,e.ownerBlock.onclick=()=>{goBack(),openProfile("leaderboard",a,(()=>openTeamModalPopout(t)))},e.ownerLoaded=!0}catch{e.ownerName.textContent="Error Loading Owner"}};preventRateLimiting?(e.ownerName.textContent="Click to Load Owner",e.ownerBlock.onclick=()=>{e.ownerLoaded||n()}):n()}(a,e)}})),s.addEventListener("click",(()=>d.click())),l.appendChild(r),l.appendChild(C),a.appendChild(l),o.set(t.profile,{entryDiv:s,frameEl:u,emblemEl:h,iconWrap:m,membersSpan:v.querySelector(".team-group-members-value"),statusSpan:D.querySelector(".team-group-status-value"),ownerBlock:E,ownerImg:S,ownerFrame:T,ownerName:M,extra:C,ownerLoaded:!1,teamProfile:null})})),s.length<6)for(let e=s.length;e<6;e++){const t=e+1,n=createEl("div",{classList:["d-flex","fd-column"]}),l=createEl("div",{classList:["leaderboard-entry","team-group-entry","placeholder-entry"]}),r=createEl("div",{classList:["leaderboard-entry-div"],style:{marginRight:"40px"}}),s=createEl("div",{classList:["team-group-rank-wrap"]}),o=createEl("p",{classList:["leaderboard-entry-rank","black-outline"],textContent:t});s.appendChild(o);const d=createEl("div",{classList:["leaderboard-entry-player","leaderboard-entry-team"]}),i=createEl("div",{classList:["leaderboard-entry-icon-ct"]}),c=createEl("img",{classList:["leaderboard-entry-frame"],src:"./Assets/UI/StrikethroughRound.webp"});i.appendChild(c);const p=createEl("p",{classList:["leaderboard-entry-name","leaderboard-outline"],textContent:"Team has no score or no longer exists"});d.appendChild(i),d.appendChild(p);const m=createEl("div",{classList:["leaderboard-entry-score"]}),u=createEl("img",{classList:["leaderboard-entry-score-icon","leaderboard-entry-score-icon-large"],src:"./Assets/UI/CtPointsIconSmall.webp"}),h=createEl("p",{classList:["leaderboard-entry-main-score","leaderboard-outline","fg-1","ta-center"],textContent:"0"});m.appendChild(u),m.appendChild(h),r.appendChild(s),r.appendChild(d),r.appendChild(m),l.appendChild(r),n.appendChild(l),a.appendChild(n)}setTimeout((()=>async function(e,t){const a=preventRateLimiting?1:4;let n=0;async function l(){for(;n<e.length;){const a=e[n++],l=t.get(a.profile);if(l)try{const e=a.profile.split("/").pop(),t=profileCache[e],n=t||await getUserProfile(a.profile);if(!n)continue;if(l.teamProfile=n,n.frameURL&&(l.frameEl.src=n.frameURL),n.iconURL&&(l.emblemEl.src=n.iconURL),null!=n.numMembers&&(l.membersSpan.textContent=n.numMembers),n.status)switch(n.status){case"OPEN":l.statusSpan.textContent="Public";break;case"CLOSED":l.statusSpan.textContent="Invite Only";break;case"FILTERED":l.statusSpan.textContent="Private";break;default:l.statusSpan.textContent=n.status}(n.banner||n.bannerURL)&&(l.entryDiv.style.backgroundImage=`url(${getProfileBanner(n)})`)}catch{}}}await Promise.all(Array.from({length:a},(()=>l())))}(s,o)),20)}catch(e){console.error(e),a.innerHTML="",a.appendChild(createEl("p",{classList:["no-data-found","black-outline"],textContent:"Failed to load team group."}))}finally{n?.remove()}})()}let readyFlags=[0,0,0,0,0],pressedStart=!1,timerInterval=null,activeTimers=new Map,constants={},locJSON={},achievementsJSON={},achievementsHelper={},trophyStoreItemsJSON={},teamsStoreItemsJSON={},rogueJSON={},backQueue=[],backButton=createEl("img",{src:"../Assets/UI/BackBtn.webp",classList:["back-button","pointer"]});function goBack(e){let t=backQueue.pop();t.source&&(document.getElementById(t.destination+"-content").style.display="none",document.getElementById(t.source+"-content").style.display="flex"),t.callback&&t.callback(),changeHexBGColor(constants.BGColor),0===backQueue.length&&backButton.classList.remove("visible"),e||resetScroll()}function addToBackQueue(e){backQueue.push(e),backButton.classList.add("visible")}function clearBackQueue(){backQueue=[],backButton.classList.remove("visible")}function createEl(e,t={}){const a=document.createElement(e);if(t.classList&&a.classList.add(...t.classList),t.innerHTML&&(a.innerHTML=t.innerHTML),t.textContent&&(a.textContent=t.textContent),t.id&&(a.id=t.id),t.src&&(a.src=t.src),t.placeholder&&(a.placeholder=t.placeholder),t.style&&Object.assign(a.style,t.style),t.onclick&&(a.onclick=t.onclick),t.attributes)for(const[e,n]of Object.entries(t.attributes))a.setAttribute(e,n);return t.children&&t.children.forEach((e=>a.appendChild(e))),a}function createModal({header:e="",content:t="",footer:a="",classList:n=[]}={}){const l=createEl("div",{classList:["modal-overlay",...n]}),r=createEl("div",{classList:["modal-box"]}),s=createEl("div",{classList:["modal-header"]});""!=e&&r.appendChild(s);const o=createEl("div",{classList:["collection-header-modal-left"]});s.appendChild(o);const d=createEl("p",{classList:["collection-modal-header-text","black-outline"],innerHTML:e});s.appendChild(d);const i=createEl("img",{classList:["collection-modal-close","pointer"],src:"./Assets/UI/CloseBtn.webp"});i.addEventListener("click",(()=>{goBack(!0)})),s.appendChild(i);const c=createEl("div",{classList:["modal-content"]});if(r.appendChild(c),"string"==typeof t?c.innerHTML=t:t&&c.appendChild(t),a){const e=createEl("div",{classList:["modal-footer"]});"string"==typeof a?e.innerHTML=a:e.appendChild(a),r.appendChild(e)}l.appendChild(r),document.body.appendChild(l),backQueue[backQueue.length-1]?.callback!==closeModal&&addToBackQueue({callback:closeModal})}function closeModal(){document.querySelector(".modal-overlay")?.remove()}function showLoading(e){let t=0;if(!e){let n=new MutationObserver((e=>{e.forEach((e=>{"childList"===e.type&&e.addedNodes.forEach((e=>{"IMG"===e.nodeName&&(t++,e.addEventListener("load",a),e.addEventListener("error",a))}))}))}));function a(){t--,0===t&&(document.getElementById("loading").style.transform="scale(0)",n.disconnect())}n.observe(document.body,{childList:!0,subtree:!0})}document.getElementById("loading").style.removeProperty("transform")}function hideLoading(){document.getElementById("loading").style.transform="scale(0)"}function fetchConstants(){return fetch("./data/Constants.json").then((e=>e.json())).then((e=>{constants=e,readyFlags[4]=1})).catch((e=>{console.error("Error:",e),errorModal(e,"js")}))}function fetchLocKeys(){return fetch("./data/English.json").then((e=>e.json())).then((e=>{locJSON=e}))}async function fetchRogueDependencies(){return await fetchLocKeys(),fetch("./data/rogueData.json").then((e=>e.json())).then((e=>{rogueJSON=e,postProcessRogueData()})).catch((e=>{console.error("Error:",e),errorModal(e,"js")}))}async function fetchInstaDependencies(){await fetchLocKeys(),generateStats(),generateInstaData(),changeProgressTab("InstaMonkeys"),clearBackQueue(),hideLoading()}async function fetchMainDependencies(){Object.keys(constants.heroesInOrder).includes(btd6usersave.primaryHero)||(btd6usersave.primaryHero=Object.keys(constants.heroesInOrder)[0]),await fetchLocKeys(),await fetchRogueDependencies(),Promise.all([fetch("./data/Achievements150.json").then((e=>e.json())),fetch("./data/trophyStoreItems.json").then((e=>e.json())),fetch("./data/teamsStoreItems.json").then((e=>e.json()))]).then((([e,t,a])=>{achievementsJSON=e,trophyStoreItemsJSON=t,teamsStoreItemsJSON=a,readyFlags[2]=1,readyFlags[3]=1,loadSettings(),generateIfReady()})).catch((e=>{console.error("Error:",e),errorModal(e,"js")})),showLoading()}function resetScroll(){document.body.scrollTop=0,document.documentElement.scrollTop=0}function loadSettings(){let e=JSON.parse(localStorage.getItem("BTD6OAKSettings"));e&&(preventRateLimiting=e.ProfileLoading,useNamedMonkeys=e.UseNamedMonkeys,showTeamsItems=e.TeamsStoreItems)}function saveSettings(){let e={ProfileLoading:preventRateLimiting,UseNamedMonkeys:useNamedMonkeys,TeamsStoreItems:showTeamsItems};localStorage.setItem("BTD6OAKSettings",JSON.stringify(e))}function generateAvatar(e,t){let a=document.createElement("div");a.style.width=`${e}px`,a.style.height=`${e}px`,a.classList.add("avatar");let n=document.createElement("img");n.classList.add("avatar-frame","noSelect"),n.style.width=`${e}px`,n.src="../Assets/UI/InstaTowersContainer.webp",a.appendChild(n);let l=document.createElement("img");return l.classList.add("avatar-img","noSelect"),l.style.width=`${e}px`,l.src=t,a.appendChild(l),a}function openBTD6Link(e){window.location.href=e}function openBTD6Site(e){window.open(e,"_blank")}function copyLoadingIcon(e){let t=document.getElementsByClassName("loading-icon")[0].cloneNode(!0);return t.classList.add("loading-icon-leaderboard"),t.style.height="unset",e.appendChild(t),t}function formatTime(e){return[Math.floor(e/3600),Math.floor(e%3600/60),Math.floor(e%60)].map((e=>e<10?"0"+e:e)).join(":")}function formatScoreTime(e){let t=Math.floor(e/1e3),a=e%1e3,n=Math.floor(t/3600);t%=3600;let l=Math.floor(t/60),r=t%60;l=l.toString().padStart(2,"0"),r=r.toString().padStart(2,"0"),a=a.toString().padStart(3,"0");let s=`${l}:${r}.${a}`;return n>0&&(n=n.toString().padStart(2,"0"),s=`${n}:${s}`),s}function getRemainingTime(e){return(e-new Date)/1e3}function updateTimer(e,t){const a=document.getElementById(t);if(!a)return"missing";const n=getRemainingTime(e);if(n>172800){const e=Math.ceil(n/86400);a.textContent=`${e} days left`,a.style.width="130px"}else{if(n<0)return a.textContent="Finished",a.style.textAlign="right","finished";a.style.width="100px",a.textContent=formatTime(n)}}function relativeTime(e,t){const a=[{name:"year",ms:31536e6},{name:"month",ms:2592e6},{name:"day",ms:864e5},{name:"hour",ms:36e5},{name:"minute",ms:6e4},{name:"second",ms:1e3}],n=e-t;for(const e of a){if(n<e.ms)continue;let t=Math.round(n/e.ms);return`${t} ${e.name}${t>1?"s":""} ago`}}function changeHexBGColor(e){null!=e?document.body.style.backgroundColor=`rgb(${255*e[0]},${255*e[1]},${255*e[2]})`:document.body.style.removeProperty("background-color")}function ratioCalc(e,t,a,n,l){switch(e){case 1:return a*(n/l);case 2:return t*(l/n);case 3:return l*(t/a);case 4:return n*(a/t)}}function processRewardsString(e){let t={},a=e.split("#"),n=0;for(let e of a){t[n]={};let a=e.split(":"),l=a[0];if(!["MonkeyMoney","Power","InstaMonkey","KnowledgePoints","RandomInstaMonkey","Trophy"].includes(l)){t[n].type="Other",t[n].value=l,n++;continue}let r=a[1].split(",");switch(l){case"MonkeyMoney":t[n].type="MonkeyMoney",t[n].amount=parseInt(r[0]);break;case"Power":t[n].type="Power",t[n].power=r[0],t[n].amount=parseInt(r[1]),null==r[1]&&(t[n].amount=1);break;case"InstaMonkey":t[n].type="InstaMonkey",t[n].tower=r[0],t[n].tiers=r[1];break;case"KnowledgePoints":t[n].type="KnowledgePoints",t[n].amount=parseInt(r[0]);break;case"RandomInstaMonkey":t[n].type="RandomInstaMonkey",t[n].tier=r[0],t[n].amount=parseInt(r[1]);break;case"Trophy":t[n].type="Trophy",t[n].trophy=r[0]}n++}return t}function generateLoginDiv(e){let t=createEl("div",{classList:["d-flex","ai-center","jc-center","fd-column","bg-color-primary"]}),a=createEl("p",{classList:["site-info-header","black-outline"],innerHTML:"Login with your OAK Token!"});t.appendChild(a);const n=createEl("div");Object.entries(localStorageOAK).forEach((([t,a])=>{const l=createEl("div",{classList:["previous-oak-entry","d-flex","ai-center","ps-relative"],style:{backgroundImage:`linear-gradient(to right, transparent 80%, var(--profile-primary) 100%),url(${a.banner})`}});l.appendChild(generateAvatar(100,a.avatar)),l.appendChild(createEl("p",{classList:["profile-name","tc-white","font-luckiest","black-outline"],innerHTML:a.displayName}));const r=createEl("img",{classList:["use-button","ps-absolute"],src:"./Assets/UI/ContinueBtn.webp"});r.addEventListener("click",(async()=>{pressedStart||(pressedStart=!0,document.getElementById("loading").style.removeProperty("transform"),oak_token=t,await getSaveData(t),loggedIn=!0,e?e(oak_token):fetchMainDependencies())})),l.appendChild(r);const s=createEl("img",{classList:["delete-button","ps-absolute"],src:"./Assets/UI/CloseBtn.webp"});s.addEventListener("click",(()=>{delete localStorageOAK[t],writeLocalStorage(),n.removeChild(l)})),l.appendChild(s),n.appendChild(l)})),t.appendChild(n);let l=document.createElement("div");l.classList.add("site-access-div"),t.appendChild(l);let r=document.createElement("div");r.classList.add("oak-entry-div"),t.appendChild(r);let s=document.createElement("input");s.classList.add("key-entry"),s.placeholder="Enter your OAK here",r.appendChild(s);let o=document.createElement("div");o.classList.add("start-button","black-outline"),o.innerHTML="Start",o.addEventListener("click",(async()=>{let e=s.value;e.length<5||e.length>30||!e.startsWith("oak_")?errorModal('Please enter a valid OAK! This will start with "oak_".'):pressedStart||(document.getElementById("loading").style.removeProperty("transform"),pressedStart=!0,loggedIn=!0,oak_token=s.value,await getSaveData(oak_token),fetchMainDependencies())})),r.appendChild(o);let d=document.createElement("div");d.classList.add("get-oak-div"),t.appendChild(d);let i=document.createElement("p");i.classList.add("where-text"),i.innerHTML="Don't have an OAK token? Read here:",d.appendChild(i);let c=document.createElement("p");c.classList.add("where-button","black-outline"),c.style.width="220px",c.innerHTML="View OAK Guide",c.addEventListener("click",(()=>{openOAKInstructionsModal()})),d.appendChild(c);let p=document.createElement("div");return p.id="oak-instructions-div",p.classList.add("oak-instructions-div"),p.style.display="none",t.appendChild(p),t}function openOAKInstructionsModal(){let e=createEl("div",{style:{padding:"10px"}});return e.appendChild(createEl("p",{classList:["oak-instructions-header","black-outline"],innerHTML:"What is an Open Access Key?"})),e.appendChild(createEl("p",{classList:["oak-instructions-text"],innerHTML:"An Open Access Key (OAK) is a unique key that allows you to access your Bloons TD 6 data from Ninja Kiwi's Open Data API. The site will use this to fetch your information from the API to be displayed in a familiar way. <br><br>NOTE: Progress tracking is not available for BTD6+ on Apple Arcade and BTD6 Netflix as OAK tokens are unavailable."})),e.appendChild(createEl("p",{classList:["oak-instructions-header","black-outline"],innerHTML:"How do I get one?"})),e.appendChild(createEl("p",{classList:["oak-instructions-text"],innerHTML:"Step 1: Login and Backup your progress with a Ninja Kiwi Account in BTD6. You can do this by going to settings from the main menu and clicking on the Account button."})),e.appendChild(createEl("img",{classList:["oak-instruction-img"],src:"./Assets/UI/OAKTutorial1.webp"})),e.appendChild(createEl("p",{classList:["oak-instructions-text"],innerHTML:'Step 2: Select "Open Data API" at the bottom right of the account screen.'})),e.appendChild(createEl("img",{classList:["oak-instruction-img"],src:"./Assets/UI/OAKTutorial2.webp"})),e.appendChild(createEl("p",{classList:["oak-instructions-text"],innerHTML:'Step 3: Generate a key and copy that in to the above text field. It should start with "oak_". Then click "Start" to begin!'})),e.appendChild(createEl("img",{classList:["oak-instruction-img"],src:"./Assets/UI/OAKTutorial3.webp"})),e.appendChild(createEl("p",{classList:["oak-instructions-text"],innerHTML:'You can read more about the Open Data API here: <a href="https://ninja.kiwi/opendatafaq" target="_blank", style="color:white";>Open Data API Article</a><br><br>Privacy Note: This app does not store any data being sent to or retrieved from Ninja Kiwi\'s Open Data API outside of your browser/device. The localStorage browser feature is used to prevent users from having to re-enter their OAK token every time they visit the site. If you would like to delete this stored data, you can do so by clicking the "X" on the profile you would like to delete on this homepage or clearing your browsing data.'})),createModal({header:"OAK Instructions",content:e}),e}function errorModal(e,t,a){if(isErrorModalOpen&&!a)return;let n=document.createElement("div");n.classList.add("error-modal-overlay"),document.body.appendChild(n);let l=document.createElement("div");l.id="error-modal",l.classList.add("error-modal"),n.appendChild(l);let r=document.createElement("div");r.id="error-modal-header",r.classList.add("error-modal-header"),l.appendChild(r);let s=document.createElement("img");s.id="error-modal-header-img",s.classList.add("error-modal-header-img"),s.src="./Assets/UI/BadConnectionBtn.webp",r.appendChild(s);let o=document.createElement("p");o.classList.add("error-modal-header-text","black-outline"),o.innerHTML="Error",r.appendChild(o);let d=document.createElement("div");d.classList.add("error-modal-dummy"),r.appendChild(d);let i=document.createElement("div");i.id="error-modal-content",i.classList.add("error-modal-content"),i.innerHTML=""+e,l.appendChild(i);let c=document.createElement("div");if(c.classList.add("error-modal-content"),"Invalid user ID / Player Does not play this game"===e)c.innerHTML="Please try again or create a new Open Access Key.",l.appendChild(c);if("ratelimit"==t){let e=document.createElement("div");e.classList.add("error-toggle-div"),l.appendChild(e);let t=document.createElement("p");t.classList.add("maps-progress-coop-toggle-text","black-outline"),t.innerHTML="Manually Load Profiles: ",e.appendChild(t);let a=document.createElement("input");a.classList.add("maps-progress-coop-toggle-input"),a.type="checkbox",a.checked=preventRateLimiting,a.addEventListener("change",(()=>{preventRateLimiting=!!a.checked})),e.appendChild(a)}let p=document.createElement("div");p.classList.add("error-modal-ok-button-div"),l.appendChild(p);let m=document.createElement("div");m.classList.add("start-button","modal-ok-button","black-outline"),m.innerHTML="OK",m.addEventListener("click",(()=>{isErrorModalOpen=!1,document.body.removeChild(n)})),p.appendChild(m);let u=document.createElement("img");u.classList.add("error-modal-close"),u.src="./Assets/UI/CloseBtn.webp",u.addEventListener("click",(()=>{isErrorModalOpen=!1,document.body.removeChild(n)})),i.appendChild(u),isErrorModalOpen=!0}backButton.addEventListener("click",(()=>{goBack()})),document.querySelector(".header").prepend(backButton);const rtf=new Intl.RelativeTimeFormat("en",{style:"long"});function getRelativeTimeString(e){const t=e-Date.now(),a=Math.abs(t),n=36e5,l=24*n;let r,s;return a>=l?(r=Math.round(t/l),s="day"):a>=n?(r=Math.round(t/n),s="hour"):(r=Math.round(t/6e4),s="minute"),rtf.format(r,s)}function registerTimer(e,t){t instanceof Date||(t=new Date(t)),activeTimers.set(e,t),ensureTimerLoop(),updateTimer(t,e)}function ensureTimerLoop(){null==timerInterval&&(timerInterval=setInterval((()=>{if(0===activeTimers.size)return clearInterval(timerInterval),void(timerInterval=null);for(let[e,t]of activeTimers){const a=updateTimer(t,e);"missing"!==a&&"finished"!==a||activeTimers.delete(e)}}),1e3))}function clearAllTimers(){activeTimers.clear(),timerInterval&&(clearInterval(timerInterval),timerInterval=null)}