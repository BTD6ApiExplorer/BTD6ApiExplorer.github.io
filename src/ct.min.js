let leaderboardNext,leaderboardType,oak_token="",btd6usersave={},_btd6usersave={},btd6publicprofile={},_btd6publicprofile={},racesData=null,leaderboardData=null,leaderboardLink=null,leaderboardPage=1,leaderboardPageEntryCount=null,localStorageOAK={},refreshRateLimited=!1,profileCache={},bossesData=null,CTData=null,DCData=null,challengesCache={},browserData=null,browserLink=null,browserPage=1,browserPageEntryCount=null,browserFilter="newest",cacheBust=!1,isErrorModalOpen=!1,customMapsCache={},rateLimited=!1,preventRateLimiting=!1,maxRequests=100,baseInterval=200,requestCount=0,completedRequests=0,lastResetTime=Date.now(),requestQueue=[],isProcessing=!1,leaderboardCache={},leaderboardMetadata={},leaderboardActiveToken=0,racesDataCachedAt=null,bossesDataCachedAt=null,CTDataCachedAt=null,challengesDataCachedAt=null,latestEvents=null;const TIMEOUT_TTL=6e5,isStale=e=>!e||Date.now()-e>6e5;function addRequestToQueue(e,t){requestQueue.push({id:e,request:t}),isProcessing||processRequestQueue()}function removeRequestFromQueue(e){requestQueue=requestQueue.filter((t=>t.id!==e))}function calculateDelay(){const e=requestCount/(maxRequests/2);return baseInterval+baseInterval*Math.pow(e,2)}async function processRequestQueue(){isProcessing||(isProcessing=!0,function e(){if(0===requestQueue.length)return void(isProcessing=!1);const t=Date.now();if(t-lastResetTime>=18e4&&(requestCount=0,lastResetTime=t),requestCount<maxRequests){const e=requestQueue.shift();requestCount++,e.request()}const n=calculateDelay();setTimeout(e,n)}())}async function fetchData(e,t){let n=null;try{cacheBust?(n=await fetch(e,{cache:"reload"}),cacheBust=!1,rateLimited=!1):(n=await fetch(e),rateLimited=!1)}catch(e){return navigator.onLine?(rateLimited=!0,requestQueue=[],hideLoading(),pressedStart=!1,`You have hit the rate limit. [${e}]`):(errorModal("You are currently offline. Please check your internet connection.","api"),`You are currently offline. [${e}]`)}try{let e=await n.json();return 1==e.success?t(e):"Rate limit"==e.reason?(isErrorModalOpen=!0,errorModal("You have hit the rate limit. Please try again later.","api")):(document.getElementById("loading").style.transform="scale(0)",pressedStart=!1,errorModal(e.error,"api")),e}catch(e){return errorModal(`Something went wrong with the request. Response Code: ${n.status} [${e}]`,"api"),`Something went wrong with the request. Response Code: ${n.status} [${e}]`}}async function getSaveData(e){cacheBust=!0;let t=!0,n=new Promise((async(n,a)=>{await fetchData(`https://data.ninjakiwi.com/btd6/save/${e}`,(e=>{btd6usersave=e.body,_btd6usersave=e.model,readyFlags[0]=1,t=!1,n()}))}));if(await n,t&&!rateLimited){let t=document.getElementsByClassName("error-modal-overlay");for(element of t)element.parentNode.removeChild(element);return delete localStorageOAK[e],writeLocalStorage(),void errorModal("Your Open Access Key has expired. Please make a new one and try again.","expire",!0)}await getPublicProfileData(e)}async function getPublicProfileData(e){return cacheBust=!0,new Promise(((t,n)=>{fetchData(`https://data.ninjakiwi.com/btd6/users/${e}`,(n=>{btd6publicprofile=n.body,_btd6publicprofile=n.model,localStorageOAK[e]={displayName:btd6publicprofile.displayName,avatar:getProfileAvatar(btd6publicprofile),banner:getProfileBanner(btd6publicprofile)},writeLocalStorage(),readyFlags[1]=1,t()}))}))}async function getRacesData(){null==racesData||isStale(racesDataCachedAt)?await fetchData("https://data.ninjakiwi.com/btd6/races",(e=>{racesData=e.body,racesDataCachedAt=Date.now(),generateRaces()})):generateRaces(),addToBackQueue({callback:generateEvents})}async function getRaceMetadata(e){return racesData&&racesData[e]&&"string"==typeof racesData[e].metadata?fetchData(racesData[e].metadata,(t=>(racesData[e].metadata=t.body,racesData[e]))):racesData[e]}async function getLeaderboardData(){return leaderboardLink?(leaderboardData=null,fetchData(`${leaderboardLink}?page=${leaderboardPage}`,(e=>(leaderboardData=e.body,leaderboardPageEntryCount=leaderboardData.length,document.getElementById("leaderboard-footer-page-number").innerHTML=`Page ${leaderboardPage} (#${leaderboardPage*leaderboardPageEntryCount-(leaderboardPageEntryCount-1)} - ${leaderboardPage*leaderboardPageEntryCount})`,leaderboardData)))):errorModal("Leaderboard Fetch Error: No leaderboard data found")}async function getAllLeaderboardData(e){return null==e&&(e=leaderboardLink),requestQueue=[],(null==leaderboardCache[leaderboardLink]||leaderboardCache[leaderboardLink]._cachedAt&&Date.now()-leaderboardCache[leaderboardLink]._cachedAt>6e5)&&(leaderboardCache[leaderboardLink]={entries:[],_cachedAt:Date.now()},getLeaderboardPage(e)),leaderboardCache[leaderboardLink]}async function getLeaderboardPage(e,t=leaderboardActiveToken){null!=e&&(leaderboardCache[leaderboardLink].nextRequested||(requestCount++,await fetchData(e,(n=>{t===leaderboardActiveToken&&(leaderboardCache[leaderboardLink].entries=leaderboardCache[leaderboardLink].entries.concat(n.body),leaderboardCache[leaderboardLink]._cachedAt=Date.now(),leaderboardCache[leaderboardLink].hasOwnProperty("entryPerPage")||(leaderboardCache[leaderboardLink].entryPerPage=n.body.length),addLeaderboardEntries(n.body,isNaN(e.split("=")[1])?1:parseInt(e.split("=")[1]),leaderboardCache[leaderboardLink].entryPerPage?leaderboardCache[leaderboardLink].entryPerPage:n.body.length),leaderboardCache[leaderboardLink].next=n.next,leaderboardCache[leaderboardLink].nextRequested=!1)}))))}async function getBossesData(){null==bossesData||isStale(bossesDataCachedAt)?await fetchData("https://data.ninjakiwi.com/btd6/bosses",(e=>{bossesData=e.body,bossesDataCachedAt=Date.now(),generateBosses(showElite)})):generateBosses(showElite),addToBackQueue({callback:generateEvents})}async function getBossMetadata(e,t){return bossesData&&bossesData[e]&&"string"==typeof bossesData[e][t?"metadataElite":"metadataStandard"]?fetchData(bossesData[e][t?"metadataElite":"metadataStandard"],(n=>(bossesData[e][t?"metadataElite":"metadataStandard"]=n.body,bossesData[e]))):bossesData[e]}async function getCTData(e){null==CTData||isStale(CTDataCachedAt)?await fetchData("https://data.ninjakiwi.com/btd6/ct",(e=>{CTData=e.body,CTDataCachedAt=Date.now(),generateCTs()})):generateCTs(),e||addToBackQueue({callback:generateEvents})}async function getCTTiles(e){let t=null;return await fetchData(e,(e=>(t=e.body,t))),t}async function getDailyChallengesData(){if(null!=DCData&&!isStale(challengesDataCachedAt))return addToBackQueue({callback:generateEvents}),DCData;await fetchData("https://data.ninjakiwi.com/btd6/challenges/filter/daily",(e=>(DCData=e.body,addToBackQueue({callback:generateEvents}),challengesDataCachedAt=Date.now(),DCData)))}async function getChallengeMetadata(e){return(null==challengesCache[e]||isStale(challengesCache[e]._cachedAt))&&await fetchData(`https://data.ninjakiwi.com/btd6/challenges/challenge/${e}`,(t=>(challengesCache[e]=t.body,challengesCache[e]._cachedAt=Date.now(),challengesCache[e]))),challengesCache[e]}async function getBrowserData(){return browserLink?(browserData=null,fetchData(`${browserLink}${browserFilter}?page=${browserPage}`,(e=>(browserData=e.body,browserPageEntryCount=browserData.length,document.getElementById("browser-footer-page-number").innerHTML=`Page ${browserPage} of 4`,leaderboardData)))):errorModal("Content Browser Fetch Error: No data found")}async function getUserProfile(e){let t=e.split("/").pop();return null==profileCache[t]&&await fetchData(e,(e=>{profileCache[t]={...e.body,_cachedAt:Date.now()}})),profileCache[t]}async function getCustomMapMetadata(e){return null==customMapsCache[e]&&await fetchData(`https://data.ninjakiwi.com/btd6/maps/map/${e}`,(t=>(customMapsCache[e]=t.body,customMapsCache[e]))),customMapsCache[e]}async function getLatestEvents(){return null==latestEvents&&await fetchData("https://data.ninjakiwi.com/btd6/events",(e=>{latestEvents=e.body})),latestEvents}async function getLatestCollectionEvent(){let e=await getLatestEvents();for(let t of e)if("collectableEvent"==t.type)return t;return null}function readLocalStorage(){null!=localStorage.getItem("BTD6OAKStorage")&&(localStorageOAK=JSON.parse(localStorage.getItem("BTD6OAKStorage")))}function writeLocalStorage(){localStorage.setItem("BTD6OAKStorage",JSON.stringify(localStorageOAK))}function challengeIdToDate(e){e.substring(0,3),parseInt(e.substring(3,7));let t=e.substring(7);return[parseInt(t.substring(0,4)),parseInt(t.substring(4,6)),parseInt(t.substring(6,8))]}function getChallengeIdFromInt(e,t){let n=new Date(2024,4,25),a=(t?2101:2114)-parseInt(e);return n.setDate(n.getDate()-a),(t?"adv":"rot")+e+n.toISOString().substring(0,10).replace(/-/g,"")}function getChallengeIDFromDate(e,t){let n=new Date(e),a=new Date(2024,4,25).getTime()-n.getTime();return(t?"adv":"rot")+((t?2101:2114)-Math.floor(a/864e5))+e.replace(/-/g,"")}function clearProfileRequestQueue(){requestQueue=[],isProcessing=!1}processRequestQueue();let externalCTData={},CTSeedToEventNumber=null;async function getCTSeedToEventNumber(){if(!CTSeedToEventNumber){const e=await fetch("https://storage.googleapis.com/btd6-ct-map/event-seeds.json").then((e=>e.json())),t={};for(const[n,a]of Object.entries(e))t[a]=parseInt(n,10);CTSeedToEventNumber=t}return CTSeedToEventNumber}async function getExternalCTData(e){await getCTSeedToEventNumber();const t=CTSeedToEventNumber[e];if(null==t)return null;if(!externalCTData[e]){const n=`https://storage.googleapis.com/btd6-ct-map/events/${t}`,[a,s,r]=await Promise.all([fetch(`${n}/tiles.json`).then((e=>e.json())),fetch(`${n}/daily_powers.json`).then((e=>e.json())),fetch(`${n}/event_relics.json`).then((e=>e.json()))]);externalCTData[e]={tiles:a,daily_powers:s,event_relics:r,eventId:t,seed:e,_cachedAt:Date.now()}}return externalCTData[e]}const achievementNameFixMap={Clicker:"Bloons Master","Superior Clicker":"Superior Bloons Master","Ultimate Clicker":"Ultimate Bloons Master","Knowledgable Primate":"Knowledgeable Primate","Triple Threat":"Triple threat","Small Bloons":"Alchermistman and Bloonacleboy","Master of Life":"Master of life","What did it cost":"What did it cost? - Everything","2 Mega Pops":"2 MegaPops","Looking fab":"Lookin fab",GoldenTicket:"Golden Ticket","Axis of Havok":"Axis of Havoc","Co-op Popper!":"Co-op Popper",CouponCrazy:"Coupon Crazy",LimitedRun:"Limited Run",ALaCode:"A La Code",InstantGratification:"Instant Gratification","Achievement Of Achievements":"Achievement of Achievements","What is this new Bloonery":"What is this new Bloonery?","Who's the Boss":"Who's the Boss?","I'llBeBack":"I'll Be Back",SoSpiiiceyNinjaKiwi:"So Spiiicey Ninja Kiwi",DavidsVsGoliath:"Davids vs Goliath",ToolsToDarwin:"Tools to Darwin",BigSpender:"Big Spender",NotLackingCriticalInformation:"Not Lacking Critical Information",StubbornStrategy:"Stubborn Strategy","Hook Line And Sinker":"Hook, Line, and Sinker",CrashOfTheTitans:"Crash of the Titans","So Shiny":"So Shiny!","Ultimate Team Up":"Ultimate Team-up",StudentLoans:"Student Loans",StickySituation:"Sticky Situation",NoHarvest:"No Harvest",ReadyPlayerOne:"Ready Player One?",TheDailyReid:"The Daily Reid",InstaCentury:"Insta Century"},reverseAchievementNameFixMap=Object.entries(achievementNameFixMap).reduce(((e,[t,n])=>(e[n]=t,e)),{}),skinNameFixMap={ObynOceanGuardian:"OceanObyn",MoltenObyn:"MountainObyn",JoanOfArcAdora:"JoanOfArc",CyberQuincy:"QuincyCyber",ETnEtienne:"ETn",SentaiCaptainChurchill:"SentaiChurchill",SleighCaptainChurchill:"SleighChurchill",TinkerfairyRosalia:"RosaliaTinkerfairy"},upgradeNameFixMap={Spikeopult:"Spike-o-pult",BuccaneerLongRange:"LongRange",BuccaneerGrapeShot:"GrapeShot",BuccaneerCrowsNest:"CrowsNest",BuccaneerHotShot:"HotShot",BuccaneerCarrierFlagship:"CarrierFlagship",BuccaneerCannonShip:"CannonShip",BuccaneerMerchantman:"Merchantman",BuccaneerFavoredTrades:"FavoredTrades",BuccaneerAircraftCarrier:"AircraftCarrier",BuccaneerDestroyer:"Destroyer",BuccaneerTradeEmpire:"TradeEmpire",BuccaneerPirateLord:"PirateLord",BuccaneerMonkeyPirates:"MonkeyPirates",HeattippedDarts:"HeatTippedDart",BioncBoomerang:"BionicBoomerang",LargeCalibre:"LongCalibre",LaserBlasts:"LaserBlast",GuidedMagic:"GuildedMagic",MortarRapidReload:"RapidReload",SupplyDrop:"CashDrop",PlasmaBlasts:"PlasmaBlast",XXXLTrap:"XXXL",OversizeNails:"OversizedNails",CenteredPath:"FlightOrders",Shockwave:"ShellShock",Monkeyopolis:"Metropolis",Spectre:"Specter",TrueSunGod:"TrueSonGod",HydraRocketPods:"HydraRockets",DartMonkeyParagon:"ApexPlasmaMaster",BoomerangMonkeyParagon:"GlaiveDominus",NinjaMonkeyParagon:"AscendedShadow",EngineerMonkeyParagon:"MasterBuilder",WizardMonkeyParagon:"MagusPerfectus",MonkeyAceParagon:"GoliathDoomship",MonkeyBuccaneerParagon:"NavarchOfTheSeas",MonkeySubParagon:"NauticSiegeCore",SmartSpikes:"DirectedSpikes",TackShooterParagon:"CycloneOfFireAndMetal"};let locJSONOverrides={"Directed Spikes":"Smart Spikes","Directed Spikes Description":"Smart Spikes Description",CircusGwendolinSkinName:"HarlegwenGwendolinSkinName",CircusGwendolinSkinDescription:"HarlegwenGwendolinSkinDescription",OctoJonesSkinName:"OctoJonesStrikerJonesSkinName",OctoJonesSkinDescription:"OctoJonesStrikerJonesSkinDescription",MoltenObynSkinName:"ObynMountainGuardianSkinName",MoltenObynSkinDescription:"ObynMountainGuardianSkinDescription",SushiBentoSkinName:"SushiBentoBenjaminSkinName",SushiBentoSkinDescription:"SushiBentoBenjaminSkinDescription",KaijuPatSkinName:"KaijuPatFustySkinName",KaijuPatSkinDescription:"KaijuPatFustySkinDescription",GalaxiliSkinName:"GalaxiliEziliSkinName",GalaxiliSkinDescription:"GalaxiliEziliSkinDescription",VoidoraSkinName:"VoidoraAdoraSkinName",VoidoraSkinDescription:"VoidoraAdoraSkinDescription",VikingSaudaSkinName:"VikingSaudaSaudaSkinName",VikingSaudaSkinDescription:"VikingSaudaSaudaSkinDescription",JiangshiSaudaSkinName:"JiangshiSaudaSaudaSkinName",JiangshiSaudaSkinDescription:"JiangshiSaudaSaudaSkinDescription",DreadPirateBrickellSkinName:"DreadPirateBrickellAdmiralBrickellSkinName",DreadPirateBrickellSkinDescription:"DreadPirateBrickellAdmiralBrickellSkinDescription",LifeguardBrickellSkinName:"LifeguardBrickellAdmiralBrickellSkinName",LifeguardBrickellSkinDescription:"LifeguardBrickellAdmiralBrickellSkinDescription",PsimbalsSkinName:"PsimbalsPsiSkinName",PsimbalsSkinDescription:"PsimbalsPsiSkinDescription",GeraldoGentlemanGadgeteerSkinName:"GentlemonkeyGadgeteerGeraldoSkinName",GeraldoGentlemanGadgeteerSkinDescription:"GentlemonkeyGadgeteerGeraldoSkinDescription","Mode Easy":"Easy","Mode Medium":"Medium","Mode Hard":"Hard","Mode Impoppable":"Impoppable","Mode Sandbox":"Sandbox",RosaliaTinkerfairySkinName:"TinkerfairyRosaliaSkinName",RosaliaTinkerfairySkinDescription:"TinkerfairyRosaliaSkinDescription",AdoraSheRaSkinDescription:"SheRaAdoraSkinDescription",AdoraSheRaSkinName:"SheRaSkinName"},medalMap={Easy:"Bronze",PrimaryOnly:"Bronze01",Deflation:"Bronze02",Medium:"Silver",MilitaryOnly:"Silver01",Apopalypse:"Silver03",Reverse:"Silver02",Hard:"Gold",MagicOnly:"Gold01",DoubleMoabHealth:"Gold03",HalfCash:"Gold04",AlternateBloonsRounds:"Gold02",Impoppable:"Impoppable",Clicks:"ImpoppableRuby","CHIMPS-BLACK":"ImpoppableHematite"},saveSkintoSkinMap={"Scientist Gwendolin":"ScientistGwendolin","Biker Bones":"BikerBones","Sentai Captain Churchill":"SentaiCaptainChurchill","Cyber Quincy":"Cyber Quincy","Octo Jones":"OctoJones","Sleigh Captain Churchill":"SleighCaptainChurchill","Wolfpack Quincy":"WolfpackQuincy",ScientistGwendolin:"Scientist Gwendolin",BikerBones:"Biker Bones",SentaiCaptainChurchill:"Sentai Captain Churchill",CyberQuincy:"Cyber Quincy",OctoJones:"Octo Jones",SleighCaptainChurchill:"Sleigh Captain Churchill",WolfpackQuincy:"Wolfpack Quincy"},trophyStoreKeyFixes={HeroesQuincyCyberQuincyPlacementFireworks:"H-CyberQuincyPlacementFireworks",HeroesChurchillPlacementTankDrop:"H-ChurchillPlacementTankDrop",HeroesBenjamminDJSkinPlacementPartyLights:"H-BenDJSkinPlacementPartyLights",HeroesStrikerJonesPlacementParadrop:"H-StrikerJonesPlacementParadrop",GameUIUpgradesDisplayNamedMonkeys:"GameUIUpgradesNamedMonkeys",GameUIMusicTrackMusicTitleFiestaMix:"UIMusic-TitleFiestaMix",GameUIMusicTrackMusicSunshineGameboyMix:"UIMusic-SunshineGameboyMix",GameUIMusicTrackMusicTropicalComplextroMix:"UIMusic-TropicalComplextroMix",BloonsAllBloonsPopsBarrelOfMonkeys:"BloonsAll-PopsBarrelOfMonkeys",CoopEmoteAnimationSparklingHearts:"CE-AnimationSparklingHearts",GameUIMusicTrackMusicSunsetSilentNightMix:"UIMusic-SunsetSilentNightMix",TowerProjectileBombshooterPumpkin:"TP-BombshooterPumpkin",TowerProjectileBananaFarmCandyCorn:"TP-BananaFarmCandyCorn",TowerEffectAllMonkeysPlacementUpgradesGhosts:"TEAMPU-Ghosts",GameUIPowerSkinSuperVampireStorm:"PSkin-SuperVampireStorm",GameUIMusicTrackMusicFiestaSynthwaveMix:"UIMusic-FiestaSynthwaveMix",TowerEffectAllMonkeysPlacementUpgradesPresents:"TEAMPU-Presents",TowerProjectileBoomerangCandyCane:"TP-BoomerangCandyCane",GameUIMusicTrackMusicJingleBloons:"UIMusic-JingleBloons",TowerProjectileSpikeFactoryPineapples:"TP-SpikeFactoryPineapples",GameUIMusicTrackMusicBMCStreetParty:"UIMusic-BMCStreetParty",TowerProjectileDartlingEasterEggs:"TP-DartlingEasterEggs",CoopEmoteAnimationPixelMonkeyDance:"CE-AnimationPixelMonkeyDance",HeroesPatFustyPlacementSuperjump:"H-PatFustyPlacementSuperjump",TowerPropMonkeyVillageBrazilFlag:"TProp-VillageBrazilFlag",TowerPropMonkeyVillageScotlandFlag:"TProp-VillageScotlandFlag",TowerPropMonkeyVillageBananaFlag:"TProp-VillageBananaFlag",TowerEffectAllMonkeysPlacementUpgradesFireworks:"TEAMPU-Fireworks",TowerProjectileWizardMonkeyFireworks:"TP-WizardMonkeyFireworks",GameUIPowerSkinMonkeyBoostFireworks:"PSkin-MonkeyBoostFireworks",GameUIMusicTrackMusicTropicalOctopusMix:"UIMusic-TropicalOctopusMix",HeroesGwendolinPlacementFireball:"H-GwendolinPlacementFireball",TowerPropMonkeyVillageGermanyFlag:"TProp-VillageGermanyFlag",TowerEffectAllMonkeysPlacementUpgradesButterflies:"TEAMPU-Butterflies",HeroesChurchillSentaiSkinPetDrone:"H-ChurchillSentaiSkinPetDrone",TowerEffectAllMonkeysPlacementUpgradesBats:"TEAMPU-Bats",TowerProjectileEngineerVampireHunter:"TP-EngineerVampireHunter",TowerPropMonkeyVillageCanadianFlag:"TProp-VillageCanadianFlag",TowerPropMonkeyVillageAustralianFlag:"TProp-VillageAustralianFlag",CoopEmoteAnimationBikerBonesRage:"H-BikerBonesPlacementHellrift",GameUIPowerSkinEnergisingTotemChristmasTree:"PSkin-EnergisingTotemXmasTree",GameUIMusicTrackMusicWinterChilledMix:"UIMusic-WinterChilledMix",HeroesStrikerJonesPetGermanShepherd:"H-StrikerJonesPetGermanShepherd",CoopEmoteAnimationThinkingMonkey:"CE-AnimationThinkingMonkey",GameUIPowerSkinRoadSpikesFlowerPatch:"PSkin-RoadSpikesFlowerPatch",GameUIPowerSkinMonkeyBoostSugarRush:"PSkin-MonkeyBoostSugarRush",GameUIMusicTrackMusicSunshineFiestaMix:"UIMusic-SunshineFiestaMix",GameUIMusicTrackMusicTribesJaloonMix:"UIMusic-TribesJaloonMix",GameUIPowerSkinGlueTrapHoneyTrap:"PSkin-GlueTrapHoneyTrap",GameUIPowerSkinBananaFarmerBananaCostume:"PSkin-BananaFarmerBananaCostume",TowerProjectileBananaFarmPresents:"TP-BananaFarmPresents",TowerProjectileTackShooterIcicles:"TP-TackShooterIcicles",TowerProjectileDartMonkeySnowballs:"TP-DartMonkeySnowballs",TowerProjectileNinjaMonkeySnowflakes:"TP-NinjaMonkeySnowflakes",HeroesStrikerJonesBikerBonesPlacementHellrift:"H-BikerBonesPlacementHellrift",TowerProjectileSniperMonkeyConfetti:"BloonsAllBloonsPopsConfetti",TowerProjectileAlchemistSpringFlowers:"TP-AlchemistSpringFlowers",TowerPropMonkeyVillageSwedenFlag:"TProp-VillageSwedenFlag",HeroesQuincyPlacementSpecialForces:"H-QuincyPlacementSpecialForces",GameUIMusicTrackMusicSunset64Mix:"UIMusic-Sunset64Mix",GameUIMusicTrackMusicFiestaHeliumHeightsMix:"UIMusic-FiestaHeliumHeightsMix",GameUIPowerSkinCamoTrapSprinkler:"PSkin-CamoTrapSprinkler",GameUIMusicTrackMusicTribesFunkedMix:"UIMusic-TribesFunkedMix",GameUIMusicTrackMusicTropicalClassyBrassMix:"UIMusic-TropicalClassyBrassMix",GameUIMusicTrackMusicWinterTonkMix:"UIMusic-WinterTonkMix",HeroesAdmiralBrickellPlacementAerialDeployment:"H-BrickellPlacementAerialDep",TowerProjectileDartMonkeyPumpkins:"TP-DartMonkeyPumpkins",TowerProjectileMonkeyBuccaneerFlavouredTrades:"TP-BuccaneerFlavouredTrades"},knownProblematicMaps=["ZMYVERW","ZMYUWTV","ZMYUDTK","ZMYVPGA","ZMYVPFH","ZMYWHPC"];function getTowerAssetPath(e,t){return"WizardMonkey"==e?`Assets/TowerIcon/${t}-Wizard.webp`:`Assets/TowerIcon/${t}-${e}.webp`}function getInstaContainerIcon(e,t){return"WizardMonkey"==e?`Assets/UI/InstaContainer/${t}-Wizard.webp`:`Assets/UI/InstaContainer/${t}-${e}.webp`}function getInstaMonkeyIcon(e,t){let n=Math.max(t[0],t[1],t[2]);switch(Math.max(t[0],t[1],t[2])){case parseInt(t[0]):n=`${n}00`;break;case parseInt(t[1]):n=`0${n}0`;break;case parseInt(t[2]):n=`00${n}`}return"WizardMonkey"==e?`Assets/InstaMonkeyIcon/${n}-WizardInsta.webp`:`Assets/InstaMonkeyIcon/${n}-${e}Insta.webp`}function getUpgradeAssetPath(e){return e=e.replace(/[^a-zA-Z0-9]/g,""),upgradeNameFixMap[e]?`Assets/UpgradeIcon/${upgradeNameFixMap[e]}UpgradeIcon.webp`:`Assets/UpgradeIcon/${e}UpgradeIcon.webp`}function getKnowledgeAssetPath(e){return"SubAdmiral"==e?"Assets/KnowledgeIcon/NavalUpgradesIcon.webp":`Assets/KnowledgeIcon/${e}Icon.webp`}function getHeroPortrait(e,t){return 1==t?`Assets/Portrait/${e}Portrait.webp`:`Assets/Portrait/${e}PortraitLvl${t}.webp`}function getHeroSquareIcon(e){return`Assets/HeroIconSquare/HeroIcon${e=skinNameFixMap[e]||e}.webp`}function getHeroIconCircle(e){return`Assets/HeroIconCircle/HeroIcon${e=skinNameFixMap[e]||e}.webp`}function getSkinAssetPath(e,t){return e=skinNameFixMap[e]||e,1==t?`Assets/Portrait/${e}Portrait.webp`:`Assets/Portrait/${e}PortraitLvl${t}.webp`}function getMapIcon(e){return void 0===constants.mapsInOrder[e]?"Assets/MapIcon/MapLoadingImage.webp":"#ouch"==e?"Assets/MapIcon/MapSelectouchButton.webp":`Assets/MapIcon/MapSelect${e}Button.webp`}function getPowerIcon(e){return`Assets/PowerIcon/${e}Icon.webp`}function getAchievementIcon(e,t){return t?"Assets/AchievementIcon/HiddenIcon.webp":`Assets/AchievementIcon/${e}Icon.webp`}function fixAchievementName(e){return achievementNameFixMap[e]||e}function getMedalIcon(e){return`Assets/MedalIcon/${e}.webp`}function getModeIcon(e){return`Assets/ModeIcon/${e}Btn.webp`}function getRewardIcon(e){switch(e.type){case"MonkeyMoney":return"Assets/UI/BloonjaminsIcon.webp";case"Power":return getPowerIcon(e.power);case"InstaMonkey":return getInstaMonkeyIcon(e.tower,e.tiers);case"KnowledgePoints":return"Assets/UI/KnowledgeIcon.webp";case"RandomInstaMonkey":return`Assets/UI/InstaRandomTier${0==e.tier?1:e.tier}.webp`;case"Trophy":return"Assets/UI/TrophyIcon.webp";default:return`Assets/UI/${e.value}Icon.webp`}}function getProfileIcon(e){return`Assets/ProfileAvatar/${e}.webp`}function getProfileAvatar(e){if(0==e.avatar)return"Assets/ProfileAvatar/ProfileAvatar01.webp";let t=parseInt(e.avatar.replace(/\D/g,""));return""==e.avatar||isNaN(t)?"Assets/ProfileAvatar/ProfileAvatar01.webp":t<=constants.profileAvatars?`Assets/ProfileAvatar/${e.avatar}.webp`:e.avatarURL}function getProfileBanner(e){if(0==e.banner)return"Assets/ProfileBanner/TeamsBannerDeafult.webp";let t=parseInt(e.banner.replace(/\D/g,""));return""==e.banner||isNaN(t)?"Assets/ProfileBanner/TeamsBannerDeafult.webp":t<=constants.profileBanners?`Assets/ProfileBanner/${e.banner}.webp`:e.bannerURL}function getCustomMapIcon(e){return knownProblematicMaps.includes(e)?`Assets/CustomMapIcon/${e}.webp`:`https://data.ninjakiwi.com/btd6/maps/map/${e}/preview`}function getLocValue(e){return locJSONOverrides[e]?locJSON[locJSONOverrides[e]]:locJSON[e]?locJSON[e]:e}function getCollectionEventSkinIcon(e){if(!e||!e.start||!e.end)return"CollectingEventTotemBtn";const t=new Date(e.start),n=new Date(e.end),a=(e,a)=>{const s=new Date(t.getFullYear(),e-1,a),r=new Date(t.getFullYear()+1,e-1,a);return s>=t&&s<=n||r>=t&&r<=n};return a(12,25)?"CollectingEventChristmasBtn":a(10,31)?"CollectingEventHalloweenBtn":a(7,4)?"CollectingEventFireworksBtn":"CollectingEventTotemBtn"}let teamColors={A:"#9C55E4",B:"#E978AA",C:"#00DD6B",D:"#04A6F3",E:"#F7D302",F:"#F4413F",M:"#B9E546"},bossIDToName={0:"Bloonarius",1:"Lych",2:"Vortex",3:"Dreadbloon",4:"Phayze",5:"Blastapopoulos"};const teamAngles={Purple:270,Pink:330,Green:30,Blue:90,Yellow:150,Red:210};let renderSettings={advancedLayers:!1,filter:"none",backgroundType:"default",selectedTeamRotation:270,searchTerm:"",showIds:!1,renderLayers:{decor:!0,banner:!0,relic:!0,map:!1,boss:!0,gameMode:!1,hero:!1,rounds:!1},roundFilterStart:1,roundFilterEnd:100,heroFilter:"NoFilter",selectedPreset:"default"},filterOptions={none:{label:"No Filter",icon:"/UI/StrikethroughRound"},banner:{label:"Banner Tiles",icon:"/UI/CTPointsBanner"},relic:{label:"Relic Tiles",icon:"/UI/DefaultRelicIcon"},leastCash:{label:"Least Cash Tiles",icon:"/UI/LeastCashIconSmall"},leastTiers:{label:"Least Tiers Tiles",icon:"/UI/LeastTiersIconSmall"},race:{label:"Race Tiles",icon:"/UI/StopWatch"},boss:{label:"Boss Tiles",icon:"/BossIcon/BloonariusPortrait"}},renderPresets={default:{icon:"./Assets/CTMap/PresetDefault.webp",label:"Default",settings:{backgroundType:"default",renderLayers:{decor:!0,banner:!0,relic:!0,map:!1,boss:!0,gameMode:!1,hero:!1,rounds:!1}}},gamemode:{icon:"./Assets/CTMap/PresetGameType.webp",label:"Game Types",settings:{backgroundType:"tileType",renderLayers:{decor:!1,banner:!1,relic:!1,map:!1,boss:!1,gameMode:!0,hero:!1,rounds:!1}}},maps:{icon:"./Assets/CTMap/PresetMapIcon.webp",label:"Maps Background",settings:{backgroundType:"mapIcon",renderLayers:{decor:!1,banner:!1,relic:!1,map:!0,boss:!1,gameMode:!1,hero:!1,rounds:!0}}},heroes:{icon:"./Assets/CTMap/PresetHeroes.webp",label:"Heroes",settings:{backgroundType:"tileType",renderLayers:{decor:!1,banner:!1,relic:!1,map:!1,boss:!1,gameMode:!1,hero:!0,rounds:!0}}}},debugGlobalCTMap=null,selectedCTData=null,teamSelectorButtons=[];async function generateCTs(){let e=document.getElementById("events-content");e.innerHTML="",await getCTSeedToEventNumber(),clearAllTimers(),document.getElementById("loading").style.transform="scale(0)",Object.values(CTData).forEach(((t,n)=>{let a=document.createElement("div");a.classList.add("race-div","ct-div"),a.style.backgroundImage="url(../Assets/ProfileBanner/TeamsBanner8.webp)",e.appendChild(a);let s=document.createElement("div");s.classList.add("ct-info-div"),a.appendChild(s);let r=document.createElement("div");r.classList.add("ct-info-top-div"),s.appendChild(r);let i=document.createElement("div");i.classList.add("ct-info-bottom-div"),s.appendChild(i);let l=CTSeedToEventNumber[t.id]?CTSeedToEventNumber[t.id]:Math.max(...Object.values(CTSeedToEventNumber))+1,o=document.createElement("p");o.classList.add("race-info-name","black-outline"),o.innerHTML="Contested Territory #"+l,r.appendChild(o);let d=document.createElement("p");d.id=`CT-${t.id}-TimeLeft`,d.classList.add("race-time-left","black-outline"),d.innerHTML="Finished",r.appendChild(d),new Date<new Date(t.start)?d.innerHTML="Coming Soon!":new Date(t.end)>new Date?registerTimer(d.id,new Date(t.end)):new Date>new Date(t.end)&&(d.innerHTML="Finished");let c=document.createElement("div");c.classList.add("ct-info-left-div"),i.appendChild(c);let p=document.createElement("p");p.classList.add("race-info-dates","ct-info-dates","black-outline"),p.innerHTML=`${new Date(t.start).toLocaleDateString()} - ${new Date(t.end).toLocaleDateString()}`,c.appendChild(p),tippy(p,{content:`${new Date(t.start).toLocaleString()}<br>${new Date(t.end).toLocaleString()}`,placement:"top",theme:"speech_bubble",allowHTML:!0});let u=createEl("div",{classList:["start-button","currency-trophies-div","black-outline"],style:{width:"200px"},innerHTML:"Event Details"});u.addEventListener("click",(()=>{showLoading(),openCTEventDetails("events",t)})),c.appendChild(u);let h=document.createElement("div");h.classList.add("ct-leaderboards-div"),i.appendChild(h);let m=document.createElement("p");m.classList.add("ct-leaderboards-header","black-outline"),m.innerHTML="Leaderboards",h.appendChild(m);let g=document.createElement("div");g.classList.add("ct-leaderboards-btns"),h.appendChild(g);let b=document.createElement("div");b.classList.add("race-info-leaderboard","ct-info-leaderboard","start-button","blue-btn","black-outline"),b.innerHTML="Players",b.addEventListener("click",(()=>{showLeaderboard("events",t,"CTPlayer")})),g.appendChild(b);let y=document.createElement("div");y.classList.add("race-info-leaderboard","ct-info-leaderboard","start-button","blue-btn","black-outline"),y.innerHTML="Teams",y.addEventListener("click",(()=>{showLeaderboard("events",t,"CTTeam")})),g.appendChild(y);let f=document.createElement("div");f.classList.add("race-info-middle-div","ct-info-middle-div"),h.appendChild(f);let C=document.createElement("p");C.classList.add("race-info-total-scores","black-outline"),C.innerHTML=`Total Scores: ${0==t.totalScores_player?"No Data":t.totalScores_player.toLocaleString()}`,f.appendChild(C);let w=document.createElement("p");w.classList.add("race-info-total-scores","black-outline"),w.innerHTML=`Total Scores: ${0==t.totalScores_team?"No Data":t.totalScores_team.toLocaleString()}`,f.appendChild(w)}));let t=createEl("div",{classList:[],style:{marginTop:"30px",paddingBottom:"30px"}});e.appendChild(t);let n=createEl("p",{classList:["black-outline","ta-center"],innerHTML:"Historic Contested Territory Events",style:{fontSize:"32px",marginBottom:"10px"}});t.appendChild(n);let a=createEl("div",{classList:["d-flex","jc-center","f-wrap"],style:{width:"800px",gap:"18px"}});t.appendChild(a);let s=Object.values(CTData).map((e=>e.id));Object.entries(CTSeedToEventNumber).reverse().forEach((([e,t])=>{if(s.includes(e)||0==t)return;let n=createEl("div",{classList:["start-button","currency-trophies-div","black-outline"],style:{}});a.appendChild(n);let r=createEl("p",{classList:["historic-ct-event-name","black-outline"],innerHTML:`CT #${t}`});n.appendChild(r),n.addEventListener("click",(()=>{showLoading(),openCTEventDetails("events",{id:e,noODA:!0})}))}))}async function openCTEventDetails(e,t){let n=await getExternalCTData(t.id),a=null;t.tiles&&(a=await getCTTiles(t.tiles)),null==a&&(a=convertExtCTDataToODAFormat(n.tiles)),null!=e&&(document.getElementById(`${e}-content`).style.display="none",addToBackQueue({source:e,destination:"relics"}));let s=document.getElementById("relics-content");s.style.display="flex",s.innerHTML="";let r=new Date,i=864e5,l=createEl("div",{classList:["relic-container","ct-panel"],style:{borderRadius:"20px 20px 10px 10px"}});resetScroll();let o=r>=new Date(t.start)&&r<=new Date(t.end),d=createEl("div",{classList:["ct-border","fd-column"]});s.appendChild(d),s.appendChild(l);let c=createEl("div",{classList:["d-flex","jc-center","w-100"]});d.appendChild(c);let p=createEl("div",{classList:["d-flex","jc-between"],style:{padding:"0px 10px",width:"800px"}});c.appendChild(p);let u=createEl("p",{classList:["relic-header-title","black-outline"],innerHTML:"Contested Territory "+(CTSeedToEventNumber[t.id]?"#"+CTSeedToEventNumber[t.id]:"")});if(p.appendChild(u),t.noODA)p.style.width="unset";else{let e=createEl("p",{classList:["relic-header-title","black-outline"],innerHTML:`${`${new Date(t.start).toLocaleDateString()} - ${new Date(t.end).toLocaleDateString()}`}`});p.appendChild(e)}let h=createEl("div",{classList:["d-flex","jc-evenly","w-100"],style:{marginTop:"10px"}});if(n&&d.appendChild(h),!n){let e=createEl("p",{classList:["font-gardenia","ta-center"],style:{fontSize:"24px",marginTop:"10px"},innerHTML:"Additional data coming soon for this event."});d.appendChild(e)}let m={width:"260px"},g=createEl("div",{classList:["d-flex","ai-center"],style:m});h.appendChild(g);let b=createEl("div",{classList:["d-flex","ai-center","jc-center"],style:m});h.appendChild(b);let y=createEl("div",{classList:["d-flex","ai-center","jc-end"],style:m});y.addEventListener("click",(()=>{openCTEventMap("relics",t)})),h.appendChild(y);let f={width:"50px",height:"50px",marginRight:"8px",objectFit:"contain"},C=createEl("img",{classList:["d-flex"],style:f,src:"./Assets/UI/CtTicketsIcon.webp"});g.appendChild(C);let w=createEl("div",{classList:[]});g.appendChild(w);let L=createEl("p",{classList:["black-outline"],innerHTML:"Next Tickets in:"});w.appendChild(L);let v=createEl("p",{classList:["black-outline"],id:"ct-tickets-timer",innerHTML:"--:--:--",style:{fontSize:"28px"}});if(w.appendChild(v),clearAllTimers(),t.noODA)v.innerHTML="Event Ended",L.style.display="none";else if(r>=new Date(new Date(t.end).getTime()-i)&&r<t.end)L.innerHTML="Event Ends In:",registerTimer(v.id,t.end);else if(new Date(t.start)<r&&r<new Date(t.end)){let e=new Date((new Date).setHours(new Date(t.start).getHours(),new Date(t.start).getMinutes(),0,0))>r?new Date((new Date).setHours(new Date(t.start).getHours(),new Date(t.start).getMinutes(),0,0)):new Date((new Date).setHours(new Date(t.start).getHours()+24,new Date(t.start).getMinutes()+13,0,0));registerTimer(v.id,e)}else r>new Date(t.end)?(v.innerHTML="Event Ended",L.style.display="none"):(v.innerHTML="Not Started",L.style.display="none");let E=createEl("img",{classList:[],style:f,src:"./Assets/UI/CTRegularTileIconSmall.webp"});b.appendChild(E);let S=document.createElement("div");S.classList.add("pos-rel"),b.appendChild(S);let x=createEl("input",{classList:["search-box","font-gardenia","rogue-search"],style:{width:"100px",paddingRight:"40px"},placeholder:"Tile Search"}),T=createEl("img",{classList:["pointer"],style:{width:"38px",height:"38px",top:"2px",right:"0px",filter:"grayscale(100%)",position:"absolute",objectFit:"contain"},src:"../Assets/UI/GoBtnSmall.webp"});T.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),3==x.value.length&&(externalCTData[t.id].tiles[x.value]?openTileModal(externalCTData[t.id].tiles[x.value],"relics"):errorModal("Tile not found. Please check your input and try again."))})),S.appendChild(T),x.addEventListener("input",(()=>{x.value=x.value.toUpperCase(),x.value=x.value.replace(/[^A-HMRX0-9]/g,""),x.value.length>3?x.value=x.value.substring(0,3):3===x.value.length?T.style.filter="none":T.style.filter="grayscale(100%)"})),S.appendChild(x);let k=createEl("img",{classList:[],style:f,src:"./Assets/UI/CTTotalTilesIcon.webp"});y.appendChild(k);let M=generateButton("View CT Map",{width:"180px",borderWidth:"10px",fontSize:"22px"},(()=>{}));M.classList.add("start-button"),M.classList.remove("where-button"),y.appendChild(M);let A=a.tiles.filter((e=>e.type.includes("Relic")));A=A.sort(((e,t)=>e.id.localeCompare(t.id))),A=A.map((e=>(e.type=e.type.split(" ")[2],e)));let D=createEl("div",{classList:["relics-div","fd-column"],style:{}});l.appendChild(D);let I=createEl("div",{classList:["d-flex","jc-center"],style:{marginBottom:"10px"}}),F=createEl("div",{classList:["d-flex","ai-center","jc-evenly","f-wrap"],style:{padding:"5px",borderRadius:"10px",backgroundColor:"#4B3B2F"}});null!=n&&(D.appendChild(F),D.appendChild(I));let B=createEl("div",{classList:["d-flex","jc-center","f-wrap"]});D.appendChild(B);let R=externalCTData[t.id]?.event_relics||[],P=[1,3,5];R.forEach(((e,n)=>{let a=createEl("div",{classList:["d-flex","fd-column","ai-center"],style:{width:"180px",borderRadius:"10px",margin:"5px",padding:"5px",backgroundColor:"#4B3B2F"}});I.appendChild(a);let s=createEl("p",{classList:["black-outline"],style:{fontSize:"24px",color:"gold"},innerHTML:`Event Relic ${n+1}`});a.appendChild(s);let i=createEl("img",{classList:[],style:{width:"85px"},src:`./Assets/RelicIcon/${e}.webp`});a.appendChild(i);let l=new Date(new Date(t.start).getTime()+24*P[n]*60*60*1e3),d=createEl("p",{id:`relic-unlock-${n}`,classList:["black-outline","ta-center"],style:{fontSize:"20px"}});r<=l&&o?registerTimer(d.id,l):o?d.innerHTML="Unlocked":d.style.display="none",a.appendChild(d),tippy(a,{content:`<p class="artifact-title">${getLocValue(`Relic${e}`)}</p>${getLocValue(`Relic${e}Description`)}`,allowHTML:!0,placement:"top",hideOnClick:!1,theme:"speech_bubble",popperOptions:{modifiers:[{name:"preventOverflow",options:{boundary:"viewport",padding:{right:18}}}]}})}));let H=externalCTData[t.id]?.daily_powers||[],N={MoabMine:1,MonkeyBoost:2,CamoTrap:1,Techbot:1,RoadSpikes:10,Thrive:2,GlueTrap:2,SuperMonkeyStorm:2};H.forEach(((e,n)=>{let a=createEl("div",{classList:[],style:{}});F.appendChild(a);let s=createEl("p",{classList:["black-outline","ta-center"],style:{fontSize:"28px"},innerHTML:`Day ${n+1}`});a.appendChild(s);let l=createEl("div",{classList:["power-div"],style:{width:"unset",height:"120px",margin:"unset"}});a.appendChild(l);let d=createEl("img",{classList:["power-img"],style:{transform:"scale(0.75)"},src:getPowerIcon("Techbot"===e?"TechBot":e)});l.appendChild(d);let c=createEl("p",{classList:["black-outline"],style:{position:"absolute",right:0,bottom:"0px",fontSize:"28px"},innerHTML:`x${N[e]}`});if(l.appendChild(c),o){let e=new Date(t.start),s=new Date(e.getTime()+n*i),l=createEl("p",{classList:["black-outline","ta-center"],style:{fontSize:"18px"},innerHTML:"--:--:--"});r>=new Date(s.getTime()+i)&&(a.style.filter="grayscale(100%)"),r>=s&&r<new Date(s.getTime()+i)&&(a.style.filter="drop-shadow(0 0 10px #fff)",l.id="current-power-timer",registerTimer(l.id,new Date(s.getTime()+i)),a.appendChild(l))}})),A.forEach((e=>{let a=e.type,s=createEl("div",{classList:["relic-div"],style:{backgroundColor:teamColors[e.id.charAt(0)],outline:"4px solid rgba(255,255,255,0.25)",outlineOffset:"-4px"}});B.appendChild(s);let r=createEl("p",{classList:["relic-id","pointer"],innerHTML:e.id});s.appendChild(r),null!=n&&r.addEventListener("click",(()=>{openTileModal(externalCTData[t.id].tiles[e.id],"relics")}));let i=createEl("img",{classList:["relic-icon"],src:`./Assets/RelicIcon/${a}.webp`});s.appendChild(i),tippy(s,{content:`<p class="artifact-title">${getLocValue(`Relic${a}`)}</p>${getLocValue(`Relic${a}Description`)}`,allowHTML:!0,placement:"top",hideOnClick:!1,theme:"speech_bubble",popperOptions:{modifiers:[{name:"preventOverflow",options:{boundary:"viewport",padding:{right:18}}}]}})}));let O=new Set(A.map((e=>e.type)));constants.relicsInOrder.filter((e=>!O.has(e))).forEach((e=>{let t=createEl("div",{classList:["relic-div"],style:{backgroundColor:"grey",outline:"4px solid rgba(255,255,255,0.25)",outlineOffset:"-4px"}});B.appendChild(t);let n=createEl("p",{classList:["relic-id"],innerHTML:"X"});t.appendChild(n);let a=createEl("img",{classList:["relic-icon"],src:`./Assets/RelicIcon/${e}.webp`});t.appendChild(a),tippy(t,{content:`<p class="artifact-title">${getLocValue(`Relic${e}`)}</p>${getLocValue(`Relic${e}Description`)}`,allowHTML:!0,placement:"top",hideOnClick:!1,theme:"speech_bubble",popperOptions:{modifiers:[{name:"preventOverflow",options:{boundary:"viewport",padding:{right:18}}}]}})}));let G=createEl("div",{classList:["d-flex","jc-center","f-wrap"],style:{marginTop:"20px"}});l.appendChild(G);let $=a.tiles.filter((e=>e.type.includes("Banner")));$=$.sort(((e,t)=>e.id.localeCompare(t.id))),$=$.sort(((e,t)=>e.gameType.localeCompare(t.gameType)));for(let e of $){let a=createEl("div",{classList:["relic-div"],style:{backgroundColor:"#104c93",outline:"4px solid #febe13",outlineOffset:"-4px"}});G.appendChild(a);let s=createEl("p",{classList:["relic-id","pointer"],innerHTML:e.id});a.appendChild(s),null!=n&&s.addEventListener("click",(()=>{openTileModal(externalCTData[t.id].tiles[e.id],"relics")}));let r,i=createEl("div",{classList:["pos-rel"],style:{}});switch(a.appendChild(i),e.gameType){case"LeastCash":r="ChallengeRulesIcon/LeastCashIcon";break;case"LeastTiers":r="ChallengeRulesIcon/LeastTiersIcon";break;case"Race":r="UI/EventRaceBtn";break;case"Boss":r="UI/BossesBtn";break;default:r="UI/CTPointsBanner"}let l=createEl("img",{classList:["relic-icon","pos-rel"],src:`./Assets/${r}.webp`});if(i.appendChild(l),n?.tiles[e.id]&&"Boss"===e.gameType){l.src=`../Assets/BossIcon/${bossIDToName[n.tiles[e.id].GameData.bossData.bossBloon]}EventIcon.webp`;let t=n.tiles[e.id].GameData?.bossData?.TierCount||0;if(t>0){let e=createEl("div",{classList:["pos-rel","d-flex","jc-center","ai-center","font-luckiest","black-outline"],innerHTML:t,style:{position:"absolute",bottom:"2px",right:"2px",width:"36px",height:"36px",backgroundImage:"url(../Assets/UI/BossTiersIconSmall.webp)",backgroundSize:"contain",color:"white",fontSize:"24px"}});i.appendChild(e)}}}}async function openCTEventMap(e,t){document.getElementById(`${e}-content`).style.display="none";let n=document.getElementById("ct-map-content");n.style.display="flex",n.innerHTML="",addToBackQueue({source:e,destination:"ct-map"});let a=await getExternalCTData(t.id);selectedCTData=a;let s=createEl("div",{id:"ct-map-div",style:{width:"100%"}}),r=createEl("div",{classList:["d-flex","jc-between","ai-center","ct-border"],style:{}});n.appendChild(r);let i=createEl("div",{classList:["d-flex","ai-center","jc-center","f-wrap"]});r.appendChild(i);let l=["Purple","Pink","Green","Blue","Yellow","Red"];for(let e of l){let t=createEl("img",{classList:["pointer"],style:{width:"40px",height:"40px",objectFit:"contain",backgroundImage:renderSettings.selectedTeamRotation==teamAngles[e]?'url("../Assets/UI/StatsTabYellow.webp")':'url("../Assets/UI/StatsTabBlue.webp")',backgroundSize:"contain",padding:"8px"},src:`./Assets/UI/TeamTileFlag${e}.webp`});t.addEventListener("click",(()=>{renderSettings.selectedTeamRotation=teamAngles[e],rotateCTTo(s,renderSettings.selectedTeamRotation),i.querySelectorAll("img").forEach((e=>e.style.backgroundImage='url("../Assets/UI/StatsTabBlue.webp")')),t.style.backgroundImage='url("../Assets/UI/StatsTabYellow.webp")',saveLocalStorageCTData()})),i.appendChild(t),teamSelectorButtons.push(t)}let o=createEl("div",{classList:["d-flex"],style:{gap:"12px"}});r.appendChild(o);let d=createEl("div",{classList:["pos-rel"]});o.appendChild(d);let c=createEl("input",{classList:["search-box","font-gardenia","rogue-search"],style:{width:"100px",paddingRight:"40px"},placeholder:"Tile Search"}),p=createEl("img",{classList:["search-icon"],src:"../Assets/UI/SearchIcon.webp",style:{}});d.appendChild(p),d.appendChild(c);let u=createEl("div",{classList:["d-flex","ai-center"]});r.appendChild(u);let h=createEl("div",{classList:["d-flex","ai-center"],style:{fontSize:"24px"}});o.appendChild(h);let m=createEl("p",{classList:["black-outline"],innerHTML:"IDs"});h.appendChild(m);let g=generateToggle(renderSettings.showIds,(e=>{renderSettings.showIds=e,updateCTRenderLayers(s)}));h.appendChild(g);let b=createEl("div",{id:"map-filter-active-div",classList:["d-flex","ai-center"],style:{marginRight:"16px",fontSize:"24px",backgroundColor:"var(--profile-primary)",padding:"8px",gap:"8px",borderRadius:"10px",visibility:"none"==renderSettings.filter?"hidden":"visible"}});u.appendChild(b);let y=createEl("img",{id:"top-bar-filter-icon",classList:["blue-tab-icon","white-outline"],style:{width:"28px",height:"28px",padding:"4px",objectFit:"contain"},src:"./Assets/UI/StrikethroughRound.webp"});b.appendChild(y),y.src="none"!=renderSettings.filter?`./Assets/${filterOptions[renderSettings.filter].icon}.webp`:"./Assets/UI/StrikethroughRound.webp";let f=createEl("p",{classList:["black-outline"],innerHTML:"Filtered"});b.appendChild(f);let C=createEl("img",{classList:["pointer"],style:{width:"32px",height:"32px",objectFit:"contain"},src:"./Assets/UI/CloseBtn.webp"});C.addEventListener("click",(()=>{renderSettings.searchTerm="",c.value="",renderSettings.filter="none",b.style.visibility="hidden",renderSettings.heroFilter="NoFilter",renderSettings.roundFilterStart=1,renderSettings.roundFilterEnd=100,applyCTFilter(s,a),saveLocalStorageCTData()})),b.appendChild(C);let w=createEl("img",{classList:["roundset-settings-btn","pointer"],style:{width:"50px",height:"50px"},src:"../Assets/UI/SettingsBtn.webp"});w.addEventListener("click",(()=>{openCTSettingsModal()})),u.appendChild(w),c.addEventListener("input",(()=>{c.value=c.value.toUpperCase(),c.value=c.value.replace(/[^A-HMRX0-9]/g,""),c.value.length>3&&(c.value=c.value.substring(0,3)),0==c.value.length?renderSettings.filter="none":(renderSettings.filter="search",y.src="./Assets/UI/SearchIcon.webp"),renderSettings.searchTerm=c.value,applyCTFilter(s,a)}));const L=buildCTGrid();let v=createEl("div",{id:"ct-main-div",style:{display:"flex",flexDirection:"column",alignItems:"center",width:"100%"}});n.appendChild(v),v.appendChild(s),debugGlobalCTMap=s,renderCTMap(s,L,a,{size:28}),applyCTFilter(s,a),updateCTBackground(s,a),updateCTRenderLayers(s)}function buildCTGrid(){const e=[{q:1,r:0},{q:1,r:-1},{q:0,r:-1},{q:-1,r:0},{q:-1,r:1},{q:0,r:1}],t=["A","B","C","D","E","F"],n=(e,t)=>`${e},${t}`;function a(t){if(0===t)return[{q:0,r:0}];let n={q:e[0].q*t,r:e[0].r*t};const a=[4,3,2,1,0,5],s=[];for(const r of a)for(let a=0;a<t;a++)s.push({q:n.q,r:n.r}),n={q:n.q+e[r].q,r:n.r+e[r].r};return s}function s(e){if(0===e)return"A";const t=Math.abs(e),n=e>0?2*t-1:2*t;return String.fromCharCode("A".charCodeAt(0)+n)}const r=e=>0===e?0:Math.ceil(e/2)*(e%2?1:-1),i=e=>String.fromCharCode("G".charCodeAt(0)-(e-1)),l=new Map,o=new Map;l.set(n(0,0),"MRX"),o.set("MRX",{q:0,r:0});for(let e=1;e<=7;e++){const d=a(e),c=i(e),p=d.length;for(let a=0;a<6;a++){const i=a*e,u=7===e?e-1:e;for(let h=0;h<u;h++){const u=r(7===e?h+1:h),m=d[(i+u+p)%p],g=s(u);let b=t[a]+g+c;"FAG"===b&&(b="FAH"),l.set(n(m.q,m.r),b),o.set(b,{q:m.q,r:m.r})}}}const d=[];{const e=7,n=a(e);for(let a=0;a<6;a++){const s=n[a*e];d.push({team:t[a],q:s.q,r:s.r})}}const c=new Map;for(const[t,a]of o.entries()){const s=[];for(const t of e){const e=l.get(n(a.q+t.q,a.r+t.r));e&&s.push(e)}c.set(t,s)}return{coordToId:l,idToCoord:o,neighbors:c,spawns:d,cubeDist:(e,t)=>Math.max(Math.abs(e),Math.abs(t),Math.abs(-e-t))}}function renderCTMap(e,t,n,a={}){const s=a.size??28,r=a.gap??2,i=renderSettings.selectedTeamRotation,l=Math.sqrt(3),o=(e,t)=>({x:l*(e+t/2)*-s,y:s*(1.5*t)}),d=(e,t,n)=>{const a=[];for(let s=0;s<6;s++){const r=Math.PI/180*(60*s-30);a.push([e+n*Math.cos(r),t+n*Math.sin(r)])}return a},c=[];for(const[e,n]of t.idToCoord.entries()){const t=o(n.q,n.r);c.push({id:e,q:n.q,r:n.r,x:t.x,y:t.y})}const p=t.spawns.map((e=>{const t=o(e.q,e.r);return{...e,x:t.x,y:t.y}}));let u=1/0,h=1/0,m=-1/0,g=-1/0;const b=s+16;for(const e of[...c,...p])u=Math.min(u,e.x-s),h=Math.min(h,e.y-s),m=Math.max(m,e.x+s),g=Math.max(g,e.y+s);u-=b,h-=b,m+=b,g+=b;const y=(u+m)/2,f=(h+g)/2;e.innerHTML="";const C=document.createElementNS("http://www.w3.org/2000/svg","svg");C.setAttribute("viewBox","-350 -370 700 750"),e.appendChild(C);const w=document.createElementNS(C.namespaceURI,"defs");C.appendChild(w);const L=document.createElementNS(C.namespaceURI,"g");L.setAttribute("transform",`rotate(${i} ${y} ${f})`),L.setAttribute("data-ct-rot","1"),C.appendChild(L);const v=document.createElementNS(C.namespaceURI,"g"),E=document.createElementNS(C.namespaceURI,"g");L.appendChild(v),L.appendChild(E);const S=new Map;let x=new Set;for(const e of c){let t=n.tiles[e.id];const a=s-r,o=d(e.x,e.y,a).map((e=>e.join(","))).join(" "),c=`tile-${e.id}`,p=document.createElementNS(C.namespaceURI,"clipPath");p.setAttribute("id",c),p.setAttribute("clipPathUnits","userSpaceOnUse");const u=document.createElementNS(C.namespaceURI,"polygon");u.setAttribute("points",o),p.appendChild(u),w.appendChild(p);const h=document.createElementNS(C.namespaceURI,"g");h.classList.add("ct-tile","pointer"),h.dataset.id=e.id,v.appendChild(h),h.addEventListener("click",(()=>{openTileModal(t,"ct-map")})),attachTileHoverTippy(h,t);const m=document.createElementNS(C.namespaceURI,"polygon");m.setAttribute("points",o),m.setAttribute("fill","#B9E546"),m.setAttribute("stroke","#000"),m.setAttribute("stroke-width","2"),h.appendChild(m);const g=document.createElementNS(C.namespaceURI,"g");g.classList.add("ct-upright"),g.dataset.cx=e.x,g.dataset.cy=e.y,g.setAttribute("transform",`rotate(${-i} ${e.x} ${e.y})`),h.appendChild(g);const b=document.createElementNS(C.namespaceURI,"g");b.classList.add("ct-layer-bg"),g.appendChild(b);const y=document.createElementNS(C.namespaceURI,"g");y.setAttribute("clip-path","polygon(32.28% 1.59%, 68.34% 1.27%, 86.27% 50%, 68.34% 99%, 32.35% 99%, 14.25% 50%)"),y.classList.add("ct-layer-mapicon"),g.insertBefore(y,b);const f=2*a,L=a*l,E=1.56*L,T=L,k=(e.x-f/1.475).toFixed(2),M=(e.y-L/2).toFixed(2),A=document.createElementNS(C.namespaceURI,"image");A.setAttribute("href",`./Assets/MapIcon/MapSelect${t.GameData.selectedMap}Button.webp`),A.setAttribute("x",k),A.setAttribute("y",M),A.setAttribute("width",E.toFixed(2)),A.setAttribute("height",T.toFixed(2)),A.setAttribute("preserveAspectRatio","none"),A.style.pointerEvents="none",y.appendChild(A);const D=document.createElementNS(C.namespaceURI,"g");if(D.classList.add("ct-layer-decor"),g.appendChild(D),calculateDecorShown(t)){let n=document.createElementNS(C.namespaceURI,"image");n.setAttribute("href",`./Assets/CTMap/${constants.mapsInOrder[t.GameData.selectedMap].theme}.webp`),n.setAttribute("x",(e.x-s).toFixed(2)),n.setAttribute("y",(e.y-s).toFixed(2)),n.setAttribute("width",(2*s).toFixed(2)),n.setAttribute("height",(2*s).toFixed(2)),D.appendChild(n)}const I=document.createElementNS(C.namespaceURI,"g");if(I.classList.add("ct-layer-relic"),g.appendChild(I),"None"!=t.RelicType){let n=document.createElementNS(C.namespaceURI,"image");n.setAttribute("href",`./Assets/RelicIcon/${t.RelicType}.webp`),n.setAttribute("x",(e.x-.625*s).toFixed(2)),n.setAttribute("y",(e.y-.625*s).toFixed(2)),n.setAttribute("width",(1.25*s).toFixed(2)),n.setAttribute("height",(1.25*s).toFixed(2)),I.appendChild(n)}const F=document.createElementNS(C.namespaceURI,"g");if(F.classList.add("ct-layer-banner"),g.appendChild(F),"Banner"===t.TileType){let t=document.createElementNS(C.namespaceURI,"image");t.setAttribute("href","./Assets/UI/CTPointsBanner.webp"),t.setAttribute("x",(e.x-.6*s).toFixed(2)),t.setAttribute("y",(e.y-.6*s).toFixed(2)),t.setAttribute("width",(1.2*s).toFixed(2)),t.setAttribute("height",(1.2*s).toFixed(2)),F.appendChild(t)}const B=document.createElementNS(C.namespaceURI,"g");if(B.classList.add("ct-layer-boss"),4==t.GameData.subGameType){let n=document.createElementNS(C.namespaceURI,"image");n.setAttribute("href",`./Assets/BossIcon/${bossIDToName[t.GameData.bossData.bossBloon]}Portrait.webp`),n.setAttribute("x",(e.x-20).toFixed(2)),n.setAttribute("y",(e.y-25).toFixed(2)),n.setAttribute("width",(.75*s).toFixed(2)),n.setAttribute("height",(.75*s).toFixed(2)),n.style.filter="drop-shadow(0px 0px 2px white)",B.appendChild(n);let a=document.createElementNS(C.namespaceURI,"image");a.setAttribute("href","./Assets/UI/BossTiersIconSmall.webp"),a.setAttribute("x",(e.x+0).toFixed(2)),a.setAttribute("y",(e.y-25).toFixed(2)),a.setAttribute("width",(.7*s).toFixed(2)),a.setAttribute("height",(.7*s).toFixed(2)),B.appendChild(a);let r=document.createElementNS(C.namespaceURI,"text");r.classList.add("font-gardenia"),r.setAttribute("x",(e.x+10).toFixed(2)),r.setAttribute("y",(e.y-12).toFixed(2)),r.setAttribute("text-anchor","middle"),r.setAttribute("font-size",Math.max(10,.4*s)),r.setAttribute("fill","#FFF"),r.setAttribute("paint-order","stroke"),r.setAttribute("stroke","#111"),r.setAttribute("stroke-width","2"),r.textContent=t.GameData.bossData.TierCount,B.appendChild(r)}let R=document.createElementNS(C.namespaceURI,"g");R.classList.add("ct-layer-gamemode"),g.appendChild(R);let P=document.createElementNS(C.namespaceURI,"image"),H=getCTGameTypeIconPath(t);if(P.setAttribute("href",`./Assets/${H}.webp`),P.setAttribute("x",(e.x-.625*s).toFixed(2)),P.setAttribute("y",(e.y-.625*s).toFixed(2)),P.setAttribute("width",(1.25*s).toFixed(2)),P.setAttribute("height",(1.25*s).toFixed(2)),R.appendChild(P),4==t.GameData.subGameType){let n=document.createElementNS(C.namespaceURI,"image");n.setAttribute("href","./Assets/UI/BossTiersIconSmall.webp"),n.setAttribute("x",(e.x+0).toFixed(2)),n.setAttribute("y",(e.y+3).toFixed(2)),n.setAttribute("width",(.65*s).toFixed(2)),n.setAttribute("height",(.65*s).toFixed(2)),R.appendChild(n);let a=document.createElementNS(C.namespaceURI,"text");a.classList.add("font-gardenia"),a.setAttribute("x",(e.x+10).toFixed(2)),a.setAttribute("y",(e.y+16).toFixed(2)),a.setAttribute("text-anchor","middle"),a.setAttribute("font-size",Math.max(10,.4*s)),a.setAttribute("fill","#FFF"),a.setAttribute("paint-order","stroke"),a.setAttribute("stroke","#111"),a.setAttribute("stroke-width","2"),a.textContent=t.GameData.bossData.TierCount,R.appendChild(a)}let N=Object.keys(simplifyTowerData(t.GameData.dcModel).heroes);x=new Set([...x,JSON.stringify(N)]);let O=N&&1==N.length&&"ChosenPrimaryHero"!==N[0]?`/HeroIconCircle/HeroIcon${N[0]}`:0==N.length?"/UI/NoHeroSelected":"/UI/AllHeroesIcon",G=document.createElementNS(C.namespaceURI,"g");G.classList.add("ct-layer-hero"),g.appendChild(G);let $=document.createElementNS(C.namespaceURI,"image");$.setAttribute("href",`./Assets/${O}.webp`),$.setAttribute("x",(e.x-.7*s).toFixed(2)),$.setAttribute("y",(e.y-.7*s).toFixed(2)),$.setAttribute("width",(1.4*s).toFixed(2)),$.setAttribute("height",(1.4*s).toFixed(2)),G.appendChild($),g.appendChild(B);let U=document.createElementNS(C.namespaceURI,"g");U.classList.add("ct-layer-rounds"),g.appendChild(U);let j=`${t.GameData.dcModel.startRules.round}/${t.GameData.dcModel.startRules.endRound}`;-1==t.GameData.dcModel.startRules.endRound&&(j=`${t.GameData.dcModel.startRules.round}/${20+20*t.GameData.bossData.TierCount}+`);let z=document.createElementNS(C.namespaceURI,"text");z.classList.add("font-gardenia","ct-tile-label"),z.setAttribute("x",e.x.toFixed(2)),z.setAttribute("y",(e.y-.3*s).toFixed(2)),z.setAttribute("text-anchor","middle"),z.setAttribute("font-size",Math.max(10,.4*s)),z.setAttribute("fill","#FFF"),z.setAttribute("paint-order","stroke"),z.setAttribute("stroke","#111"),z.setAttribute("stroke-width","2"),z.textContent=j,U.appendChild(z);const q=document.createElementNS(C.namespaceURI,"g");q.classList.add("ct-layer-text"),g.appendChild(q);const _=document.createElementNS(C.namespaceURI,"text");_.classList.add("font-gardenia","ct-tile-label"),_.setAttribute("x",e.x.toFixed(2)),_.setAttribute("y",(e.y+20).toFixed(2)),_.setAttribute("text-anchor","middle"),_.setAttribute("font-size",Math.max(10,.6*s)),_.setAttribute("fill","#FFF"),_.setAttribute("paint-order","stroke"),_.setAttribute("stroke","#111"),_.setAttribute("stroke-width","2"),_.textContent=e.id,q.appendChild(_),S.set(e.id,{gTile:h,gUpright:g,gBg:b,gRelic:I,gBanner:F,gText:q,cx:e.x,cy:e.y,clipId:c,hexS:a,polygon:m,gMapFill:y,gDecor:D,gBoss:B,gGameMode:R,gHero:G,gRoundsText:U})}for(const e of p){const t=s-r,n=d(e.x,e.y,t).map((e=>e.join(","))).join(" "),a=document.createElementNS(C.namespaceURI,"polygon");a.setAttribute("points",n),a.setAttribute("cx",e.x),a.setAttribute("cy",e.y),a.setAttribute("r",.75*(s-r)),a.setAttribute("fill",teamColors[e.team]??"#fff"),a.setAttribute("stroke","white"),a.setAttribute("stroke-width","3");const i=document.createElementNS(C.namespaceURI,"title");i.textContent=`Spawn: ${e.team}`,a.appendChild(i),E.appendChild(a)}e._ct={rotationDeg:i,cx:y,cy:f,gRot:L,size:s,gap:r,tileIndex:S}}function rotateCT(e,t){const n=e?._ct;if(!n)return;const a=((renderSettings.selectedTeamRotation+t)%360+360)%360;renderSettings.selectedTeamRotation=a,n.gRot.setAttribute("transform",`rotate(${a} ${n.cx} ${n.cy})`),e.querySelectorAll(".ct-upright").forEach((e=>{e.setAttribute("transform",`rotate(${-a} ${parseFloat(e.dataset.cx)} ${parseFloat(e.dataset.cy)})`)}))}function rotateCTTo(e,t){const n=e?._ct;n&&rotateCT(e,t-renderSettings.selectedTeamRotation)}function applyCTFilter(e,t){const n=e?._ct;if(!n)return;const a=renderSettings.filter,s=(renderSettings.searchTerm||"").trim().toUpperCase();for(const e of n.tileIndex.values()){let n=e.clipId.replace("tile-","");const r=!s||n.includes(s),i=t.tiles[n];let l=!1;if(l=!!r&&("none"===a||matchesCTFilter(a,i)),l){const{start:e,end:t}=getTileRoundRange(i);t<=renderSettings.roundFilterEnd&&e>=renderSettings.roundFilterStart||(l=!1)}if(l&&"NoFilter"!==renderSettings.heroFilter){const e=Object.keys(simplifyTowerData(i.GameData.dcModel).heroes);console.log(e,e.length,0==e.length),"NoHeroes"===renderSettings.heroFilter?0!==e.length&&(l=!1):"AnyHeroes"===renderSettings.heroFilter?0==e.length&&(l=!1):e.filter((e=>"ChosenPrimaryHero"!==e)).includes(renderSettings.heroFilter)||(l=!1)}l?(e.gTile.style.filter="",e.gTile.style.opacity="1"):(e.gTile.style.filter="grayscale(60%) brightness(0.55)",e.gTile.style.opacity="0.6")}document.getElementById("map-filter-active-div").style.visibility="none"!==a||s?"visible":"hidden"}function matchesCTFilter(e,t){if(!t)return!1;switch(e){case"none":case"search":return!0;case"banner":return"Banner"===t.TileType;case"relic":return"None"!==t.RelicType;case"race":return 2==t.GameData.subGameType;case"leastCash":return 8==t.GameData.subGameType;case"leastTiers":return 9==t.GameData.subGameType;case"boss":return 4==t.GameData.subGameType;default:return!1}}function updateCTBackground(e,t){const n=e?._ct;if(!n)return;const a=renderSettings.backgroundType;for(const[e,s]of n.tileIndex.entries()){const n=t.tiles[e];if(!n)continue;let r="#444";switch(s.gMapFill.style.display="none",s.gDecor.style.display="none",a){case"default":r="#B9E546",s.gDecor.style.display="block";break;case"tileType":switch(n.TileType){case"Relic":r="#D621E7";break;case"Banner":r="#1855A5";break;case"Regular":case"TeamFirstCapture":r="#B9E546";break;default:r="#888888"}break;case"gameType":switch(n.GameData?.subGameType){case 2:r="#E12900";break;case 4:r="#9F00FF";break;case 8:r="#FFCC00";break;case 9:r="#35DA00";break;default:r="#5c6b73"}break;case"mapIcon":s.gMapFill.style.display="block";break;case"nearestTeam":r=teamColors[e.charAt(0)]??"#888";break;default:continue}s.polygon.setAttribute("fill",r)}}function updateCTRenderLayers(e){const t=e?._ct;if(t)for(const e of t.tileIndex.values())e.gBg.style.display=renderSettings.renderLayers.bg?"block":"none",e.gRelic.style.display=renderSettings.renderLayers.relic?"block":"none",e.gBanner.style.display=renderSettings.renderLayers.banner?"block":"none",e.gText.style.display=renderSettings.showIds?"block":"none",e.gDecor.style.display=renderSettings.renderLayers.decor?"block":"none",e.gMapFill.style.display="mapIcon"==renderSettings.backgroundType?"block":"none",e.gBoss.style.display=renderSettings.renderLayers.boss?"block":"none",e.gGameMode.style.display=renderSettings.renderLayers.gameMode?"block":"none",e.gHero.style.display=renderSettings.renderLayers.hero?"block":"none",e.gRoundsText.style.display=renderSettings.renderLayers.rounds?"block":"none"}function openCTSettingsModal(){const e=createEl("div",{style:{display:"flex",flexDirection:"column",gap:"16px",borderRadius:"10px"}}),t=createEl("div",{classList:["d-flex","jc-between"],style:{backgroundColor:"var(--profile-primary)",padding:"8px 16px",borderRadius:"8px"}});e.appendChild(t);const n=createEl("p",{classList:["collection-modal-header-text","black-outline"],innerHTML:"CT Map Settings"});t.appendChild(n);let a=createEl("div",{classList:["d-flex","jc-between","f-wrap","fd-column"],style:{gap:"12px",display:renderSettings.advancedLayers?"none":"flex"}}),s=createEl("div",{classList:["d-flex","jc-between","f-wrap","fd-column"],style:{gap:"12px",display:renderSettings.advancedLayers?"flex":"none"}}),r=createEl("div",{classList:["d-flex","fd-column"],style:{gap:"8px"}});function i(){s.innerHTML="";let e={decor:{label:"Tile Decorations",icon:"CTRegularTileIconSmall"},banner:{label:"Banner Icons",icon:"CTPointsBanner"},relic:{label:"Relic Icons",icon:"DefaultRelicIcon"},gameMode:{label:"Game Mode Icons",icon:"EventRaceBtn"},hero:{label:"Hero Icons",icon:"AllHeroesIcon"},boss:{label:"Small Boss Icons",icon:"BossTiersIconSmall"},rounds:{label:"Rounds Labels",icon:"StartRoundIconSmall"}};for(let[t,n]of Object.entries(e)){let e=createEl("div",{classList:["d-flex","ai-center","jc-between"]}),a=generateToggle(renderSettings.renderLayers[t],(e=>{renderSettings.renderLayers[t]=e,updateCTRenderLayers(debugGlobalCTMap),saveLocalStorageCTData()})),r=createEl("div",{classList:["d-flex","ai-center"]});e.appendChild(r);let i=createEl("img",{classList:["white-outline"],src:`./Assets/UI/${n.icon}.webp`,style:{width:"32px",height:"32px",marginRight:"8px"}});r.appendChild(i);let l=createEl("p",{classList:["black-outline"],style:{fontSize:"24px"},innerHTML:n.label});r.appendChild(l),e.appendChild(a),s.appendChild(e)}let t=createEl("div",{classList:["d-flex","fd-column"],style:{}});s.appendChild(t),t.appendChild(createEl("p",{classList:["black-outline","ta-center"],style:{fontSize:"20px"},innerHTML:"Background Fill"}));let n=createEl("div",{classList:["d-flex"],style:{gap:"8px",marginTop:"12px"}});t.appendChild(n);let a={default:{label:"Default",icon:"BGDefault"},tileType:{label:"Tile Type",icon:"BGTileType"},mapIcon:{label:"Map Icon",icon:"BGMapIcon"},nearestTeam:{label:"Nearest",icon:"BGNearestTeam"}};for(let[e,t]of Object.entries(a)){let a=createEl("div",{classList:["d-flex","ai-center","fd-column","pos-rel","pointer"],style:{}});n.appendChild(a);let s=createEl("img",{classList:["white-outline"],src:`./Assets/CTMap/${t.icon}.webp`,style:{width:"75px",height:"75px"}});a.appendChild(s);let r=createEl("p",{classList:["font-luckiest","black-outline","d-flex","ai-center","pointer"],style:{fontSize:"18px",paddingTop:"4px",color:renderSettings.backgroundType==e?"#4BFF00":"white"},innerHTML:t.label});a.appendChild(r);let i=createEl("img",{classList:["bg-selection-checkmark"],src:"./Assets/UI/SelectedTick.webp",style:{width:"32px",height:"32px",position:"absolute",top:"0px",right:"0px",display:renderSettings.backgroundType==e?"block":"none"}});a.appendChild(i),a.addEventListener("click",(()=>{renderSettings.backgroundType=e,updateCTBackground(debugGlobalCTMap,selectedCTData),n.querySelectorAll(".bg-selection-checkmark").forEach((e=>{e.style.display="none"})),n.querySelectorAll("p").forEach((e=>{e.style.color="white"})),r.style.color="#4BFF00",i.style.display="block",saveLocalStorageCTData()}))}}let l=createEl("div",{classList:["d-flex","ai-center","pointer"],style:{}});t.appendChild(l);let o=createEl("p",{classList:["black-outline"],style:{fontSize:"24px"},innerHTML:"Advanced Mode"});l.appendChild(o);let d=generateToggle(renderSettings.advancedLayers,(e=>{renderSettings.advancedLayers=e,renderSettings.selectedPreset=null,e?(a.style.display="none",s.style.display="flex",r.style.display="flex",i()):(a.style.display="flex",s.style.display="none",r.style.display="none",renderSettings.roundFilterStart=1,renderSettings.roundFilterEnd=100,renderSettings.heroFilter="NoFilter",applyCTFilter(debugGlobalCTMap,selectedCTData)),saveLocalStorageCTData()}));l.appendChild(d);let c=createEl("div",{classList:["d-flex","jc-evenly","f-wrap"],style:{gap:"24px"}});e.appendChild(c);let p=createEl("div",{classList:["d-flex","f-wrap","fd-column"],style:{gap:"12px",width:"350px"}});c.appendChild(p),p.appendChild(createEl("p",{classList:["oak-instructions-header","black-outline"],innerHTML:"Filter Tiles"}));let u=createEl("div",{classList:["d-flex","fd-column","jc-evenly","fg-1"],style:{gap:"8px"}});p.appendChild(u);for(let[e,t]of Object.entries(filterOptions)){let n=createEl("div",{classList:["d-flex","ai-center","jc-between","pointer"],style:{width:"320px"}});u.appendChild(n);let a=createEl("div",{classList:["d-flex","ai-center"]});n.appendChild(a);let s=createEl("img",{classList:["white-outline"],src:`./Assets/${t.icon}.webp`,style:{width:"32px",height:"32px",marginRight:"8px"}});a.appendChild(s);let r=createEl("label",{classList:["font-luckiest","black-outline","d-flex","ai-center","pointer"],style:{color:"white",fontSize:"24px",gap:"8px"},innerHTML:t.label});a.appendChild(r);let i=createEl("img",{classList:["pointer","filter-radio-button"],src:renderSettings.filter==e?"./Assets/UI/BlueBtnCircleSmall.webp":"./Assets/UI/PagePipOff.webp",style:{width:"36px",height:"36px"},value:e,checked:renderSettings.filter===e});n.appendChild(i),n.addEventListener("click",(()=>{document.querySelectorAll(".filter-radio-button").forEach((e=>{e.src="./Assets/UI/PagePipOff.webp"})),i.src="./Assets/UI/BlueBtnCircleSmall.webp",renderSettings.filter=e,applyCTFilter(debugGlobalCTMap,selectedCTData),document.getElementById("top-bar-filter-icon").src=`./Assets/${t.icon}.webp`,saveLocalStorageCTData()}))}r.style.display=renderSettings.advancedLayers?"flex":"none",p.appendChild(r);let h=createEl("div",{classList:["d-flex","fd-column"],style:{gap:"8px",marginTop:"12px"}});r.appendChild(h),h.appendChild(createEl("p",{classList:["black-outline"],style:{fontSize:"20px"},innerHTML:"Advanced Filters"}));let m=createEl("div",{classList:["d-flex","ai-center"]});h.appendChild(m);let g=createEl("img",{classList:["of-contain"],src:"./Assets/UI/StartRoundIconSmall.webp",style:{width:"40px",height:"40px",marginRight:"4px"}});m.appendChild(g);let b=generateNumberInput("Rounds",renderSettings.roundFilterStart,1,100,1,(e=>{renderSettings.roundFilterStart=e,renderSettings.roundFilterStart>renderSettings.roundFilterEnd&&(renderSettings.roundFilterEnd=renderSettings.roundFilterStart),applyCTFilter(debugGlobalCTMap,selectedCTData),saveLocalStorageCTData()}));b.style.flexGrow="1",b.style.width="80px",m.appendChild(b);let y=generateNumberInput("",renderSettings.roundFilterEnd,1,100,1,(e=>{renderSettings.roundFilterEnd=e,renderSettings.roundFilterEnd<renderSettings.roundFilterStart&&(renderSettings.roundFilterStart=renderSettings.roundFilterEnd),applyCTFilter(debugGlobalCTMap,selectedCTData),saveLocalStorageCTData()}));y.style.gap="unset",y.style.width="80px",m.appendChild(y);let f=createEl("div",{classList:["d-flex","ai-center"]});r.appendChild(f);let C=createEl("img",{classList:["of-contain"],style:{width:"40px",height:"40px",marginRight:"4px"}});function w(e){switch(e){case"NoFilter":C.src="./Assets/UI/StrikethroughRound.webp";break;case"NoHeroes":C.src="./Assets/UI/NoHeroSelected.webp";break;case"AnyHeroes":C.src="./Assets/UI/AllHeroesIcon.webp";break;default:C.src=`./Assets/HeroIconCircle/HeroIcon${e}.webp`}}f.appendChild(C),w(renderSettings.heroFilter);let L=generateDropdown("Hero Filter:",["No Filter","No Heroes","Any Heroes",...Object.keys(constants.heroesInOrder).map((e=>getLocValue(e)))],{NoFilter:"No Filter",NoHeroes:"No Heroes",AnyHeroes:"Any Heroes",StrikerJones:"Striker Jones",AdmiralBrickell:"Admiral Brickell",CaptainChurchill:"Captain Churchill",PatFusty:"Pat Fusty",ObynGreenfoot:"Obyn Greenfoot"}[renderSettings.heroFilter]||renderSettings.heroFilter,(e=>{renderSettings.heroFilter=e.replaceAll(" ",""),w(renderSettings.heroFilter),applyCTFilter(debugGlobalCTMap,selectedCTData),saveLocalStorageCTData()}));L.querySelector(".dropdown-label").style.minWidth="110px",L.classList.add("jc-between","w-100"),f.appendChild(L);let v=createEl("div",{classList:["d-flex","f-wrap","fd-column"],style:{gap:"12px",width:"350px"}});c.appendChild(v),v.appendChild(createEl("p",{classList:["oak-instructions-header","black-outline"],innerHTML:"Display Options"})),v.appendChild(s),v.appendChild(a),i();let E=createEl("div",{classList:["d-flex","fd-column"],style:{}});a.appendChild(E),E.appendChild(createEl("p",{classList:["black-outline","ta-center"],style:{fontSize:"20px"},innerHTML:"Layout Presets"}));let S=createEl("div",{classList:["d-flex","f-wrap","jc-between"],style:{width:"330px",gap:"8px",marginTop:"12px"}});E.appendChild(S);for(let[e,t]of Object.entries(renderPresets)){let n=createEl("div",{classList:["d-flex","ai-center","fd-column","pos-rel","pointer"],style:{}});S.appendChild(n);let a=createEl("img",{classList:["white-outline"],src:t.icon,style:{width:"150px",height:"150px"}});n.appendChild(a);let s=createEl("p",{classList:["font-luckiest","black-outline","d-flex","ai-center","pointer"],style:{fontSize:"18px",paddingTop:"4px",color:renderSettings.selectedPreset==e?"#4BFF00":"white"},innerHTML:t.label});n.appendChild(s);let r=createEl("img",{classList:["bg-selection-checkmark"],src:"./Assets/UI/SelectedTick.webp",style:{width:"40px",height:"40px",position:"absolute",top:"2px",right:"4px",display:renderSettings.selectedPreset==e?"block":"none"}});n.appendChild(r),n.addEventListener("click",(()=>{renderSettings.backgroundType=t.settings.backgroundType,renderSettings.renderLayers={...t.settings.renderLayers},updateCTBackground(debugGlobalCTMap,selectedCTData),updateCTRenderLayers(debugGlobalCTMap),S.querySelectorAll(".bg-selection-checkmark").forEach((e=>{e.style.display="none"})),S.querySelectorAll("p").forEach((e=>{e.style.color="white"})),s.style.color="#4BFF00",r.style.display="block",renderSettings.selectedPreset=e,saveLocalStorageCTData()}))}const x=createEl("div",{classList:["d-flex","jc-center"],style:{marginTop:"8px",gap:"10px",padding:"20px"}}),T=createEl("div",{classList:["maps-progress-view","black-outline","pointer"],innerHTML:"Apply",style:{padding:"6px 14px",filter:"hue-rotate(270deg)"}});return T.addEventListener("click",(()=>{closeModal&&closeModal(),goBack()})),x.appendChild(T),e.appendChild(x),createModal({content:e}),e}function simplifyTowerData(e){let t={towers:{},heroes:{},bannedHeroes:[]};for(let n of e.towers._items)0!=n.max?n.isHero?t.heroes[n.tower]=n.max:t.towers[n.tower]=n.max:n.isHero&&"ChosenPrimaryHero"!=n.tower&&t.bannedHeroes.push(n.tower);return t}function getTileRoundRange(e){if(!e?.GameData?.dcModel?.startRules)return{start:0,end:0};const t=e.GameData.dcModel.startRules.round;let n=e.GameData.dcModel.startRules.endRound;if(-1===n){n=20+20*(e.GameData?.bossData?.TierCount??0)}return{start:t,end:n}}function getCTGameTypeIconPath(e){switch(e.GameData.subGameType){case 2:return"/UI/EventRaceBtn";case 4:return`/BossIcon/${bossIDToName[e.GameData.bossData.bossBloon]}EventIcon`;case 8:return"/ChallengeRulesIcon/LeastCashIcon";case 9:return"/ChallengeRulesIcon/LeastTiersIcon"}}function openTileModal(e,t){let n=createEl("div",{classList:["d-flex","fd-column","ct-panel"],style:{borderRadius:"20px 20px 10px 10px",gap:"16px"}}),a=createEl("div",{classList:["d-flex","ai-center","jc-between"],style:{}});n.appendChild(a);let s=createEl("div",{classList:["d-flex"],style:{width:"140px"}});a.appendChild(s);let r=createEl("div",{classList:["d-flex","pos-rel"],style:{}});s.appendChild(r);let i=createEl("img",{classList:["of-contain"],src:`./Assets/${getCTGameTypeIconPath(e)}.webp`,style:{width:"75px",height:"75px"}});if(r.appendChild(i),4==e.GameData.subGameType){let t=createEl("div",{classList:[],style:{position:"absolute",right:"0",bottom:"4px"}});r.appendChild(t);let n=createEl("img",{classList:["of-contain"],src:"./Assets/UI/BossTiersIconSmall.webp",style:{width:"32px",height:"32px"}});t.appendChild(n);let a=createEl("p",{classList:["black-outline"],style:{position:"absolute",top:"4px",left:"10px",fontSize:"24px"},innerHTML:e.GameData.bossData.TierCount});t.appendChild(a)}let l=createEl("div",{classList:["d-flex","fd-column","ai-center"],style:{marginLeft:"16px",gap:"4px"}});a.appendChild(l);let o=null;switch(e.GameData.subGameType){case 2:o="Time Attack";break;case 4:o=`${getLocValue(bossIDToName[e.GameData.bossData.bossBloon])} (${e.GameData.bossData.TierCount} ${e.GameData.bossData.TierCount>1?"Tiers":"Tier"})`;break;case 8:o="Least Cash";break;case 9:o="Least Tiers"}let d=createEl("p",{classList:["black-outline","ta-center"],style:{fontSize:"28px"},innerHTML:`${getLocValue(e.GameData.selectedDifficulty)} - ${getLocValue("Mode "+e.GameData.selectedMode)}<br>${o}`});l.appendChild(d);let c=createEl("div",{classList:["d-flex","jc-end","ai-center"],style:{width:"140px"}});a.appendChild(c);let p=createEl("div",{classList:["d-flex","ai-center"],style:{backgroundColor:"rgba(0,0,0,0.2)",padding:"8px",borderRadius:"10px"}});c.appendChild(p);let u=null;switch(e.TileType){case"Relic":u=`/RelicIcon/${e.RelicType}`;break;case"Banner":u="/UI/CTPointsBanner";break;case"TeamFirstCapture":case"Regular":u="/UI/CTRegularTileIconSmall"}let h=createEl("img",{classList:["of-contain"],src:`./Assets/${u}.webp`,style:{width:"56px",height:"56px"}});p.appendChild(h),"Relic"==e.TileType&&tippy(h,{content:`<p class="artifact-title">${getLocValue(`Relic${e.RelicType}`)}</p>${getLocValue(`Relic${e.RelicType}Description`)}`,allowHTML:!0,placement:"top",hideOnClick:!1,theme:"speech_bubble",zIndex:10001,popperOptions:{modifiers:[{name:"preventOverflow",options:{boundary:"viewport",padding:{right:18}}}]}});let m=createEl("p",{classList:["font-gardenia","ta-center"],style:{fontSize:"28px",padding:"8px"},innerHTML:e.Code});p.appendChild(m);let g=document.createElement("img");g.classList.add("collection-modal-close","pointer"),g.src="./Assets/UI/CloseBtn.webp",g.addEventListener("click",(()=>{goBack(!0)})),c.appendChild(g);let b=createEl("div",{classList:["d-flex","fd-column"],style:{}});n.appendChild(b);let y=createEl("div",{classList:["d-flex"],style:{padding:"5px",borderRadius:"10px",backgroundColor:"#5C4B3E"}});b.appendChild(y);let f=document.createElement("div");f.classList.add("race-map-div","silver-border","h-100"),y.appendChild(f);let C=document.createElement("img");C.classList.add("race-map-img"),C.src=getMapIcon(e.GameData.selectedMap),f.appendChild(C);let w=document.createElement("p");w.classList.add("race-map-rounds","black-outline");let L=getTileRoundRange(e);w.innerHTML=`Rounds: ${L.start}/${L.end+(-1==e.GameData.dcModel.startRules.endRound?"+":"")}`,f.appendChild(w);let v=createEl("div",{classList:["d-flex","fd-column","w-100"],style:{gap:"4px"}});y.appendChild(v);let E=createEl("div",{classList:["d-flex","ai-center","jc-center"],style:{gap:"16px"}});v.appendChild(E);let S={"Starting Cash":{icon:"CoinIcon",value:e.GameData.dcModel.startRules.cash.toLocaleString()},"Starting Lives":{icon:"LivesIcon",value:-1==e.GameData.dcModel.startRules.lives?constants.lives[e.GameData.dcModel.difficulty]:e.GameData.dcModel.startRules.lives},"Max Monkeys":{icon:"MaxMonkeysIcon",value:-1==e.GameData.dcModel.maxTowers?"Unlimited":e.GameData.dcModel.maxTowers.toLocaleString()+" Towers"}};Object.entries(S).forEach((([e,t],n)=>{let a=createEl("div",{classList:["d-flex","ai-center"],style:{gap:"4px"}});E.appendChild(a);let s=createEl("img",{classList:["of-contain"],src:`./Assets/UI/${t.icon}.webp`,style:{width:"32px",height:"32px"}});a.appendChild(s);let r=createEl("p",{classList:["black-outline"],style:{fontSize:"20px"},innerHTML:t.value});a.appendChild(r)}));let x=createEl("div",{classList:["maps-progress-view","black-outline","pointer"],style:{margin:"0",fontSize:"18px",filter:"hue-rotate(270deg)"}});x.innerHTML="Open Rounds",x.addEventListener("click",(n=>{closeModal(),showLoading();let a="DefaultRoundSet";4==e.GameData.subGameType&&(a=bossIDToName[e.GameData.bossData.bossBloon]+"RoundSet");let s=e.GameData.dcModel.startRules.endRound;if(-1==s){s=39+20*(e.GameData?.bossData?.TierCount??0)}showRoundsetModel(t,a,{roundFilterStart:e.GameData.dcModel.startRules.round,roundFilterEnd:s,roundsetStartingCash:e.GameData.dcModel.startRules.cash,roundsetReversed:"Reverse"==e.GameData.dcModel.mode,roundsetShowModified:!1,roundsetShowHints:!1})})),E.appendChild(x);let T=createEl("div",{classList:["d-flex","f-wrap","fg-1","ai-center"],style:{}});v.appendChild(T);let k=challengeModifiersCT(e.GameData.dcModel);if(Object.entries(k).forEach((([e,t])=>{let n=createEl("div",{classList:["challenge-modifier"],style:{margin:"4px 6px",width:"228px"}});T.appendChild(n);let a=createEl("img",{classList:["of-contain"],src:`./Assets/ChallengeRulesIcon/${t.icon}.webp`,style:{width:"60px",height:"60px"}});n.appendChild(a);let s=createEl("div",{classList:["challenge-modifier-texts"]});n.appendChild(s);let r=createEl("p",{classList:["challenge-modifier-text","black-outline"],style:{fontSize:"18px"},innerHTML:`${e}:`});s.appendChild(r);let i=createEl("p",{classList:["black-outline"],style:{fontSize:"20px"},innerHTML:isNaN(t.value)?t.value:`${(100*t.value).toFixed(0)}%`});s.appendChild(i)})),challengeRulesCT(e.GameData).forEach((e=>{let t=createEl("div",{classList:["challenge-modifier"],style:{margin:"4px 6px",width:"228px"}});T.appendChild(t);let n=createEl("img",{classList:["of-contain"],src:`./Assets/ChallengeRulesIcon/${rulesMap[e]}.webp`,style:{width:"60px",height:"60px"}});t.appendChild(n);let a=createEl("div",{classList:["challenge-modifier-texts"]});t.appendChild(a);let s=createEl("p",{classList:["challenge-modifier-text","black-outline"],style:{fontSize:"18px"},innerHTML:e});a.appendChild(s)})),0==T.children.length){let e=createEl("p",{classList:["challenge-modifier-none","w-100"],style:{},innerHTML:"Default Rules & No Modifiers"});T.appendChild(e)}let M=createEl("div",{classList:["d-flex","fd-column"],style:{}});b.appendChild(M);let A=simplifyTowerData(e.GameData.dcModel),D=createEl("div",{classList:["d-flex","fg-1"],style:{marginTop:"12px",padding:"5px",borderRadius:"10px",backgroundColor:"#4B3B2F"}});if(M.appendChild(D),Object.keys(A.heroes).length>0)if(1==Object.keys(A.heroes).length&&A.heroes.hasOwnProperty("ChosenPrimaryHero")||Object.keys(A.heroes).length>1){let e=createEl("div",{classList:["d-flex","ai-center","tower-selector-hero"],style:{width:"90px",height:"108px"}});D.appendChild(e);let t=createEl("img",{classList:["tower-selector-img"],src:"./Assets/UI/AllHeroesIcon.webp",style:{width:"90px"}});e.appendChild(t)}else for(let[e,t]of Object.entries(A.heroes)){let t=createEl("div",{classList:["d-flex","ai-center","tower-selector-hero"],style:{width:"90px",height:"108px"}});D.appendChild(t);let n=createEl("img",{classList:["tower-selector-img"],src:getInstaContainerIcon(e,"000"),style:{width:"90px"}});t.appendChild(n)}for(let[e,t]of Object.entries(A.towers)){let n=createEl("div",{classList:["d-flex","ai-center",`tower-selector-${constants.towersInOrder[e].toLowerCase()}`],style:{width:"90px",height:"108px"}});D.appendChild(n);let a=createEl("img",{classList:["tower-selector-img"],src:getInstaContainerIcon(e,"000"),style:{width:"90px"}});if(n.appendChild(a),-1!=t){let e=createEl("p",{classList:["d-flex","ai-start","max-count","towerTopLeft","towerTopLeftText","black-outline"],style:{width:"40px",height:"40px",fontSize:"24px",lineHeight:"1.5"},innerHTML:t});n.appendChild(e)}}if(Object.keys(A.heroes).length>0&&A.bannedHeroes.length<Object.keys(A.heroes).length){let e=createEl("div",{classList:["d-flex","fg-1","ml-16"],style:{marginTop:"12px",padding:"5px",borderRadius:"10px",backgroundColor:"#4B3B2F"}});M.appendChild(e);for(let t of A.bannedHeroes){let n=createEl("div",{classList:["d-flex","ai-center","tower-selector-hero"],style:{width:"90px",height:"108px"}});e.appendChild(n);let a=createEl("img",{classList:["tower-selector-img"],src:getInstaContainerIcon(t,"000"),style:{width:"90px"}});n.appendChild(a);let s=createEl("p",{classList:["max-count","towerTopLeft","towerExcluded"],style:{width:"40px",height:"40px"}});n.appendChild(s)}}createModal({content:n,backgroundColor:"unset"})}function generateTileHover(e){let t=createEl("div",{classList:["d-flex","fd-column","ct-panel"],style:{borderRadius:"20px 20px 10px 10px",gap:"16px"}}),n=createEl("div",{classList:["d-flex","ai-center","jc-between"],style:{}});t.appendChild(n);let a=createEl("div",{classList:["d-flex"],style:{width:"80px"}});n.appendChild(a);let s=createEl("div",{classList:["d-flex","pos-rel"],style:{}});a.appendChild(s);let r=createEl("img",{classList:["of-contain"],src:`./Assets/${getCTGameTypeIconPath(e)}.webp`,style:{width:"75px",height:"75px"}});if(s.appendChild(r),4==e.GameData.subGameType){let t=createEl("div",{classList:[],style:{position:"absolute",right:"0",bottom:"4px"}});s.appendChild(t);let n=createEl("img",{classList:["of-contain"],src:"./Assets/UI/BossTiersIconSmall.webp",style:{width:"32px",height:"32px"}});t.appendChild(n);let a=createEl("p",{classList:["black-outline"],style:{position:"absolute",top:"4px",left:"10px",fontSize:"24px"},innerHTML:e.GameData.bossData.TierCount});t.appendChild(a)}let i=createEl("div",{classList:["d-flex","fd-column","ai-center"],style:{marginLeft:"16px",gap:"4px"}}),l=createEl("p",{classList:["black-outline","ta-center"],style:{fontSize:"28px"},innerHTML:`${getLocValue(e.GameData.selectedDifficulty)} - ${getLocValue("Mode "+e.GameData.selectedMode)}`});i.appendChild(l);let o=createEl("div",{classList:["d-flex","jc-end","ai-center"],style:{width:"80px"}});n.appendChild(o);let d=createEl("div",{classList:["d-flex","ai-center"],style:{backgroundColor:"rgba(0,0,0,0.2)",padding:"8px",borderRadius:"10px"}});o.appendChild(d);let c=null;switch(e.TileType){case"Relic":c=`/RelicIcon/${e.RelicType}`;break;case"Banner":c="/UI/CTPointsBanner";break;case"TeamFirstCapture":case"Regular":c="/UI/CTRegularTileIconSmall"}let p=createEl("img",{classList:["of-contain"],src:`./Assets/${c}.webp`,style:{width:"70px",height:"70px"}});n.appendChild(p);let u=createEl("p",{classList:["font-gardenia","ta-center"],style:{fontSize:"28px",padding:"8px"},innerHTML:e.Code});d.appendChild(u);let h=createEl("div",{classList:["d-flex","fd-column"],style:{}});t.appendChild(h);let m=createEl("div",{classList:["d-flex","jc-center"],style:{padding:"5px",borderRadius:"10px",backgroundColor:"#5C4B3E"}});h.appendChild(m);let g=document.createElement("div");g.classList.add("race-map-div","silver-border","h-100"),m.appendChild(g);let b=document.createElement("img");b.classList.add("race-map-img"),b.src=getMapIcon(e.GameData.selectedMap),g.appendChild(b);let y=document.createElement("div");y.classList.add("race-challenge-icons"),g.appendChild(y);let f=document.createElement("p");f.classList.add("race-map-rounds","black-outline");let C=getTileRoundRange(e);f.innerHTML=`Rounds: ${C.start}/${C.end+(-1==e.GameData.dcModel.startRules.endRound?"+":"")}`,g.appendChild(f);let w=challengeModifiersCT(e.GameData.dcModel),L=challengeRulesCT(e.GameData);for(let e of Object.values(w)){let t=document.createElement("img");t.style.width="60px",t.style.height="60px",t.src=`./Assets/ChallengeRulesIcon/${e.icon}.webp`,y.appendChild(t)}for(let e of L){let t=document.createElement("img");t.style.width="60px",t.style.height="60px",t.src=`./Assets/ChallengeRulesIcon/${rulesMap[e]}.webp`,y.appendChild(t)}h.appendChild(i);let v=createEl("div",{classList:["d-flex","ai-center","jc-center"],style:{gap:"16px"}});h.appendChild(v);let E={"Starting Cash":{icon:"CoinIcon",value:e.GameData.dcModel.startRules.cash.toLocaleString()},"Starting Lives":{icon:"LivesIcon",value:-1==e.GameData.dcModel.startRules.lives?constants.lives[e.GameData.dcModel.difficulty]:e.GameData.dcModel.startRules.lives},"Max Monkeys":{icon:"MaxMonkeysIcon",value:-1==e.GameData.dcModel.maxTowers?"Unlimited":e.GameData.dcModel.maxTowers.toLocaleString()+" Towers"}};Object.entries(E).forEach((([e,t],n)=>{let a=createEl("div",{classList:["d-flex","ai-center"],style:{gap:"4px"}});v.appendChild(a);let s=createEl("img",{classList:["of-contain"],src:`./Assets/UI/${t.icon}.webp`,style:{width:"32px",height:"32px"}});a.appendChild(s);let r=createEl("p",{classList:["black-outline"],style:{fontSize:"20px"},innerHTML:t.value});a.appendChild(r)}));let S=createEl("div",{classList:["d-flex","fd-column"],style:{}});h.appendChild(S);let x=simplifyTowerData(e.GameData.dcModel),T=createEl("div",{classList:["d-flex","fg-1","f-wrap"],style:{width:"380px",marginTop:"12px",padding:"5px",borderRadius:"10px",backgroundColor:"#4B3B2F"}});if(S.appendChild(T),Object.keys(x.heroes).length>0)if(1==Object.keys(x.heroes).length&&x.heroes.hasOwnProperty("ChosenPrimaryHero")||Object.keys(x.heroes).length>1){let e=createEl("div",{classList:["d-flex","ai-center","tower-selector-hero"],style:{width:"90px",height:"108px"}});T.appendChild(e);let t=createEl("img",{classList:["tower-selector-img"],src:"./Assets/UI/AllHeroesIcon.webp",style:{width:"90px"}});e.appendChild(t)}else for(let[e,t]of Object.entries(x.heroes)){let t=createEl("div",{classList:["d-flex","ai-center","tower-selector-hero"],style:{width:"90px",height:"108px"}});T.appendChild(t);let n=createEl("img",{classList:["tower-selector-img"],src:getInstaContainerIcon(e,"000"),style:{width:"90px"}});t.appendChild(n)}for(let[e,t]of Object.entries(x.towers)){let n=createEl("div",{classList:["d-flex","ai-center",`tower-selector-${constants.towersInOrder[e].toLowerCase()}`],style:{width:"90px",height:"108px"}});T.appendChild(n);let a=createEl("img",{classList:["tower-selector-img"],src:getInstaContainerIcon(e,"000"),style:{width:"90px"}});if(n.appendChild(a),-1!=t){let e=createEl("p",{classList:["d-flex","ai-start","max-count","towerTopLeft","towerTopLeftText","black-outline"],style:{width:"40px",height:"40px",fontSize:"24px",lineHeight:"1.5"},innerHTML:t});n.appendChild(e)}}return t}let once={};function calculateDecorShown(e){if(!e.Code)return!1;if("Water"===constants.mapsInOrder[e.GameData.selectedMap].theme)return!0;class t{constructor(e){this._seedArray=null,this._inext=0,this._inextp=0,this.ensureInitialized(e)}ensureInitialized(e){null===this._seedArray&&this.initialize(e)}initialize(e){const t=new Array(56),n=2147483647;let a;a=-2147483648===e?n:Math.abs(e);let s=161803398-a;t[55]=s;let r=1,i=0;for(let e=1;e<55;e++)i+=21,i>=55&&(i-=55),t[i]=r,r=s-r,r<0&&(r+=n),s=t[i];for(let e=1;e<5;e++)for(let e=1;e<56;e++){let a=e+30;a>=55&&(a-=55),t[e]-=t[1+a],t[e]<0&&(t[e]+=n)}this._seedArray=t,this._inext=0,this._inextp=21}internalSample(){const e=2147483647,t=this._seedArray;let n=this._inext;n++,n>=56&&(n=1);let a=this._inextp;a++,a>=56&&(a=1);let s=t[n]-t[a];return s===e&&s--,s<0&&(s+=e),t[n]=s,this._inext=n,this._inextp=a,s}sample(){return this.internalSample()*(1/2147483647)}}let n=function(e){e=e.toLowerCase().split("").reverse().join("");let t=0;for(let n=0;n<e.length;n++){const a=e[n],s="0123456789abcdefghijklmnopqrstuvwxyz".indexOf(a);if(-1===s)throw new Error(`Invalid character in seed string: ${a}`);t+=s*36**n}for(;t>2147483647;)t=Math.floor(t/10);return t}(selectedCTData.seed),a={MRX:0,DAG:2,DAF:4,DAE:6,DAD:8,DAC:10,DAB:12,DAA:14,AAG:1002,AAF:1004,AAE:1006,AAD:1008,AAC:1010,AAB:1012,AAA:1014,CAG:10001,CBF:10003,DCE:10005,DCD:10007,DCC:10009,DCB:10011,DCA:10013,BAG:11001,ABF:11003,ABE:11005,ABD:11007,ABC:11009,ABB:11011,ABA:11013,BBF:2e4,CAF:20002,CBE:20004,CDD:20006,DEC:20008,DEB:20010,DEA:20012,BAF:21002,BCE:21004,ADD:21006,ADC:21008,ADB:21010,ADA:21012,CCE:30001,CAE:30003,CBD:30005,CDC:30007,CFB:30009,DGA:30011,BBE:31001,BAE:31003,BCD:31005,BEC:31007,AFB:31009,AFA:31011,BDD:4e4,CCD:40002,CAD:40004,CBC:40006,CDB:40008,CFA:40010,BBD:41002,BAD:41004,BCC:41006,BEB:41008,BGA:41010,CEC:50001,CCC:50003,CAC:50005,CBB:50007,CDA:50009,BDC:51001,BBC:51003,BAC:51005,BCB:51007,BEA:51009,BFB:6e4,CEB:60002,CCB:60004,CAB:60006,CBA:60008,BDB:61002,BBB:61004,BAB:61006,BCA:61008,CGA:70001,CEA:70003,CCA:70005,CAA:70007,BFA:71001,BDA:71003,BBA:71005,BAA:71007,EAG:10010001,DBF:10010003,DBE:10010005,DBD:10010007,DBC:10010009,DBB:10010011,DBA:10010013,FAH:10011001,FBF:10011003,ACE:10011005,ACD:10011007,ACC:10011009,ACB:10011011,ACA:10011013,EBF:1002e4,EAF:10020002,ECE:10020004,DDD:10020006,DDC:10020008,DDB:10020010,DDA:10020012,FAF:10021002,FBE:10021004,FDD:10021006,AEC:10021008,AEB:10021010,AEA:10021012,EBE:10030001,EAE:10030003,ECD:10030005,EEC:10030007,DFB:10030009,DFA:10030011,FCE:10031001,FAE:10031003,FBD:10031005,FDC:10031007,FFB:10031009,AGA:10031011,EDD:1004e4,EBD:10040002,EAD:10040004,ECC:10040006,EEB:10040008,EGA:10040010,FCD:10041002,FAD:10041004,FBC:10041006,FDB:10041008,FFA:10041010,EDC:10050001,EBC:10050003,EAC:10050005,ECB:10050007,EEA:10050009,FEC:10051001,FCC:10051003,FAC:10051005,FBB:10051007,FDA:10051009,EFB:1006e4,EDB:10060002,EBB:10060004,EAB:10060006,ECA:10060008,FEB:10061002,FCB:10061004,FAB:10061006,FBA:10061008,EFA:10070001,EDA:10070003,EBA:10070005,EAA:10070007,FGA:10071001,FEA:10071003,FCA:10071005,FAA:10071007}[e.Code]+n,s=new class{constructor(e){this._prng=new t(0|e)}nextDouble(){return this._prng.sample()}next(){return this._prng.internalSample()}}(a),r=s.nextDouble();return once[e.Code]=r,r>.5}function challengeRulesCT(e){let t=[],n=e.dcModel;return n.disableMK&&t.push("Monkey Knowledge Disabled"),1==n.startRules.lives&&t.push("No Lives Lost"),n.disableSelling&&t.push("Selling Disabled"),e.bossData?.TierCount>0&&t.push("Custom Rounds"),t}function challengeModifiersCT(e){let t={};return 1!=e.bloonModifiers.speedMultiplier&&(t["Bloon Speed"]={value:e.bloonModifiers.speedMultiplier,icon:e.bloonModifiers.speedMultiplier>1?"FasterBloonsIcon":"SlowerBloonsIcon"}),1!=e.bloonModifiers.moabSpeedMultiplier&&(t["MOAB Speed"]={value:e.bloonModifiers.moabSpeedMultiplier,icon:e.bloonModifiers.moabSpeedMultiplier>1?"FasterMoabIcon":"SlowerMoabIcon"}),1!=e.bloonModifiers.regrowRateMultiplier&&(t["Regrow Rate"]={value:e.bloonModifiers.regrowRateMultiplier,icon:e.bloonModifiers.regrowRateMultiplier>1?"RegrowRateIncreaseIcon":"RegrowRateDecreaseIcon"}),1!=e.bloonModifiers.healthMultipliers.bloons&&(t["Ceramic Health"]={value:e.bloonModifiers.healthMultipliers.bloons,icon:e.bloonModifiers.healthMultipliers.bloons>1?"CeramicIncreaseHPIcon.webp":"CeramicDecreaseHPIcon"}),1!=e.bloonModifiers.healthMultipliers.moabs&&(t["MOAB Health"]={value:e.bloonModifiers.healthMultipliers.moabs,icon:e.bloonModifiers.healthMultipliers.moabs>1?"MoabBoostIcon":"MoabDecreaseHPIcon"}),t}function attachTileHoverTippy(e,t){tippy(e,{allowHTML:!0,interactive:!1,placement:"top",maxWidth:500,theme:"unset",arrow:!1,touch:!1,onShow(e){e.setContent(generateTileHover(t))},popperOptions:{modifiers:[{name:"preventOverflow",options:{boundary:"viewport",padding:{right:18}}},{name:"flip",options:{fallbackPlacements:["bottom","right","left"],padding:10}}]}})}function convertExtCTDataToODAFormat(e){let t=[];for(let n of Object.values(e)){let e={id:n.Code,type:n.TileType};switch("Relic"===n.TileType&&(e.type=`Relic - ${n.RelicType}`),n.GameData.subGameType){case 2:e.gameType="Race";break;case 8:e.gameType="LeastCash";break;case 9:e.gameType="LeastTiers";break;case 4:e.gameType="Boss"}t.push(e)}return{tiles:t}}function saveLocalStorageCTData(){localStorage.setItem("CTSettings",JSON.stringify(renderSettings))}function loadLocalStorageCTData(){let e=localStorage.getItem("CTSettings");e&&(renderSettings=JSON.parse(e))}loadLocalStorageCTData();let roundPreviewFilterType,currentRoundsetView="Simple",roundsetProcessed=null,selectedRoundset=null,currentPreviewRound=0,currentIndexInModifiedRounds=0,previewActive=!1,previewModified=null,currentModifiedRounds=[],currentRoundsetEndRound=140,hiddenGroups=[],roundsetFilterSettings={},currentRoundsetData=null,bloonToRounds=new Map,roundsetPreviewButton=null;const BloonTraitBits={Camo:1,Regrow:2,Fortified:4,Lead:8,Purple:16,DDT:32,MOABClass:64};function generateRoundsets(){let e=document.getElementById("rounds-content");e.innerHTML="",clearAllTimers();let t=document.createElement("div");t.classList.add("progress-page"),e.appendChild(t);let n=document.createElement("div");n.classList.add("selectors-div"),t.appendChild(n);let a={},s={};Object.entries(constants.limitedTimeEvents).forEach((([e,t])=>{t.end>Date.now()?a[e]=t:s[e]=t})),Object.entries(a).forEach((([e,t])=>{let a=document.createElement("div");a.classList.add("roundset-selector-div","fd-column"),n.appendChild(a);let s=createEl("div",{classList:["d-flex","jc-between","ai-center","w-100"]});a.appendChild(s);let r=createEl("div",{classList:["d-flex"]});a.appendChild(r);let i=document.createElement("img");switch(i.classList.add("roundset-selector-img"),s.appendChild(i),t.type){case"Race":i.src="../Assets/UI/EventRaceBtn.webp",a.classList.add("race-roundset");break;case"Odyssey":i.src="../Assets/UI/OdysseyEventBtn.webp",a.classList.add("odyssey-roundset");break;case"Boss":i.src=`../Assets/BossIcon/${t.boss[0].toUpperCase()+t.boss.slice(1)}EventIcon.webp`,a.style.backgroundImage=`url(../Assets/EventBanner/EventBannerSmall${t.boss[0].toUpperCase()+t.boss.slice(1)}.webp)`,a.classList.add("boss-roundset")}let l=document.createElement("div");l.classList.add("roundset-selector-text-div","w-100"),s.appendChild(l);let o=document.createElement("p");o.classList.add("selector-text","black-outline"),o.innerHTML=`${t.type} Event - ${e}`,l.appendChild(o);let d=document.createElement("div");d.classList.add("d-flex","jc-center","w-100"),l.appendChild(d);let c=document.createElement("p");if(c.id="time-left-"+e,c.classList.add("selector-text","black-outline"),d.appendChild(c),new Date<new Date(t.start)?c.innerHTML="Coming Soon!":new Date(t.end)>new Date&&registerTimer(c.id,new Date(t.end)),t.roundsets)for(const[e,n]of Object.entries(t.roundsets)){let t=createEl("div",{classList:["maps-progress-view","black-outline","pointer"],style:{filter:"hue-rotate(270deg)",padding:"2px 4px",margin:"0 4px"}});t.innerHTML=n,r.appendChild(t),t.addEventListener("click",(()=>{showLoading(),showRoundsetModel("rounds",e)}))}else{let e=document.createElement("img");e.classList.add("selector-go-img"),e.src="../Assets/UI/ContinueBtn.webp",s.appendChild(e),a.addEventListener("click",(()=>{showLoading(),showRoundsetModel("rounds",t.roundset)}))}}));let r=Object.fromEntries(Object.entries(constants.roundSets).filter((([e,t])=>"normal"===t.type))),i=Object.fromEntries(Object.entries(constants.roundSets).filter((([e,t])=>"boss"===t.type))),l=Object.fromEntries(Object.entries(constants.roundSets).filter((([e,t])=>"legends"===t.type))),o=Object.fromEntries(Object.entries(constants.roundSets).filter((([e,t])=>"quest"===t.type)));Object.entries(r).forEach((([e,t])=>{let a=document.createElement("div");a.classList.add("roundset-selector-div","wood-container"),a.addEventListener("click",(()=>{showLoading(),showRoundsetModel("rounds",e)})),n.appendChild(a);let s=document.createElement("img");s.classList.add("roundset-selector-img"),s.src=`../Assets/UI/${t.icon}.webp`,a.appendChild(s);let r=document.createElement("p");r.classList.add("selector-text","black-outline"),r.innerHTML=t.name,a.appendChild(r);let i=document.createElement("img");i.classList.add("selector-go-img"),i.src="../Assets/UI/ContinueBtn.webp",a.appendChild(i)})),Object.entries(l).forEach((([e,t])=>{let a=document.createElement("div");a.classList.add("roundset-selector-div","veteran-container"),a.addEventListener("click",(()=>{showLoading(),showRoundsetModel("rounds",e)})),n.appendChild(a);let s=document.createElement("img");s.classList.add("roundset-selector-img"),s.src=`../Assets/UI/${t.icon}.webp`,a.appendChild(s);let r=document.createElement("p");r.classList.add("selector-text","black-outline"),r.innerHTML=t.name,a.appendChild(r);let i=document.createElement("img");i.classList.add("selector-go-img"),i.src="../Assets/UI/ContinueBtn.webp",a.appendChild(i)}));let d=document.createElement("p");d.classList.add("other-roundsets-selector-text","black-outline"),d.innerHTML="Boss Custom Rounds",n.appendChild(d);let c=document.createElement("div");c.classList.add("other-roundsets-selector-div"),n.appendChild(c),Object.entries(i).forEach((([e,t])=>{let n=document.createElement("div");n.classList.add("other-roundset-selector-div"),n.addEventListener("click",(()=>{showRoundsetModel("rounds",e)})),c.appendChild(n);let a=document.createElement("img");a.classList.add("other-roundset-selector-img"),a.src=`../Assets/UI/${t.icon}.webp`,n.appendChild(a)}));let p=document.createElement("p");p.classList.add("other-roundsets-selector-text","black-outline"),p.innerHTML="Quest Custom Rounds",n.appendChild(p);let u=document.createElement("div");u.classList.add("other-roundsets-selector-div"),n.appendChild(u),Object.entries(o).forEach((([e,t])=>{let n=document.createElement("div");n.classList.add("other-roundset-selector-div"),n.addEventListener("click",(()=>{showRoundsetModel("rounds",t.roundset?t.roundset:e)})),u.appendChild(n);let a=document.createElement("p");a.classList.add("other-roundset-selector-text","black-outline");let s=e.match(/(Part|Stage)(\d+)/i);!s&&t.part&&(s=[e,"Part",t.part]),null!=s&&(a.innerHTML=`${s[1]} ${s[2]}`,n.appendChild(a));let r=document.createElement("img");r.classList.add("other-roundset-selector-img"),r.src=`../Assets/QuestIcon/${t.icon}.webp`,n.appendChild(r)}));let h=document.createElement("div");h.classList.add("known-previous-events-div"),n.appendChild(h);let m=document.createElement("p");m.classList.add("other-roundsets-selector-text","black-outline"),m.innerHTML="Known Previous Events",h.appendChild(m),Object.entries(s).forEach((([e,t])=>{let a=document.createElement("div");a.classList.add("roundset-selector-div","fd-column"),n.appendChild(a);let s=createEl("div",{classList:["d-flex","jc-between","ai-center","w-100"]});a.appendChild(s);let r=createEl("div",{classList:["d-flex"]});a.appendChild(r);let i=document.createElement("img");switch(i.classList.add("roundset-selector-img"),s.appendChild(i),t.type){case"Race":i.src="../Assets/UI/EventRaceBtn.webp",a.classList.add("race-roundset");break;case"Odyssey":i.src="../Assets/UI/OdysseyEventBtn.webp",a.classList.add("odyssey-roundset");break;case"Boss":i.src=`../Assets/BossIcon/${t.boss[0].toUpperCase()+t.boss.slice(1)}EventIcon.webp`,a.style.backgroundImage=`url(../Assets/EventBanner/EventBannerSmall${t.boss[0].toUpperCase()+t.boss.slice(1)}.webp)`,a.classList.add("boss-roundset")}let l=document.createElement("div");l.classList.add("roundset-selector-text-div"),s.appendChild(l);let o=document.createElement("p");o.classList.add("selector-text","black-outline"),o.innerHTML=`${t.type} Event - ${e}`,l.appendChild(o);let d=document.createElement("div");d.classList.add("d-flex","jc-center","w-100"),l.appendChild(d);let c=document.createElement("p");if(c.id="time-left-"+e,c.classList.add("selector-text","black-outline"),d.appendChild(c),new Date<new Date(t.start)?c.innerHTML="Coming Soon!":new Date(t.end)>new Date?registerTimer(c.id,new Date(t.end)):c.innerHTML=`${new Date(t.start).toLocaleDateString()} - ${new Date(t.end).toLocaleDateString()}`,t.hasOwnProperty("roundsets"))for(const[e,n]of Object.entries(t.roundsets)){let t=createEl("div",{classList:["maps-progress-view","black-outline","pointer"],style:{filter:"hue-rotate(270deg)",padding:"2px 4px",margin:"0 4px"}});t.innerHTML=n,r.appendChild(t),t.addEventListener("click",(()=>{showLoading(),showRoundsetModel("rounds",e)}))}else{let e=document.createElement("img");e.classList.add("selector-go-img"),e.src="../Assets/UI/ContinueBtn.webp",s.appendChild(e),a.addEventListener("click",(()=>{showLoading(),showRoundsetModel("rounds",t.roundset)}))}}));let g=document.createElement("div");g.classList.add("sku-roundset-selector-div"),n.appendChild(g);let b=document.createElement("p");b.classList.add("other-roundsets-selector-text","black-outline"),b.innerHTML="Other Custom Rounds",g.appendChild(b);let y=document.createElement("p");y.classList.add("sku-roundset-selector-desc"),y.innerHTML="These mostly old roundsets will have only been used in one-off events such as Odysseys, Races, or Bosses and may not have ended up being used for their intended purpose despite their name. Take these roundsets with a grain of salt. I'm including them on the viewer for completeness sake.",g.appendChild(y);let f=document.createElement("div");f.classList.add("sku-roundsets-selector-div"),g.appendChild(f),constants.skuRoundsets.forEach((e=>{let t=document.createElement("div");t.classList.add("sku-roundset-selector-div"),t.addEventListener("click",(()=>{showRoundsetModel("rounds",e)})),f.appendChild(t);let n=document.createElement("p");n.classList.add("sku-roundset-selector-text","black-outline"),n.innerHTML=e,t.appendChild(n)}))}async function showRoundsetModel(e,t,n={}){roundsetProcessed=null,currentRoundsetData=null,roundsetFilterSettings={roundFilterStart:1,roundFilterEnd:null,roundsetStartingCash:650,roundFilterPreset:"All",roundsetReversed:!1,roundsetHideUnused:!0,roundsetShowModified:!0,roundsetFilteredBloons:[],roundsetAdvancedFilterMode:!1,roundsetBasicFilter:null,roundsetAdvancedFilterLogic:"ANY",roundsetShowHints:!0},Object.keys(n).length>0&&Object.entries(n).forEach((([e,t])=>{roundsetFilterSettings[e]=t}));let a=document.getElementById("roundsets-content");a.style.display="flex",a.innerHTML="",document.getElementById(`${e}-content`).style.display="none",addToBackQueue({source:e,destination:"roundsets"}),resetScroll();let s=await fetch(`./data/${t}.json`).then((e=>e.json())),r="unknown";constants.roundSets[t]&&(r=constants.roundSets[t].type),currentRoundsetData=processRoundset(t,s),null===roundsetFilterSettings.roundFilterEnd&&(roundsetFilterSettings.roundFilterEnd=Math.max(...currentRoundsetData.rounds.map((e=>e.roundNumber)))),selectedRoundset=t;let i=document.createElement("div");i.classList.add("roundset-header-bar"),a.appendChild(i);let l=document.createElement("div");l.classList.add("roundset-header-title"),i.appendChild(l);let o=document.createElement("div");o.classList.add("roundset-header-left"),l.appendChild(o);let d=createEl("img",{classList:["roundset-settings-btn","pointer"],style:{width:"50px",height:"50px"},src:"../Assets/UI/SettingsBtn.webp"});d.addEventListener("click",(()=>{openRoundsetSettingsModal(r)})),o.appendChild(d);let c=document.createElement("p");c.classList.add("roundset-header-text","black-outline"),c.innerHTML=constants.roundSets[t]?constants.roundSets[t].name:t,l.appendChild(c);let p=document.createElement("div");p.classList.add("roundset-header-right"),l.appendChild(p);let u=document.createElement("img");if(u.classList.add("modal-close"),u.src="./Assets/UI/CloseBtn.webp",u.addEventListener("click",(()=>{goBack()})),p.appendChild(u),t.startsWith("Rogue")){let n=document.createElement("div");n.classList.add("d-flex","jc-evenly"),i.appendChild(n);let a={RogueRoundSet:"Rogue Legends Default Roundset",RogueBloonierSet:"Now with more Bloons!",RogueDenseSet:"Bloons spawn more densely",RoguePinkSet:"Bloons start fast and end slow",RoguePurpleSet:"More Purples and faster Bloons. Bloon health is reduced",RogueImmuneSet:"Alternate rounds with more Bloons with immunities",RogueLeadSet:"More Lead Bloons and DDTs"};Object.entries(a).forEach((([a,s])=>{let r=document.createElement("div");r.classList.add("pointer"),r.addEventListener("click",(()=>{showLoading(),goBack(),showRoundsetModel(e,a)})),n.appendChild(r),a==t&&r.classList.add("rogue-roundset-selector-active");let i=document.createElement("img");i.classList.add("roundset-header-rogue-img"),i.style.width="100px",i.src=`../Assets/UI/${a}.webp`,r.appendChild(i),tippy(r,{content:s,placement:"top",theme:"speech_bubble",popperOptions:{modifiers:[{name:"preventOverflow",options:{boundary:"viewport",padding:{right:18}}}]}})}))}let h=document.createElement("div");h.classList.add("roundset-header-bar-bottom"),i.appendChild(h);let m=document.createElement("div");m.classList.add("maps-progress-views"),h.appendChild(m);let g=document.createElement("p");g.classList.add("maps-progress-coop-toggle-text","maps-progress-view-list","black-outline"),g.innerHTML="Display Type:",m.appendChild(g);let b=document.createElement("div");b.classList.add("maps-progress-view","stats-tab-yellow","black-outline"),b.innerHTML="Simple",m.appendChild(b);let y=document.createElement("div");y.classList.add("maps-progress-view","black-outline"),y.innerHTML="Detailed",m.appendChild(y);let f=document.createElement("div");f.classList.add("maps-progress-view","black-outline"),f.innerHTML="Preview",m.appendChild(f),roundsetPreviewButton=f;let C=document.createElement("div");C.classList.add("maps-progress-views");let w=document.createElement("p");w.classList.add("maps-progress-coop-toggle-text","black-outline"),w.id="rounds-shown-label",w.innerHTML="",C.appendChild(w);let L=document.createElement("div");L.classList.add("maps-progress-view","black-outline","pointer"),L.innerHTML="Clear Filters",L.id="clear-filters-btn",L.style.display="none",L.addEventListener("click",(()=>{roundsetFilterSettings.roundFilterStart=1,roundsetFilterSettings.roundFilterEnd=currentRoundsetData.rounds[currentRoundsetData.rounds.length-1].roundNumber,roundsetFilterSettings.roundFilterPreset="All",roundsetFilterSettings.roundsetBasicFilter=null,roundsetFilterSettings.roundsetFilteredBloons=[],roundsetFilterSettings.roundsetAdvancedFilterMode=!1,roundsetFilterSettings.roundsetAdvancedFilterLogic="ANY",roundsetFilterSettings.roundsetReversed=!1,roundsetFilterSettings.roundsetHideUnused=!0,roundsetFilterSettings.roundsetShowModified=!1,applyRoundFilters(r),generateRounds(currentRoundsetView,roundsetFilterSettings.roundsetReversed,r)})),C.appendChild(L),h.appendChild(C);let v=document.createElement("div");v.id="roundset-content",v.classList.add("rounds-content"),a.appendChild(v),b.addEventListener("click",(()=>{b.classList.add("stats-tab-yellow"),y.classList.remove("stats-tab-yellow"),f.classList.remove("stats-tab-yellow"),currentRoundsetView="Simple",generateRounds(currentRoundsetView,roundsetFilterSettings.roundsetReversed,r)})),y.addEventListener("click",(()=>{y.classList.add("stats-tab-yellow"),b.classList.remove("stats-tab-yellow"),f.classList.remove("stats-tab-yellow"),currentRoundsetView="Topper",generateRounds(currentRoundsetView,roundsetFilterSettings.roundsetReversed,r)})),f.addEventListener("click",(()=>{f.classList.add("stats-tab-yellow"),b.classList.remove("stats-tab-yellow"),y.classList.remove("stats-tab-yellow"),currentRoundsetView="Preview",generateRounds(currentRoundsetView,roundsetFilterSettings.roundsetReversed,r)})),currentPreviewRound=0,currentRoundsetView="Simple",generateRounds(currentRoundsetView,roundsetFilterSettings.roundsetReversed,r),updateRoundsShownLabel()}function processRoundset(e,t){const n=["Moab","Bfb","Zomg","Ddt","Bad"];let a=JSON.parse(JSON.stringify(t));a=addRoundHints(e,a);let s=0,r=0;return a.rounds.forEach((e=>{let t=0;e.bloonGroups.forEach((a=>{const s=a.bloon.toLowerCase();s.includes("camo")&&(t|=BloonTraitBits.Camo),s.includes("regrow")&&(t|=BloonTraitBits.Regrow),s.includes("fortified")&&(t|=BloonTraitBits.Fortified),s.includes("lead")&&(t|=BloonTraitBits.Lead),s.includes("purple")&&(t|=BloonTraitBits.Purple),s.includes("ddt")?t|=BloonTraitBits.DDT|BloonTraitBits.MOABClass:n.some((e=>a.bloon.includes(e)))&&(t|=BloonTraitBits.MOABClass),bloonToRounds.has(a.bloon)||bloonToRounds.set(a.bloon,new Set),bloonToRounds.get(a.bloon).add(e.roundNumber)})),e.traitMask=t,"number"==typeof e.income&&(s+=e.income,e.incomeSum=s),"number"==typeof e.rbe&&(r+=e.rbe,e.rbeSum=r)})),a}function applyRoundFilters(e){if(!currentRoundsetData)return;const t=roundsetFilterSettings.roundFilterEnd??currentRoundsetData.rounds[currentRoundsetData.rounds.length-1].roundNumber;let n=JSON.parse(JSON.stringify(currentRoundsetData));n.rounds=n.rounds.filter((e=>e.roundNumber>=roundsetFilterSettings.roundFilterStart&&e.roundNumber<=t));let a=roundsetFilterSettings.roundsetStartingCash,s=0;if(n.rounds.forEach((e=>{roundsetFilterSettings.roundsetReversed?e.bloonGroups.sort(((e,t)=>e.end-t.end)):e.bloonGroups.sort(((e,t)=>e.start-t.start)),"number"==typeof e.income&&(a+=e.income,e.incomeSum=a),"number"==typeof e.rbe&&(s+=e.rbe,e.rbeSum=s)})),null!=e)switch(e){case"quest":if(roundsetFilterSettings.roundsetHideUnused){let e=constants.roundSets[selectedRoundset].endRound;n.rounds=n.rounds.filter((t=>t.roundNumber<=e))}break;case"boss":if(roundsetFilterSettings.roundsetShowModified){let e=constants.roundSets[selectedRoundset].modifiedRounds;n.rounds=n.rounds.filter((t=>e.includes(t.roundNumber)))}}let r=0;switch(roundsetFilterSettings.roundsetBasicFilter){case"Any Camo":r|=BloonTraitBits.Camo;break;case"Any Regrow":r|=BloonTraitBits.Regrow;break;case"Any Fortified":r|=BloonTraitBits.Fortified;break;case"Lead & DDT":r|=BloonTraitBits.Lead|BloonTraitBits.DDT;break;case"Purple":r|=BloonTraitBits.Purple;break;case"MOAB-Class":r|=BloonTraitBits.MOABClass}if(0!==r&&(n.rounds=n.rounds.filter((e=>!!(e.traitMask&r)))),roundsetFilterSettings.roundsetFilteredBloons.length>0){let e=roundsetFilterSettings.roundsetFilteredBloons.map((e=>bloonToRounds.get(e))).filter((e=>e&&e.size>0));if(0===e.length)n.rounds=[];else if("COMBO"===roundsetFilterSettings.roundsetAdvancedFilterLogic){e.sort(((e,t)=>e.size-t.size));let t=new Set(e[0]);for(let n=1;n<e.length;n++){for(let a of Array.from(t))e[n].has(a)||t.delete(a);if(0===t.size)break}n.rounds=n.rounds.filter((e=>t.has(e.roundNumber)))}else{let t=new Set;e.forEach((e=>e.forEach((e=>t.add(e))))),n.rounds=n.rounds.filter((e=>t.has(e.roundNumber)))}}roundsetProcessed=n;const i=document.getElementById("clear-filters-btn");i&&(i.style.display=isFiltersActive()?"":"none"),updateRoundsShownLabel()}function addRoundHints(e,t){return["DefaultRoundSet","AlternateRoundSet","RogueRoundSet"].includes(e)&&t.rounds.forEach(((t,n)=>{switch(e){case"DefaultRoundSet":constants.roundHints.hasOwnProperty("Hint "+(t.roundNumber-1))&&(t.hint=constants.roundHints["Hint "+(t.roundNumber-1)]);break;case"AlternateRoundSet":constants.roundHints.hasOwnProperty("Alternate Hint "+(t.roundNumber-1))&&(t.hint=constants.roundHints["Alternate Hint "+(t.roundNumber-1)]);break;case"RogueRoundSet":constants.roundHints.hasOwnProperty("Rogue Hint "+(t.roundNumber-1))&&(t.hint=constants.roundHints["Rogue Hint "+(t.roundNumber-1)])}})),t}async function generateRounds(e,t,n,a={}){let s=document.getElementById("roundset-content");s.innerHTML="",!roundsetProcessed&&currentRoundsetData&&applyRoundFilters(n);let r=roundsetProcessed.rounds.every(((e,t,n)=>0===t||e.roundNumber===n[t-1].roundNumber+1));switch(e){case"Simple":if(resetPreview(),"boss"===n&&roundsetFilterSettings.roundsetShowModified){let e={BloonariusRoundSet:"Bloonarius Changes: Only rounds that the boss spawns from are changed. They now spawn Bloons that are one tier lower than normal with 10 seconds of delay.",LychRoundSet:"Lych Changes: Rounds 40 to 48 have extra MOABs added in for Lych to resurrect when hitting a skull. Rounds that Lych spawns from are changed to spawn Bloons that are one tier lower than normal with 10 seconds of delay.",VortexRoundSet:"Vortex Changes: A small group of rounds have Bloons upgraded to speedier ones as well as adding some extra faster bloons. Rounds that Vortex spawns from are changed to spawn Bloons that are one tier lower than normal with 10 seconds of delay.",DreadbloonRoundSet:"Dreadbloon Changes: In general summary, Zebra -> Lead, Lead -> Fortified Lead, Rainbow -> Ceramic, Ceramic -> Fortified Ceramic. After Round 50, every other Blue MOAB is fortified, and after round 70 all Blue MOABs are fortified. There are some exceptions. Rounds that Dreadbloon spawns from are changed to spawn Bloons that are one tier lower than normal with 10 seconds of delay.",PhayzeRoundSet:"Phayze Changes: Only rounds that the boss spawns from are changed. They now spawn Bloons that are one tier lower than normal with 10 seconds of delay.",BlastapopoulosRoundSet:"Blastapopoulos Changes: Only rounds that the boss spawns from are changed. They now spawn Bloons that are one tier lower than normal with 10 seconds of delay."};const t=document.createElement("div");t.classList.add("disclaimer-div");const n=document.createElement("p");n.classList.add("disclaimer"),n.style.fontSize="24px",n.style.padding="1rem",n.style.lineHeight="1.5",n.innerHTML='Showing modified rounds. Disable "Only Modified" in Roundset Settings to show all rounds.<br>'+e[selectedRoundset],t.appendChild(n),s.appendChild(t)}let e=!1;roundsetProcessed.rounds.forEach((async(t,n)=>{let a=document.createElement("div");a.id=`round-${t.roundNumber}`,a.classList.add("round-div","jc-between"),e&&a.classList.add("round-div-alt");let r=document.createElement("p");r.classList.add("round-number","black-outline","pointer"),r.innerHTML=t.roundNumber,r.addEventListener("click",(()=>{currentPreviewRound=indexOfRoundNumberOrNearest(t.roundNumber),currentRoundsetView="Preview",roundsetPreviewButton.click()})),a.appendChild(r);let i=document.createElement("div");i.id=`round-${t.roundNumber}-groups`,i.classList.add("round-bloon-groups","fg-1"),a.appendChild(i);let l=document.createDocumentFragment();t.bloonGroups.sort(((e,t)=>e.start-t.start)).forEach(((e,t)=>{let n=document.createElement("div");n.classList.add("bloon-group-div");let a=document.createElement("p");a.classList.add("bloon-group-number","black-outline"),a.innerHTML="x"+e.count,n.appendChild(a);let s=document.createElement("img");s.classList.add("bloon-group-bloon"),s.src=`../Assets/BloonIcon/${e.bloon}.webp`,s.loading="lazy",n.appendChild(s),l.appendChild(n)})),i.appendChild(l);let o=document.createElement("div");o.classList.add("d-flex","ai-center"),o.style.minWidth="120px",a.appendChild(o);let d=document.createElement("img");d.classList.add("leaderboard-entry-score-icon"),d.src="./Assets/UI/StopWatch.webp",o.appendChild(d);let c=document.createElement("p");c.classList.add("round-number","black-outline");let p=t.bloonGroups.length?Math.max(...t.bloonGroups.map((e=>e.end))):0;c.innerHTML=p.toFixed(2),o.appendChild(c),s.appendChild(a),isRoundInFilter(t.roundNumber)?(e&&a.classList.add("round-div-alt"),e=!e):a.style.display="none"})),roundsetFilterSettings.roundsetReversed&&onChangeReverse();break;case"Topper":resetPreview();let a=document.createElement("div");a.classList.add("rounds-detailed-div"),s.appendChild(a),copyLoadingIcon(a),setTimeout((()=>{let e=document.createDocumentFragment(),n=document.createElement("div");n.classList.add("disclaimer-div"),e.appendChild(n);let s=document.createElement("p");s.classList.add("disclaimer"),s.innerHTML="This layout is based on Topper's website:",n.appendChild(s);let i=document.createElement("a");i.classList.add("disclaimer-link"),i.href="https://topper64.co.uk/nk/btd6/rounds/",i.target="_blank",i.innerHTML="Topper's Round Information",n.appendChild(i);roundsetProcessed.rounds.forEach((async(n,a)=>{if(!isRoundInFilter(n.roundNumber))return;let s=document.createElement("div");s.id=`round-${n.roundNumber}`,s.classList.add("round-div-detailed"),t&&s.classList.add("round-div-reverse");let i=document.createElement("div");i.classList.add("rounds-div-header"),s.appendChild(i);let l=document.createElement("p");l.classList.add("round-number","round-number-detailed","black-outline","pointer"),l.innerHTML=`Round ${n.roundNumber}`,l.addEventListener("click",(()=>{currentPreviewRound=indexOfRoundNumberOrNearest(n.roundNumber),currentRoundsetView="Preview",roundsetPreviewButton.click()})),i.appendChild(l);let o=document.createElement("div");o.classList.add("income-div"),i.appendChild(o);let d=document.createElement("img");d.classList.add("income-img"),d.src="../Assets/UI/CoinIcon.webp",o.appendChild(d);let c=document.createElement("div");c.classList.add("income-text-div"),o.appendChild(c);let p=document.createElement("p");p.classList.add("round-income","black-outline"),p.innerHTML=`Income: ${n.income.toLocaleString()}`,c.appendChild(p);let u=document.createElement("p");u.classList.add("round-income-total","black-outline"),u.innerHTML=`Total: ${n.incomeSum.toLocaleString()}`,r&&c.appendChild(u);let h=document.createElement("div");h.classList.add("rbe-div"),i.appendChild(h);let m=document.createElement("img");m.classList.add("rbe-img"),m.src="../Assets/BloonIcon/Red.webp",h.appendChild(m);let g=document.createElement("div");g.classList.add("rbe-text-div"),h.appendChild(g);let b=document.createElement("p");b.classList.add("round-rbe","black-outline"),b.innerHTML=`RBE: ${n.rbe.toLocaleString()}`,g.appendChild(b);let y=document.createElement("p");y.classList.add("round-rbe-total","black-outline"),y.innerHTML=`Total: ${n.rbeSum.toLocaleString()}`,r&&g.appendChild(y);let f=n.bloonGroups.length?Math.max(...n.bloonGroups.map((e=>e.end))):0,C=document.createElement("p");if(C.classList.add("round-duration","black-outline"),C.innerHTML=`Duration: ${f.toFixed(2)}s`,i.appendChild(C),n.hint&&roundsetFilterSettings.roundsetShowHints){let e=document.createElement("div");e.classList.add("round-hint-div","coop-border"),s.appendChild(e);let t=document.createElement("p");t.classList.add("round-hint-x"),t.innerHTML="X",t.addEventListener("click",(()=>{e.style.display="none"})),e.appendChild(t);let a=document.createElement("p");a.classList.add("round-hint"),a.innerHTML=n.hint,e.appendChild(a)}let w=document.createElement("div");w.classList.add("timeline-div"),s.appendChild(w),n.bloonGroups.forEach(((e,t)=>{let n=document.createElement("div");n.classList.add("bloon-group-div-detailed"),w.appendChild(n);let a=document.createElement("div");a.classList.add("left-div"),n.appendChild(a);let s=document.createElement("img");s.classList.add("bloon-image"),s.src=`../Assets/BloonIcon/${e.bloon}.webp`,a.appendChild(s);let r=document.createElement("p");r.classList.add("bloon-count","black-outline"),r.innerHTML="x"+e.count,a.appendChild(r);let i=document.createElement("div");i.classList.add("timeline-right-div"),n.appendChild(i);let l=document.createElement("div");l.classList.add("bloon-bar"),i.appendChild(l);let o=document.createElement("div");o.classList.add("bloon-bar-fill"),o.style.background=bloonsData[e.bloon.replace("Camo","").replace("Regrow","").replace("Fortified","")].color,e.bloon.includes("Rainbow")||(o.style.border=`4px solid ${bloonsData[e.bloon.replace("Camo","").replace("Regrow","").replace("Fortified","")].border}`),tippy(o,{content:`${e.start.toFixed(2)}s - ${e.end.toFixed(2)}s`,placement:"top",theme:"speech_bubble",popperOptions:{modifiers:[{name:"preventOverflow",options:{boundary:"viewport",padding:{right:18}}}]}});let d=(e.end-e.start)/f*100,c=e.start/f*100;d<5&&(d=5),c+d>100&&(c=100-d),o.style.width=`${d}%`,o.style.left=`${c}%`,l.appendChild(o)})),e.appendChild(s)})),a.innerHTML="",a.appendChild(e),roundsetFilterSettings.roundsetReversed&&onChangeReverse()}),0);break;case"Preview":resetPreview(),null==roundsetProcessed.rounds[currentPreviewRound]&&(currentPreviewRound=0),(roundsetProcessed.rounds[currentPreviewRound].roundNumber<roundsetFilterSettings.roundFilterStart||roundsetProcessed.rounds[currentPreviewRound].roundNumber>roundsetFilterSettings.roundFilterEnd)&&(currentPreviewRound=Math.max(0,roundsetFilterSettings.roundFilterStart-1));let i=document.createElement("div");i.classList.add("preview-container-div"),s.appendChild(i);let l=document.createElement("div");l.classList.add("preview-div"),i.appendChild(l);let o=document.createElement("div");o.classList.add("preview-header"),l.appendChild(o);let d=document.createElement("p");d.id="round-number-preview",d.classList.add("round-number","round-number-preview","black-outline"),d.innerHTML=`Round ${roundsetProcessed.rounds[currentPreviewRound].roundNumber}`,o.appendChild(d);let c=document.createElement("input");c.id="select-round-num-preview",c.classList.add("select-round-num"),c.type="number",c.min=1,c.max=roundsetFilterSettings.roundFilterEnd,c.value=roundsetProcessed.rounds[currentPreviewRound].roundNumber,c.addEventListener("change",(()=>{let e=parseInt(c.value);e<roundsetFilterSettings.roundFilterStart&&(e=roundsetFilterSettings.roundFilterStart),e>roundsetFilterSettings.roundFilterEnd&&(e=roundsetFilterSettings.roundFilterEnd),c.value=e,currentPreviewRound=indexOfRoundNumberOrNearest(e),d.innerHTML=`Round ${roundsetProcessed.rounds[currentPreviewRound].roundNumber}`,updatePreviewRoundTimeline()})),o.appendChild(c);let p=document.createElement("div");p.classList.add("preview-right-div");let u=document.createElement("img");u.classList.add("clear-button"),u.src="../Assets/UI/DestroyBloonsBtn.webp",u.addEventListener("click",(()=>{clearPreview()})),p.appendChild(u);let h=document.createElement("img");h.classList.add("play-normal-button"),h.src="../Assets/UI/GoBtnSmall.webp",h.addEventListener("click",(()=>{speedMultiplier=1,d.innerHTML=`Round ${roundsetProcessed.rounds[currentPreviewRound].roundNumber}`,clearPreview(),startRound(roundsetProcessed.rounds[currentPreviewRound])})),p.appendChild(h);let m=document.createElement("img");m.classList.add("play-fast-button"),m.src="../Assets/UI/FastForwardBtn.webp",m.addEventListener("click",(()=>{speedMultiplier=3,d.innerHTML=`Round ${roundsetProcessed.rounds[currentPreviewRound].roundNumber}`,clearPreview(),startRound(roundsetProcessed.rounds[currentPreviewRound])})),p.appendChild(m),canvas=document.createElement("canvas"),canvas.classList.add("roundset-canvas"),canvas.width=800,canvas.height=300,l.appendChild(canvas);let g=document.createElement("div");g.classList.add("preview-footer-div","ai-center"),l.appendChild(g);let b=document.createElement("div");b.classList.add("d-flex","ai-center"),g.appendChild(b);let y=createEl("p",{classList:["black-outline"],innerHTML:"Bloon Speed:",style:{fontSize:"28px"}});b.appendChild(y);let f=document.createElement("div");f.classList.add("maps-progress-view","stats-tab-yellow","black-outline"),f.innerHTML="Easy",b.appendChild(f);let C=document.createElement("div");C.classList.add("maps-progress-view","black-outline"),C.innerHTML="Medium",b.appendChild(C);let w=document.createElement("div");switch(w.classList.add("maps-progress-view","black-outline"),w.innerHTML="Hard",b.appendChild(w),f.addEventListener("click",(()=>{difficultySpeedModifier=1,f.classList.add("stats-tab-yellow"),C.classList.remove("stats-tab-yellow"),w.classList.remove("stats-tab-yellow")})),C.addEventListener("click",(()=>{difficultySpeedModifier=1.1,f.classList.remove("stats-tab-yellow"),C.classList.add("stats-tab-yellow"),w.classList.remove("stats-tab-yellow")})),w.addEventListener("click",(()=>{difficultySpeedModifier=1.26,f.classList.remove("stats-tab-yellow"),C.classList.remove("stats-tab-yellow"),w.classList.add("stats-tab-yellow")})),selectedRoundset){case"AlternateRoundSet":w.click();break;case"AcceleratedRoundSet":case"EnduranceRoundSet":case"FastUpgradesRoundSet":case"MOABMadnessRoundSet":case"RogueRoundSet":case"RogueBloonierSet":case"RogueDenseSet":case"RoguePinkSet":case"RoguePurpleSet":case"RogueImmuneSet":case"RogueLeadSet":C.click()}let L=document.createElement("div");L.classList.add("next-prev-div"),o.appendChild(L),g.appendChild(p);let v=document.createElement("div");v.classList.add("maps-progress-view","black-outline"),v.innerHTML="Previous",v.addEventListener("click",(()=>{null!=previewModified&&previewModified.checked?(currentIndexInModifiedRounds--,currentIndexInModifiedRounds<0&&(currentIndexInModifiedRounds=currentModifiedRounds.length-1),currentPreviewRound=currentModifiedRounds[currentIndexInModifiedRounds]-1):(currentPreviewRound--,currentPreviewRound<0&&(currentPreviewRound=roundsetProcessed.rounds.length-1)),c.value=roundsetProcessed.rounds[currentPreviewRound].roundNumber,clearPreview(),updatePreviewRoundTimeline()})),L.appendChild(v);let E=document.createElement("div");E.classList.add("maps-progress-view","black-outline"),E.innerHTML="Next",E.addEventListener("click",(()=>{null!=previewModified&&previewModified.checked?(currentIndexInModifiedRounds++,currentIndexInModifiedRounds>=currentModifiedRounds.length&&(currentIndexInModifiedRounds=0),currentPreviewRound=currentModifiedRounds[currentIndexInModifiedRounds]-1):(currentPreviewRound++,currentPreviewRound>=roundsetProcessed.rounds.length&&(currentPreviewRound=0)),c.value=roundsetProcessed.rounds[currentPreviewRound].roundNumber,clearPreview(),updatePreviewRoundTimeline()})),L.appendChild(E);let S=document.createElement("div");S.id="preview-round-info-div",S.classList.add("round-info-div"),l.appendChild(S),ctx=canvas.getContext("2d"),startPreviewLoop(),updatePreviewRoundTimeline()}}function onChangeReverse(){switch(currentRoundsetView){case"Simple":roundsetProcessed.rounds.forEach(((e,t)=>{let n=document.getElementById(`round-${e.roundNumber}-groups`);Array.from(n.children).reverse().forEach((e=>n.appendChild(e)))}));break;case"Topper":let e=document.getElementsByClassName("timeline-div");for(let t of e)t.classList.toggle("timeline-div-reverse");let t=document.getElementsByClassName("timeline-right-div");for(let e of t)e.classList.toggle("flip-horizontal");break;case"Preview":document.getElementById("preview-timeline-div").classList.toggle("timeline-div-reverse");let n=document.getElementsByClassName("preview-timeline-right-div");for(let e of n)e.classList.toggle("flip-horizontal")}clearPreview()}function updatePreviewRoundTimeline(){let e=document.getElementById("preview-round-info-div");e.innerHTML="";let t=roundsetProcessed.rounds[currentPreviewRound];hiddenGroups=[];let n=document.createElement("div");n.classList.add("round-div-detailed"),e.appendChild(n);let a=document.createElement("div");a.classList.add("rounds-div-header"),n.appendChild(a);let s=document.createElement("p");s.classList.add("round-number","round-number-detailed","black-outline"),s.innerHTML=`Round ${t.roundNumber}`,a.appendChild(s);let r=document.createElement("div");r.classList.add("income-div"),a.appendChild(r);let i=document.createElement("img");i.classList.add("income-img"),i.src="../Assets/UI/CoinIcon.webp",r.appendChild(i);let l=document.createElement("div");l.classList.add("income-text-div"),r.appendChild(l);let o=document.createElement("p");o.classList.add("round-income","black-outline"),o.innerHTML=`Income: ${t.income.toLocaleString()}`,l.appendChild(o);let d=document.createElement("p");d.classList.add("round-income-total","black-outline"),d.innerHTML=`Total: ${t.incomeSum.toLocaleString()}`,l.appendChild(d);let c=document.createElement("div");c.classList.add("rbe-div"),a.appendChild(c);let p=document.createElement("img");p.classList.add("rbe-img"),p.src="../Assets/BloonIcon/Red.webp",c.appendChild(p);let u=document.createElement("div");u.classList.add("rbe-text-div"),c.appendChild(u);let h=document.createElement("p");h.classList.add("round-rbe","black-outline"),h.innerHTML=`RBE: ${t.rbe.toLocaleString()}`,u.appendChild(h);let m=document.createElement("p");m.classList.add("round-rbe-total","black-outline"),m.innerHTML=`Total: ${t.rbeSum.toLocaleString()}`,u.appendChild(m);let g=t.bloonGroups.length?Math.max(...t.bloonGroups.map((e=>e.end))):0,b=document.createElement("p");if(b.classList.add("round-duration","black-outline"),b.innerHTML=`Duration: ${g.toFixed(2)}s`,a.appendChild(b),t.hint&&roundsetFilterSettings.roundsetShowHints){let e=document.createElement("div");e.classList.add("round-hint-div","coop-border"),n.appendChild(e);let a=document.createElement("p");a.classList.add("round-hint-x"),a.innerHTML="X",a.addEventListener("click",(()=>{e.style.display="none"})),e.appendChild(a);let s=document.createElement("p");s.classList.add("round-hint"),s.innerHTML=t.hint,e.appendChild(s)}let y=document.createElement("div");y.id="preview-timeline-div",y.classList.add("timeline-div"),n.appendChild(y);t.bloonGroups.forEach(((e,t)=>{let n=document.createElement("div");n.classList.add("bloon-group-div-detailed"),n.addEventListener("click",(()=>{hiddenGroups.includes(t)?(n.style.filter="",hiddenGroups.splice(hiddenGroups.indexOf(t),1)):(hiddenGroups.push(t),n.style.filter="brightness(0.5)")})),y.appendChild(n);let a=document.createElement("div");a.classList.add("left-div"),n.appendChild(a);let s=document.createElement("img");s.classList.add("bloon-image"),s.src=`../Assets/BloonIcon/${e.bloon}.webp`,a.appendChild(s);let r=document.createElement("p");r.classList.add("bloon-count","black-outline"),r.innerHTML="x"+e.count,a.appendChild(r);let i=document.createElement("div");i.classList.add("timeline-right-div","preview-timeline-right-div"),n.appendChild(i);let l=document.createElement("div");l.classList.add("bloon-bar"),i.appendChild(l);let o=document.createElement("div");o.classList.add("bloon-bar-fill"),o.style.background=bloonsData[e.bloon.replace("Camo","").replace("Regrow","").replace("Fortified","")].color,e.bloon.includes("Rainbow")||(o.style.border=`4px solid ${bloonsData[e.bloon.replace("Camo","").replace("Regrow","").replace("Fortified","")].border}`),tippy(o,{content:`${e.start.toFixed(2)}s - ${e.end.toFixed(2)}s`,placement:"top",theme:"speech_bubble",popperOptions:{modifiers:[{name:"preventOverflow",options:{boundary:"viewport",padding:{right:18}}}]}});let d=(e.end-e.start)/g*100,c=e.start/g*100;d<5&&(d=5),c+d>100&&(c=100-d),o.style.width=`${d}%`,o.style.left=`${c}%`,l.appendChild(o)})),roundsetFilterSettings.roundsetReversed&&onChangeReverse()}function addTimelinePlayhead(e){let t=document.getElementById("preview-timeline-div"),n=document.createElement("div");n.id="preview-playhead",n.classList.add("playhead"),t.appendChild(n),n.style.animation=`playhead ${e}s linear`,n.addEventListener("animationend",(function(){n.remove()}))}function clearPreview(){document.getElementById("preview-playhead")&&document.getElementById("preview-playhead").remove(),currentRoundGroups=null,bloons.length=0}function openRoundsetSettingsModal(e){if(!roundsetProcessed)return;null===roundsetFilterSettings.roundFilterEnd&&(roundsetFilterSettings.roundFilterEnd=roundsetProcessed.rounds[roundsetProcessed.rounds.length-1].roundNumber);const t=createEl("div",{style:{padding:"16px",display:"flex",flexDirection:"column",gap:"16px"}});let n=createEl("div",{classList:["d-flex","ai-center","jc-between"],style:{gap:"8px"}});t.appendChild(n);let a=createEl("div",{classList:["d-flex"],style:{gap:"8px",flexDirection:"column"}});n.appendChild(a);let s=createEl("div",{classList:["d-flex","ai-center","jc-center"],style:{gap:"8px",flexWrap:"wrap",width:"55%"}}),r=currentRoundsetData.rounds[0].roundNumber,i=currentRoundsetData.rounds[currentRoundsetData.rounds.length-1].roundNumber,l=createEl("div",{classList:["d-flex","ai-center"]});a.appendChild(l);let o=createEl("img",{classList:["of-contain"],src:"./Assets/UI/StartRoundIconSmall.webp",style:{width:"40px",height:"40px",marginRight:"4px"}});l.appendChild(o);let d=generateNumberInput("Start Round",roundsetFilterSettings.roundFilterStart,r,i,1,(e=>{roundsetFilterSettings.roundFilterStart=e,s.querySelectorAll("div").forEach((e=>e.classList.remove("stats-tab-yellow")))}));l.appendChild(d);let c=createEl("div",{classList:["d-flex","ai-center"]});a.appendChild(c);let p=createEl("img",{classList:["of-contain"],src:"./Assets/UI/EndRoundIconSmall.webp",style:{width:"40px",height:"40px",marginRight:"4px"}});c.appendChild(p);let u=generateNumberInput("End Round",roundsetFilterSettings.roundFilterEnd,r,i,1,(e=>{roundsetFilterSettings.roundFilterEnd=e,s.querySelectorAll("div").forEach((e=>e.classList.remove("stats-tab-yellow")))}));if(u.style.flexGrow="1",c.appendChild(u),"DefaultRoundSet"===selectedRoundset){["All","Easy","Medium","Hard","Impoppable","CHIMPS"].forEach((e=>{const t=generateSelectorTab(e,e===roundsetFilterSettings.roundFilterPreset);t.addEventListener("click",(()=>{switch(roundsetFilterSettings.roundFilterPreset=e,Array.from(s.children).forEach((e=>e.classList.remove("stats-tab-yellow"))),t.classList.add("stats-tab-yellow"),e){case"All":roundsetFilterSettings.roundFilterStart=1,roundsetFilterSettings.roundFilterEnd=i;break;case"Easy":roundsetFilterSettings.roundFilterStart=1,roundsetFilterSettings.roundFilterEnd=Math.min(40,i);break;case"Medium":roundsetFilterSettings.roundFilterStart=1,roundsetFilterSettings.roundFilterEnd=Math.min(60,i);break;case"Hard":roundsetFilterSettings.roundFilterStart=3,roundsetFilterSettings.roundFilterEnd=Math.min(80,i);break;case"Impoppable":case"CHIMPS":roundsetFilterSettings.roundFilterStart=6,roundsetFilterSettings.roundFilterEnd=Math.min(100,i)}const n=d.querySelector("input"),a=u.querySelector("input");n&&(n.value=roundsetFilterSettings.roundFilterStart),a&&roundsetFilterSettings.roundFilterEnd&&(a.value=roundsetFilterSettings.roundFilterEnd)})),s.appendChild(t)})),n.appendChild(s)}else a.style.flexDirection="row",a.style.gap="50px";let h=createEl("p",{classList:["font-gardenia"],style:{fontSize:"22px",display:selectedRoundset.startsWith("Rogue")&&roundsetFilterSettings.roundsetReversed?"block":"none"},innerHTML:"In Rogue Legends, the rounds are not reversed even when the track path is."}),m=createEl("div",{classList:["d-flex"]});t.appendChild(m);let g=createEl("div",{classList:["d-flex","ai-center"]});m.appendChild(g);let b=createEl("img",{classList:["of-contain"],src:"./Assets/UI/CoinIcon.webp",style:{width:"40px",height:"40px",marginRight:"4px"}});g.appendChild(b);let y=generateNumberInput("Starting Cash",roundsetFilterSettings.roundsetStartingCash,0,99999999,50,(e=>{roundsetFilterSettings.roundsetStartingCash=e}));g.appendChild(y);let f=generateCheckbox("Reverse Mode",roundsetFilterSettings.roundsetReversed,(e=>{roundsetFilterSettings.roundsetReversed=e,h.style.display=selectedRoundset.startsWith("Rogue")&&e?"block":"none"}));if(m.appendChild(f),"quest"===e){let e=generateCheckbox("Hide Unused",roundsetFilterSettings.roundsetHideUnused,(e=>{roundsetFilterSettings.roundsetHideUnused=e}));m.appendChild(e),m.classList.add("jc-between")}else if("boss"===e){let e=generateCheckbox("Only Modified",roundsetFilterSettings.roundsetShowModified,(e=>{roundsetFilterSettings.roundsetShowModified=e}));m.appendChild(e),m.classList.add("jc-between")}else if("DefaultRoundSet"===selectedRoundset||selectedRoundset.startsWith("Rogue")){let e=generateCheckbox("Round Hints",roundsetFilterSettings.roundsetShowHints,(e=>{roundsetFilterSettings.roundsetShowHints=e}));m.appendChild(e),m.classList.add("jc-between")}else m.style.gap="32px";t.appendChild(h);let C=createEl("div",{classList:["d-flex","ai-center","jc-between"],style:{gap:"8px"}});t.appendChild(C);let w=createEl("p",{classList:["dropdown-label","black-outline"],innerHTML:"Filter by Bloons"});C.appendChild(w);let L=createEl("div",{classList:["d-flex","ai-center"],style:{gap:"6px",display:roundsetFilterSettings.roundsetAdvancedFilterMode?"flex":"none"}});C.appendChild(L);let v=createEl("p",{classList:["black-outline"],style:{fontSize:"24px"},innerHTML:"Logic:"});L.appendChild(v);const E=e=>{let t=createEl("div",{classList:["maps-progress-view","black-outline","pointer"],innerHTML:e});return roundsetFilterSettings.roundsetAdvancedFilterLogic===e&&t.classList.add("stats-tab-yellow"),t.addEventListener("click",(()=>{roundsetFilterSettings.roundsetAdvancedFilterLogic!==e&&(roundsetFilterSettings.roundsetAdvancedFilterLogic=e,Array.from(L.querySelectorAll(".maps-progress-view")).forEach((e=>e.classList.remove("stats-tab-yellow"))),t.classList.add("stats-tab-yellow"))})),t};L.appendChild(E("ANY")),L.appendChild(E("COMBO"));let S=createEl("div",{classList:["tooltip-container","d-flex","ai-center"],style:{gap:"8px"}});C.appendChild(S);let x=createEl("p",{classList:["black-outline"],style:{fontSize:"24px"},innerHTML:"Advanced"});S.appendChild(x);let T=generateToggle(roundsetFilterSettings.roundsetAdvancedFilterMode,(e=>{roundsetFilterSettings.roundsetAdvancedFilterMode=e,roundsetFilterSettings.roundsetBasicFilter=null,roundsetFilterSettings.roundsetFilteredBloons=[],L.style.display=e?"flex":"none",F()}));S.appendChild(T);let k=createEl("div",{classList:["d-flex","ai-center","jc-start"],style:{gap:"8px"}});t.appendChild(k);let M=createEl("div",{classList:["d-flex","jc-center"],style:{gap:"6px",flexWrap:"wrap"}});k.appendChild(M);let A=["Red","Blue","Green","Yellow","Pink","Black","White","Purple","Lead","Zebra","Rainbow","Ceramic"],D=["Moab","Bfb","Zomg","DdtCamo","Bad"];const I=e=>{let t=createEl("div",{classList:["pointer"],style:{backgroundImage:"url(../Assets/UI/StatsTabBlue.webp)",backgroundSize:"contain",width:"60px",height:"60px"}}),n=createEl("img",{classList:["bloon-filter-img"],style:{width:"50px",height:"50px",padding:"5px",objectFit:"contain"},src:`../Assets/BloonIcon/${e}.webp`});return t.appendChild(n),roundsetFilterSettings.roundsetFilteredBloons.includes(e)&&(t.style.backgroundImage="url(../Assets/UI/StatsTabYellow.webp)"),t.addEventListener("click",(()=>{let n=roundsetFilterSettings.roundsetFilteredBloons;n.includes(e)?(roundsetFilterSettings.roundsetFilteredBloons=n.filter((t=>t!==e)),t.style.backgroundImage="url(../Assets/UI/StatsTabBlue.webp)"):(n.push(e),t.style.backgroundImage="url(../Assets/UI/StatsTabYellow.webp)")})),t};function F(){if(M.innerHTML="",roundsetFilterSettings.roundsetAdvancedFilterMode){let e=[];A.forEach((t=>{e.push(t,`${t}Regrow`,`${t}Camo`,`${t}RegrowCamo`)}));let t=D.map((e=>`${e}Fortified`));t[3]="DdtFortifiedCamo";let n=["LeadFortified","LeadFortifiedCamo","CeramicFortified","CeramicFortifiedCamo",...D],a=["LeadRegrowFortified","LeadRegrowFortifiedCamo","CeramicRegrowFortified","CeramicRegrowFortifiedCamo",...t],s=createEl("div",{classList:["d-flex","ai-center"],style:{gap:"6px",flexWrap:"wrap",width:"530px"}});e.forEach((e=>s.appendChild(I(e)))),M.appendChild(s);let r=createEl("div",{classList:["d-flex","ai-center","jc-center"],style:{gap:"6px",flexWrap:"wrap"}}),i=createEl("div",{classList:["d-flex","ai-center"],style:{gap:"6px",flexWrap:"wrap"}});n.forEach((e=>i.appendChild(I(e)))),r.appendChild(i);let l=createEl("div",{classList:["d-flex","ai-center"],style:{gap:"6px",flexWrap:"wrap"}});a.forEach((e=>l.appendChild(I(e)))),r.appendChild(l),M.appendChild(r)}else{const e={"Any Camo":"GreenCamo","Any Regrow":"PinkRegrow","Any Fortified":"CeramicFortified",Purple:"Purple","Lead & DDT":"Lead","MOAB-Class":"Moab"};let t=createEl("div",{classList:["d-flex","ai-center"],style:{gap:"6px",flexWrap:"wrap"}});Object.keys(e).forEach((n=>{let a=createEl("div",{classList:["d-flex","ai-center"],style:{gap:"2px",width:"250px"}}),s=createEl("div",{classList:["pointer"],style:{backgroundImage:"url(../Assets/UI/StatsTabBlue.webp)",backgroundSize:"contain",width:"60px",height:"60px"}});a._iconHolder=s;let r=createEl("img",{classList:["bloon-filter-img"],style:{width:"50px",height:"50px",padding:"5px",objectFit:"contain"},src:`../Assets/BloonIcon/${e[n]}.webp`});s.appendChild(r);let i=createEl("p",{classList:["black-outline"],style:{fontSize:"20px"},innerHTML:n});a.appendChild(s),a.appendChild(i),roundsetFilterSettings.roundsetBasicFilter===n&&(s.style.backgroundImage="url(../Assets/UI/StatsTabYellow.webp)"),t.appendChild(a),a.addEventListener("click",(()=>{roundsetFilterSettings.roundsetBasicFilter===n?(roundsetFilterSettings.roundsetBasicFilter=null,s.style.backgroundImage="url(../Assets/UI/StatsTabBlue.webp)"):(Array.from(t.children).forEach((e=>{e._iconHolder&&(e._iconHolder.style.backgroundImage="url(../Assets/UI/StatsTabBlue.webp)")})),roundsetFilterSettings.roundsetBasicFilter=n,s.style.backgroundImage="url(../Assets/UI/StatsTabYellow.webp)")}))})),M.appendChild(t)}}F();const B=createEl("div",{classList:["d-flex","jc-end"],style:{marginTop:"8px",gap:"10px"}}),R=createEl("div",{classList:["maps-progress-view","black-outline","pointer"],innerHTML:"Apply",style:{padding:"6px 14px",filter:"hue-rotate(270deg)"}});return R.addEventListener("click",(()=>{if(!currentRoundsetData)return void(closeModal&&closeModal());if(null===roundsetFilterSettings.roundFilterEnd&&(roundsetFilterSettings.roundFilterEnd=roundsetProcessed.rounds[roundsetProcessed.rounds.length-1].roundNumber),roundsetFilterSettings.roundFilterStart>roundsetFilterSettings.roundFilterEnd){const e=roundsetFilterSettings.roundFilterStart;roundsetFilterSettings.roundFilterStart=roundsetFilterSettings.roundFilterEnd,roundsetFilterSettings.roundFilterEnd=e}applyRoundFilters(e),generateRounds(currentRoundsetView,roundsetFilterSettings.roundsetReversed);const t=document.getElementById("select-round-num-preview");if(t){t.min=roundsetFilterSettings.roundFilterStart,t.max=roundsetFilterSettings.roundFilterEnd,isRoundInFilter(roundsetProcessed.rounds[currentPreviewRound].roundNumber)||(currentPreviewRound=roundsetFilterSettings.roundFilterStart-1,t.value=roundsetFilterSettings.roundFilterStart,updatePreviewRoundTimeline())}closeModal&&closeModal(),goBack()})),B.appendChild(R),t.appendChild(B),createModal({header:"Roundset Settings",content:t}),t}function isRoundInFilter(e){return e>=roundsetFilterSettings.roundFilterStart&&e<=(roundsetFilterSettings.roundFilterEnd??1/0)}function indexOfRoundNumberOrNearest(e){const t=roundsetProcessed?.rounds??[];if(0===t.length)return-1;const n=t.findIndex((t=>t.roundNumber===e));return-1!==n?n:t.reduce(((n,a,s)=>{const r=t[n].roundNumber,i=Math.abs(r-e),l=Math.abs(a.roundNumber-e);return l<i||l===i&&a.roundNumber<r?s:n}),0)}function isFiltersActive(){if(!currentRoundsetData)return!1;const e=currentRoundsetData.rounds[currentRoundsetData.rounds.length-1]?.roundNumber??1/0,t=null==roundsetFilterSettings.roundFilterEnd||roundsetFilterSettings.roundFilterEnd===e,n="boss"===constants.roundSets[selectedRoundset]?.type&&!!roundsetFilterSettings.roundsetShowModified;return[1!==roundsetFilterSettings.roundFilterStart,!t,"All"!==roundsetFilterSettings.roundFilterPreset,null!==roundsetFilterSettings.roundsetBasicFilter,(roundsetFilterSettings.roundsetFilteredBloons?.length??0)>0,!0===roundsetFilterSettings.roundsetAdvancedFilterMode,n,!0===roundsetFilterSettings.roundsetReversed].some(Boolean)}function updateRoundsShownLabel(){const e=document.getElementById("rounds-shown-label");if(!e||!roundsetProcessed||0===roundsetProcessed.rounds.length)return;const t=roundsetProcessed.rounds.filter((e=>isRoundInFilter(e.roundNumber)));if(0===t.length)return void(e.innerHTML="No rounds shown");const n=t[0].roundNumber,a=t[t.length-1].roundNumber;e.innerHTML=`Rounds ${n}-${a}`}let canvas,ctx,previewFrameId=null,speedMultiplier=1,bloonsData={Red:{name:"Red",rbe:1,speed:25,layer:1,scale:.8,color:"#ED0F0F",border:"#690000"},Blue:{name:"Blue",rbe:2,speed:35,layer:2,scale:.85,color:"#2797E0",border:"#004772"},Green:{name:"Green",rbe:3,speed:45,layer:3,scale:.9,color:"#77A80F",border:"#3D5400"},Yellow:{name:"Yellow",rbe:4,speed:80,layer:4,scale:.95,color:"#FFD50F",border:"#8E620C"},Pink:{name:"Pink",rbe:5,speed:87.5,layer:5,scale:1,color:"#F15060",border:"#A92626"},Black:{name:"Black",rbe:11,speed:45,layer:6,scale:.58,color:"#161616",border:"#414141"},Purple:{name:"Purple",rbe:11,speed:75,layer:7,scale:.95,color:"#9326E0",border:"#00E4FF"},White:{name:"White",rbe:12,speed:50,layer:6,scale:.58,color:"#D7D7D7",border:"#727272"},Lead:{name:"Lead",rbe:23,speed:25,layer:7,scale:.95,color:"#7E7E7E",border:"#2F2F2F"},Zebra:{name:"Zebra",rbe:23,speed:45,layer:7,scale:.9,color:"repeating-linear-gradient(145deg, #040404, #040404 10px, #ffffff 10px, #ffffff 20px)",border:"#5A5A5A"},Rainbow:{name:"Rainbow",rbe:47,speed:55,layer:8,scale:1,color:"linear-gradient(180deg, rgba(228,26,26,1) 0%, rgba(255,159,0,1) 16%, rgba(255,224,0,1) 33%, rgba(125,181,4,1) 48%, rgba(83,176,222,1) 66%, rgba(226,74,226,1) 84%, rgba(132,21,132,1) 100%)",border:"transparent"},Ceramic:{name:"Ceramic",rbe:47,speed:62.5,layer:9,scale:1,color:"#BE6C1D",border:"#61370B"},Moab:{name:"Moab",rbe:616,speed:25,layer:10,color:"#2AC2FF",border:"#FFFFFF"},Bfb:{name:"Bfb",rbe:3164,speed:6.25,layer:11,color:"#C00505",border:"#FFFFFF"},Zomg:{name:"Zomg",rbe:16656,speed:4.5,layer:12,color:"#575757",border:"#B7F700"},Ddt:{name:"Ddt",rbe:3164,speed:66,layer:12,color:"#3C3C3C",border:"#A5A5A5"},Bad:{name:"Bad",rbe:16464,speed:4.5,layer:13,color:"#AB02AC",border:"#500151"}},bloons_spritesheet=new Image;bloons_spritesheet.src="../Assets/BloonIcon/preview_bloons_spritesheet.webp";let bloonImageMap={CeramicCamo:{x:1153,y:0,width:129,height:163},CeramicFortified:{x:993,y:547,width:140,height:163},CeramicFortifiedCamo:{x:993,y:711,width:140,height:163},CeramicRegrow:{x:0,y:782,width:176,height:162},CeramicRegrowCamo:{x:177,y:782,width:176,height:162},CeramicRegrowFortified:{x:629,y:0,width:186,height:162},CeramicRegrowFortifiedCamo:{x:629,y:163,width:186,height:162},Black:{x:1283,y:790,width:78,height:97},BlackCamo:{x:1283,y:888,width:78,height:97},BlackRegrow:{x:833,y:945,width:105,height:97},BlackRegrowCamo:{x:708,y:782,width:105,height:97},Blue:{x:1283,y:148,width:110,height:139},BlueCamo:{x:1283,y:288,width:110,height:139},BlueRegrow:{x:408,y:641,width:150,height:138},BlueRegrowCamo:{x:993,y:146,width:150,height:138},Ceramic:{x:1153,y:164,width:129,height:163},LeadFortifiedCamo:{x:993,y:875,width:133,height:156},LeadRegrow:{x:816,y:326,width:168,height:154},LeadRegrowCamo:{x:816,y:481,width:168,height:154},LeadRegrowFortified:{x:629,y:326,width:178,height:154},LeadRegrowFortifiedCamo:{x:629,y:481,width:178,height:154},Green:{x:878,y:1100,width:116,height:147},GreenCamo:{x:995,y:1100,width:116,height:147},GreenRegrow:{x:468,y:474,width:159,height:145},GreenRegrowCamo:{x:629,y:636,width:159,height:145},Lead:{x:134,y:1100,width:123,height:156},LeadCamo:{x:258,y:1100,width:123,height:156},LeadFortified:{x:0,y:1100,width:133,height:156},WhiteRegrow:{x:1153,y:1132,width:105,height:97},WhiteRegrowCamo:{x:1283,y:428,width:105,height:97},Yellow:{x:382,y:1100,width:123,height:156},YellowCamo:{x:506,y:1100,width:123,height:156},YellowRegrow:{x:816,y:636,width:168,height:154},YellowRegrowCamo:{x:0,y:945,width:168,height:154},Zebra:{x:1153,y:984,width:116,height:147},ZebraCamo:{x:1283,y:0,width:116,height:147},ZebraRegrow:{x:816,y:791,width:159,height:145},ZebraRegrowCamo:{x:993,y:0,width:159,height:145},Pink:{x:1153,y:328,width:129,height:163},PinkCamo:{x:1153,y:492,width:129,height:163},PinkRegrow:{x:354,y:782,width:176,height:162},PinkRegrowCamo:{x:531,y:782,width:176,height:162},Purple:{x:630,y:1100,width:123,height:156},PurpleCamo:{x:754,y:1100,width:123,height:156},PurpleRegrow:{x:169,y:945,width:168,height:154},PurpleRegrowCamo:{x:338,y:945,width:168,height:154},Rainbow:{x:1153,y:656,width:129,height:163},RainbowCamo:{x:1153,y:820,width:129,height:163},RainbowRegrow:{x:816,y:0,width:176,height:162},RainbowRegrowCamo:{x:816,y:163,width:176,height:162},Red:{x:1283,y:526,width:103,height:131},RedCamo:{x:1283,y:658,width:103,height:131},RedRegrow:{x:993,y:285,width:143,height:130},RedRegrowCamo:{x:993,y:416,width:143,height:130},White:{x:1283,y:986,width:78,height:97},WhiteCamo:{x:1283,y:1084,width:78,height:97},Bad:{x:0,y:238,width:326,height:235},BadFortified:{x:0,y:0,width:326,height:237},Bfb:{x:234,y:474,width:233,height:164},BfbFortified:{x:0,y:474,width:233,height:166},DdtCamo:{x:0,y:641,width:203,height:140},DdtFortifiedCamo:{x:204,y:641,width:203,height:140},Moab:{x:670,y:945,width:162,height:105},MoabFortified:{x:507,y:945,width:162,height:110},Zomg:{x:327,y:0,width:301,height:194},ZomgFortified:{x:327,y:195,width:301,height:194}};class Bloon{constructor(e,t){this.speed=bloonsData[e.replace("Camo","").replace("Regrow","").replace("Fortified","")].speed,this.scale=bloonsData[e.replace("Camo","").replace("Regrow","").replace("Fortified","")].scale,this.x=-ratioCalc(1,0,100,bloonImageMap[e].width,bloonImageMap[e].height),this.y=100+(100-100*this.scale)/2,this.type=e,this.groupIndex=t,this.width=ratioCalc(1,0,100,bloonImageMap[e].width,bloonImageMap[e].height)}move(e){this.x+=this.speed*e*6.86*speedMultiplier*roundSpeedModifier*difficultySpeedModifier}shouldDelete(){return this.x>=800}render(e){if(hiddenGroups.includes(this.groupIndex))return;let t=bloonImageMap[this.type];e.drawImage(bloons_spritesheet,t.x,t.y,t.width,t.height,this.x,this.y,this.scale*this.width,100*this.scale)}}class Blimp{constructor(e,t){this.speed=bloonsData[e.replace("Camo","").replace("Regrow","").replace("Fortified","")].speed,this.x=-1.62*bloonImageMap[e].width,this.type=e,this.groupIndex=t}move(e){this.x+=this.speed*e*6.86*speedMultiplier*roundSpeedModifier*difficultySpeedModifier}shouldDelete(){return this.x>=800}render(e){if(hiddenGroups.includes(this.groupIndex))return;let t=bloonImageMap[this.type];e.drawImage(bloons_spritesheet,t.x,t.y,t.width,t.height,this.x,150-1.62*t.height/2,1.62*t.width,1.62*t.height)}}const bloons=[];let currentRoundGroups,difficultySpeedModifier=1,roundSpeedModifier=1;function resetPreview(){previewActive=!1,previewFrameId&&(cancelAnimationFrame(previewFrameId),previewFrameId=null),clearPreview()}function startPreviewLoop(){previewFrameId&&(cancelAnimationFrame(previewFrameId),previewFrameId=null),previewActive=!0;let e=performance.now();previewFrameId=requestAnimationFrame((function t(){if(!previewActive)return;const n=performance.now(),a=(n-e)/1e3;e=n,update(a),render(),previewFrameId=requestAnimationFrame(t)}))}const update=e=>{const t=performance.now();for(let t=bloons.length-1;t>=0;t--){const n=bloons[t];n.move(e),n.shouldDelete()&&bloons.splice(t,1)}null!=currentRoundGroups&&currentRoundGroups.bloonGroups.forEach((e=>{if(t>=e.startTime&&e.spawned<e.total){const n=(t-e.startTime)/1e3;if(0===e.spawnInterval){const t=e.total-e.spawned;for(let a=0;a<t;a++)e.spawnBloon(n),e.spawned++}else{const t=Math.min(e.total,Math.floor(n/e.spawnInterval)+1);for(;e.spawned<t;){const t=e.spawned,a=Math.max(0,n-t*e.spawnInterval);e.spawnBloon(a),e.spawned++}}}}))},render=()=>{ctx.clearRect(0,0,canvas.width,canvas.height),bloons.forEach((e=>e.render(ctx)))};function startRound(e){if(roundSpeedModifier=calcRoundSpeed(e.roundNumber),currentRoundGroups=JSON.parse(JSON.stringify(e)),roundsetFilterSettings.roundsetReversed){let t=Math.max(...e.bloonGroups.map((e=>e.end)));for(let e of currentRoundGroups.bloonGroups){let n=e.end-e.start;e.start=t-e.end,e.end=e.start+n}}addTimelinePlayhead(Math.max(...currentRoundGroups.bloonGroups.map((e=>e.end)))/speedMultiplier),currentRoundGroups.bloonGroups.forEach(((e,t)=>{e.startTime=performance.now()+1e3*e.start/speedMultiplier,e.total=e.count,e.spawned=0,e.activeTime=0,e.spawnAccumulator=0,e.spawnInterval=(e.end-e.start)/(e.count-1)/speedMultiplier,(!isFinite(e.spawnInterval)||e.spawnInterval<0)&&(e.spawnInterval=0),e.spawnBloon=spawnBloon(e,t)}))}function spawnBloon(e,t){return function(n=0){let a=e.bloon,s=["Moab","MoabFortified","Bfb","BfbFortified","Zomg","ZomgFortified","DdtCamo","DdtFortifiedCamo","Bad","BadFortified"].includes(a)?new Blimp(a,t):new Bloon(a,t);n>0&&s.move(n);let r=bloonsData[a.replace("Camo","").replace("Regrow","").replace("Fortified","")].layer,i=bloons.findIndex((e=>bloonsData[e.type.replace("Camo","").replace("Regrow","").replace("Fortified","")].layer>r));-1===i?bloons.push(s):bloons.splice(i,0,s)}}function calcRoundSpeed(e){let t=0;return t=e<=80?1:e<=100?1+.02*(e-80):e<=150?1.6+.02*(e-101):e<=200?3+.02*(e-151):e<=250?4.5+.02*(e-201):6+.02*(e-252),t}function generateCheckbox(e,t,n){let a=document.createElement("div");a.classList.add("checkbox-div");let s=document.createElement("p");s.classList.add("checkbox-label","black-outline"),s.innerHTML=e,a.appendChild(s);let r=document.createElement("input");return r.classList.add("checkbox-input"),r.type="checkbox",r.checked=t,n&&r.addEventListener("change",(()=>{n(r.checked)})),a.appendChild(r),a}function generateDropdown(e,t,n,a){let s=document.createElement("div");s.classList.add("d-flex","ai-center");let r=document.createElement("p");r.classList.add("dropdown-label","black-outline"),r.innerHTML=e,s.appendChild(r);let i=document.createElement("select");return i.classList.add("dropdown-select"),t.forEach((e=>{let t=document.createElement("option");t.value=e,t.innerHTML=e,i.appendChild(t)})),s.appendChild(i),i.value=n,i.addEventListener("change",(()=>{a(i.value)})),s.appendChild(i),s}function generateToggle(e=!1,t){let n=document.createElement("label");n.classList.add("setting-input-label","switch");let a=document.createElement("input");a.classList.add("setting-input"),a.type="checkbox",a.checked=e,n.appendChild(a);let s=document.createElement("span");return s.classList.add("toggle-img","slider"),n.appendChild(s),a.addEventListener("change",(()=>{t&&t(a.checked)})),n}function generateButton(e,t,n){let a=document.createElement("button");return a.classList.add("where-button","black-outline"),t&&Object.assign(a.style,t),a.innerHTML=e,a.addEventListener("click",n),a}function generateNumberInput(e,t,n,a,s,r){let i=document.createElement("div");i.classList.add("d-flex","ai-center","jc-between"),i.style.gap="10px",i.style.flexWrap="wrap";let l=document.createElement("p");l.classList.add("black-outline"),l.style.fontSize="24px",l.innerHTML=e,i.appendChild(l);let o=document.createElement("input");return o.classList.add("font-gardenia","ta-center"),o.value=t,o.min=n,o.max=a,o.step=s,o.style.width="80px",o.style.height="30px",o.style.color="white",o.style.fontSize="24px",o.style.backgroundColor="var(--profile-tertiary)",o.addEventListener("change",(()=>{let e=parseFloat(o.value);isNaN(e)||(e<n&&(e=n),e>a&&(e=a),o.value=e,r(e))})),i.appendChild(o),i}function generateSelectorTab(e,t=!1){const n=document.createElement("div");return n.classList.add("maps-progress-view","black-outline"),t&&n.classList.add("stats-tab-yellow"),n.textContent=e,n}let readyFlags=[0,0,0,0,0],pressedStart=!1,timerInterval=null,activeTimers=new Map,constants={},locJSON={},achievementsJSON={},achievementsHelper={},trophyStoreItemsJSON={},teamsStoreItemsJSON={},rogueJSON={},rulesMap={"Monkey Knowledge Disabled":"NoKnowledgeIcon","No Lives Lost":"NoLivesLostIcon","Selling Disabled":"SellingDisabledIcon","Powers Disabled":"PowersDisabledIcon","No Continues":"NoContinuesIcon","All Camo":"AllCamoIcon","All Regrow":"AllRegenIcon","Double Cash Disabled":"NoDoubleCashIcon","No Round 100 Reward":"NoInstaMonkeys","Custom Rounds":"CustomRoundIcon","Paragon Limit":"ParagonLimitIcon"},backQueue=[],backButton=createEl("img",{src:"../Assets/UI/BackBtn.webp",classList:["back-button","pointer"]});function goBack(e){let t=backQueue.pop();t.source&&(document.getElementById(t.destination+"-content").style.display="none",document.getElementById(t.source+"-content").style.display="flex"),t.callback&&t.callback(),changeHexBGColor(constants.BGColor),0===backQueue.length&&backButton.classList.remove("visible"),e||resetScroll()}function addToBackQueue(e){backQueue.push(e),backButton.classList.add("visible")}function clearBackQueue(){backQueue=[],backButton.classList.remove("visible")}function createEl(e,t={}){const n=document.createElement(e);if(t.classList&&n.classList.add(...t.classList),t.innerHTML&&(n.innerHTML=t.innerHTML),t.textContent&&(n.textContent=t.textContent),t.id&&(n.id=t.id),t.src&&(n.src=t.src),t.placeholder&&(n.placeholder=t.placeholder),t.style&&Object.assign(n.style,t.style),t.onclick&&(n.onclick=t.onclick),t.type&&(n.type=t.type),t.name&&(n.name=t.name),t.attributes)for(const[e,a]of Object.entries(t.attributes))n.setAttribute(e,a);return t.children&&t.children.forEach((e=>n.appendChild(e))),n}function createModal({header:e="",content:t="",footer:n="",backgroundColor:a="var(--profile-secondary)"}={}){const s=createEl("div",{classList:["modal-overlay"]}),r=createEl("div",{classList:["modal-box"]}),i=createEl("div",{classList:["modal-header"]});""!=e&&r.appendChild(i);const l=createEl("div",{classList:["collection-header-modal-left"]});i.appendChild(l);const o=createEl("p",{classList:["collection-modal-header-text","black-outline"],innerHTML:e});i.appendChild(o);const d=createEl("img",{classList:["collection-modal-close","pointer"],src:"./Assets/UI/CloseBtn.webp"});d.addEventListener("click",(()=>{goBack(!0)})),i.appendChild(d);const c=createEl("div",{classList:["modal-content"],style:{backgroundColor:a}});if(r.appendChild(c),"string"==typeof t?c.innerHTML=t:t&&c.appendChild(t),n){const e=createEl("div",{classList:["modal-footer"]});"string"==typeof n?e.innerHTML=n:e.appendChild(n),r.appendChild(e)}s.appendChild(r),document.body.appendChild(s),backQueue[backQueue.length-1]?.callback!==closeModal&&addToBackQueue({callback:closeModal})}function closeModal(){document.querySelector(".modal-overlay")?.remove()}function showLoading(e){let t=0;if(!e){let a=new MutationObserver((e=>{e.forEach((e=>{"childList"===e.type&&e.addedNodes.forEach((e=>{"IMG"===e.nodeName&&(t++,e.addEventListener("load",n),e.addEventListener("error",n))}))}))}));function n(){t--,0===t&&(document.getElementById("loading").style.transform="scale(0)",a.disconnect())}a.observe(document.body,{childList:!0,subtree:!0})}document.getElementById("loading").style.removeProperty("transform")}function hideLoading(){document.getElementById("loading").style.transform="scale(0)"}function fetchConstants(){return fetch("./data/Constants.json").then((e=>e.json())).then((e=>{constants=e,readyFlags[4]=1})).catch((e=>{console.error("Error:",e),errorModal(e,"js")}))}function fetchLocKeys(){return fetch("./data/English.json").then((e=>e.json())).then((e=>{locJSON=e}))}async function fetchRogueDependencies(){return await fetchLocKeys(),fetch("./data/rogueData.json").then((e=>e.json())).then((e=>{rogueJSON=e,postProcessRogueData()})).catch((e=>{console.error("Error:",e),errorModal(e,"js")}))}async function fetchInstaDependencies(){await fetchLocKeys(),generateStats(),generateInstaData(),changeProgressTab("InstaMonkeys"),clearBackQueue(),hideLoading()}async function fetchMainDependencies(){Object.keys(constants.heroesInOrder).includes(btd6usersave.primaryHero)||(btd6usersave.primaryHero=Object.keys(constants.heroesInOrder)[0]),await fetchLocKeys(),await fetchRogueDependencies(),Promise.all([fetch("./data/Achievements150.json").then((e=>e.json())),fetch("./data/trophyStoreItems.json").then((e=>e.json())),fetch("./data/teamsStoreItems.json").then((e=>e.json()))]).then((([e,t,n])=>{achievementsJSON=e,trophyStoreItemsJSON=t,teamsStoreItemsJSON=n,readyFlags[2]=1,readyFlags[3]=1,loadSettings(),generateIfReady()})).catch((e=>{console.error("Error:",e),errorModal(e,"js")})),showLoading()}function resetScroll(){document.body.scrollTop=0,document.documentElement.scrollTop=0}function loadSettings(){let e=JSON.parse(localStorage.getItem("BTD6OAKSettings"));e&&(preventRateLimiting=e.ProfileLoading,useNamedMonkeys=e.UseNamedMonkeys,showTeamsItems=e.TeamsStoreItems)}function saveSettings(){let e={ProfileLoading:preventRateLimiting,UseNamedMonkeys:useNamedMonkeys,TeamsStoreItems:showTeamsItems};localStorage.setItem("BTD6OAKSettings",JSON.stringify(e))}function generateAvatar(e,t){let n=document.createElement("div");n.style.width=`${e}px`,n.style.height=`${e}px`,n.classList.add("avatar");let a=document.createElement("img");a.classList.add("avatar-frame","noSelect"),a.style.width=`${e}px`,a.src="../Assets/UI/InstaTowersContainer.webp",n.appendChild(a);let s=document.createElement("img");return s.classList.add("avatar-img","noSelect"),s.style.width=`${e}px`,s.src=t,n.appendChild(s),n}function openBTD6Link(e){window.location.href=e}function openBTD6Site(e){window.open(e,"_blank")}function copyLoadingIcon(e){let t=document.getElementsByClassName("loading-icon")[0].cloneNode(!0);return t.classList.add("loading-icon-leaderboard"),t.style.height="unset",e.appendChild(t),t}function formatTime(e){return[Math.floor(e/3600),Math.floor(e%3600/60),Math.floor(e%60)].map((e=>e<10?"0"+e:e)).join(":")}function formatScoreTime(e){let t=Math.floor(e/1e3),n=e%1e3,a=Math.floor(t/3600);t%=3600;let s=Math.floor(t/60),r=t%60;s=s.toString().padStart(2,"0"),r=r.toString().padStart(2,"0"),n=n.toString().padStart(3,"0");let i=`${s}:${r}.${n}`;return a>0&&(a=a.toString().padStart(2,"0"),i=`${a}:${i}`),i}function getRemainingTime(e){return(e-new Date)/1e3}function updateTimer(e,t,n="Finished"){const a=document.getElementById(t);if(!a)return"missing";const s=getRemainingTime(e);if(s>172800){const e=Math.floor(s/86400);a.textContent=`${e} days left`,a.style.width="130px"}else{if(s<0)return a.textContent=n,a.style.textAlign="right","finished";a.style.width="100px",a.textContent=formatTime(s)}}function relativeTime(e,t){const n=[{name:"year",ms:31536e6},{name:"month",ms:2592e6},{name:"day",ms:864e5},{name:"hour",ms:36e5},{name:"minute",ms:6e4},{name:"second",ms:1e3}],a=e-t;for(const e of n){if(a<e.ms)continue;let t=Math.round(a/e.ms);return`${t} ${e.name}${t>1?"s":""} ago`}}function changeHexBGColor(e){null!=e?document.body.style.backgroundColor=`rgb(${255*e[0]},${255*e[1]},${255*e[2]})`:document.body.style.removeProperty("background-color")}function ratioCalc(e,t,n,a,s){switch(e){case 1:return n*(a/s);case 2:return t*(s/a);case 3:return s*(t/n);case 4:return a*(n/t)}}function processRewardsString(e){let t={},n=e.split("#"),a=0;for(let e of n){t[a]={};let n=e.split(":"),s=n[0];if(!["MonkeyMoney","Power","InstaMonkey","KnowledgePoints","RandomInstaMonkey","Trophy"].includes(s)){t[a].type="Other",t[a].value=s,a++;continue}let r=n[1].split(",");switch(s){case"MonkeyMoney":t[a].type="MonkeyMoney",t[a].amount=parseInt(r[0]);break;case"Power":t[a].type="Power",t[a].power=r[0],t[a].amount=parseInt(r[1]),null==r[1]&&(t[a].amount=1);break;case"InstaMonkey":t[a].type="InstaMonkey",t[a].tower=r[0],t[a].tiers=r[1];break;case"KnowledgePoints":t[a].type="KnowledgePoints",t[a].amount=parseInt(r[0]);break;case"RandomInstaMonkey":t[a].type="RandomInstaMonkey",t[a].tier=r[0],t[a].amount=parseInt(r[1]);break;case"Trophy":t[a].type="Trophy",t[a].trophy=r[0]}a++}return t}function generateLoginDiv(e){let t=createEl("div",{classList:["d-flex","ai-center","jc-center","fd-column","bg-color-primary"]}),n=createEl("p",{classList:["site-info-header","black-outline"],innerHTML:"Login with your OAK Token!"});t.appendChild(n);const a=createEl("div");Object.entries(localStorageOAK).forEach((([t,n])=>{const s=createEl("div",{classList:["previous-oak-entry","d-flex","ai-center","ps-relative"],style:{backgroundImage:`linear-gradient(to right, transparent 80%, var(--profile-primary) 100%),url(${n.banner})`}});s.appendChild(generateAvatar(100,n.avatar)),s.appendChild(createEl("p",{classList:["profile-name","tc-white","font-luckiest","black-outline"],innerHTML:n.displayName}));const r=createEl("img",{classList:["use-button","ps-absolute"],src:"./Assets/UI/ContinueBtn.webp"});r.addEventListener("click",(async()=>{pressedStart||(pressedStart=!0,document.getElementById("loading").style.removeProperty("transform"),oak_token=t,await getSaveData(t),loggedIn=!0,e?e(oak_token):fetchMainDependencies())})),s.appendChild(r);const i=createEl("img",{classList:["delete-button","ps-absolute"],src:"./Assets/UI/CloseBtn.webp"});i.addEventListener("click",(()=>{delete localStorageOAK[t],writeLocalStorage(),a.removeChild(s)})),s.appendChild(i),a.appendChild(s)})),t.appendChild(a);let s=document.createElement("div");s.classList.add("site-access-div"),t.appendChild(s);let r=document.createElement("div");r.classList.add("oak-entry-div"),t.appendChild(r);let i=document.createElement("input");i.classList.add("key-entry"),i.placeholder="Enter your OAK here",r.appendChild(i);let l=document.createElement("div");l.classList.add("start-button","black-outline"),l.innerHTML="Start",l.addEventListener("click",(async()=>{let e=i.value;e.length<5||e.length>30||!e.startsWith("oak_")?errorModal('Please enter a valid OAK! This will start with "oak_".'):pressedStart||(document.getElementById("loading").style.removeProperty("transform"),pressedStart=!0,loggedIn=!0,oak_token=i.value,await getSaveData(oak_token),fetchMainDependencies())})),r.appendChild(l);let o=document.createElement("div");o.classList.add("get-oak-div"),t.appendChild(o);let d=document.createElement("p");d.classList.add("where-text"),d.innerHTML="Don't have an OAK token? Read here:",o.appendChild(d);let c=document.createElement("p");c.classList.add("where-button","black-outline"),c.style.width="220px",c.innerHTML="View OAK Guide",c.addEventListener("click",(()=>{openOAKInstructionsModal()})),o.appendChild(c);let p=document.createElement("div");return p.id="oak-instructions-div",p.classList.add("oak-instructions-div"),p.style.display="none",t.appendChild(p),t}function openOAKInstructionsModal(){let e=createEl("div",{style:{padding:"10px"}});return e.appendChild(createEl("p",{classList:["oak-instructions-header","black-outline"],innerHTML:"What is an Open Access Key?"})),e.appendChild(createEl("p",{classList:["oak-instructions-text"],innerHTML:"An Open Access Key (OAK) is a unique key that allows you to access your Bloons TD 6 data from Ninja Kiwi's Open Data API. The site will use this to fetch your information from the API to be displayed in a familiar way. <br><br>NOTE: Progress tracking is not available for BTD6+ on Apple Arcade and BTD6 Netflix as OAK tokens are unavailable."})),e.appendChild(createEl("p",{classList:["oak-instructions-header","black-outline"],innerHTML:"How do I get one?"})),e.appendChild(createEl("p",{classList:["oak-instructions-text"],innerHTML:"Step 1: Login and Backup your progress with a Ninja Kiwi Account in BTD6. You can do this by going to settings from the main menu and clicking on the Account button."})),e.appendChild(createEl("img",{classList:["oak-instruction-img"],src:"./Assets/UI/OAKTutorial1.webp"})),e.appendChild(createEl("p",{classList:["oak-instructions-text"],innerHTML:'Step 2: Select "Open Data API" at the bottom right of the account screen.'})),e.appendChild(createEl("img",{classList:["oak-instruction-img"],src:"./Assets/UI/OAKTutorial2.webp"})),e.appendChild(createEl("p",{classList:["oak-instructions-text"],innerHTML:'Step 3: Generate a key and copy that in to the above text field. It should start with "oak_". Then click "Start" to begin!'})),e.appendChild(createEl("img",{classList:["oak-instruction-img"],src:"./Assets/UI/OAKTutorial3.webp"})),e.appendChild(createEl("p",{classList:["oak-instructions-text"],innerHTML:'You can read more about the Open Data API here: <a href="https://ninja.kiwi/opendatafaq" target="_blank", style="color:white";>Open Data API Article</a><br><br>Privacy Note: This app does not store any data being sent to or retrieved from Ninja Kiwi\'s Open Data API outside of your browser/device. The localStorage browser feature is used to prevent users from having to re-enter their OAK token every time they visit the site. If you would like to delete this stored data, you can do so by clicking the "X" on the profile you would like to delete on this homepage or clearing your browsing data.'})),createModal({header:"OAK Instructions",content:e}),e}function errorModal(e,t,n){if(isErrorModalOpen&&!n)return;let a=document.createElement("div");a.classList.add("error-modal-overlay"),document.body.appendChild(a);let s=document.createElement("div");s.id="error-modal",s.classList.add("error-modal"),a.appendChild(s);let r=document.createElement("div");r.id="error-modal-header",r.classList.add("error-modal-header"),s.appendChild(r);let i=document.createElement("img");i.id="error-modal-header-img",i.classList.add("error-modal-header-img"),i.src="./Assets/UI/BadConnectionBtn.webp",r.appendChild(i);let l=document.createElement("p");l.classList.add("error-modal-header-text","black-outline"),l.innerHTML="Error",r.appendChild(l);let o=document.createElement("div");o.classList.add("error-modal-dummy"),r.appendChild(o);let d=document.createElement("div");d.id="error-modal-content",d.classList.add("error-modal-content"),d.innerHTML=""+e,s.appendChild(d);let c=document.createElement("div");switch(c.classList.add("error-modal-content"),e){case"Invalid user ID / Player Does not play this game":c.innerHTML="Please try again or create a new Open Access Key.",s.appendChild(c);break;case"Cannot load public profile. Player does not play this game or is running a newer version":c.innerHTML="Note: If a major update for the game just released, it is possible the Open Data API is temporarily broken until updates are made.",s.appendChild(c)}if("ratelimit"==t){let e=document.createElement("div");e.classList.add("error-toggle-div"),s.appendChild(e);let t=document.createElement("p");t.classList.add("maps-progress-coop-toggle-text","black-outline"),t.innerHTML="Manually Load Profiles: ",e.appendChild(t);let n=document.createElement("input");n.classList.add("maps-progress-coop-toggle-input"),n.type="checkbox",n.checked=preventRateLimiting,n.addEventListener("change",(()=>{preventRateLimiting=!!n.checked})),e.appendChild(n)}let p=document.createElement("div");p.classList.add("error-modal-ok-button-div"),s.appendChild(p);let u=document.createElement("div");u.classList.add("start-button","modal-ok-button","black-outline"),u.innerHTML="OK",u.addEventListener("click",(()=>{isErrorModalOpen=!1,document.body.removeChild(a)})),p.appendChild(u);let h=document.createElement("img");h.classList.add("error-modal-close"),h.src="./Assets/UI/CloseBtn.webp",h.addEventListener("click",(()=>{isErrorModalOpen=!1,document.body.removeChild(a)})),d.appendChild(h),isErrorModalOpen=!0}backButton.addEventListener("click",(()=>{goBack()})),document.querySelector(".header").prepend(backButton);const rtf=new Intl.RelativeTimeFormat("en",{style:"long"});function getRelativeTimeString(e){const t=e-Date.now(),n=Math.abs(t),a=36e5,s=24*a;let r,i;return n>=s?(r=Math.round(t/s),i="day"):n>=a?(r=Math.round(t/a),i="hour"):(r=Math.round(t/6e4),i="minute"),rtf.format(r,i)}function registerTimer(e,t){t instanceof Date||(t=new Date(t)),activeTimers.set(e,t),ensureTimerLoop(),updateTimer(t,e)}function ensureTimerLoop(){null==timerInterval&&(timerInterval=setInterval((()=>{if(0===activeTimers.size)return clearInterval(timerInterval),void(timerInterval=null);for(let[e,t]of activeTimers){const n=updateTimer(t,e);"missing"!==n&&"finished"!==n||activeTimers.delete(e)}}),1e3))}function clearAllTimers(){activeTimers.clear(),timerInterval&&(clearInterval(timerInterval),timerInterval=null)}