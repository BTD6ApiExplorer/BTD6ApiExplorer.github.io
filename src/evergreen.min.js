let e=[0,0,0,0,0],t=!1,n=null,a={},o={},s={},i={},r={},l={},d={},c=[],p=y("img",{src:"../Assets/UI/BackBtn.png",classList:["back-button","pointer"]});function m(){let e=c.pop();e.source&&(document.getElementById(e.destination+"-content").style.display="none",document.getElementById(e.source+"-content").style.display="flex"),e.callback&&e.callback(),n&&clearInterval(n),D(a.BGColor),0===c.length&&p.classList.remove("visible"),w()}function u(e){c.push(e),p.classList.add("visible")}function h(){c=[],p.classList.remove("visible")}function y(e,t={}){const n=document.createElement(e);if(t.classList&&n.classList.add(...t.classList),t.innerHTML&&(n.innerHTML=t.innerHTML),t.textContent&&(n.textContent=t.textContent),t.id&&(n.id=t.id),t.src&&(n.src=t.src),t.placeholder&&(n.placeholder=t.placeholder),t.style&&Object.assign(n.style,t.style),t.onclick&&(n.onclick=t.onclick),t.attributes)for(const[e,a]of Object.entries(t.attributes))n.setAttribute(e,a);return t.children&&t.children.forEach((e=>n.appendChild(e))),n}function g({header:e="",content:t="",footer:n="",classList:a=[]}={}){const o=y("div",{classList:["modal-overlay",...a]}),s=y("div",{classList:["modal-box"]}),i=y("div",{classList:["modal-header"]});""!=e&&s.appendChild(i);const r=y("div",{classList:["collection-header-modal-left"]});i.appendChild(r);const l=y("p",{classList:["collection-modal-header-text","black-outline"],innerHTML:e});i.appendChild(l);const d=y("img",{classList:["collection-modal-close","pointer"],src:"./Assets/UI/CloseBtn.png"});d.addEventListener("click",(()=>{m()})),i.appendChild(d);const c=y("div",{classList:["modal-content"]});if(s.appendChild(c),"string"==typeof t?c.innerHTML=t:t&&c.appendChild(t),n){const e=y("div",{classList:["modal-footer"]});"string"==typeof n?e.innerHTML=n:e.appendChild(n),s.appendChild(e)}o.appendChild(s),document.body.appendChild(o),u({callback:f})}function f(){document.querySelector(".modal-overlay")?.remove()}function L(){let e=0;function t(){e--,0===e&&(document.getElementById("loading").style.transform="scale(0)")}new MutationObserver((n=>{n.forEach((n=>{"childList"===n.type&&n.addedNodes.forEach((n=>{"IMG"===n.nodeName&&(e++,n.addEventListener("load",t),n.addEventListener("error",t))}))}))})).observe(document.body,{childList:!0,subtree:!0}),document.getElementById("loading").style.removeProperty("transform")}function k(){document.getElementById("loading").style.transform="scale(0)"}function v(){return fetch("./data/Constants.json").then((e=>e.json())).then((t=>{a=t,e[4]=1})).catch((e=>{console.error("Error:",e),_(e,"js")}))}function b(){return fetch("./data/English.json").then((e=>e.json())).then((e=>{o=e}))}async function C(){return await b(),fetch("./data/rogueData.json").then((e=>e.json())).then((e=>{d=e,postProcessRogueData()})).catch((e=>{console.error("Error:",e),_(e,"js")}))}async function E(){await b(),generateStats(),generateInstaData(),changeProgressTab("InstaMonkeys"),h(),k()}async function M(){await b(),await C(),Promise.all([fetch("./data/Achievements150.json").then((e=>e.json())),fetch("./data/trophyStoreItems.json").then((e=>e.json())),fetch("./data/teamsStoreItems.json").then((e=>e.json()))]).then((([t,n,a])=>{s=t,r=n,l=a,e[2]=1,e[3]=1,I(),generateIfReady()})).catch((e=>{console.error("Error:",e),_(e,"js")})),L()}function w(){document.body.scrollTop=0,document.documentElement.scrollTop=0}function I(){let e=JSON.parse(localStorage.getItem("BTD6OAKSettings"));e&&(preventRateLimiting=e.ProfileLoading,useNamedMonkeys=e.UseNamedMonkeys,showTeamsItems=e.TeamsStoreItems)}function T(){let e={ProfileLoading:preventRateLimiting,UseNamedMonkeys:useNamedMonkeys,TeamsStoreItems:showTeamsItems};localStorage.setItem("BTD6OAKSettings",JSON.stringify(e))}function A(e,t){let n=document.createElement("div");n.style.width=`${e}px`,n.style.height=`${e}px`,n.classList.add("avatar");let a=document.createElement("img");a.classList.add("avatar-frame","noSelect"),a.style.width=`${e}px`,a.src="../Assets/UI/InstaTowersContainer.png",n.appendChild(a);let o=document.createElement("img");return o.classList.add("avatar-img","noSelect"),o.style.width=`${e}px`,o.src=t,n.appendChild(o),n}function O(e){window.location.href=e}function S(e){window.open(e,"_blank")}function x(e){let t=document.getElementsByClassName("loading-icon")[0].cloneNode(!0);t.classList.add("loading-icon-leaderboard"),t.style.height="unset",e.appendChild(t)}function j(e){return[Math.floor(e/3600),Math.floor(e%3600/60),Math.floor(e%60)].map((e=>e<10?"0"+e:e)).join(":")}function P(e){let t=Math.floor(e/1e3),n=e%1e3,a=Math.floor(t/3600);t%=3600;let o=Math.floor(t/60),s=t%60;o=o.toString().padStart(2,"0"),s=s.toString().padStart(2,"0"),n=n.toString().padStart(3,"0");let i=`${o}:${s}.${n}`;return a>0&&(a=a.toString().padStart(2,"0"),i=`${a}:${i}`),i}function K(e){return(e-new Date)/1e3}function B(e,t){const n=K(e),a=document.getElementById(t);if(n>172800){const e=Math.ceil(n/86400);a.textContent=`${e} days left`,a.style.width="130px"}else n<0?(a.textContent="Finished",a.style.textAlign="right"):(a.style.width="100px",a.textContent=j(n))}function H(e,t){const n=[{name:"year",ms:31536e6},{name:"month",ms:2592e6},{name:"day",ms:864e5},{name:"hour",ms:36e5},{name:"minute",ms:6e4},{name:"second",ms:1e3}],a=e-t;for(const e of n){if(a<e.ms)continue;let t=Math.round(a/e.ms);return`${t} ${e.name}${t>1?"s":""} ago`}}function D(e){null!=e?document.body.style.backgroundColor=`rgb(${255*e[0]},${255*e[1]},${255*e[2]})`:document.body.style.removeProperty("background-color")}function N(e,t,n,a,o){switch(e){case 1:return n*(a/o);case 2:return t*(o/a);case 3:return o*(t/n);case 4:return a*(n/t)}}function $(e){let t={},n=e.split("#"),a=0;for(let e of n){t[a]={};let n=e.split(":"),o=n[0];if(!["MonkeyMoney","Power","InstaMonkey","KnowledgePoints","RandomInstaMonkey","Trophy"].includes(o)){t[a].type="Other",t[a].value=o,a++;continue}let s=n[1].split(",");switch(o){case"MonkeyMoney":t[a].type="MonkeyMoney",t[a].amount=parseInt(s[0]);break;case"Power":t[a].type="Power",t[a].power=s[0],t[a].amount=parseInt(s[1]),null==s[1]&&(t[a].amount=1);break;case"InstaMonkey":t[a].type="InstaMonkey",t[a].tower=s[0],t[a].tiers=s[1];break;case"KnowledgePoints":t[a].type="KnowledgePoints",t[a].amount=parseInt(s[0]);break;case"RandomInstaMonkey":t[a].type="RandomInstaMonkey",t[a].tier=s[0],t[a].amount=parseInt(s[1]);break;case"Trophy":t[a].type="Trophy",t[a].trophy=s[0]}a++}return t}function R(e){let n=y("div",{classList:["d-flex","ai-center","jc-center","fd-column","bg-color-primary"]}),a=y("p",{classList:["site-info-header","black-outline"],innerHTML:"Login with your OAK Token!"});n.appendChild(a);const o=y("div");Object.entries(localStorageOAK).forEach((([n,a])=>{const s=y("div",{classList:["previous-oak-entry","d-flex","ai-center","ps-relative"],style:{backgroundImage:`linear-gradient(to right, transparent 80%, var(--profile-primary) 100%),url(${a.banner})`}});s.appendChild(A(100,a.avatar)),s.appendChild(y("p",{classList:["profile-name","tc-white","font-luckiest","black-outline"],innerHTML:a.displayName}));const i=y("img",{classList:["use-button","ps-absolute"],src:"./Assets/UI/ContinueBtn.png"});i.addEventListener("click",(async()=>{t||(t=!0,document.getElementById("loading").style.removeProperty("transform"),oak_token=n,await getSaveData(n),loggedIn=!0,e?e(oak_token):M())})),s.appendChild(i);const r=y("img",{classList:["delete-button","ps-absolute"],src:"./Assets/UI/CloseBtn.png"});r.addEventListener("click",(()=>{delete localStorageOAK[n],writeLocalStorage(),o.removeChild(s)})),s.appendChild(r),o.appendChild(s)})),n.appendChild(o);let s=document.createElement("div");s.classList.add("site-access-div"),n.appendChild(s);let i=document.createElement("div");i.classList.add("oak-entry-div"),n.appendChild(i);let r=document.createElement("input");r.classList.add("key-entry"),r.placeholder="Enter your OAK here",i.appendChild(r);let l=document.createElement("div");l.classList.add("start-button","black-outline"),l.innerHTML="Start",l.addEventListener("click",(async()=>{let e=r.value;e.length<5||e.length>30||!e.startsWith("oak_")?_('Please enter a valid OAK! This will start with "oak_".'):t||(document.getElementById("loading").style.removeProperty("transform"),t=!0,loggedIn=!0,oak_token=r.value,await getSaveData(oak_token),M())})),i.appendChild(l);let d=document.createElement("div");d.classList.add("get-oak-div"),n.appendChild(d);let c=document.createElement("p");c.classList.add("where-text"),c.innerHTML="Don't have an OAK token? Read here:",d.appendChild(c);let p=document.createElement("p");p.classList.add("where-button","black-outline"),p.style.width="220px",p.innerHTML="View OAK Guide",p.addEventListener("click",(()=>{U()})),d.appendChild(p);let m=document.createElement("div");return m.id="oak-instructions-div",m.classList.add("oak-instructions-div"),m.style.display="none",n.appendChild(m),n}function U(){let e=y("div",{style:{padding:"10px"}});return e.appendChild(y("p",{classList:["oak-instructions-header","black-outline"],innerHTML:"What is an Open Access Key?"})),e.appendChild(y("p",{classList:["oak-instructions-text"],innerHTML:"An Open Access Key (OAK) is a unique key that allows you to access your Bloons TD 6 data from Ninja Kiwi's Open Data API. The site will use this to fetch your information from the API to be displayed in a familiar way. <br><br>NOTE: Progress tracking is not available for BTD6+ on Apple Arcade and BTD6 Netflix as OAK tokens are unavailable."})),e.appendChild(y("p",{classList:["oak-instructions-header","black-outline"],innerHTML:"How do I get one?"})),e.appendChild(y("p",{classList:["oak-instructions-text"],innerHTML:"Step 1: Login and Backup your progress with a Ninja Kiwi Account in BTD6. You can do this by going to settings from the main menu and clicking on the Account button."})),e.appendChild(y("img",{classList:["oak-instruction-img"],src:"./Assets/UI/OAKTutorial1.jpg"})),e.appendChild(y("p",{classList:["oak-instructions-text"],innerHTML:'Step 2: Select "Open Data API" at the bottom right of the account screen.'})),e.appendChild(y("img",{classList:["oak-instruction-img"],src:"./Assets/UI/OAKTutorial2.jpg"})),e.appendChild(y("p",{classList:["oak-instructions-text"],innerHTML:'Step 3: Generate a key and copy that in to the above text field. It should start with "oak_". Then click "Start" to begin!'})),e.appendChild(y("img",{classList:["oak-instruction-img"],src:"./Assets/UI/OAKTutorial3.jpg"})),e.appendChild(y("p",{classList:["oak-instructions-text"],innerHTML:'You can read more about the Open Data API here: <a href="https://ninja.kiwi/opendatafaq" target="_blank", style="color:white";>Open Data API Article</a><br><br>Privacy Note: This app does not store any data being sent to or retrieved from Ninja Kiwi\'s Open Data API outside of your browser/device. The localStorage browser feature is used to prevent users from having to re-enter their OAK token every time they visit the site. If you would like to delete this stored data, you can do so by clicking the "X" on the profile you would like to delete on this homepage or clearing your browsing data.'})),g({header:"OAK Instructions",content:e}),e}function _(e,t,n){if(isErrorModalOpen&&!n)return;let a=document.createElement("div");a.classList.add("error-modal-overlay"),document.body.appendChild(a);let o=document.createElement("div");o.id="error-modal",o.classList.add("error-modal"),a.appendChild(o);let s=document.createElement("div");s.id="error-modal-header",s.classList.add("error-modal-header"),o.appendChild(s);let i=document.createElement("img");i.id="error-modal-header-img",i.classList.add("error-modal-header-img"),i.src="./Assets/UI/BadConnectionBtn.png",s.appendChild(i);let r=document.createElement("p");r.classList.add("error-modal-header-text","black-outline"),r.innerHTML="Error",s.appendChild(r);let l=document.createElement("div");l.classList.add("error-modal-dummy"),s.appendChild(l);let d=document.createElement("div");d.id="error-modal-content",d.classList.add("error-modal-content"),d.innerHTML=""+e,o.appendChild(d);let c=document.createElement("div");if(c.classList.add("error-modal-content"),"Invalid user ID / Player Does not play this game"===e)c.innerHTML="Please try again or create a new Open Access Key.",o.appendChild(c);if("ratelimit"==t){let e=document.createElement("div");e.classList.add("error-toggle-div"),o.appendChild(e);let t=document.createElement("p");t.classList.add("maps-progress-coop-toggle-text","black-outline"),t.innerHTML="Manually Load Profiles: ",e.appendChild(t);let n=document.createElement("input");n.classList.add("maps-progress-coop-toggle-input"),n.type="checkbox",n.checked=preventRateLimiting,n.addEventListener("change",(()=>{n.checked?preventRateLimiting=!0:preventRateLimiting=!1})),e.appendChild(n)}let p=document.createElement("div");p.classList.add("error-modal-ok-button-div"),o.appendChild(p);let m=document.createElement("div");m.classList.add("start-button","modal-ok-button","black-outline"),m.innerHTML="OK",m.addEventListener("click",(()=>{isErrorModalOpen=!1,document.body.removeChild(a)})),p.appendChild(m);let u=document.createElement("img");u.classList.add("error-modal-close"),u.src="./Assets/UI/CloseBtn.png",u.addEventListener("click",(()=>{isErrorModalOpen=!1,document.body.removeChild(a)})),d.appendChild(u),isErrorModalOpen=!0}p.addEventListener("click",(()=>{m()})),document.querySelector(".header").prepend(p);const q=new Intl.RelativeTimeFormat("en",{style:"long"});function G(e){const t=e-Date.now(),n=Math.abs(t),a=36e5,o=24*a;let s,i;return n>=o?(s=Math.round(t/o),i="day"):n>=a?(s=Math.round(t/a),i="hour"):(s=Math.round(t/6e4),i="minute"),q.format(s,i)}